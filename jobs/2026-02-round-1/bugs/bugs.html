<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FHIRsmith tx-compare Bug Report</title>
<style>
:root {
  --bg: #ffffff;
  --bg-surface: #f6f8fa;
  --bg-card: #ffffff;
  --border: #d1d9e0;
  --border-light: #e8ecf0;
  --text: #1f2328;
  --text-secondary: #59636e;
  --text-muted: #818b98;
  --shadow: 0 1px 3px rgba(0,0,0,0.08), 0 1px 2px rgba(0,0,0,0.04);
  --shadow-hover: 0 4px 12px rgba(0,0,0,0.1), 0 2px 4px rgba(0,0,0,0.06);
  --radius: 8px;
  --radius-sm: 6px;
  --font: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans", Helvetica, Arial, sans-serif;
  --font-mono: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace;

  --pill-tx-bg: #ccfbf1; --pill-tx-fg: #115e59; --pill-tx-border: #5eead4;
  --pill-default-bg: #f3f4f6; --pill-default-fg: #4b5563; --pill-default-border: #d1d5db;

  --status-open-bg: #dcfce7; --status-open-fg: #166534; --status-open-border: #86efac;
  --status-closed-bg: #f3f4f6; --status-closed-fg: #6b7280; --status-closed-border: #d1d5db;
}

@media (prefers-color-scheme: dark) {
  :root {
    --bg: #0d1117;
    --bg-surface: #161b22;
    --bg-card: #1c2128;
    --border: #30363d;
    --border-light: #21262d;
    --text: #e6edf3;
    --text-secondary: #8b949e;
    --text-muted: #6e7681;
    --shadow: 0 1px 3px rgba(0,0,0,0.3), 0 1px 2px rgba(0,0,0,0.2);
    --shadow-hover: 0 4px 12px rgba(0,0,0,0.4), 0 2px 4px rgba(0,0,0,0.3);

    --pill-tx-bg: #042f2e; --pill-tx-fg: #5eead4; --pill-tx-border: #134e4a;
    --pill-default-bg: #1f2937; --pill-default-fg: #9ca3af; --pill-default-border: #374151;

    --status-open-bg: #052e16; --status-open-fg: #86efac; --status-open-border: #14532d;
    --status-closed-bg: #1f2937; --status-closed-fg: #9ca3af; --status-closed-border: #374151;
  }
}

*, *::before, *::after { box-sizing: border-box; }

body {
  font-family: var(--font);
  background: var(--bg);
  color: var(--text);
  margin: 0;
  padding: 0;
  line-height: 1.6;
}

.container {
  max-width: 960px;
  margin: 0 auto;
  padding: 24px 16px;
}

h1 {
  font-size: 24px;
  font-weight: 700;
  margin: 0 0 4px 0;
}

.subtitle {
  color: var(--text-muted);
  font-size: 14px;
  margin: 0 0 24px 0;
}

.stats-bar {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 20px;
  padding: 16px;
  background: var(--bg-surface);
  border: 1px solid var(--border-light);
  border-radius: var(--radius);
}

.stat {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 13px;
  color: var(--text-secondary);
  padding: 4px 10px;
  border-radius: var(--radius-sm);
  background: var(--bg-card);
  border: 1px solid var(--border-light);
}

.stat-value {
  font-weight: 700;
  color: var(--text);
  font-size: 15px;
}

.stat-divider {
  width: 1px;
  height: 24px;
  background: var(--border);
  margin: 0 4px;
}

.filter-bar {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-bottom: 20px;
  align-items: center;
}

.search-box {
  flex: 1;
  min-width: 200px;
  padding: 8px 12px;
  font-size: 14px;
  font-family: var(--font);
  background: var(--bg-card);
  color: var(--text);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  outline: none;
  transition: border-color 0.15s, box-shadow 0.15s;
}

.search-box:focus {
  border-color: #3b82f6;
  box-shadow: 0 0 0 3px rgba(59,130,246,0.15);
}

.search-box::placeholder {
  color: var(--text-muted);
}

.filter-pills {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.filter-pill {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 4px 10px;
  font-size: 12px;
  font-weight: 600;
  border-radius: 999px;
  cursor: pointer;
  user-select: none;
  transition: opacity 0.15s, transform 0.1s;
  border: 1px solid var(--pill-default-border);
  background: var(--pill-default-bg);
  color: var(--pill-default-fg);
}

.filter-pill[data-label="tx-compare"] {
  background: var(--pill-tx-bg);
  color: var(--pill-tx-fg);
  border-color: var(--pill-tx-border);
}

.filter-pill:hover {
  transform: translateY(-1px);
}

.filter-pill.dimmed {
  opacity: 0.35;
}

.filter-pill .count {
  font-weight: 400;
  opacity: 0.8;
}

.controls {
  display: flex;
  gap: 4px;
  margin-left: auto;
  flex-wrap: wrap;
}

.ctrl-btn {
  padding: 4px 10px;
  font-size: 12px;
  font-weight: 600;
  border-radius: var(--radius-sm);
  cursor: pointer;
  border: 1px solid var(--border);
  background: var(--bg-card);
  color: var(--text-secondary);
  font-family: var(--font);
  transition: background 0.15s, color 0.15s;
}

.ctrl-btn:hover {
  background: var(--bg-surface);
}

.ctrl-btn.active {
  background: var(--text);
  color: var(--bg);
  border-color: var(--text);
}

.bug-card {
  background: var(--bg-card);
  border: 1px solid var(--border-light);
  border-radius: var(--radius);
  margin-bottom: 8px;
  box-shadow: var(--shadow);
  transition: box-shadow 0.15s, border-color 0.15s;
  overflow: hidden;
}

.bug-card:hover {
  box-shadow: var(--shadow-hover);
  border-color: var(--border);
}

.bug-card.hidden {
  display: none;
}

.bug-header {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  padding: 12px 16px;
  cursor: pointer;
  user-select: none;
}

.bug-header:hover {
  background: var(--bg-surface);
}

.bug-expand-icon {
  flex-shrink: 0;
  width: 18px;
  height: 18px;
  margin-top: 2px;
  color: var(--text-muted);
  transition: transform 0.2s;
}

.bug-card.expanded .bug-expand-icon {
  transform: rotate(90deg);
}

.bug-info {
  flex: 1;
  min-width: 0;
}

.bug-title {
  font-size: 14px;
  font-weight: 600;
  line-height: 1.4;
  word-break: break-word;
}

.bug-meta {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 6px;
  margin-top: 6px;
}

.pill {
  display: inline-flex;
  align-items: center;
  padding: 1px 8px;
  font-size: 11px;
  font-weight: 600;
  border-radius: 999px;
  border: 1px solid;
  white-space: nowrap;
}

.pill-status-open {
  background: var(--status-open-bg);
  color: var(--status-open-fg);
  border-color: var(--status-open-border);
}

.pill-status-closed {
  background: var(--status-closed-bg);
  color: var(--status-closed-fg);
  border-color: var(--status-closed-border);
}

.pill-label {
  background: var(--pill-default-bg);
  color: var(--pill-default-fg);
  border-color: var(--pill-default-border);
}

.pill-label[data-label="tx-compare"] {
  background: var(--pill-tx-bg);
  color: var(--pill-tx-fg);
  border-color: var(--pill-tx-border);
}

.pill-impact {
  background: #fef3c7;
  color: #92400e;
  border-color: #fcd34d;
  font-family: var(--font-mono);
  font-size: 10px;
}

@media (prefers-color-scheme: dark) {
  .pill-impact {
    background: #3b2f0b;
    color: #fcd34d;
    border-color: #78350f;
  }
}

.bug-id {
  font-size: 11px;
  color: var(--text-muted);
  font-family: var(--font-mono);
}

.bug-date {
  font-size: 11px;
  color: var(--text-muted);
}

.bug-body {
  display: none;
  padding: 0 16px 16px 44px;
  border-top: 1px solid var(--border-light);
}

.bug-card.expanded .bug-body {
  display: block;
}

.bug-body h1, .bug-body h2, .bug-body h3,
.bug-body h4, .bug-body h5, .bug-body h6 {
  margin: 16px 0 8px 0;
  font-weight: 700;
  line-height: 1.3;
}

.bug-body h1 { font-size: 18px; }
.bug-body h2 { font-size: 16px; }
.bug-body h3 { font-size: 14px; }
.bug-body h4, .bug-body h5, .bug-body h6 { font-size: 13px; }

.bug-body p {
  margin: 8px 0;
  font-size: 13px;
  line-height: 1.65;
}

.bug-body ul, .bug-body ol {
  margin: 8px 0;
  padding-left: 24px;
  font-size: 13px;
}

.bug-body li {
  margin: 4px 0;
  line-height: 1.55;
}

.bug-body code {
  font-family: var(--font-mono);
  font-size: 12px;
  background: var(--bg-surface);
  padding: 2px 6px;
  border-radius: 4px;
  border: 1px solid var(--border-light);
}

.bug-body pre {
  background: var(--bg-surface);
  border: 1px solid var(--border-light);
  border-radius: var(--radius-sm);
  padding: 12px 16px;
  overflow-x: auto;
  margin: 12px 0;
}

.bug-body pre code {
  background: none;
  border: none;
  padding: 0;
  font-size: 12px;
  line-height: 1.5;
}

.bug-body hr {
  border: none;
  border-top: 1px solid var(--border-light);
  margin: 16px 0;
}

.bug-body strong { font-weight: 700; }
.bug-body em { font-style: italic; }
.bug-body a { color: #3b82f6; text-decoration: none; }
.bug-body a:hover { text-decoration: underline; }

.no-results {
  text-align: center;
  padding: 48px 16px;
  color: var(--text-muted);
  font-size: 14px;
}

.no-results.hidden {
  display: none;
}

.pipeline-bar {
  display: flex;
  gap: 0;
  margin-bottom: 12px;
  border-radius: var(--radius);
  overflow: hidden;
  border: 1px solid var(--border-light);
  font-size: 12px;
  line-height: 1.3;
}

.pipeline-bar:empty {
  display: none;
}

.pipeline-seg {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 10px 8px;
  min-width: 0;
  text-align: center;
}

.pipeline-seg .seg-value {
  font-weight: 700;
  font-size: 16px;
  font-family: var(--font-mono);
}

.pipeline-seg .seg-label {
  font-size: 10px;
  opacity: 0.8;
  margin-top: 2px;
}

.seg-perfect { background: #dcfce7; color: #166534; }
.seg-equiv { background: #dbeafe; color: #1e40af; }
.seg-known { background: #fef3c7; color: #92400e; }
.seg-untriaged { background: #fee2e2; color: #991b1b; }

@media (prefers-color-scheme: dark) {
  .seg-perfect { background: #052e16; color: #86efac; }
  .seg-equiv { background: #172554; color: #93c5fd; }
  .seg-known { background: #3b2f0b; color: #fcd34d; }
  .seg-untriaged { background: #450a0a; color: #fca5a5; }
}

@media (max-width: 640px) {
  .container { padding: 16px 12px; }
  .stats-bar { padding: 12px; gap: 6px; }
  .stat-divider { display: none; }
  .filter-bar { flex-direction: column; }
  .search-box { min-width: 100%; }
  .bug-body { padding: 0 12px 12px 12px; }
  .bug-header { padding: 10px 12px; }
  .controls { margin-left: 0; }
  .pipeline-bar { font-size: 10px; }
  .pipeline-seg .seg-value { font-size: 13px; }
}
</style>
</head>
<body>
<div class="container">
  <h1>FHIRsmith tx-compare Bugs</h1>
  <p class="subtitle">Generated from git-bug &middot; <span id="gen-time"></span></p>

  <div class="pipeline-bar" id="pipeline-bar"></div>
  <div class="stats-bar" id="stats-bar"></div>

  <div class="filter-bar">
    <input type="text" class="search-box" id="search" placeholder="Search bugs by title or body..." autocomplete="off">
    <div class="filter-pills" id="label-filters"></div>
    <div class="controls">
      <button class="ctrl-btn" id="expand-all-btn" onclick="toggleExpandAll()">Expand all</button>
      <span class="stat-divider"></span>
      <button class="ctrl-btn active" data-status="all">All</button>
      <button class="ctrl-btn" data-status="open">Open</button>
      <button class="ctrl-btn" data-status="closed">Closed</button>
      <span class="stat-divider"></span>
      <button class="ctrl-btn sort-btn active" data-sort="impact">Impact</button>
      <button class="ctrl-btn sort-btn" data-sort="date">Date</button>
      <button class="ctrl-btn sort-btn" data-sort="title">Title</button>
    </div>
  </div>

  <div id="bug-list"></div>
  <div class="no-results hidden" id="no-results">No bugs match your filters.</div>
</div>

<script>
const BUGS = [{"id": "d1b7d3b", "title": "Dev $expand echoes includeDefinition=false parameter in expansion", "status": "open", "labels": ["content-differs", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 11:31", "date_iso": "2026-02-07T11:31:56-06:00", "body_md": "Records-Impacted: 677\nTolerance-ID: expand-dev-includeDefinition-param\nRecord-ID: 2bbd9519-3a6b-4f55-8309-745d9f1b16a7\n\n## Repro\n\n```bash\n# Prod — does NOT echo includeDefinition=false (omits default-value parameter)\ncurl -s \"https://tx.fhir.org/r4/ValueSet/\\$expand\" \\\n  -H \"Accept: application/fhir+json\" \\\n  -H \"Content-Type: application/fhir+json\" \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/ValueSet/observation-status\"},{\"name\":\"excludeNested\",\"valueBoolean\":true},{\"name\":\"includeDefinition\",\"valueBoolean\":false}]}'\n\n# Dev — echoes includeDefinition=false in expansion.parameter\ncurl -s \"https://tx-dev.fhir.org/r4/ValueSet/\\$expand\" \\\n  -H \"Accept: application/fhir+json\" \\\n  -H \"Content-Type: application/fhir+json\" \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/ValueSet/observation-status\"},{\"name\":\"excludeNested\",\"valueBoolean\":true},{\"name\":\"includeDefinition\",\"valueBoolean\":false}]}'\n```\n\nProd expansion.parameter: `[excludeNested, used-codesystem]` — no includeDefinition.\nDev expansion.parameter: `[excludeNested, includeDefinition, used-codesystem]` — echoes `{\"name\":\"includeDefinition\",\"valueBoolean\":false}`.\n\nDev $expand responses include an extra `includeDefinition` parameter (value: false) in the expansion.parameter array. Prod does not include this parameter.\n\n## What differs\n\nIn 677 of the 893 $expand delta records, dev includes `{\"name\":\"includeDefinition\",\"valueBoolean\":false}` in the `expansion.parameter` array. Prod omits this parameter entirely.\n\nThe `includeDefinition` parameter is an input parameter to the $expand operation. While it's valid to echo input parameters in the expansion.parameter array, prod doesn't do it for this parameter (presumably because false is the default). This is a behavioral difference — not a conformance violation per se, but a real difference in what the servers return.\n\n## How to reproduce\n\n```bash\ngrep '\"op\":\"expand\"' jobs/2026-02-round-1/results/deltas/deltas.ndjson | python3 -c \"\nimport json, sys\nfor line in sys.stdin:\n    rec = json.loads(line)\n    dev = json.loads(rec.get('devBody','{}'))\n    params = dev.get('expansion',{}).get('parameter',[])\n    if any(p.get('name')=='includeDefinition' for p in params): print(rec['id'])\n\" | wc -l\n# Returns 677\n```\n\n## Example\n\n**Dev** includes extra parameter:\n```json\n\"parameter\": [\n  {\"name\":\"excludeNested\",\"valueBoolean\":true},\n  {\"name\":\"includeDefinition\",\"valueBoolean\":false},\n  {\"name\":\"offset\",\"valueInteger\":0},\n  ...\n]\n```\n\n**Prod** omits it:\n```json\n\"parameter\": [\n  {\"name\":\"excludeNested\",\"valueBoolean\":true},\n  {\"name\":\"offset\",\"valueInteger\":0},\n  ...\n]\n```", "body_html": "<p>Records-Impacted: 677<br>\nTolerance-ID: expand-dev-includeDefinition-param<br>\nRecord-ID: 2bbd9519-3a6b-4f55-8309-745d9f1b16a7</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod — does NOT echo includeDefinition=false (omits default-value parameter)\ncurl -s &quot;https://tx.fhir.org/r4/ValueSet/\\$expand&quot; \\\n  -H &quot;Accept: application/fhir+json&quot; \\\n  -H &quot;Content-Type: application/fhir+json&quot; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/ValueSet/observation-status&quot;},{&quot;name&quot;:&quot;excludeNested&quot;,&quot;valueBoolean&quot;:true},{&quot;name&quot;:&quot;includeDefinition&quot;,&quot;valueBoolean&quot;:false}]}&#x27;\n\n# Dev — echoes includeDefinition=false in expansion.parameter\ncurl -s &quot;https://tx-dev.fhir.org/r4/ValueSet/\\$expand&quot; \\\n  -H &quot;Accept: application/fhir+json&quot; \\\n  -H &quot;Content-Type: application/fhir+json&quot; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/ValueSet/observation-status&quot;},{&quot;name&quot;:&quot;excludeNested&quot;,&quot;valueBoolean&quot;:true},{&quot;name&quot;:&quot;includeDefinition&quot;,&quot;valueBoolean&quot;:false}]}&#x27;</code></pre>\n<p>Prod expansion.parameter: <code>[excludeNested, used-codesystem]</code> — no includeDefinition.<br>\nDev expansion.parameter: <code>[excludeNested, includeDefinition, used-codesystem]</code> — echoes <code>{&quot;name&quot;:&quot;includeDefinition&quot;,&quot;valueBoolean&quot;:false}</code>.</p>\n<p>Dev $expand responses include an extra <code>includeDefinition</code> parameter (value: false) in the expansion.parameter array. Prod does not include this parameter.</p>\n<h2>What differs</h2>\n<p>In 677 of the 893 $expand delta records, dev includes <code>{&quot;name&quot;:&quot;includeDefinition&quot;,&quot;valueBoolean&quot;:false}</code> in the <code>expansion.parameter</code> array. Prod omits this parameter entirely.</p>\n<p>The <code>includeDefinition</code> parameter is an input parameter to the $expand operation. While it&#x27;s valid to echo input parameters in the expansion.parameter array, prod doesn&#x27;t do it for this parameter (presumably because false is the default). This is a behavioral difference — not a conformance violation per se, but a real difference in what the servers return.</p>\n<h2>How to reproduce</h2>\n<pre><code class=\"lang-bash\">grep &#x27;&quot;op&quot;:&quot;expand&quot;&#x27; jobs/2026-02-round-1/results/deltas/deltas.ndjson | python3 -c &quot;\nimport json, sys\nfor line in sys.stdin:\n    rec = json.loads(line)\n    dev = json.loads(rec.get(&#x27;devBody&#x27;,&#x27;{}&#x27;))\n    params = dev.get(&#x27;expansion&#x27;,{}).get(&#x27;parameter&#x27;,[])\n    if any(p.get(&#x27;name&#x27;)==&#x27;includeDefinition&#x27; for p in params): print(rec[&#x27;id&#x27;])\n&quot; | wc -l\n# Returns 677</code></pre>\n<h2>Example</h2>\n<p><strong>Dev</strong> includes extra parameter:</p>\n<pre><code class=\"lang-json\">&quot;parameter&quot;: [\n  {&quot;name&quot;:&quot;excludeNested&quot;,&quot;valueBoolean&quot;:true},\n  {&quot;name&quot;:&quot;includeDefinition&quot;,&quot;valueBoolean&quot;:false},\n  {&quot;name&quot;:&quot;offset&quot;,&quot;valueInteger&quot;:0},\n  ...\n]</code></pre>\n<p><strong>Prod</strong> omits it:</p>\n<pre><code class=\"lang-json\">&quot;parameter&quot;: [\n  {&quot;name&quot;:&quot;excludeNested&quot;,&quot;valueBoolean&quot;:true},\n  {&quot;name&quot;:&quot;offset&quot;,&quot;valueInteger&quot;:0},\n  ...\n]</code></pre>", "impact": 677}, {"id": "4233647", "title": "Searchset Bundle formatting: empty entry array, extra pagination links, absolute URLs", "status": "open", "labels": ["P6", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 10:54", "date_iso": "2026-02-07T10:54:51-06:00", "body_md": "Records-Impacted: 491\nTolerance-ID: searchset-bundle-format\nRecord-ID: c97f36a4-973b-42c5-8b6d-58464195cfd5\n\n## Repro\n\n```bash\n# Prod\ncurl -s 'https://tx.fhir.org/r4/ValueSet?_format=json&url=http%3A%2F%2Fwww.rsna.org%2FRadLex_Playbook.aspx' \\\n  -H 'Accept: application/fhir+json'\n\n# Dev\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet?_format=json&url=http%3A%2F%2Fwww.rsna.org%2FRadLex_Playbook.aspx' \\\n  -H 'Accept: application/fhir+json'\n```\n\nProd returns a searchset Bundle with `total: 0`, no `entry` field, a single `self` link with a relative URL, and server-generated `id`/`meta.lastUpdated`. Dev returns a searchset Bundle with `total: 0`, an empty `entry: []` array, three links (`self`/`first`/`last`) with absolute URLs and `_offset=0`, and no `id` or `meta`.\n\n## What differs\n\nDev's searchset Bundle responses differ from prod in several ways:\n\n1. **`entry: []` on empty results**: When a search returns no results (total: 0), dev includes `entry: []` (an empty array). Prod omits the entry field entirely. Empty arrays violate FHIR's general rule that arrays, if present, must be non-empty.\n\n2. **Extra pagination link relations**: Dev returns `self`, `first`, and `last` link relations. Prod returns only `self`. This applies to both empty and non-empty search results.\n\n3. **Absolute vs relative link URLs**: Dev uses absolute URLs with full host prefix (e.g., `http://tx.fhir.org/r4/ValueSet?...&_offset=0`). Prod uses relative URLs (e.g., `ValueSet?&url=...`). Dev also appends `_offset=0` to search links.\n\n4. **Server-generated metadata**: Prod includes `id` and `meta.lastUpdated` on searchset Bundles. Dev omits these. (This is server-generated transient metadata and is the least significant difference.)\n\n## How widespread\n\nAffects all searchset Bundle responses for ValueSet and CodeSystem searches:\n- 337 empty ValueSet search Bundles\n- 154 empty CodeSystem search Bundles\n- 7 non-empty searchset Bundles (these also have the extra links, and may have other substantive differences like total count disagreements)\n\nTotal: **498 records** in the deltas file.\n\nSearch used: Parsed all records with `ValueSet?` or `CodeSystem?` in the URL where prodBody contains a Bundle with type \"searchset\".\n\n## Representative record IDs\n\n- `c97f36a4-973b-42c5-8b6d-58464195cfd5` (empty ValueSet search, RadLex Playbook)\n- `4ab7655f-015d-4f44-b184-5ba0fd256926` (empty ValueSet search, DICOM)\n- `640875e4-3839-40d1-aaa1-0bf79bef77f2` (non-empty CodeSystem search, USPS)", "body_html": "<p>Records-Impacted: 491<br>\nTolerance-ID: searchset-bundle-format<br>\nRecord-ID: c97f36a4-973b-42c5-8b6d-58464195cfd5</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod\ncurl -s &#x27;https://tx.fhir.org/r4/ValueSet?_format=json&amp;url=http%3A%2F%2Fwww.rsna.org%2FRadLex_Playbook.aspx&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;\n\n# Dev\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet?_format=json&amp;url=http%3A%2F%2Fwww.rsna.org%2FRadLex_Playbook.aspx&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;</code></pre>\n<p>Prod returns a searchset Bundle with <code>total: 0</code>, no <code>entry</code> field, a single <code>self</code> link with a relative URL, and server-generated <code>id</code>/<code>meta.lastUpdated</code>. Dev returns a searchset Bundle with <code>total: 0</code>, an empty <code>entry: []</code> array, three links (<code>self</code>/<code>first</code>/<code>last</code>) with absolute URLs and <code>_offset=0</code>, and no <code>id</code> or <code>meta</code>.</p>\n<h2>What differs</h2>\n<p>Dev&#x27;s searchset Bundle responses differ from prod in several ways:</p>\n<ol><li>**<code>entry: []</code> on empty results**: When a search returns no results (total: 0), dev includes <code>entry: []</code> (an empty array). Prod omits the entry field entirely. Empty arrays violate FHIR&#x27;s general rule that arrays, if present, must be non-empty.</li></ol>\n<ol><li><strong>Extra pagination link relations</strong>: Dev returns <code>self</code>, <code>first</code>, and <code>last</code> link relations. Prod returns only <code>self</code>. This applies to both empty and non-empty search results.</li></ol>\n<ol><li><strong>Absolute vs relative link URLs</strong>: Dev uses absolute URLs with full host prefix (e.g., <code>http://tx.fhir.org/r4/ValueSet?...&amp;_offset=0</code>). Prod uses relative URLs (e.g., <code>ValueSet?&amp;url=...</code>). Dev also appends <code>_offset=0</code> to search links.</li></ol>\n<ol><li><strong>Server-generated metadata</strong>: Prod includes <code>id</code> and <code>meta.lastUpdated</code> on searchset Bundles. Dev omits these. (This is server-generated transient metadata and is the least significant difference.)</li></ol>\n<h2>How widespread</h2>\n<p>Affects all searchset Bundle responses for ValueSet and CodeSystem searches:</p>\n<ul><li>337 empty ValueSet search Bundles</li><li>154 empty CodeSystem search Bundles</li><li>7 non-empty searchset Bundles (these also have the extra links, and may have other substantive differences like total count disagreements)</li></ul>\n<p>Total: <strong>498 records</strong> in the deltas file.</p>\n<p>Search used: Parsed all records with <code>ValueSet?</code> or <code>CodeSystem?</code> in the URL where prodBody contains a Bundle with type &quot;searchset&quot;.</p>\n<h2>Representative record IDs</h2>\n<ul><li><code>c97f36a4-973b-42c5-8b6d-58464195cfd5</code> (empty ValueSet search, RadLex Playbook)</li><li><code>4ab7655f-015d-4f44-b184-5ba0fd256926</code> (empty ValueSet search, DICOM)</li><li><code>640875e4-3839-40d1-aaa1-0bf79bef77f2</code> (non-empty CodeSystem search, USPS)</li></ul>", "impact": 491}, {"id": "1c145d2", "title": "Dev returns 404 instead of 422 for  when referenced CodeSystem is not found", "status": "open", "labels": ["P4", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 11:00", "date_iso": "2026-02-07T11:00:00-06:00", "body_md": "Records-Impacted: 296\nTolerance-ID: expand-422-vs-404-codesystem-not-found\nRecord-ID: eee2c985-52e0-4520-b4e4-01766ede5a7d\n\n## Repro\n\n```bash\n# Prod (returns 422)\ncurl -s -w '\\nHTTP Status: %{http_code}\\n' 'https://tx.fhir.org/r4/ValueSet/$expand' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"compose\":{\"include\":[{\"system\":\"http://ontariohealth.ca/fhir/questionnaire/CodeSystem/breastSiteCodes\"}]}}}]}'\n\n# Dev (returns 404)\ncurl -s -w '\\nHTTP Status: %{http_code}\\n' 'https://tx-dev.fhir.org/r4/ValueSet/$expand' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"compose\":{\"include\":[{\"system\":\"http://ontariohealth.ca/fhir/questionnaire/CodeSystem/breastSiteCodes\"}]}}}]}'\n```\n\nProd returns HTTP 422, dev returns HTTP 404. Both return the same OperationOutcome error: \"A definition for CodeSystem '...' could not be found, so the value set cannot be expanded\".\n\n## What differs\n\nWhen a ValueSet $expand fails because a referenced CodeSystem definition cannot be found, prod returns HTTP 422 (Unprocessable Entity) while dev returns HTTP 404 (Not Found). The OperationOutcome error message is identical on both sides: \"A definition for CodeSystem '...' could not be found, so the value set cannot be expanded\". The issue code is `not-found` in both cases.\n\nAdditionally, dev includes `location: [null]` and `expression: [null]` arrays in the OperationOutcome issue (prod omits these), and dev omits the `text` narrative element that prod includes. These are secondary cosmetic differences; the primary issue is the status code mismatch.\n\n## How widespread\n\n296 records in this comparison batch. All are POST /r4/ValueSet/$expand operations where the error message contains \"could not be found, so the value set cannot be expanded\".\n\nSearch: `grep '\"prodStatus\":422,\"devStatus\":404' jobs/2026-02-round-1/results/deltas/deltas.ndjson | wc -l` → 296\n\nAll 296 have:\n- Operation: POST /r4/ValueSet/$expand\n- Prod status: 422\n- Dev status: 404\n- OperationOutcome issue code: not-found\n- Identical error message text\n\n## What the tolerance covers\n\nTolerance ID: `expand-422-vs-404-codesystem-not-found`\nMatches: POST /r4/ValueSet/$expand where prodStatus=422 and devStatus=404, and the OperationOutcome contains \"could not be found, so the value set cannot be expanded\".\nNormalizes: status code difference, strips null location/expression arrays from dev, strips text narrative from prod. Compares remaining OperationOutcome content.\nAffects: 296 records.\n\n## Representative record\n\nID: eee2c985-52e0-4520-b4e4-01766ede5a7d", "body_html": "<p>Records-Impacted: 296<br>\nTolerance-ID: expand-422-vs-404-codesystem-not-found<br>\nRecord-ID: eee2c985-52e0-4520-b4e4-01766ede5a7d</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod (returns 422)\ncurl -s -w &#x27;\\nHTTP Status: %{http_code}\\n&#x27; &#x27;https://tx.fhir.org/r4/ValueSet/$expand&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;http://ontariohealth.ca/fhir/questionnaire/CodeSystem/breastSiteCodes&quot;}]}}}]}&#x27;\n\n# Dev (returns 404)\ncurl -s -w &#x27;\\nHTTP Status: %{http_code}\\n&#x27; &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;http://ontariohealth.ca/fhir/questionnaire/CodeSystem/breastSiteCodes&quot;}]}}}]}&#x27;</code></pre>\n<p>Prod returns HTTP 422, dev returns HTTP 404. Both return the same OperationOutcome error: &quot;A definition for CodeSystem &#x27;...&#x27; could not be found, so the value set cannot be expanded&quot;.</p>\n<h2>What differs</h2>\n<p>When a ValueSet $expand fails because a referenced CodeSystem definition cannot be found, prod returns HTTP 422 (Unprocessable Entity) while dev returns HTTP 404 (Not Found). The OperationOutcome error message is identical on both sides: &quot;A definition for CodeSystem &#x27;...&#x27; could not be found, so the value set cannot be expanded&quot;. The issue code is <code>not-found</code> in both cases.</p>\n<p>Additionally, dev includes <code>location: [null]</code> and <code>expression: [null]</code> arrays in the OperationOutcome issue (prod omits these), and dev omits the <code>text</code> narrative element that prod includes. These are secondary cosmetic differences; the primary issue is the status code mismatch.</p>\n<h2>How widespread</h2>\n<p>296 records in this comparison batch. All are POST /r4/ValueSet/$expand operations where the error message contains &quot;could not be found, so the value set cannot be expanded&quot;.</p>\n<p>Search: <code>grep &#x27;&quot;prodStatus&quot;:422,&quot;devStatus&quot;:404&#x27; jobs/2026-02-round-1/results/deltas/deltas.ndjson | wc -l</code> → 296</p>\n<p>All 296 have:</p>\n<ul><li>Operation: POST /r4/ValueSet/$expand</li><li>Prod status: 422</li><li>Dev status: 404</li><li>OperationOutcome issue code: not-found</li><li>Identical error message text</li></ul>\n<h2>What the tolerance covers</h2>\n<p>Tolerance ID: <code>expand-422-vs-404-codesystem-not-found</code><br>\nMatches: POST /r4/ValueSet/$expand where prodStatus=422 and devStatus=404, and the OperationOutcome contains &quot;could not be found, so the value set cannot be expanded&quot;.<br>\nNormalizes: status code difference, strips null location/expression arrays from dev, strips text narrative from prod. Compares remaining OperationOutcome content.<br>\nAffects: 296 records.</p>\n<h2>Representative record</h2>\n<p>ID: eee2c985-52e0-4520-b4e4-01766ede5a7d</p>", "impact": 296}, {"id": "17ad254", "title": "UCUM -code: dev returns human-readable display instead of code-as-display", "status": "open", "labels": ["content-differs", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 11:19", "date_iso": "2026-02-07T11:19:46-06:00", "body_md": "Records-Impacted: 220\nTolerance-ID: ucum-display-code-as-display\nRecord-ID: 6ae99904-538b-4241-89db-b15eab6e637e\n\n## Repro\n\n```bash\n# Prod\ncurl -s 'https://tx.fhir.org/r4/CodeSystem/$validate-code?url=http://unitsofmeasure.org&code=%5Bin_i%5D' \\\n  -H 'Accept: application/fhir+json'\n\n# Dev\ncurl -s 'https://tx-dev.fhir.org/r4/CodeSystem/$validate-code?url=http://unitsofmeasure.org&code=%5Bin_i%5D' \\\n  -H 'Accept: application/fhir+json'\n```\n\nProd returns `display: \"[in_i]\"` (the UCUM code itself), dev returns `display: \"(inch)\"` (human-readable name).\n\n## What differs\n\nFor UCUM ($validate-code) operations, prod returns the UCUM code itself as the `display` parameter (e.g., `[in_i]`, `[lb_av]`, `mg`, `%`), while dev returns a human-readable name (e.g., `(inch)`, `(pound)`, `(milligram)`, `(percent)`).\n\nPer the FHIR UCUM guidance (https://terminology.hl7.org/UCUM.html): \"No standardized display value is defined. The UCUM code itself is used directly as the display.\" Prod follows this convention; dev does not.\n\nAll other parameters (result, system, code, version) agree between prod and dev. Display is the only difference.\n\nExamples:\n- code=[in_i]: prod display=\"[in_i]\", dev display=\"(inch)\"\n- code=[lb_av]: prod display=\"[lb_av]\", dev display=\"(pound)\"\n- code=[degF]: prod display=\"[degF]\", dev display=\"(degree Fahrenheit)\"\n- code=mg: prod display=\"mg\", dev display=\"(milligram)\"\n- code=%: prod display=\"%\", dev display=\"(percent)\"\n- code=mm[Hg]: prod display=\"mm[Hg]\", dev display=\"(millimeter of mercury column)\"\n- code=kg/m2: prod display=\"kg/m2\", dev display=\"(kilogram) / (meter ^ 2)\"\n\n## How widespread\n\n220 records in deltas.ndjson match this pattern. All are validate-code operations on system http://unitsofmeasure.org where display is the only diff. Found with:\n\n  grep '\"param\":\"display\"' deltas.ndjson | grep 'unitsofmeasure.org' | wc -l\n\nIn all 220 cases, prod's display equals the UCUM code exactly.\n\n## Tolerance\n\nTolerance ID: ucum-display-code-as-display\nMatches: validate-code operations on http://unitsofmeasure.org where display values differ\nNormalizes both sides to prod's display value (the code itself, per FHIR convention)\n\n## Representative record\n\n6ae99904-538b-4241-89db-b15eab6e637e (POST /r4/ValueSet/$validate-code, code=[in_i])", "body_html": "<p>Records-Impacted: 220<br>\nTolerance-ID: ucum-display-code-as-display<br>\nRecord-ID: 6ae99904-538b-4241-89db-b15eab6e637e</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod\ncurl -s &#x27;https://tx.fhir.org/r4/CodeSystem/$validate-code?url=http://unitsofmeasure.org&amp;code=%5Bin_i%5D&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;\n\n# Dev\ncurl -s &#x27;https://tx-dev.fhir.org/r4/CodeSystem/$validate-code?url=http://unitsofmeasure.org&amp;code=%5Bin_i%5D&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;</code></pre>\n<p>Prod returns <code>display: &quot;[in_i]&quot;</code> (the UCUM code itself), dev returns <code>display: &quot;(inch)&quot;</code> (human-readable name).</p>\n<h2>What differs</h2>\n<p>For UCUM ($validate-code) operations, prod returns the UCUM code itself as the <code>display</code> parameter (e.g., <code>[in_i]</code>, <code>[lb_av]</code>, <code>mg</code>, <code>%</code>), while dev returns a human-readable name (e.g., <code>(inch)</code>, <code>(pound)</code>, <code>(milligram)</code>, <code>(percent)</code>).</p>\n<p>Per the FHIR UCUM guidance (https://terminology.hl7.org/UCUM.html): &quot;No standardized display value is defined. The UCUM code itself is used directly as the display.&quot; Prod follows this convention; dev does not.</p>\n<p>All other parameters (result, system, code, version) agree between prod and dev. Display is the only difference.</p>\n<p>Examples:</p>\n<ul><li>code=[in_i]: prod display=&quot;[in_i]&quot;, dev display=&quot;(inch)&quot;</li><li>code=[lb_av]: prod display=&quot;[lb_av]&quot;, dev display=&quot;(pound)&quot;</li><li>code=[degF]: prod display=&quot;[degF]&quot;, dev display=&quot;(degree Fahrenheit)&quot;</li><li>code=mg: prod display=&quot;mg&quot;, dev display=&quot;(milligram)&quot;</li><li>code=%: prod display=&quot;%&quot;, dev display=&quot;(percent)&quot;</li><li>code=mm[Hg]: prod display=&quot;mm[Hg]&quot;, dev display=&quot;(millimeter of mercury column)&quot;</li><li>code=kg/m2: prod display=&quot;kg/m2&quot;, dev display=&quot;(kilogram) / (meter ^ 2)&quot;</li></ul>\n<h2>How widespread</h2>\n<p>220 records in deltas.ndjson match this pattern. All are validate-code operations on system http://unitsofmeasure.org where display is the only diff. Found with:</p>\n<p>grep &#x27;&quot;param&quot;:&quot;display&quot;&#x27; deltas.ndjson | grep &#x27;unitsofmeasure.org&#x27; | wc -l</p>\n<p>In all 220 cases, prod&#x27;s display equals the UCUM code exactly.</p>\n<h2>Tolerance</h2>\n<p>Tolerance ID: ucum-display-code-as-display<br>\nMatches: validate-code operations on http://unitsofmeasure.org where display values differ<br>\nNormalizes both sides to prod&#x27;s display value (the code itself, per FHIR convention)</p>\n<h2>Representative record</h2>\n<p>6ae99904-538b-4241-89db-b15eab6e637e (POST /r4/ValueSet/$validate-code, code=[in_i])</p>", "impact": 220}, {"id": "9376cf0", "title": "Dev crashes (500) on $expand when CodeSystem content mode prevents expansion", "status": "open", "labels": ["dev-crash-on-error", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 11:38", "date_iso": "2026-02-07T11:38:12-06:00", "body_md": "Records-Impacted: 186\nTolerance-ID: expand-dev-crash-on-error\nRecord-ID: f39ee3d3-8249-4e0c-a8a6-c2d5d1ffdcbd\n\n## Repro\n\n```bash\n# Prod (returns 422 with clear error: \"is a fragment\")\ncurl -s -w '\\nHTTP_STATUS:%{http_code}\\n' 'https://tx.fhir.org/r4/ValueSet/$expand' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"compose\":{\"include\":[{\"system\":\"http://hl7.org/fhir/sid/icd-9-cm\"}]}}}]}'\n\n# Dev (returns 500 with JS source code leak: \"is a contentMode() { return this.codeSystem.content; }\")\ncurl -s -w '\\nHTTP_STATUS:%{http_code}\\n' 'https://tx-dev.fhir.org/r4/ValueSet/$expand' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"compose\":{\"include\":[{\"system\":\"http://hl7.org/fhir/sid/icd-9-cm\"}]}}}]}'\n```\n\nProd returns HTTP 422 with `\"is a fragment, so this expansion is not permitted\"`. Dev returns HTTP 500 with `\"is a contentMode() {\\r\\n    return this.codeSystem.content;\\r\\n  }, so this expansion is not permitted\"` — a JavaScript function body leaked into the error message.\n\n## What differs\n\nWhen a $expand request fails because a CodeSystem's content mode (fragment, not-present) prevents expansion, prod returns HTTP 422 with a clear OperationOutcome. Dev returns HTTP 500 with an error message that leaks internal implementation details.\n\nThree distinct error sub-patterns in dev:\n\n1. **Source code leak in error text** (178 records): Dev interpolates a JavaScript function body into the error message. Instead of \"is a fragment, so this expansion is not permitted\", dev returns \"is a contentMode() {\\r\\n    return this.codeSystem.content;\\r\\n  }, so this expansion is not permitted\". The `.contentMode` property accessor is being `.toString()`'d instead of invoked.\n\n2. **exp.addParamUri is not a function** (4 records): Dev crashes with a JS TypeError when attempting to expand ValueSets referencing CodeSystem `https://codesystem.x12.org/005010/1365`.\n\n3. **TerminologyError is not a constructor** (4 records): Dev crashes with a JS TypeError when attempting to expand ValueSets referencing `http://terminology.hl7.org/CodeSystem/v2-0360|2.7`.\n\nAdditional differences in all 186 records:\n- HTTP status: prod=422, dev=500\n- Issue code: prod uses `invalid`, dev uses `business-rule`\n- Dev includes `location: [null]` and `expression: [null]` (arrays containing null — invalid FHIR)\n- Dev omits the `text` narrative that prod includes\n\n## How widespread\n\nAll 186 records are POST /r4/ValueSet/$expand with prod=422, dev=500. This accounts for all `dev-crash-on-error` records in the current delta set.\n\nCode systems involved in sub-pattern 1:\n- http://hl7.org/fhir/sid/icd-9-cm (154 records)\n- https://fhir.progyny.com/CodeSystem/identifier-type-cs (24 records)\n\nSearch: `grep -c 'contentMode()' results/deltas/deltas.ndjson` → 178\nSearch: `grep '\"dev-crash-on-error\"' results/deltas/deltas.ndjson | wc -l` → 186\n\n## What the tolerance covers\n\nTolerance `expand-dev-crash-on-error` skips all records matching POST /r4/ValueSet/$expand with prod.status=422 and dev.status=500. Eliminates all 186 records.", "body_html": "<p>Records-Impacted: 186<br>\nTolerance-ID: expand-dev-crash-on-error<br>\nRecord-ID: f39ee3d3-8249-4e0c-a8a6-c2d5d1ffdcbd</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod (returns 422 with clear error: &quot;is a fragment&quot;)\ncurl -s -w &#x27;\\nHTTP_STATUS:%{http_code}\\n&#x27; &#x27;https://tx.fhir.org/r4/ValueSet/$expand&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;http://hl7.org/fhir/sid/icd-9-cm&quot;}]}}}]}&#x27;\n\n# Dev (returns 500 with JS source code leak: &quot;is a contentMode() { return this.codeSystem.content; }&quot;)\ncurl -s -w &#x27;\\nHTTP_STATUS:%{http_code}\\n&#x27; &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;http://hl7.org/fhir/sid/icd-9-cm&quot;}]}}}]}&#x27;</code></pre>\n<p>Prod returns HTTP 422 with <code>&quot;is a fragment, so this expansion is not permitted&quot;</code>. Dev returns HTTP 500 with <code>&quot;is a contentMode() {\\r\\n    return this.codeSystem.content;\\r\\n  }, so this expansion is not permitted&quot;</code> — a JavaScript function body leaked into the error message.</p>\n<h2>What differs</h2>\n<p>When a $expand request fails because a CodeSystem&#x27;s content mode (fragment, not-present) prevents expansion, prod returns HTTP 422 with a clear OperationOutcome. Dev returns HTTP 500 with an error message that leaks internal implementation details.</p>\n<p>Three distinct error sub-patterns in dev:</p>\n<ol><li><strong>Source code leak in error text</strong> (178 records): Dev interpolates a JavaScript function body into the error message. Instead of &quot;is a fragment, so this expansion is not permitted&quot;, dev returns &quot;is a contentMode() {\\r\\n    return this.codeSystem.content;\\r\\n  }, so this expansion is not permitted&quot;. The <code>.contentMode</code> property accessor is being <code>.toString()</code>&#x27;d instead of invoked.</li></ol>\n<ol><li><strong>exp.addParamUri is not a function</strong> (4 records): Dev crashes with a JS TypeError when attempting to expand ValueSets referencing CodeSystem <code>https://codesystem.x12.org/005010/1365</code>.</li></ol>\n<ol><li><strong>TerminologyError is not a constructor</strong> (4 records): Dev crashes with a JS TypeError when attempting to expand ValueSets referencing <code>http://terminology.hl7.org/CodeSystem/v2-0360|2.7</code>.</li></ol>\n<p>Additional differences in all 186 records:</p>\n<ul><li>HTTP status: prod=422, dev=500</li><li>Issue code: prod uses <code>invalid</code>, dev uses <code>business-rule</code></li><li>Dev includes <code>location: [null]</code> and <code>expression: [null]</code> (arrays containing null — invalid FHIR)</li><li>Dev omits the <code>text</code> narrative that prod includes</li></ul>\n<h2>How widespread</h2>\n<p>All 186 records are POST /r4/ValueSet/$expand with prod=422, dev=500. This accounts for all <code>dev-crash-on-error</code> records in the current delta set.</p>\n<p>Code systems involved in sub-pattern 1:</p>\n<ul><li>http://hl7.org/fhir/sid/icd-9-cm (154 records)</li><li>https://fhir.progyny.com/CodeSystem/identifier-type-cs (24 records)</li></ul>\n<p>Search: <code>grep -c &#x27;contentMode()&#x27; results/deltas/deltas.ndjson</code> → 178<br>\nSearch: <code>grep &#x27;&quot;dev-crash-on-error&quot;&#x27; results/deltas/deltas.ndjson | wc -l</code> → 186</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance <code>expand-dev-crash-on-error</code> skips all records matching POST /r4/ValueSet/$expand with prod.status=422 and dev.status=500. Eliminates all 186 records.</p>", "impact": 186}, {"id": "da50d17", "title": "SNOMED CT edition version skew: dev loads older editions than prod", "status": "open", "labels": ["content-differs", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 11:23", "date_iso": "2026-02-07T11:23:49-06:00", "body_md": "Records-Impacted: 181\nTolerance-ID: snomed-version-skew\nRecord-ID: e5716810-0ced-4937-85a5-5651fb884719\n\n## Repro\n\nThe version skew is visible in both the metadata endpoint and $validate-code responses.\nThe International edition has been partially fixed (both servers now resolve to 20250201),\nbut the US edition (731000124108) still shows the bug: dev defaults to 20230301 instead\nof 20250901. Both servers have the 20250901 edition loaded, but dev picks the wrong default.\n\n### 1. Metadata: compare loaded SNOMED US editions\n\n```bash\n# PROD - lists US edition 20250901 only\ncurl -s \"https://tx.fhir.org/r4/metadata?mode=terminology\" \\\n  -H \"Accept: application/fhir+json\" | \\\n  jq '.codeSystem[] | select(.uri==\"http://snomed.info/sct\") | .version[].code | select(contains(\"731000124108\"))'\n\n# DEV - lists BOTH 20250901 AND 20230301 (extra stale edition)\ncurl -s \"https://tx-dev.fhir.org/r4/metadata?mode=terminology\" \\\n  -H \"Accept: application/fhir+json\" | \\\n  jq '.codeSystem[] | select(.uri==\"http://snomed.info/sct\") | .version[].code | select(contains(\"731000124108\"))'\n```\n\nExpected: both list only `http://snomed.info/sct/731000124108/version/20250901`\nActual: dev also has `http://snomed.info/sct/731000124108/version/20230301`\n\n### 2. $validate-code: US edition resolves to wrong default version\n\n```bash\n# PROD - returns version 20250901\ncurl -s \"https://tx.fhir.org/r4/CodeSystem/\\$validate-code\" \\\n  -H \"Content-Type: application/fhir+json\" \\\n  -H \"Accept: application/fhir+json\" \\\n  --data-raw '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://snomed.info/sct\"},{\"name\":\"code\",\"valueCode\":\"243796009\"},{\"name\":\"version\",\"valueString\":\"http://snomed.info/sct/731000124108\"}]}'\n\n# DEV - returns version 20230301 (should be 20250901)\ncurl -s \"https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code\" \\\n  -H \"Content-Type: application/fhir+json\" \\\n  -H \"Accept: application/fhir+json\" \\\n  --data-raw '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://snomed.info/sct\"},{\"name\":\"code\",\"valueCode\":\"243796009\"},{\"name\":\"version\",\"valueString\":\"http://snomed.info/sct/731000124108\"}]}'\n```\n\nExpected: both return `\"version\": \"http://snomed.info/sct/731000124108/version/20250901\"`\nActual: dev returns `\"version\": \"http://snomed.info/sct/731000124108/version/20230301\"`\n\n### Additional affected records\n\n- 36822cee-7132-4003-bf9e-a5602f839466 (US edition, code 243796009)\n- 1796976f-3807-40ec-aa48-f8758b0fee62 (US edition, code 272379006)\n- 03fec18b-e871-4041-b9b8-5c770b2b17c7 (International edition, code 106292003)\n\nTested: 2026-02-07\n\nDev returns different (generally older) SNOMED CT edition versions than prod across multiple modules.\n\n## What differs\n\nThe `version` parameter in $validate-code responses contains different SNOMED CT edition URIs:\n\n- International edition (900000000000207008): prod=20250201, dev=20240201 (256 records)\n- US edition (731000124108): prod=20250901, dev=20230301 (46 records, some with reversed newer dev versions)\n- Swedish edition (45991000052106): prod=20220531, dev=20231130 (13 records)\n- Plus other national editions with smaller counts\n\n## How widespread\n\n279 total records in the current comparison dataset show SNOMED version parameter differences:\n- 265 categorized as content-differs (version string is the only or primary diff)\n- 14 categorized as result-disagrees (validation result boolean differs — codes valid in one edition but not the other)\n\nAll are $validate-code operations. The version difference also correlates with display text differences in ~80 records (display names changed between editions).\n\nMatched by: system=http://snomed.info/sct AND version parameter contains snomed.info/sct AND prod version != dev version.\n\n## What the tolerance covers\n\nTolerance ID: snomed-version-skew\nNormalizes the `version` parameter to prod's value on both sides when both contain snomed.info/sct URIs with different version dates. This eliminates records where version is the only diff (~190 records). Records with additional diffs (display, message, result) still surface for separate triage.\n\n## Representative record IDs\n\n- e5716810-0ced-4937-85a5-5651fb884719 (International edition, version-only diff)\n- e85ce5f3-b23f-41c0-892e-5f7b2aa672ef (result-disagrees, code 116154003)", "body_html": "<p>Records-Impacted: 181<br>\nTolerance-ID: snomed-version-skew<br>\nRecord-ID: e5716810-0ced-4937-85a5-5651fb884719</p>\n<h2>Repro</h2>\n<p>The version skew is visible in both the metadata endpoint and $validate-code responses.<br>\nThe International edition has been partially fixed (both servers now resolve to 20250201),<br>\nbut the US edition (731000124108) still shows the bug: dev defaults to 20230301 instead<br>\nof 20250901. Both servers have the 20250901 edition loaded, but dev picks the wrong default.</p>\n<h3>1. Metadata: compare loaded SNOMED US editions</h3>\n<pre><code class=\"lang-bash\"># PROD - lists US edition 20250901 only\ncurl -s &quot;https://tx.fhir.org/r4/metadata?mode=terminology&quot; \\\n  -H &quot;Accept: application/fhir+json&quot; | \\\n  jq &#x27;.codeSystem[] | select(.uri==&quot;http://snomed.info/sct&quot;) | .version[].code | select(contains(&quot;731000124108&quot;))&#x27;\n\n# DEV - lists BOTH 20250901 AND 20230301 (extra stale edition)\ncurl -s &quot;https://tx-dev.fhir.org/r4/metadata?mode=terminology&quot; \\\n  -H &quot;Accept: application/fhir+json&quot; | \\\n  jq &#x27;.codeSystem[] | select(.uri==&quot;http://snomed.info/sct&quot;) | .version[].code | select(contains(&quot;731000124108&quot;))&#x27;</code></pre>\n<p>Expected: both list only <code>http://snomed.info/sct/731000124108/version/20250901</code><br>\nActual: dev also has <code>http://snomed.info/sct/731000124108/version/20230301</code></p>\n<h3>2. $validate-code: US edition resolves to wrong default version</h3>\n<pre><code class=\"lang-bash\"># PROD - returns version 20250901\ncurl -s &quot;https://tx.fhir.org/r4/CodeSystem/\\$validate-code&quot; \\\n  -H &quot;Content-Type: application/fhir+json&quot; \\\n  -H &quot;Accept: application/fhir+json&quot; \\\n  --data-raw &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://snomed.info/sct&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;243796009&quot;},{&quot;name&quot;:&quot;version&quot;,&quot;valueString&quot;:&quot;http://snomed.info/sct/731000124108&quot;}]}&#x27;\n\n# DEV - returns version 20230301 (should be 20250901)\ncurl -s &quot;https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code&quot; \\\n  -H &quot;Content-Type: application/fhir+json&quot; \\\n  -H &quot;Accept: application/fhir+json&quot; \\\n  --data-raw &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://snomed.info/sct&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;243796009&quot;},{&quot;name&quot;:&quot;version&quot;,&quot;valueString&quot;:&quot;http://snomed.info/sct/731000124108&quot;}]}&#x27;</code></pre>\n<p>Expected: both return <code>&quot;version&quot;: &quot;http://snomed.info/sct/731000124108/version/20250901&quot;</code><br>\nActual: dev returns <code>&quot;version&quot;: &quot;http://snomed.info/sct/731000124108/version/20230301&quot;</code></p>\n<h3>Additional affected records</h3>\n<ul><li>36822cee-7132-4003-bf9e-a5602f839466 (US edition, code 243796009)</li><li>1796976f-3807-40ec-aa48-f8758b0fee62 (US edition, code 272379006)</li><li>03fec18b-e871-4041-b9b8-5c770b2b17c7 (International edition, code 106292003)</li></ul>\n<p>Tested: 2026-02-07</p>\n<p>Dev returns different (generally older) SNOMED CT edition versions than prod across multiple modules.</p>\n<h2>What differs</h2>\n<p>The <code>version</code> parameter in $validate-code responses contains different SNOMED CT edition URIs:</p>\n<ul><li>International edition (900000000000207008): prod=20250201, dev=20240201 (256 records)</li><li>US edition (731000124108): prod=20250901, dev=20230301 (46 records, some with reversed newer dev versions)</li><li>Swedish edition (45991000052106): prod=20220531, dev=20231130 (13 records)</li><li>Plus other national editions with smaller counts</li></ul>\n<h2>How widespread</h2>\n<p>279 total records in the current comparison dataset show SNOMED version parameter differences:</p>\n<ul><li>265 categorized as content-differs (version string is the only or primary diff)</li><li>14 categorized as result-disagrees (validation result boolean differs — codes valid in one edition but not the other)</li></ul>\n<p>All are $validate-code operations. The version difference also correlates with display text differences in ~80 records (display names changed between editions).</p>\n<p>Matched by: system=http://snomed.info/sct AND version parameter contains snomed.info/sct AND prod version != dev version.</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance ID: snomed-version-skew<br>\nNormalizes the <code>version</code> parameter to prod&#x27;s value on both sides when both contain snomed.info/sct URIs with different version dates. This eliminates records where version is the only diff (~190 records). Records with additional diffs (display, message, result) still surface for separate triage.</p>\n<h2>Representative record IDs</h2>\n<ul><li>e5716810-0ced-4937-85a5-5651fb884719 (International edition, version-only diff)</li><li>e85ce5f3-b23f-41c0-892e-5f7b2aa672ef (result-disagrees, code 116154003)</li></ul>", "impact": 181}, {"id": "d3b49ff", "title": "v2-0360 $lookup returns version 3.0.0 vs prod 2.0.0 with extra definition/designation", "status": "open", "labels": ["P6", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 10:13", "date_iso": "2026-02-07T10:13:12-06:00", "body_md": "Records-Impacted: 157\nTolerance-ID: v2-0360-lookup-version-skew\nRecord-ID: 80a780e6-8842-43a9-a260-889ce87f76ac\n\n## Repro\n\n```bash\n# Prod\ncurl -s 'https://tx.fhir.org/r4/CodeSystem/$lookup?system=http://terminology.hl7.org/CodeSystem/v2-0360&code=RN' \\\n  -H 'Accept: application/fhir+json'\n\n# Dev\ncurl -s 'https://tx-dev.fhir.org/r4/CodeSystem/$lookup?system=http://terminology.hl7.org/CodeSystem/v2-0360&code=RN' \\\n  -H 'Accept: application/fhir+json'\n```\n\nProd returns `version: \"2.0.0\"` with no top-level `definition` or `designation` parameters. Dev returns `version: \"3.0.0\"` with an extra `definition` parameter (\"Registered Nurse\") and an extra `designation` parameter (use=preferredForLanguage).\n\n## What differs\n\n$lookup on CodeSystem v2-0360 (DegreeLicenseCertificate) returns different version and content between prod and dev:\n\n1. **Version**: prod returns `version: \"2.0.0\"`, dev returns `version: \"3.0.0\"`\n2. **Definition parameter**: dev returns a top-level `definition` parameter (`\"Registered Nurse\"`); prod returns the definition only as a property (code=definition)\n3. **Designation parameter**: dev returns a `designation` parameter with `preferredForLanguage` use coding; prod does not include designation\n\nThese differences reflect that dev has loaded a newer edition (3.0.0) of the v2-0360 CodeSystem than prod (2.0.0). The structural differences (definition as top-level param, extra designation) are consistent with the newer version having richer content.\n\n## How widespread\n\nAll 157 $lookup deltas are for this same system and show the identical pattern. All use code=RN.\n\n```\ngrep '\"op\":\"lookup\"' jobs/2026-02-round-1/results/deltas/deltas.ndjson | wc -l\n# 157\n\ngrep '\"op\":\"lookup\"' jobs/2026-02-round-1/results/deltas/deltas.ndjson | grep -c 'v2-0360'\n# 157\n```\n\nRequest properties that predict this difference:\n- Operation: $lookup\n- System: http://terminology.hl7.org/CodeSystem/v2-0360\n- FHIR version: /r4/\n\n## Tolerance\n\nTolerance ID: `v2-0360-lookup-version-skew`\nMatches: $lookup requests on v2-0360 system\nNormalizes: strips version, definition, and designation parameters from both sides; removes property with code=definition from both sides\nAffects: 157 records\n\n## Representative record\n\nID: `80a780e6-8842-43a9-a260-889ce87f76ac`\nURL: GET /r4/CodeSystem/$lookup?system=http://terminology.hl7.org/CodeSystem/v2-0360&code=RN", "body_html": "<p>Records-Impacted: 157<br>\nTolerance-ID: v2-0360-lookup-version-skew<br>\nRecord-ID: 80a780e6-8842-43a9-a260-889ce87f76ac</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod\ncurl -s &#x27;https://tx.fhir.org/r4/CodeSystem/$lookup?system=http://terminology.hl7.org/CodeSystem/v2-0360&amp;code=RN&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;\n\n# Dev\ncurl -s &#x27;https://tx-dev.fhir.org/r4/CodeSystem/$lookup?system=http://terminology.hl7.org/CodeSystem/v2-0360&amp;code=RN&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;</code></pre>\n<p>Prod returns <code>version: &quot;2.0.0&quot;</code> with no top-level <code>definition</code> or <code>designation</code> parameters. Dev returns <code>version: &quot;3.0.0&quot;</code> with an extra <code>definition</code> parameter (&quot;Registered Nurse&quot;) and an extra <code>designation</code> parameter (use=preferredForLanguage).</p>\n<h2>What differs</h2>\n<p>$lookup on CodeSystem v2-0360 (DegreeLicenseCertificate) returns different version and content between prod and dev:</p>\n<ol><li><strong>Version</strong>: prod returns <code>version: &quot;2.0.0&quot;</code>, dev returns <code>version: &quot;3.0.0&quot;</code></li><li><strong>Definition parameter</strong>: dev returns a top-level <code>definition</code> parameter (<code>&quot;Registered Nurse&quot;</code>); prod returns the definition only as a property (code=definition)</li><li><strong>Designation parameter</strong>: dev returns a <code>designation</code> parameter with <code>preferredForLanguage</code> use coding; prod does not include designation</li></ol>\n<p>These differences reflect that dev has loaded a newer edition (3.0.0) of the v2-0360 CodeSystem than prod (2.0.0). The structural differences (definition as top-level param, extra designation) are consistent with the newer version having richer content.</p>\n<h2>How widespread</h2>\n<p>All 157 $lookup deltas are for this same system and show the identical pattern. All use code=RN.</p>\n<pre><code>grep &#x27;&quot;op&quot;:&quot;lookup&quot;&#x27; jobs/2026-02-round-1/results/deltas/deltas.ndjson | wc -l\n# 157\n\ngrep &#x27;&quot;op&quot;:&quot;lookup&quot;&#x27; jobs/2026-02-round-1/results/deltas/deltas.ndjson | grep -c &#x27;v2-0360&#x27;\n# 157</code></pre>\n<p>Request properties that predict this difference:</p>\n<ul><li>Operation: $lookup</li><li>System: http://terminology.hl7.org/CodeSystem/v2-0360</li><li>FHIR version: /r4/</li></ul>\n<h2>Tolerance</h2>\n<p>Tolerance ID: <code>v2-0360-lookup-version-skew</code><br>\nMatches: $lookup requests on v2-0360 system<br>\nNormalizes: strips version, definition, and designation parameters from both sides; removes property with code=definition from both sides<br>\nAffects: 157 records</p>\n<h2>Representative record</h2>\n<p>ID: <code>80a780e6-8842-43a9-a260-889ce87f76ac</code><br>\nURL: GET /r4/CodeSystem/$lookup?system=http://terminology.hl7.org/CodeSystem/v2-0360&amp;code=RN</p>", "impact": 157}, {"id": "b9e3cfd", "title": "Expand display text differs between prod and dev for same codes", "status": "open", "labels": ["content-differs", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 12:47", "date_iso": "2026-02-07T12:47:55-06:00", "body_md": "Records-Impacted: 157\nTolerance-ID: expand-display-text-differs\nRecord-ID: 6d25c912-25f4-45cf-8dea-3dd07d9d7e1e\n\n## What differs\n\nIn $expand responses, display text for the same code differs between prod and dev in\nexpansion.contains[].display. Both servers return the same codes in the same order, but\nwith different human-readable display strings.\n\nExamples:\n- SNOMED 116101001: prod=\"Product containing gonadotropin releasing hormone receptor\n  antagonist (product)\", dev=\"Gonadotropin releasing hormone antagonist\"\n- SNOMED 425901007: prod=\"IVF - In vitro fertilisation with intracytoplasmic sperm\n  injection (ICSI)\", dev=\"In vitro fertilization with intracytoplasmic sperm injection\n  (procedure)\"\n- SNOMED 60001007: prod=\"Not pregnant\", dev=\"Non pregnant state\"\n- ISO 3166 CUW: prod=\"Curagao\", dev=\"Curaçao\" (character encoding/data edition)\n- ISO 3166 ALA: prod=\"Eland Islands\", dev=\"Åland Islands\"\n\n## How widespread\n\n157 expand delta records have display text diffs in expansion.contains.\n\nBy code system:\n- http://snomed.info/sct: 134 records\n- urn:iso:std:iso:3166: 22 records\n- http://unitsofmeasure.org: 1 record\n\nSearch: Compared expansion.contains display values between prodBody and devBody for\nall expand deltas in results/deltas/deltas.ndjson.\n\n## What the tolerance covers\n\nTolerance ID: expand-display-text-differs\nMatches: $expand responses (resourceType=ValueSet with expansion) where any\ncontains[].display differs between prod and dev for the same code.\nNormalizes: Sets both sides' display to prod's value (canonical), preserving other\nfield differences.\n\n## Representative records\n\n- 6d25c912-25f4-45cf-8dea-3dd07d9d7e1e (SNOMED 116101001)\n- 44f0851b-80e8-4a27-b05e-551c0522e39b (SNOMED 425901007, 161744009)\n- 2ff10aef-7210-489d-bb28-6c7739c27027 (ISO 3166 CUW, ALA, CIV)", "body_html": "<p>Records-Impacted: 157<br>\nTolerance-ID: expand-display-text-differs<br>\nRecord-ID: 6d25c912-25f4-45cf-8dea-3dd07d9d7e1e</p>\n<h2>What differs</h2>\n<p>In $expand responses, display text for the same code differs between prod and dev in<br>\nexpansion.contains[].display. Both servers return the same codes in the same order, but<br>\nwith different human-readable display strings.</p>\n<p>Examples:</p>\n<ul><li>SNOMED 116101001: prod=&quot;Product containing gonadotropin releasing hormone receptor</li></ul>\n<p>antagonist (product)&quot;, dev=&quot;Gonadotropin releasing hormone antagonist&quot;</p>\n<ul><li>SNOMED 425901007: prod=&quot;IVF - In vitro fertilisation with intracytoplasmic sperm</li></ul>\n<p>injection (ICSI)&quot;, dev=&quot;In vitro fertilization with intracytoplasmic sperm injection<br>\n(procedure)&quot;</p>\n<ul><li>SNOMED 60001007: prod=&quot;Not pregnant&quot;, dev=&quot;Non pregnant state&quot;</li><li>ISO 3166 CUW: prod=&quot;Curagao&quot;, dev=&quot;Curaçao&quot; (character encoding/data edition)</li><li>ISO 3166 ALA: prod=&quot;Eland Islands&quot;, dev=&quot;Åland Islands&quot;</li></ul>\n<h2>How widespread</h2>\n<p>157 expand delta records have display text diffs in expansion.contains.</p>\n<p>By code system:</p>\n<ul><li>http://snomed.info/sct: 134 records</li><li>urn:iso:std:iso:3166: 22 records</li><li>http://unitsofmeasure.org: 1 record</li></ul>\n<p>Search: Compared expansion.contains display values between prodBody and devBody for<br>\nall expand deltas in results/deltas/deltas.ndjson.</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance ID: expand-display-text-differs<br>\nMatches: $expand responses (resourceType=ValueSet with expansion) where any<br>\ncontains[].display differs between prod and dev for the same code.<br>\nNormalizes: Sets both sides&#x27; display to prod&#x27;s value (canonical), preserving other<br>\nfield differences.</p>\n<h2>Representative records</h2>\n<ul><li>6d25c912-25f4-45cf-8dea-3dd07d9d7e1e (SNOMED 116101001)</li><li>44f0851b-80e8-4a27-b05e-551c0522e39b (SNOMED 425901007, 161744009)</li><li>2ff10aef-7210-489d-bb28-6c7739c27027 (ISO 3166 CUW, ALA, CIV)</li></ul>", "impact": 157}, {"id": "ac95424", "title": "HCPCS CodeSystem loaded in dev but unknown in prod — 110 result-disagrees", "status": "open", "labels": ["result-disagrees", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 12:23", "date_iso": "2026-02-07T12:23:35-06:00", "body_md": "Records-Impacted: 123\nTolerance-ID: hcpcs-codesystem-availability\nRecord-ID: 238a26b7-46b6-4095-a3ba-364b1973da4d\n\n## What differs\n\nFor $validate-code requests involving system http://www.cms.gov/Medicare/Coding/HCPCSReleaseCodeSets, prod returns result=false with the error \"A definition for CodeSystem 'http://www.cms.gov/Medicare/Coding/HCPCSReleaseCodeSets' could not be found, so the code cannot be validated\" and x-caused-by-unknown-system. Dev returns result=true with version 2025-01, display text, system, and code parameters — successfully finding and validating the codes.\n\nThe diagnostics confirm: prod says \"CodeSystem not found: http://www.cms.gov/Medicare/Coding/HCPCSReleaseCodeSets\" while dev says \"CodeSystem found: http://www.cms.gov/Medicare/Coding/HCPCSReleaseCodeSets|2025-01\".\n\n## How widespread\n\n123 delta records mention HCPCS (all validate-code operations):\n- 110 result-disagrees: prod=false dev=true (prod doesn't have HCPCS, dev does)\n- 4 result-disagrees: prod=true dev=false (code 33206, likely a different sub-issue)\n- 9 content-differs: same result but differences in surrounding content\n\nSearched with: grep -c 'HCPCSReleaseCodeSets' jobs/2026-02-round-1/results/deltas/deltas.ndjson\nAll 110 prod=false/dev=true records have x-caused-by-unknown-system pointing to HCPCSReleaseCodeSets.\n\n## What the tolerance covers\n\nTolerance ID: hcpcs-codesystem-availability. Matches validate-code records where prod has x-caused-by-unknown-system for HCPCSReleaseCodeSets and dev returns result=true. Skips these records since the root cause is code system availability, not a logic bug.", "body_html": "<p>Records-Impacted: 123<br>\nTolerance-ID: hcpcs-codesystem-availability<br>\nRecord-ID: 238a26b7-46b6-4095-a3ba-364b1973da4d</p>\n<h2>What differs</h2>\n<p>For $validate-code requests involving system http://www.cms.gov/Medicare/Coding/HCPCSReleaseCodeSets, prod returns result=false with the error &quot;A definition for CodeSystem &#x27;http://www.cms.gov/Medicare/Coding/HCPCSReleaseCodeSets&#x27; could not be found, so the code cannot be validated&quot; and x-caused-by-unknown-system. Dev returns result=true with version 2025-01, display text, system, and code parameters — successfully finding and validating the codes.</p>\n<p>The diagnostics confirm: prod says &quot;CodeSystem not found: http://www.cms.gov/Medicare/Coding/HCPCSReleaseCodeSets&quot; while dev says &quot;CodeSystem found: http://www.cms.gov/Medicare/Coding/HCPCSReleaseCodeSets|2025-01&quot;.</p>\n<h2>How widespread</h2>\n<p>123 delta records mention HCPCS (all validate-code operations):</p>\n<ul><li>110 result-disagrees: prod=false dev=true (prod doesn&#x27;t have HCPCS, dev does)</li><li>4 result-disagrees: prod=true dev=false (code 33206, likely a different sub-issue)</li><li>9 content-differs: same result but differences in surrounding content</li></ul>\n<p>Searched with: grep -c &#x27;HCPCSReleaseCodeSets&#x27; jobs/2026-02-round-1/results/deltas/deltas.ndjson<br>\nAll 110 prod=false/dev=true records have x-caused-by-unknown-system pointing to HCPCSReleaseCodeSets.</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance ID: hcpcs-codesystem-availability. Matches validate-code records where prod has x-caused-by-unknown-system for HCPCSReleaseCodeSets and dev returns result=true. Skips these records since the root cause is code system availability, not a logic bug.</p>", "impact": 123}, {"id": "9390fe4", "title": "Dev echoes display param on failed validate-code when CodeSystem unknown", "status": "open", "labels": ["content-differs", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 12:18", "date_iso": "2026-02-07T12:18:59-06:00", "body_md": "Records-Impacted: 74\nTolerance-ID: validate-code-display-echo-on-unknown-system\nRecord-ID: d9457f4d-39c0-445a-96d4-0721961e169d\n\n## What differs\n\nWhen $validate-code returns result=false because the CodeSystem is unknown (x-caused-by-unknown-system), dev echoes back the input `display` parameter in the response while prod omits it.\n\nFor example, validating code \"U\" against unknown system `https://codesystem.x12.org/005010/1338`:\n- Prod: returns result=false, system, code, message, x-caused-by-unknown-system, issues — no display parameter\n- Dev: returns all of the above PLUS `display: \"Urgent\"` (echoed from the request input)\n\nPer the FHIR spec, the output `display` parameter is \"a valid display for the concept if the system wishes to present it to users.\" When the CodeSystem is unknown, the server has no basis to return a valid display — it is simply echoing back the unvalidated input.\n\n## How widespread\n\n74 records in deltas.ndjson match this pattern. 73 have `x-caused-by-unknown-system` in prod response; 1 has no system at all. All are $validate-code with result=false. Across 38+ distinct code systems including x12.org, various OID-based systems, and others.\n\nSearch: parsed all deltas.ndjson records where comparison.diffs includes {type: \"extra-in-dev\", param: \"display\"} and result=false.\n\n## What the tolerance covers\n\nTolerance ID: `validate-code-display-echo-on-unknown-system`\nMatches: $validate-code Parameters responses where result=false, prod has no display parameter, and dev has a display parameter.\nNormalizes: strips the display parameter from dev to match prod.\nEliminates: 74 records (73 with only the display diff, 1 with additional message/issues diffs that will remain after normalization).\n\n## Representative record\n\nd9457f4d-39c0-445a-96d4-0721961e169d — POST /r4/CodeSystem/$validate-code, code U in system https://codesystem.x12.org/005010/1338", "body_html": "<p>Records-Impacted: 74<br>\nTolerance-ID: validate-code-display-echo-on-unknown-system<br>\nRecord-ID: d9457f4d-39c0-445a-96d4-0721961e169d</p>\n<h2>What differs</h2>\n<p>When $validate-code returns result=false because the CodeSystem is unknown (x-caused-by-unknown-system), dev echoes back the input <code>display</code> parameter in the response while prod omits it.</p>\n<p>For example, validating code &quot;U&quot; against unknown system <code>https://codesystem.x12.org/005010/1338</code>:</p>\n<ul><li>Prod: returns result=false, system, code, message, x-caused-by-unknown-system, issues — no display parameter</li><li>Dev: returns all of the above PLUS <code>display: &quot;Urgent&quot;</code> (echoed from the request input)</li></ul>\n<p>Per the FHIR spec, the output <code>display</code> parameter is &quot;a valid display for the concept if the system wishes to present it to users.&quot; When the CodeSystem is unknown, the server has no basis to return a valid display — it is simply echoing back the unvalidated input.</p>\n<h2>How widespread</h2>\n<p>74 records in deltas.ndjson match this pattern. 73 have <code>x-caused-by-unknown-system</code> in prod response; 1 has no system at all. All are $validate-code with result=false. Across 38+ distinct code systems including x12.org, various OID-based systems, and others.</p>\n<p>Search: parsed all deltas.ndjson records where comparison.diffs includes {type: &quot;extra-in-dev&quot;, param: &quot;display&quot;} and result=false.</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance ID: <code>validate-code-display-echo-on-unknown-system</code><br>\nMatches: $validate-code Parameters responses where result=false, prod has no display parameter, and dev has a display parameter.<br>\nNormalizes: strips the display parameter from dev to match prod.<br>\nEliminates: 74 records (73 with only the display diff, 1 with additional message/issues diffs that will remain after normalization).</p>\n<h2>Representative record</h2>\n<p>d9457f4d-39c0-445a-96d4-0721961e169d — POST /r4/CodeSystem/$validate-code, code U in system https://codesystem.x12.org/005010/1338</p>", "impact": 74}, {"id": "f559b53", "title": "CPT -code: dev fails to recognize valid CPT codes (result=false)", "status": "open", "labels": ["result-disagrees", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 12:32", "date_iso": "2026-02-07T12:32:20-06:00", "body_md": "Records-Impacted: 45\nTolerance-ID: cpt-validate-code-result-disagrees\nRecord-ID: d05e7906-16ee-4915-8c8a-92137b4e62c7\n\n## What differs\n\nDev returns `result: false` with \"Unknown code '<code>' in the CodeSystem 'http://www.ama-assn.org/go/cpt' version '2023'\" for CPT codes that prod successfully validates as `result: true`. Prod returns the code's display text and version; dev returns an error OperationOutcome with `code-invalid`.\n\nExample: CPT code 99214 (a standard E&M visit code). Prod validates it successfully with display text. Dev says it's unknown.\n\nThis affects 17 distinct CPT codes: 33206, 44211, 44401, 45346, 58545, 70551, 73722, 74263, 77061, 77081, 81528, 82274, 83036, 87624, 88175, 93978, 99214.\n\nBoth servers reference the same CodeSystem version (2023), suggesting dev has the CPT CodeSystem loaded but its concept list is incomplete or not being searched correctly.\n\n## How widespread\n\n45 result-disagrees records total:\n- 41 on POST /r4/CodeSystem/$validate-code\n- 4 on POST /r4/ValueSet/$validate-code\n\nAll are prod=true/dev=false (dev never finds these codes). Searched with:\n  grep 'ama-assn.org/go/cpt' results/deltas/deltas.ndjson | grep result-disagrees\n\nThere are also 71 content-differs and 8 status-mismatch records for CPT (124 total CPT delta records), likely related to the same underlying data issue, but those are separate patterns.\n\n## What the tolerance covers\n\nTolerance `cpt-validate-code-result-disagrees` skips all validate-code records where system is http://www.ama-assn.org/go/cpt and prod=true/dev=false (result-disagrees). Eliminates 45 records.", "body_html": "<p>Records-Impacted: 45<br>\nTolerance-ID: cpt-validate-code-result-disagrees<br>\nRecord-ID: d05e7906-16ee-4915-8c8a-92137b4e62c7</p>\n<h2>What differs</h2>\n<p>Dev returns <code>result: false</code> with &quot;Unknown code &#x27;&lt;code&gt;&#x27; in the CodeSystem &#x27;http://www.ama-assn.org/go/cpt&#x27; version &#x27;2023&#x27;&quot; for CPT codes that prod successfully validates as <code>result: true</code>. Prod returns the code&#x27;s display text and version; dev returns an error OperationOutcome with <code>code-invalid</code>.</p>\n<p>Example: CPT code 99214 (a standard E&amp;M visit code). Prod validates it successfully with display text. Dev says it&#x27;s unknown.</p>\n<p>This affects 17 distinct CPT codes: 33206, 44211, 44401, 45346, 58545, 70551, 73722, 74263, 77061, 77081, 81528, 82274, 83036, 87624, 88175, 93978, 99214.</p>\n<p>Both servers reference the same CodeSystem version (2023), suggesting dev has the CPT CodeSystem loaded but its concept list is incomplete or not being searched correctly.</p>\n<h2>How widespread</h2>\n<p>45 result-disagrees records total:</p>\n<ul><li>41 on POST /r4/CodeSystem/$validate-code</li><li>4 on POST /r4/ValueSet/$validate-code</li></ul>\n<p>All are prod=true/dev=false (dev never finds these codes). Searched with:<br>\ngrep &#x27;ama-assn.org/go/cpt&#x27; results/deltas/deltas.ndjson | grep result-disagrees</p>\n<p>There are also 71 content-differs and 8 status-mismatch records for CPT (124 total CPT delta records), likely related to the same underlying data issue, but those are separate patterns.</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance <code>cpt-validate-code-result-disagrees</code> skips all validate-code records where system is http://www.ama-assn.org/go/cpt and prod=true/dev=false (result-disagrees). Eliminates 45 records.</p>", "impact": 45}, {"id": "cf90495", "title": "Wrong Display Name message format differs: different display option count, formatting, and language tags", "status": "open", "labels": ["P6", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 10:22", "date_iso": "2026-02-07T10:22:21-06:00", "body_md": "Records-Impacted: 44\nTolerance-ID: invalid-display-message-format\nRecord-ID: beb4276b-f937-46c3-81ab-7f63cb7798b7\n\n## Repro\n\n```bash\n# Prod\ncurl -s 'https://tx.fhir.org/r4/CodeSystem/$validate-code' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"system\",\"valueUri\":\"urn:ietf:bcp:47\"},{\"name\":\"code\",\"valueCode\":\"en-US\"},{\"name\":\"display\",\"valueString\":\"English\"},{\"name\":\"displayLanguage\",\"valueCode\":\"en-US\"}]}'\n\n# Dev\ncurl -s 'https://tx-dev.fhir.org/r4/CodeSystem/$validate-code' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"system\",\"valueUri\":\"urn:ietf:bcp:47\"},{\"name\":\"code\",\"valueCode\":\"en-US\"},{\"name\":\"display\",\"valueString\":\"English\"},{\"name\":\"displayLanguage\",\"valueCode\":\"en-US\"}]}'\n```\n\nProd returns \"one of 6 choices\" with duplicate display options and no language tags; dev returns \"one of 3 choices\" with de-duplicated options and `(en)` language tags appended to each.\n\n## What differs\n\nWhen $validate-code detects a wrong display name, prod and dev return different error message text in both the `message` parameter and `issues` OperationOutcome `details.text`.\n\nSpecific differences:\n- **Display option count**: Prod may list duplicate display options (e.g., \"6 choices\" with repeats), while dev de-duplicates (e.g., \"3 choices\" with unique entries)\n- **Language tags**: Dev appends language tags like `(en)` after each display option; prod does not\n- **Example**: For `urn:ietf:bcp:47#en-US`:\n  - Prod: \"Valid display is one of 6 choices: 'English (Region=United States)', 'English (United States)', 'English (Region=United States)', ...\"\n  - Dev: \"Valid display is one of 3 choices: 'English (Region=United States)' (en), 'English (United States)' (en) or 'English (Region=United States)' (en) ...\"\n\nThe core validation result (`result: false`) agrees in all but 1 of 41 records. The difference is confined to the human-readable error message text.\n\n## How widespread\n\n44 delta records have `invalid-display` issue type with only `message` and `issues` diffs. 41 records contain \"Wrong Display Name\" in the delta text.\n\nSearch: `grep -c 'Wrong Display Name' jobs/2026-02-round-1/results/deltas/deltas.ndjson` → 41\nSearch: `grep -c 'invalid-display' jobs/2026-02-round-1/results/deltas/deltas.ndjson` → 53 (44 with only message/issues diffs)\n\nAffected operations: $validate-code on both CodeSystem and ValueSet\nAffected systems: urn:ietf:bcp:47, http://snomed.info/sct, and others\n\n## What the tolerance covers\n\nTolerance ID: `invalid-display-message-format`\nMatches: validate-code records where both prod and dev have `invalid-display` issue type and only the message/issues text differs. Normalizes the message and issues text to prod's version.\nExpected elimination: ~44 records.\n\n## Representative record ID\n\n`beb4276b-f937-46c3-81ab-7f63cb7798b7` — grep -n 'beb4276b-f937-46c3-81ab-7f63cb7798b7' jobs/2026-02-round-1/comparison.ndjson", "body_html": "<p>Records-Impacted: 44<br>\nTolerance-ID: invalid-display-message-format<br>\nRecord-ID: beb4276b-f937-46c3-81ab-7f63cb7798b7</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod\ncurl -s &#x27;https://tx.fhir.org/r4/CodeSystem/$validate-code&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;system&quot;,&quot;valueUri&quot;:&quot;urn:ietf:bcp:47&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;en-US&quot;},{&quot;name&quot;:&quot;display&quot;,&quot;valueString&quot;:&quot;English&quot;},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueCode&quot;:&quot;en-US&quot;}]}&#x27;\n\n# Dev\ncurl -s &#x27;https://tx-dev.fhir.org/r4/CodeSystem/$validate-code&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;system&quot;,&quot;valueUri&quot;:&quot;urn:ietf:bcp:47&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;en-US&quot;},{&quot;name&quot;:&quot;display&quot;,&quot;valueString&quot;:&quot;English&quot;},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueCode&quot;:&quot;en-US&quot;}]}&#x27;</code></pre>\n<p>Prod returns &quot;one of 6 choices&quot; with duplicate display options and no language tags; dev returns &quot;one of 3 choices&quot; with de-duplicated options and <code>(en)</code> language tags appended to each.</p>\n<h2>What differs</h2>\n<p>When $validate-code detects a wrong display name, prod and dev return different error message text in both the <code>message</code> parameter and <code>issues</code> OperationOutcome <code>details.text</code>.</p>\n<p>Specific differences:</p>\n<ul><li><strong>Display option count</strong>: Prod may list duplicate display options (e.g., &quot;6 choices&quot; with repeats), while dev de-duplicates (e.g., &quot;3 choices&quot; with unique entries)</li><li><strong>Language tags</strong>: Dev appends language tags like <code>(en)</code> after each display option; prod does not</li><li><strong>Example</strong>: For <code>urn:ietf:bcp:47#en-US</code>:</li><li>Prod: &quot;Valid display is one of 6 choices: &#x27;English (Region=United States)&#x27;, &#x27;English (United States)&#x27;, &#x27;English (Region=United States)&#x27;, ...&quot;</li><li>Dev: &quot;Valid display is one of 3 choices: &#x27;English (Region=United States)&#x27; (en), &#x27;English (United States)&#x27; (en) or &#x27;English (Region=United States)&#x27; (en) ...&quot;</li></ul>\n<p>The core validation result (<code>result: false</code>) agrees in all but 1 of 41 records. The difference is confined to the human-readable error message text.</p>\n<h2>How widespread</h2>\n<p>44 delta records have <code>invalid-display</code> issue type with only <code>message</code> and <code>issues</code> diffs. 41 records contain &quot;Wrong Display Name&quot; in the delta text.</p>\n<p>Search: <code>grep -c &#x27;Wrong Display Name&#x27; jobs/2026-02-round-1/results/deltas/deltas.ndjson</code> → 41<br>\nSearch: <code>grep -c &#x27;invalid-display&#x27; jobs/2026-02-round-1/results/deltas/deltas.ndjson</code> → 53 (44 with only message/issues diffs)</p>\n<p>Affected operations: $validate-code on both CodeSystem and ValueSet<br>\nAffected systems: urn:ietf:bcp:47, http://snomed.info/sct, and others</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance ID: <code>invalid-display-message-format</code><br>\nMatches: validate-code records where both prod and dev have <code>invalid-display</code> issue type and only the message/issues text differs. Normalizes the message and issues text to prod&#x27;s version.<br>\nExpected elimination: ~44 records.</p>\n<h2>Representative record ID</h2>\n<p><code>beb4276b-f937-46c3-81ab-7f63cb7798b7</code> — grep -n &#x27;beb4276b-f937-46c3-81ab-7f63cb7798b7&#x27; jobs/2026-02-round-1/comparison.ndjson</p>", "impact": 44}, {"id": "515117b", "title": "Dev $expand reports different used-codesystem versions than prod", "status": "open", "labels": ["content-differs", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 11:32", "date_iso": "2026-02-07T11:32:05-06:00", "body_md": "Records-Impacted: 37\nTolerance-ID: expand-used-codesystem-version-skew\nRecord-ID: 2bbd9519-3a6b-4f55-8309-745d9f1b16a7\n\n## Repro\n\n```bash\n# Prod\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$expand' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"compose\":{\"include\":[{\"system\":\"http://snomed.info/sct\",\"concept\":[{\"code\":\"160245001\"}]}]}}},{\"name\":\"system-version\",\"valueUri\":\"http://snomed.info/sct|http://snomed.info/sct/731000124108\"}]}'\n\n# Dev\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$expand' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"compose\":{\"include\":[{\"system\":\"http://snomed.info/sct\",\"concept\":[{\"code\":\"160245001\"}]}]}}},{\"name\":\"system-version\",\"valueUri\":\"http://snomed.info/sct|http://snomed.info/sct/731000124108\"}]}'\n```\n\nProd returns `used-codesystem` version `20250901`, dev returns `20230301` for SNOMED US edition.\n\nDev $expand responses report different code system versions in the `used-codesystem` expansion parameter compared to prod. This is the $expand counterpart of the existing SNOMED version skew bug (da50d17), but affects multiple code systems and is specific to expansion metadata rather than validate-code Parameters.\n\n## What differs\n\nIn 37 $expand delta records, the `used-codesystem` expansion parameter reports a different version in dev than prod. This affects multiple code systems:\n\n- (empty/missing): 14 records\n- http://hl7.org/fhir/sid/icd-9-cm: 11 records\n- http://snomed.info/sct: 6 records\n- http://terminology.hl7.org/CodeSystem/medicationrequest-category: 2 records\n- http://loinc.org: 2 records\n- http://terminology.hl7.org/CodeSystem/v3-NullFlavor: 1 record\n- http://hl7.org/fhir/sid/icd-10-cm: 1 record\n\nExamples:\n- SNOMED US: prod `20250901`, dev `20230301`\n- medicationrequest-category: prod `4.0.1`, dev `1.0.0`\n\nThis indicates dev loads different (generally older) editions of these code systems.\n\n## How to reproduce\n\n```bash\ngrep '\"op\":\"expand\"' jobs/2026-02-round-1/results/deltas/deltas.ndjson | python3 -c \"\nimport json, sys\nfor line in sys.stdin:\n    rec = json.loads(line)\n    dev = json.loads(rec.get('devBody','{}'))\n    prod = json.loads(rec.get('prodBody','{}'))\n    d = {p.get('name'):p for p in dev.get('expansion',{}).get('parameter',[])}\n    p = {p.get('name'):p for p in prod.get('expansion',{}).get('parameter',[])}\n    du = d.get('used-codesystem',{}).get('valueUri','')\n    pu = p.get('used-codesystem',{}).get('valueUri','')\n    if du != pu: print(f'{rec[\\\"id\\\"]}: prod={pu} dev={du}')\n\" | wc -l\n# Returns 37\n```", "body_html": "<p>Records-Impacted: 37<br>\nTolerance-ID: expand-used-codesystem-version-skew<br>\nRecord-ID: 2bbd9519-3a6b-4f55-8309-745d9f1b16a7</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod\ncurl -s &#x27;https://tx.fhir.org/r4/ValueSet/$expand&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;http://snomed.info/sct&quot;,&quot;concept&quot;:[{&quot;code&quot;:&quot;160245001&quot;}]}]}}},{&quot;name&quot;:&quot;system-version&quot;,&quot;valueUri&quot;:&quot;http://snomed.info/sct|http://snomed.info/sct/731000124108&quot;}]}&#x27;\n\n# Dev\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;http://snomed.info/sct&quot;,&quot;concept&quot;:[{&quot;code&quot;:&quot;160245001&quot;}]}]}}},{&quot;name&quot;:&quot;system-version&quot;,&quot;valueUri&quot;:&quot;http://snomed.info/sct|http://snomed.info/sct/731000124108&quot;}]}&#x27;</code></pre>\n<p>Prod returns <code>used-codesystem</code> version <code>20250901</code>, dev returns <code>20230301</code> for SNOMED US edition.</p>\n<p>Dev $expand responses report different code system versions in the <code>used-codesystem</code> expansion parameter compared to prod. This is the $expand counterpart of the existing SNOMED version skew bug (da50d17), but affects multiple code systems and is specific to expansion metadata rather than validate-code Parameters.</p>\n<h2>What differs</h2>\n<p>In 37 $expand delta records, the <code>used-codesystem</code> expansion parameter reports a different version in dev than prod. This affects multiple code systems:</p>\n<ul><li>(empty/missing): 14 records</li><li>http://hl7.org/fhir/sid/icd-9-cm: 11 records</li><li>http://snomed.info/sct: 6 records</li><li>http://terminology.hl7.org/CodeSystem/medicationrequest-category: 2 records</li><li>http://loinc.org: 2 records</li><li>http://terminology.hl7.org/CodeSystem/v3-NullFlavor: 1 record</li><li>http://hl7.org/fhir/sid/icd-10-cm: 1 record</li></ul>\n<p>Examples:</p>\n<ul><li>SNOMED US: prod <code>20250901</code>, dev <code>20230301</code></li><li>medicationrequest-category: prod <code>4.0.1</code>, dev <code>1.0.0</code></li></ul>\n<p>This indicates dev loads different (generally older) editions of these code systems.</p>\n<h2>How to reproduce</h2>\n<pre><code class=\"lang-bash\">grep &#x27;&quot;op&quot;:&quot;expand&quot;&#x27; jobs/2026-02-round-1/results/deltas/deltas.ndjson | python3 -c &quot;\nimport json, sys\nfor line in sys.stdin:\n    rec = json.loads(line)\n    dev = json.loads(rec.get(&#x27;devBody&#x27;,&#x27;{}&#x27;))\n    prod = json.loads(rec.get(&#x27;prodBody&#x27;,&#x27;{}&#x27;))\n    d = {p.get(&#x27;name&#x27;):p for p in dev.get(&#x27;expansion&#x27;,{}).get(&#x27;parameter&#x27;,[])}\n    p = {p.get(&#x27;name&#x27;):p for p in prod.get(&#x27;expansion&#x27;,{}).get(&#x27;parameter&#x27;,[])}\n    du = d.get(&#x27;used-codesystem&#x27;,{}).get(&#x27;valueUri&#x27;,&#x27;&#x27;)\n    pu = p.get(&#x27;used-codesystem&#x27;,{}).get(&#x27;valueUri&#x27;,&#x27;&#x27;)\n    if du != pu: print(f&#x27;{rec[\\&quot;id\\&quot;]}: prod={pu} dev={du}&#x27;)\n&quot; | wc -l\n# Returns 37</code></pre>", "impact": 37}, {"id": "de8b2f7", "title": "Dev appends 'and undefined' to valid version list in UNKNOWN_CODESYSTEM_VERSION messages", "status": "open", "labels": ["content-differs", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 12:43", "date_iso": "2026-02-07T12:43:31-06:00", "body_md": "Records-Impacted: 26\nTolerance-ID: unknown-version-valid-versions-message\nRecord-ID: a3cf69a7-48f3-47b8-a29d-cd6453647621\n\n## What differs\n\nWhen a requested CodeSystem version is not found, both prod and dev return an UNKNOWN_CODESYSTEM_VERSION error listing available versions. Dev appends \" and undefined\" at the end of this version list in 26 of 40 such records.\n\nExample from dev message:\n\"...http://snomed.info/xsct/900000000000207008/version/20250814 and undefined\"\n\nProd message ends cleanly:\n\"...http://snomed.info/xsct/900000000000207008/version/20250814\"\n\nThis appears to be a JS undefined value being concatenated into the version list string, likely from an off-by-one or array join issue.\n\n## How widespread\n\n26 records in deltas.ndjson contain \"and undefined\" in the devBody. All are validate-code operations. The pattern appears across SNOMED and other code systems when the requested version is not found.\n\nSearch: grep -c 'and undefined' deltas.ndjson => 26\n\n## What the tolerance covers\n\nTolerance `unknown-version-valid-versions-message` normalizes the message and issues text in UNKNOWN_CODESYSTEM_VERSION responses by stripping \"Valid versions:\" lists from both sides. This covers both the \"and undefined\" bug and the version list differences caused by different editions being loaded.\n\n## Representative record\n\na3cf69a7-48f3-47b8-a29d-cd6453647621 — POST /r4/CodeSystem/$validate-code for SNOMED 2017-09, both return result=false", "body_html": "<p>Records-Impacted: 26<br>\nTolerance-ID: unknown-version-valid-versions-message<br>\nRecord-ID: a3cf69a7-48f3-47b8-a29d-cd6453647621</p>\n<h2>What differs</h2>\n<p>When a requested CodeSystem version is not found, both prod and dev return an UNKNOWN_CODESYSTEM_VERSION error listing available versions. Dev appends &quot; and undefined&quot; at the end of this version list in 26 of 40 such records.</p>\n<p>Example from dev message:<br>\n&quot;...http://snomed.info/xsct/900000000000207008/version/20250814 and undefined&quot;</p>\n<p>Prod message ends cleanly:<br>\n&quot;...http://snomed.info/xsct/900000000000207008/version/20250814&quot;</p>\n<p>This appears to be a JS undefined value being concatenated into the version list string, likely from an off-by-one or array join issue.</p>\n<h2>How widespread</h2>\n<p>26 records in deltas.ndjson contain &quot;and undefined&quot; in the devBody. All are validate-code operations. The pattern appears across SNOMED and other code systems when the requested version is not found.</p>\n<p>Search: grep -c &#x27;and undefined&#x27; deltas.ndjson =&gt; 26</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance <code>unknown-version-valid-versions-message</code> normalizes the message and issues text in UNKNOWN_CODESYSTEM_VERSION responses by stripping &quot;Valid versions:&quot; lists from both sides. This covers both the &quot;and undefined&quot; bug and the version list differences caused by different editions being loaded.</p>\n<h2>Representative record</h2>\n<p>a3cf69a7-48f3-47b8-a29d-cd6453647621 — POST /r4/CodeSystem/$validate-code for SNOMED 2017-09, both return result=false</p>", "impact": 26}, {"id": "7258b41", "title": "NDC validate-code: dev returns inactive/version/message/issues params that prod omits", "status": "open", "labels": ["content-differs", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 11:48", "date_iso": "2026-02-07T11:48:41-06:00", "body_md": "Records-Impacted: 16\nTolerance-ID: ndc-validate-code-extra-inactive-params\nRecord-ID: ac23726f-6ff2-4b72-b2c8-584922d04c92\n## Repro\n\nValidate NDC code 0777-3105-02 against both servers:\n\n```bash\n# Prod (tx.fhir.org) -- returns result, system, code, display only\ncurl -s -X POST \"https://tx.fhir.org/r4/CodeSystem/\\$validate-code?\" \\\n  -H \"Content-Type: application/fhir+json\" \\\n  -H \"Accept: application/fhir+json\" \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/sid/ndc\"},{\"name\":\"code\",\"valueCode\":\"0777-3105-02\"}]}'\n\n# Dev (tx-dev.fhir.org) -- returns those plus version, inactive, message, issues\ncurl -s -X POST \"https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code?\" \\\n  -H \"Content-Type: application/fhir+json\" \\\n  -H \"Accept: application/fhir+json\" \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/sid/ndc\"},{\"name\":\"code\",\"valueCode\":\"0777-3105-02\"}]}'\n```\n\n**Prod response** (4 parameters):\n- `result: true`, `system`, `code: \"0777-3105-02\"`, `display: \"Prozac, 100 CAPSULE in 1 BOTTLE (0777-3105-02) (package)\"`\n\n**Dev response** (8 parameters) -- same 4 plus:\n- `version: \"2021-11-01\"`\n- `inactive: true`\n- `message: \"The concept '0777-3105-02' has a status of null and its use should be reviewed\"`\n- `issues`: OperationOutcome with INACTIVE_CONCEPT_FOUND warning\n\nAlso reproducible with NDC codes `0002-8215-01` and `0169-4132-12`.\n\n## What differs\n\nFor NDC ($validate-code on http://hl7.org/fhir/sid/ndc), both servers agree result=true and return matching system, code, and display. However, dev returns four additional parameters that prod omits entirely:\n\n- `version: \"2021-11-01\"` — the NDC code system version\n- `inactive: true` — flags the concept as inactive\n- `message: \"The concept '<code>' has a status of null and its use should be reviewed\"` — a warning about the concept status\n- `issues` — an OperationOutcome with a warning (severity=warning, code=business-rule, tx-issue-type=code-comment, message-id=INACTIVE_CONCEPT_FOUND)\n\nProd's diagnostics show it uses NDC with no version: `Using CodeSystem \"http://hl7.org/fhir/sid/ndc|\" (content = complete)` (empty string after the pipe). Dev uses NDC version 2021-11-01.\n\n## How widespread\n\n16 records in deltas.ndjson match this exact pattern. All are POST /r4/CodeSystem/$validate-code? for http://hl7.org/fhir/sid/ndc. Three distinct NDC codes are affected: 0777-3105-02, 0002-8215-01, and 0169-4132-12.\n\nSearch: `grep '\"param\":\"inactive\"' jobs/2026-02-round-1/results/deltas/deltas.ndjson | wc -l` → 16\n\nAll 16 have the same diff signature: extra-in-dev for inactive, issues, message, and version.\n\n## What the tolerance covers\n\nTolerance `ndc-validate-code-extra-inactive-params` matches validate-code responses where system is http://hl7.org/fhir/sid/ndc and dev has inactive/version/message/issues parameters that prod lacks. It strips the four extra parameters from dev to eliminate the diff. Eliminates 16 records.\n\n## Representative record\n\nac23726f-6ff2-4b72-b2c8-584922d04c92 — NDC code 0777-3105-02 (Prozac 100 capsule)", "body_html": "<p>Records-Impacted: 16<br>\nTolerance-ID: ndc-validate-code-extra-inactive-params<br>\nRecord-ID: ac23726f-6ff2-4b72-b2c8-584922d04c92</p>\n<h2>Repro</h2>\n<p>Validate NDC code 0777-3105-02 against both servers:</p>\n<pre><code class=\"lang-bash\"># Prod (tx.fhir.org) -- returns result, system, code, display only\ncurl -s -X POST &quot;https://tx.fhir.org/r4/CodeSystem/\\$validate-code?&quot; \\\n  -H &quot;Content-Type: application/fhir+json&quot; \\\n  -H &quot;Accept: application/fhir+json&quot; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/sid/ndc&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;0777-3105-02&quot;}]}&#x27;\n\n# Dev (tx-dev.fhir.org) -- returns those plus version, inactive, message, issues\ncurl -s -X POST &quot;https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code?&quot; \\\n  -H &quot;Content-Type: application/fhir+json&quot; \\\n  -H &quot;Accept: application/fhir+json&quot; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/sid/ndc&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;0777-3105-02&quot;}]}&#x27;</code></pre>\n<p><strong>Prod response</strong> (4 parameters):</p>\n<ul><li><code>result: true</code>, <code>system</code>, <code>code: &quot;0777-3105-02&quot;</code>, <code>display: &quot;Prozac, 100 CAPSULE in 1 BOTTLE (0777-3105-02) (package)&quot;</code></li></ul>\n<p><strong>Dev response</strong> (8 parameters) -- same 4 plus:</p>\n<ul><li><code>version: &quot;2021-11-01&quot;</code></li><li><code>inactive: true</code></li><li><code>message: &quot;The concept &#x27;0777-3105-02&#x27; has a status of null and its use should be reviewed&quot;</code></li><li><code>issues</code>: OperationOutcome with INACTIVE_CONCEPT_FOUND warning</li></ul>\n<p>Also reproducible with NDC codes <code>0002-8215-01</code> and <code>0169-4132-12</code>.</p>\n<h2>What differs</h2>\n<p>For NDC ($validate-code on http://hl7.org/fhir/sid/ndc), both servers agree result=true and return matching system, code, and display. However, dev returns four additional parameters that prod omits entirely:</p>\n<ul><li><code>version: &quot;2021-11-01&quot;</code> — the NDC code system version</li><li><code>inactive: true</code> — flags the concept as inactive</li><li><code>message: &quot;The concept &#x27;&lt;code&gt;&#x27; has a status of null and its use should be reviewed&quot;</code> — a warning about the concept status</li><li><code>issues</code> — an OperationOutcome with a warning (severity=warning, code=business-rule, tx-issue-type=code-comment, message-id=INACTIVE_CONCEPT_FOUND)</li></ul>\n<p>Prod&#x27;s diagnostics show it uses NDC with no version: <code>Using CodeSystem &quot;http://hl7.org/fhir/sid/ndc|&quot; (content = complete)</code> (empty string after the pipe). Dev uses NDC version 2021-11-01.</p>\n<h2>How widespread</h2>\n<p>16 records in deltas.ndjson match this exact pattern. All are POST /r4/CodeSystem/$validate-code? for http://hl7.org/fhir/sid/ndc. Three distinct NDC codes are affected: 0777-3105-02, 0002-8215-01, and 0169-4132-12.</p>\n<p>Search: <code>grep &#x27;&quot;param&quot;:&quot;inactive&quot;&#x27; jobs/2026-02-round-1/results/deltas/deltas.ndjson | wc -l</code> → 16</p>\n<p>All 16 have the same diff signature: extra-in-dev for inactive, issues, message, and version.</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance <code>ndc-validate-code-extra-inactive-params</code> matches validate-code responses where system is http://hl7.org/fhir/sid/ndc and dev has inactive/version/message/issues parameters that prod lacks. It strips the four extra parameters from dev to eliminate the diff. Eliminates 16 records.</p>\n<h2>Representative record</h2>\n<p>ac23726f-6ff2-4b72-b2c8-584922d04c92 — NDC code 0777-3105-02 (Prozac 100 capsule)</p>", "impact": 16}, {"id": "3967e97", "title": "Dev $expand includes extra ValueSet metadata (contact) that prod omits", "status": "open", "labels": ["content-differs", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 12:03", "date_iso": "2026-02-07T12:03:22-06:00", "body_md": "Records-Impacted: 12\nTolerance-ID: expand-dev-extra-contact-metadata\nRecord-ID: 80d06a63-cebf-4a33-af1b-583b4f6a1c10\n\n## Repro\n\nDev includes the `contact` field in `$expand` responses; prod omits it. Reproduce with any of these ValueSets:\n\n**medicationrequest-category** (contact has URL only):\n```bash\n# Prod — no contact field in response\ncurl -s -H 'Accept: application/fhir+json' \\\n  'https://tx.fhir.org/r4/ValueSet/$expand?url=http://hl7.org/fhir/ValueSet/medicationrequest-category&count=0' \\\n  | python3 -c \"import sys,json; d=json.load(sys.stdin); print('contact' in d)\"\n# => False\n\n# Dev — contact field present\ncurl -s -H 'Accept: application/fhir+json' \\\n  'https://tx-dev.fhir.org/r4/ValueSet/$expand?url=http://hl7.org/fhir/ValueSet/medicationrequest-category&count=0' \\\n  | python3 -c \"import sys,json; d=json.load(sys.stdin); print('contact' in d, d.get('contact'))\"\n# => True [{\"telecom\": [{\"system\": \"url\", \"value\": \"http://hl7.org/fhir\"}]}]\n```\n\n**administrative-gender** (contact has URL + email):\n```bash\ncurl -s -H 'Accept: application/fhir+json' \\\n  'https://tx-dev.fhir.org/r4/ValueSet/$expand?url=http://hl7.org/fhir/ValueSet/administrative-gender&count=0' \\\n  | python3 -c \"import sys,json; d=json.load(sys.stdin); print('contact' in d, d.get('contact'))\"\n# => True [{\"telecom\": [{\"system\": \"url\", \"value\": \"http://hl7.org/fhir\"}, {\"system\": \"email\", \"value\": \"fhir@lists.hl7.org\"}]}]\n```\n\nOther affected ValueSets include: `address-type`, `address-use`, `identifier-use`, `gender-identity`, `iso3166-1-2`, `languages`, `mimetypes`, `name-use`.\n\n## What differs\n\nDev $expand responses include the ValueSet `contact` field (publisher contact information) that prod omits from expansion results. The contact data comes from the source ValueSet definition and contains HL7 FHIR contact info such as:\n\n- `{\"telecom\": [{\"system\": \"url\", \"value\": \"http://hl7.org/fhir\"}]}`\n- `{\"telecom\": [{\"system\": \"url\", \"value\": \"http://hl7.org/fhir\"}, {\"system\": \"email\", \"value\": \"fhir@lists.hl7.org\"}]}`\n\nProd strips this metadata from the expansion response; dev passes it through.\n\n## How widespread\n\n12 records in deltas, 59 in the full comparison dataset (others already eliminated by existing tolerances). All are $expand operations on /r4/ValueSet/$expand. Matched with:\n\n```\ngrep '\"contact\":[' deltas.ndjson  # in devBody\n```\n\nFiltered to cases where dev has contact but prod does not.\n\n## What the tolerance covers\n\nTolerance `expand-dev-extra-contact-metadata` matches ValueSet $expand responses where dev has a `contact` field and prod does not. It strips the `contact` field from dev to normalize both sides. Eliminates 12 delta records (9 where contact was the sole remaining difference, 3 where other differences also exist — those 3 will remain in deltas due to the other differences).\n\n## Representative record\n\n`80d06a63-cebf-4a33-af1b-583b4f6a1c10` — POST /r4/ValueSet/$expand for medicationrequest-category ValueSet. Dev includes `contact: [{telecom: [{system: \"url\", value: \"http://hl7.org/fhir\"}]}]`, prod omits it.", "body_html": "<p>Records-Impacted: 12<br>\nTolerance-ID: expand-dev-extra-contact-metadata<br>\nRecord-ID: 80d06a63-cebf-4a33-af1b-583b4f6a1c10</p>\n<h2>Repro</h2>\n<p>Dev includes the <code>contact</code> field in <code>$expand</code> responses; prod omits it. Reproduce with any of these ValueSets:</p>\n<p><strong>medicationrequest-category</strong> (contact has URL only):</p>\n<pre><code class=\"lang-bash\"># Prod — no contact field in response\ncurl -s -H &#x27;Accept: application/fhir+json&#x27; \\\n  &#x27;https://tx.fhir.org/r4/ValueSet/$expand?url=http://hl7.org/fhir/ValueSet/medicationrequest-category&amp;count=0&#x27; \\\n  | python3 -c &quot;import sys,json; d=json.load(sys.stdin); print(&#x27;contact&#x27; in d)&quot;\n# =&gt; False\n\n# Dev — contact field present\ncurl -s -H &#x27;Accept: application/fhir+json&#x27; \\\n  &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand?url=http://hl7.org/fhir/ValueSet/medicationrequest-category&amp;count=0&#x27; \\\n  | python3 -c &quot;import sys,json; d=json.load(sys.stdin); print(&#x27;contact&#x27; in d, d.get(&#x27;contact&#x27;))&quot;\n# =&gt; True [{&quot;telecom&quot;: [{&quot;system&quot;: &quot;url&quot;, &quot;value&quot;: &quot;http://hl7.org/fhir&quot;}]}]</code></pre>\n<p><strong>administrative-gender</strong> (contact has URL + email):</p>\n<pre><code class=\"lang-bash\">curl -s -H &#x27;Accept: application/fhir+json&#x27; \\\n  &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand?url=http://hl7.org/fhir/ValueSet/administrative-gender&amp;count=0&#x27; \\\n  | python3 -c &quot;import sys,json; d=json.load(sys.stdin); print(&#x27;contact&#x27; in d, d.get(&#x27;contact&#x27;))&quot;\n# =&gt; True [{&quot;telecom&quot;: [{&quot;system&quot;: &quot;url&quot;, &quot;value&quot;: &quot;http://hl7.org/fhir&quot;}, {&quot;system&quot;: &quot;email&quot;, &quot;value&quot;: &quot;fhir@lists.hl7.org&quot;}]}]</code></pre>\n<p>Other affected ValueSets include: <code>address-type</code>, <code>address-use</code>, <code>identifier-use</code>, <code>gender-identity</code>, <code>iso3166-1-2</code>, <code>languages</code>, <code>mimetypes</code>, <code>name-use</code>.</p>\n<h2>What differs</h2>\n<p>Dev $expand responses include the ValueSet <code>contact</code> field (publisher contact information) that prod omits from expansion results. The contact data comes from the source ValueSet definition and contains HL7 FHIR contact info such as:</p>\n<ul><li><code>{&quot;telecom&quot;: [{&quot;system&quot;: &quot;url&quot;, &quot;value&quot;: &quot;http://hl7.org/fhir&quot;}]}</code></li><li><code>{&quot;telecom&quot;: [{&quot;system&quot;: &quot;url&quot;, &quot;value&quot;: &quot;http://hl7.org/fhir&quot;}, {&quot;system&quot;: &quot;email&quot;, &quot;value&quot;: &quot;fhir@lists.hl7.org&quot;}]}</code></li></ul>\n<p>Prod strips this metadata from the expansion response; dev passes it through.</p>\n<h2>How widespread</h2>\n<p>12 records in deltas, 59 in the full comparison dataset (others already eliminated by existing tolerances). All are $expand operations on /r4/ValueSet/$expand. Matched with:</p>\n<pre><code>grep &#x27;&quot;contact&quot;:[&#x27; deltas.ndjson  # in devBody</code></pre>\n<p>Filtered to cases where dev has contact but prod does not.</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance <code>expand-dev-extra-contact-metadata</code> matches ValueSet $expand responses where dev has a <code>contact</code> field and prod does not. It strips the <code>contact</code> field from dev to normalize both sides. Eliminates 12 delta records (9 where contact was the sole remaining difference, 3 where other differences also exist — those 3 will remain in deltas due to the other differences).</p>\n<h2>Representative record</h2>\n<p><code>80d06a63-cebf-4a33-af1b-583b4f6a1c10</code> — POST /r4/ValueSet/$expand for medicationrequest-category ValueSet. Dev includes <code>contact: [{telecom: [{system: &quot;url&quot;, value: &quot;http://hl7.org/fhir&quot;}]}]</code>, prod omits it.</p>", "impact": 12}, {"id": "51f23f5", "title": "DICOM CID 29 AcquisitionModality ValueSet missing from dev", "status": "open", "labels": ["P3", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 10:50", "date_iso": "2026-02-07T10:50:05-06:00", "body_md": "Records-Impacted: 10\nTolerance-ID: dicom-cid29-missing\nRecord-ID: 3e3359d1-7391-4620-8b72-552f197f21cf\n\n## Repro\n\n**Test 1: Direct read by ID** (prod=200, dev=404)\n\n```bash\n# Prod (expect 200 with full ValueSet, 51 DICOM modality codes)\ncurl -s -H \"Accept: application/fhir+json\" \\\n  \"https://tx.fhir.org/r4/ValueSet/dicom-cid-29-AcquisitionModality\" \\\n  | python3 -c \"import sys,json; d=json.load(sys.stdin); print(f'Status: 200, resourceType: {d[\\\"resourceType\\\"]}, id: {d[\\\"id\\\"]}')\"\n\n# Dev (expect 404 with OperationOutcome \"not found\")\ncurl -s -o /dev/null -w \"%{http_code}\" -H \"Accept: application/fhir+json\" \\\n  \"https://tx-dev.fhir.org/r4/ValueSet/dicom-cid-29-AcquisitionModality\"\n# Returns: 404\n```\n\n**Test 2: URL search** (prod total=1, dev total=0)\n\n```bash\n# Prod (expect total: 1, one entry)\ncurl -s -H \"Accept: application/fhir+json\" \\\n  \"https://tx.fhir.org/r4/ValueSet?url=http%3A%2F%2Fdicom.nema.org%2Fmedical%2Fdicom%2Fcurrent%2Foutput%2Fchtml%2Fpart16%2Fsect_CID_29.html\" \\\n  | python3 -c \"import sys,json; d=json.load(sys.stdin); print(f'total: {d[\\\"total\\\"]}, entries: {len(d.get(\\\"entry\\\",[]))}')\"\n# Returns: total: 1, entries: 1\n\n# Dev (expect total: 0, no entries)\ncurl -s -H \"Accept: application/fhir+json\" \\\n  \"https://tx-dev.fhir.org/r4/ValueSet?url=http%3A%2F%2Fdicom.nema.org%2Fmedical%2Fdicom%2Fcurrent%2Foutput%2Fchtml%2Fpart16%2Fsect_CID_29.html\" \\\n  | python3 -c \"import sys,json; d=json.load(sys.stdin); print(f'total: {d[\\\"total\\\"]}, entries: {len(d.get(\\\"entry\\\",[]))}')\"\n# Returns: total: 0, entries: 0\n```\n\nVerified 2026-02-07: both tests confirm the DICOM CID 29 AcquisitionModality ValueSet exists on prod but is entirely missing from dev.\n\n## What differs\n\nWhen searching for the DICOM CID 29 AcquisitionModality ValueSet by URL (`/r4/ValueSet?url=http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_29.html`), prod returns a Bundle with `total: 1` containing the full ValueSet resource (id: `dicom-cid-29-AcquisitionModality`, 51 DICOM modality codes). Dev returns an empty Bundle with `total: 0`.\n\nDirect reads by ID (`/r4/ValueSet/dicom-cid-29-AcquisitionModality`) return 200 on prod with the full ValueSet, and 404 on dev with \"ValueSet/dicom-cid-29-AcquisitionModality not found\".\n\nThe ValueSet has URL `http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_29.html`, version `2025.3.20250714`, and uses system `http://dicom.nema.org/resources/ontology/DCM`.\n\n## How widespread\n\n10 records in the delta file:\n- 5x P3 (prod=200, dev=404): direct read `/r4/ValueSet/dicom-cid-29-AcquisitionModality`\n- 5x P6 (both 200, content differs): URL search returning empty Bundle vs populated Bundle\n\nSearch: `grep 'dicom-cid-29\\|sect_CID_29' deltas.ndjson` finds all 10.\n\n## Representative record IDs\n\n- `3e3359d1-7391-4620-8b72-552f197f21cf` (P6 URL search)\n- `ab5f8ed0-5149-4967-af3a-3c649cbb10c5` (P3 direct read)", "body_html": "<p>Records-Impacted: 10<br>\nTolerance-ID: dicom-cid29-missing<br>\nRecord-ID: 3e3359d1-7391-4620-8b72-552f197f21cf</p>\n<h2>Repro</h2>\n<p><strong>Test 1: Direct read by ID</strong> (prod=200, dev=404)</p>\n<pre><code class=\"lang-bash\"># Prod (expect 200 with full ValueSet, 51 DICOM modality codes)\ncurl -s -H &quot;Accept: application/fhir+json&quot; \\\n  &quot;https://tx.fhir.org/r4/ValueSet/dicom-cid-29-AcquisitionModality&quot; \\\n  | python3 -c &quot;import sys,json; d=json.load(sys.stdin); print(f&#x27;Status: 200, resourceType: {d[\\&quot;resourceType\\&quot;]}, id: {d[\\&quot;id\\&quot;]}&#x27;)&quot;\n\n# Dev (expect 404 with OperationOutcome &quot;not found&quot;)\ncurl -s -o /dev/null -w &quot;%{http_code}&quot; -H &quot;Accept: application/fhir+json&quot; \\\n  &quot;https://tx-dev.fhir.org/r4/ValueSet/dicom-cid-29-AcquisitionModality&quot;\n# Returns: 404</code></pre>\n<p><strong>Test 2: URL search</strong> (prod total=1, dev total=0)</p>\n<pre><code class=\"lang-bash\"># Prod (expect total: 1, one entry)\ncurl -s -H &quot;Accept: application/fhir+json&quot; \\\n  &quot;https://tx.fhir.org/r4/ValueSet?url=http%3A%2F%2Fdicom.nema.org%2Fmedical%2Fdicom%2Fcurrent%2Foutput%2Fchtml%2Fpart16%2Fsect_CID_29.html&quot; \\\n  | python3 -c &quot;import sys,json; d=json.load(sys.stdin); print(f&#x27;total: {d[\\&quot;total\\&quot;]}, entries: {len(d.get(\\&quot;entry\\&quot;,[]))}&#x27;)&quot;\n# Returns: total: 1, entries: 1\n\n# Dev (expect total: 0, no entries)\ncurl -s -H &quot;Accept: application/fhir+json&quot; \\\n  &quot;https://tx-dev.fhir.org/r4/ValueSet?url=http%3A%2F%2Fdicom.nema.org%2Fmedical%2Fdicom%2Fcurrent%2Foutput%2Fchtml%2Fpart16%2Fsect_CID_29.html&quot; \\\n  | python3 -c &quot;import sys,json; d=json.load(sys.stdin); print(f&#x27;total: {d[\\&quot;total\\&quot;]}, entries: {len(d.get(\\&quot;entry\\&quot;,[]))}&#x27;)&quot;\n# Returns: total: 0, entries: 0</code></pre>\n<p>Verified 2026-02-07: both tests confirm the DICOM CID 29 AcquisitionModality ValueSet exists on prod but is entirely missing from dev.</p>\n<h2>What differs</h2>\n<p>When searching for the DICOM CID 29 AcquisitionModality ValueSet by URL (<code>/r4/ValueSet?url=http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_29.html</code>), prod returns a Bundle with <code>total: 1</code> containing the full ValueSet resource (id: <code>dicom-cid-29-AcquisitionModality</code>, 51 DICOM modality codes). Dev returns an empty Bundle with <code>total: 0</code>.</p>\n<p>Direct reads by ID (<code>/r4/ValueSet/dicom-cid-29-AcquisitionModality</code>) return 200 on prod with the full ValueSet, and 404 on dev with &quot;ValueSet/dicom-cid-29-AcquisitionModality not found&quot;.</p>\n<p>The ValueSet has URL <code>http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_29.html</code>, version <code>2025.3.20250714</code>, and uses system <code>http://dicom.nema.org/resources/ontology/DCM</code>.</p>\n<h2>How widespread</h2>\n<p>10 records in the delta file:</p>\n<ul><li>5x P3 (prod=200, dev=404): direct read <code>/r4/ValueSet/dicom-cid-29-AcquisitionModality</code></li><li>5x P6 (both 200, content differs): URL search returning empty Bundle vs populated Bundle</li></ul>\n<p>Search: <code>grep &#x27;dicom-cid-29\\|sect_CID_29&#x27; deltas.ndjson</code> finds all 10.</p>\n<h2>Representative record IDs</h2>\n<ul><li><code>3e3359d1-7391-4620-8b72-552f197f21cf</code> (P6 URL search)</li><li><code>ab5f8ed0-5149-4967-af3a-3c649cbb10c5</code> (P3 direct read)</li></ul>", "impact": 10}, {"id": "e09cff6", "title": "BCP-47 display text format: dev returns 'Region=...' instead of standard format", "status": "open", "labels": ["P6", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 10:45", "date_iso": "2026-02-07T10:45:20-06:00", "body_md": "Records-Impacted: 7\nTolerance-ID: bcp47-display-format\nRecord-ID: da702ab4-7ced-4b69-945c-0b5bbbc088c0\n\n## Repro\n\n```bash\n# Prod\ncurl -s 'https://tx.fhir.org/r4/CodeSystem/$validate-code?url=urn:ietf:bcp:47&code=en-US' -H 'Accept: application/fhir+json'\n\n# Dev\ncurl -s 'https://tx-dev.fhir.org/r4/CodeSystem/$validate-code?url=urn:ietf:bcp:47&code=en-US' -H 'Accept: application/fhir+json'\n```\n\nAs of 2026-02-07, both servers return `\"display\": \"English (Region=United States)\"` — the original difference (prod had \"English (United States)\") is no longer present. Prod appears to have been updated to match dev's format.\n\n## What differs\n\nFor BCP-47 language codes (system urn:ietf:bcp:47), dev returns display text with explicit subtag labels like \"English (Region=United States)\" while prod returns the standard format \"English (United States)\".\n\nSpecific example for code en-US:\n- prod: \"English (United States)\"\n- dev: \"English (Region=United States)\"\n\nThe \"Region=\" prefix in dev's display text is non-standard. The IANA/BCP-47 convention is to show the region name without a label prefix.\n\n## How widespread\n\n7 P6 $validate-code records in the current delta set match this pattern — all are urn:ietf:bcp:47 validate-code operations for code en-US where the only difference (after diagnostics stripping and parameter sorting) is the display parameter value.\n\nSearch: grep -c 'Region=' deltas.ndjson → 10 total hits (7 are this display-only P6 pattern; 2 are P1 case-sensitivity issues for en-us; 1 is an $expand with transient metadata diffs where \"Region=\" appears only in diagnostics).\n\n## What the tolerance covers\n\nTolerance: bcp47-display-format. Matches $validate-code records where system=urn:ietf:bcp:47, both prod and dev return display parameters, and the values differ. Canonicalizes dev display to match prod. Expected to eliminate 7 records.\n\n## Representative record\n\nda702ab4-7ced-4b69-945c-0b5bbbc088c0 — POST /r4/ValueSet/$validate-code? for en-US in urn:ietf:bcp:47", "body_html": "<p>Records-Impacted: 7<br>\nTolerance-ID: bcp47-display-format<br>\nRecord-ID: da702ab4-7ced-4b69-945c-0b5bbbc088c0</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod\ncurl -s &#x27;https://tx.fhir.org/r4/CodeSystem/$validate-code?url=urn:ietf:bcp:47&amp;code=en-US&#x27; -H &#x27;Accept: application/fhir+json&#x27;\n\n# Dev\ncurl -s &#x27;https://tx-dev.fhir.org/r4/CodeSystem/$validate-code?url=urn:ietf:bcp:47&amp;code=en-US&#x27; -H &#x27;Accept: application/fhir+json&#x27;</code></pre>\n<p>As of 2026-02-07, both servers return <code>&quot;display&quot;: &quot;English (Region=United States)&quot;</code> — the original difference (prod had &quot;English (United States)&quot;) is no longer present. Prod appears to have been updated to match dev&#x27;s format.</p>\n<h2>What differs</h2>\n<p>For BCP-47 language codes (system urn:ietf:bcp:47), dev returns display text with explicit subtag labels like &quot;English (Region=United States)&quot; while prod returns the standard format &quot;English (United States)&quot;.</p>\n<p>Specific example for code en-US:</p>\n<ul><li>prod: &quot;English (United States)&quot;</li><li>dev: &quot;English (Region=United States)&quot;</li></ul>\n<p>The &quot;Region=&quot; prefix in dev&#x27;s display text is non-standard. The IANA/BCP-47 convention is to show the region name without a label prefix.</p>\n<h2>How widespread</h2>\n<p>7 P6 $validate-code records in the current delta set match this pattern — all are urn:ietf:bcp:47 validate-code operations for code en-US where the only difference (after diagnostics stripping and parameter sorting) is the display parameter value.</p>\n<p>Search: grep -c &#x27;Region=&#x27; deltas.ndjson → 10 total hits (7 are this display-only P6 pattern; 2 are P1 case-sensitivity issues for en-us; 1 is an $expand with transient metadata diffs where &quot;Region=&quot; appears only in diagnostics).</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance: bcp47-display-format. Matches $validate-code records where system=urn:ietf:bcp:47, both prod and dev return display parameters, and the values differ. Canonicalizes dev display to match prod. Expected to eliminate 7 records.</p>\n<h2>Representative record</h2>\n<p>da702ab4-7ced-4b69-945c-0b5bbbc088c0 — POST /r4/ValueSet/$validate-code? for en-US in urn:ietf:bcp:47</p>", "impact": 7}, {"id": "e5a78af", "title": "ISO 3166 : prod includes 42 reserved/user-assigned codes that dev omits", "status": "open", "labels": ["content-differs", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 12:52", "date_iso": "2026-02-07T12:52:15-06:00", "body_md": "Records-Impacted: 7\nTolerance-ID: expand-iso3166-extra-reserved-codes\nRecord-ID: 70faaf64-3ca5-4ee1-94f1-7f89ad1cf7ed\n\n## What differs\n\nPOST /r4/ValueSet/$expand for ValueSets containing urn:iso:std:iso:3166: prod returns 291 codes (total=291), dev returns 249 codes (total=249). The 42 extra codes in prod are all ISO 3166-1 reserved/user-assigned codes:\n\n- AA (User-assigned)\n- QM through QZ (15 User-assigned codes)\n- XA through XJ, XL through XZ (24 codes: mostly User-assigned, plus XK=Kosovo, XX=Unknown, XZ=International Waters)\n- ZZ (Unknown or Invalid Territory)\n\nDev returns only the 249 standard assigned country codes.\n\n## How widespread\n\n7 $expand records in deltas show this exact pattern (prod_total=291, dev_total=249):\n- `grep 'iso:3166' jobs/2026-02-round-1/results/deltas/deltas.ndjson` finds 14 records total (including reads and a dev-crash)\n- All 7 content-differs expand records share the same 291 vs 249 pattern\n\nSearch used:\n```\npython3 -c \"\nimport json\nwith open('jobs/2026-02-round-1/results/deltas/deltas.ndjson') as f:\n    for line in f:\n        r = json.loads(line)\n        if 'iso:3166' in r.get('prodBody',''):\n            prod = json.loads(r['prodBody'])\n            dev = json.loads(r['devBody'])\n            if prod.get('expansion',{}).get('total') == 291:\n                print(r['id'][:12])\n\"\n```\n\n## What the tolerance covers\n\nTolerance `expand-iso3166-extra-reserved-codes` matches expand records where both prod and dev use urn:iso:std:iso:3166 and prod.expansion.total > dev.expansion.total. It normalizes by filtering prod's contains array to only include codes present in dev, and sets both totals to dev's count. This eliminates 7 records while preserving any other differences (display text, etc.) for detection.", "body_html": "<p>Records-Impacted: 7<br>\nTolerance-ID: expand-iso3166-extra-reserved-codes<br>\nRecord-ID: 70faaf64-3ca5-4ee1-94f1-7f89ad1cf7ed</p>\n<h2>What differs</h2>\n<p>POST /r4/ValueSet/$expand for ValueSets containing urn:iso:std:iso:3166: prod returns 291 codes (total=291), dev returns 249 codes (total=249). The 42 extra codes in prod are all ISO 3166-1 reserved/user-assigned codes:</p>\n<ul><li>AA (User-assigned)</li><li>QM through QZ (15 User-assigned codes)</li><li>XA through XJ, XL through XZ (24 codes: mostly User-assigned, plus XK=Kosovo, XX=Unknown, XZ=International Waters)</li><li>ZZ (Unknown or Invalid Territory)</li></ul>\n<p>Dev returns only the 249 standard assigned country codes.</p>\n<h2>How widespread</h2>\n<p>7 $expand records in deltas show this exact pattern (prod_total=291, dev_total=249):</p>\n<ul><li><code>grep &#x27;iso:3166&#x27; jobs/2026-02-round-1/results/deltas/deltas.ndjson</code> finds 14 records total (including reads and a dev-crash)</li><li>All 7 content-differs expand records share the same 291 vs 249 pattern</li></ul>\n<p>Search used:</p>\n<pre><code>python3 -c &quot;\nimport json\nwith open(&#x27;jobs/2026-02-round-1/results/deltas/deltas.ndjson&#x27;) as f:\n    for line in f:\n        r = json.loads(line)\n        if &#x27;iso:3166&#x27; in r.get(&#x27;prodBody&#x27;,&#x27;&#x27;):\n            prod = json.loads(r[&#x27;prodBody&#x27;])\n            dev = json.loads(r[&#x27;devBody&#x27;])\n            if prod.get(&#x27;expansion&#x27;,{}).get(&#x27;total&#x27;) == 291:\n                print(r[&#x27;id&#x27;][:12])\n&quot;</code></pre>\n<h2>What the tolerance covers</h2>\n<p>Tolerance <code>expand-iso3166-extra-reserved-codes</code> matches expand records where both prod and dev use urn:iso:std:iso:3166 and prod.expansion.total &gt; dev.expansion.total. It normalizes by filtering prod&#x27;s contains array to only include codes present in dev, and sets both totals to dev&#x27;s count. This eliminates 7 records while preserving any other differences (display text, etc.) for detection.</p>", "impact": 7}, {"id": "241f1d8", "title": "Draft CodeSystem message missing provenance suffix in dev", "status": "open", "labels": ["content-differs", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 11:43", "date_iso": "2026-02-07T11:43:08-06:00", "body_md": "Records-Impacted: 4\nTolerance-ID: draft-codesystem-message-provenance-suffix\nRecord-ID: dcdd2b94-db92-4e95-973c-5ced19783bef\n\n## Repro\n\nValidate a code against a draft CodeSystem (e.g. `event-status`) on both servers and compare the `details.text` in the OperationOutcome issue:\n\n```bash\n# Prod (includes provenance suffix \"from hl7.fhir.r4.core#4.0.1\"):\ncurl -s \"https://tx.fhir.org/r4/CodeSystem/\\$validate-code\" \\\n  -H \"Content-Type: application/fhir+json\" \\\n  -H \"Accept: application/fhir+json\" \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/event-status\"},{\"name\":\"code\",\"valueCode\":\"completed\"}]}'\n\n# Dev (missing provenance suffix):\ncurl -s \"https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code\" \\\n  -H \"Content-Type: application/fhir+json\" \\\n  -H \"Accept: application/fhir+json\" \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/event-status\"},{\"name\":\"code\",\"valueCode\":\"completed\"}]}'\n```\n\n**Expected** (prod): `details.text` = `Reference to draft CodeSystem http://hl7.org/fhir/event-status|4.0.1 from hl7.fhir.r4.core#4.0.1`\n**Actual** (dev): `details.text` = `Reference to draft CodeSystem http://hl7.org/fhir/event-status|4.0.1`\n\nAlso reproduces with other draft CodeSystems: `narrative-status`, `medicationrequest-status`, `medicationrequest-intent`.\n\n## What differs\n\nWhen validating codes against draft CodeSystems, both prod and dev return an informational OperationOutcome issue with code \"status-check\" and message ID \"MSG_DRAFT\". The details.text differs:\n\n- **Prod**: `Reference to draft CodeSystem http://hl7.org/fhir/event-status|4.0.1 from hl7.fhir.r4.core#4.0.1`\n- **Dev**: `Reference to draft CodeSystem http://hl7.org/fhir/event-status|4.0.1`\n\nDev omits the ` from <package>#<version>` provenance suffix that identifies which FHIR package the CodeSystem was loaded from.\n\n## How widespread\n\n4 records in the comparison dataset, all POST /r4/CodeSystem/$validate-code against draft CodeSystems from hl7.fhir.r4.core#4.0.1:\n- http://hl7.org/fhir/event-status\n- http://hl7.org/fhir/narrative-status\n- http://hl7.org/fhir/CodeSystem/medicationrequest-status\n- http://hl7.org/fhir/CodeSystem/medicationrequest-intent\n\nFound via: `grep -c 'from hl7.fhir' results/deltas/deltas.ndjson` (4 matches out of 910 deltas).\n\nAll 4 records agree on result (true), system, code, version, and display. The only remaining difference after normalization is the details.text provenance suffix.\n\n## What the tolerance covers\n\nTolerance ID: `draft-codesystem-message-provenance-suffix`. Matches validate-code Parameters responses where OperationOutcome issue text in prod ends with ` from <package>#<version>` and dev has the same text without that suffix. Normalizes both sides to the prod text (which includes provenance). Eliminates 4 records.", "body_html": "<p>Records-Impacted: 4<br>\nTolerance-ID: draft-codesystem-message-provenance-suffix<br>\nRecord-ID: dcdd2b94-db92-4e95-973c-5ced19783bef</p>\n<h2>Repro</h2>\n<p>Validate a code against a draft CodeSystem (e.g. <code>event-status</code>) on both servers and compare the <code>details.text</code> in the OperationOutcome issue:</p>\n<pre><code class=\"lang-bash\"># Prod (includes provenance suffix &quot;from hl7.fhir.r4.core#4.0.1&quot;):\ncurl -s &quot;https://tx.fhir.org/r4/CodeSystem/\\$validate-code&quot; \\\n  -H &quot;Content-Type: application/fhir+json&quot; \\\n  -H &quot;Accept: application/fhir+json&quot; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/event-status&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;completed&quot;}]}&#x27;\n\n# Dev (missing provenance suffix):\ncurl -s &quot;https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code&quot; \\\n  -H &quot;Content-Type: application/fhir+json&quot; \\\n  -H &quot;Accept: application/fhir+json&quot; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/event-status&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;completed&quot;}]}&#x27;</code></pre>\n<p><strong>Expected</strong> (prod): <code>details.text</code> = <code>Reference to draft CodeSystem http://hl7.org/fhir/event-status|4.0.1 from hl7.fhir.r4.core#4.0.1</code><br>\n<strong>Actual</strong> (dev): <code>details.text</code> = <code>Reference to draft CodeSystem http://hl7.org/fhir/event-status|4.0.1</code></p>\n<p>Also reproduces with other draft CodeSystems: <code>narrative-status</code>, <code>medicationrequest-status</code>, <code>medicationrequest-intent</code>.</p>\n<h2>What differs</h2>\n<p>When validating codes against draft CodeSystems, both prod and dev return an informational OperationOutcome issue with code &quot;status-check&quot; and message ID &quot;MSG_DRAFT&quot;. The details.text differs:</p>\n<ul><li><strong>Prod</strong>: <code>Reference to draft CodeSystem http://hl7.org/fhir/event-status|4.0.1 from hl7.fhir.r4.core#4.0.1</code></li><li><strong>Dev</strong>: <code>Reference to draft CodeSystem http://hl7.org/fhir/event-status|4.0.1</code></li></ul>\n<p>Dev omits the <code> from &lt;package&gt;#&lt;version&gt;</code> provenance suffix that identifies which FHIR package the CodeSystem was loaded from.</p>\n<h2>How widespread</h2>\n<p>4 records in the comparison dataset, all POST /r4/CodeSystem/$validate-code against draft CodeSystems from hl7.fhir.r4.core#4.0.1:</p>\n<ul><li>http://hl7.org/fhir/event-status</li><li>http://hl7.org/fhir/narrative-status</li><li>http://hl7.org/fhir/CodeSystem/medicationrequest-status</li><li>http://hl7.org/fhir/CodeSystem/medicationrequest-intent</li></ul>\n<p>Found via: <code>grep -c &#x27;from hl7.fhir&#x27; results/deltas/deltas.ndjson</code> (4 matches out of 910 deltas).</p>\n<p>All 4 records agree on result (true), system, code, version, and display. The only remaining difference after normalization is the details.text provenance suffix.</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance ID: <code>draft-codesystem-message-provenance-suffix</code>. Matches validate-code Parameters responses where OperationOutcome issue text in prod ends with <code> from &lt;package&gt;#&lt;version&gt;</code> and dev has the same text without that suffix. Normalizes both sides to the prod text (which includes provenance). Eliminates 4 records.</p>", "impact": 4}, {"id": "52ecb75", "title": "CodeSystem/$validate-code without system: different error message and severity", "status": "open", "labels": ["content-differs", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 12:28", "date_iso": "2026-02-07T12:28:48-06:00", "body_md": "Records-Impacted: 1\nTolerance-ID: cs-validate-code-no-system-error-format\nRecord-ID: 9afb9fcf-df5f-4766-a56a-33379c66b90a\n\n## What differs\n\nPOST /r4/CodeSystem/$validate-code with code \"OBG\" and no system parameter.\n\nBoth servers return result=false, but they differ in how they report the error:\n\n- **Prod**: severity=warning, message=\"Coding has no system. A code with no system has no defined meaning, and it cannot be validated. A system should be provided\", includes details.coding with code \"invalid-data\" from tx-issue-type system\n- **Dev**: severity=error, message=\"No CodeSystem specified - provide url parameter or codeSystem resource\", no details.coding at all\n\nThree distinct differences:\n1. Severity: warning (prod) vs error (dev)\n2. Message text: completely different wording\n3. Issue detail coding: prod includes structured tx-issue-type coding, dev omits it\n\n## How widespread\n\nThis is the only record in the dataset with this specific pattern. Searched for \"No CodeSystem specified\" across both comparison.ndjson and deltas.ndjson — found exactly 1 match. The request shape (POST to /r4/CodeSystem/$validate-code without trailing ?) is also unique.\n\n## What the tolerance covers\n\nTolerance ID: cs-validate-code-no-system-error-format\nMatches: POST /r4/CodeSystem/$validate-code (without trailing ?), where dev message contains \"No CodeSystem specified\". Normalizes message and issues to prod's values to suppress this single record.\n\n## Representative record\n\n9afb9fcf-df5f-4766-a56a-33379c66b90a", "body_html": "<p>Records-Impacted: 1<br>\nTolerance-ID: cs-validate-code-no-system-error-format<br>\nRecord-ID: 9afb9fcf-df5f-4766-a56a-33379c66b90a</p>\n<h2>What differs</h2>\n<p>POST /r4/CodeSystem/$validate-code with code &quot;OBG&quot; and no system parameter.</p>\n<p>Both servers return result=false, but they differ in how they report the error:</p>\n<ul><li><strong>Prod</strong>: severity=warning, message=&quot;Coding has no system. A code with no system has no defined meaning, and it cannot be validated. A system should be provided&quot;, includes details.coding with code &quot;invalid-data&quot; from tx-issue-type system</li><li><strong>Dev</strong>: severity=error, message=&quot;No CodeSystem specified - provide url parameter or codeSystem resource&quot;, no details.coding at all</li></ul>\n<p>Three distinct differences:</p>\n<ol><li>Severity: warning (prod) vs error (dev)</li><li>Message text: completely different wording</li><li>Issue detail coding: prod includes structured tx-issue-type coding, dev omits it</li></ol>\n<h2>How widespread</h2>\n<p>This is the only record in the dataset with this specific pattern. Searched for &quot;No CodeSystem specified&quot; across both comparison.ndjson and deltas.ndjson — found exactly 1 match. The request shape (POST to /r4/CodeSystem/$validate-code without trailing ?) is also unique.</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance ID: cs-validate-code-no-system-error-format<br>\nMatches: POST /r4/CodeSystem/$validate-code (without trailing ?), where dev message contains &quot;No CodeSystem specified&quot;. Normalizes message and issues to prod&#x27;s values to suppress this single record.</p>\n<h2>Representative record</h2>\n<p>9afb9fcf-df5f-4766-a56a-33379c66b90a</p>", "impact": 1}, {"id": "933fdcc", "title": "Dev fails to process VSAC ValueSets with vsacOpModifier extension", "status": "open", "labels": ["content-differs", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 11:27", "date_iso": "2026-02-07T11:27:58-06:00", "body_md": "Dev returns a generic error \"Cannot process resource at \\\"exclude[0].filter\\\" due to the presence of the modifier extension vsacOpModifier\" instead of processing VSAC ValueSets that use the vsacOpModifier extension in their exclude filters.\n\n## Repro\n\n```bash\n# Prod — returns detailed validation (unknown codesystem version + not-in-valueset):\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$validate-code?url=http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.4.642.40.2.48.1|20250419&system=urn:oid:2.16.840.1.113883.6.238&code=2184-0&display=Dominican' -H 'Accept: application/fhir+json'\n\n# Dev — returns generic \"vsacOpModifier\" business-rule error:\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$validate-code?url=http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.4.642.40.2.48.1|20250419&system=urn:oid:2.16.840.1.113883.6.238&code=2184-0&display=Dominican' -H 'Accept: application/fhir+json'\n```\n\n**Expected (prod)**: `result: false` with specific errors — \"CodeSystem version '1.3' could not be found\" and \"code not found in value set\".\n**Actual (dev)**: `result: false` with generic error — \"Cannot process resource at \\\"exclude[0].filter\\\" due to the presence of the modifier extension vsacOpModifier\".\n\nAlso reproducible with codes `2148-5` (Mexican) and `2151-9` (Chicano) against the same ValueSet.\n\n**What differs**: When validating codes against VSAC ValueSets that use vsacOpModifier, prod processes the ValueSet and returns proper validation results (e.g., unknown codesystem version, not-in-valueset issues), while dev bails out at ValueSet processing with a business-rule error about the modifier extension. Both return result=false, but for completely different reasons — prod gives specific, correct error details while dev gives a generic \"cannot process\" error.\n\n**How widespread**: 3 records in the delta file, all POST /r4/ValueSet/$validate-code, all involving the same VSAC ValueSet (http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.4.642.40.2.48.1|20250419) with system urn:oid:2.16.840.1.113883.6.238.\n\nSearch: grep -c 'vsacOpModifier' results/deltas/deltas.ndjson → 3\n\n**Tolerance**: `vsac-modifier-extension-error` (temp-tolerance) matches validate-code records where dev's message contains \"vsacOpModifier\". Eliminates 3 records.\n\n**Representative record**: 64ff24e8-e8ff-456c-a0ed-0f222b9454fb", "body_html": "<p>Dev returns a generic error &quot;Cannot process resource at \\&quot;exclude[0].filter\\&quot; due to the presence of the modifier extension vsacOpModifier&quot; instead of processing VSAC ValueSets that use the vsacOpModifier extension in their exclude filters.</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod — returns detailed validation (unknown codesystem version + not-in-valueset):\ncurl -s &#x27;https://tx.fhir.org/r4/ValueSet/$validate-code?url=http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.4.642.40.2.48.1|20250419&amp;system=urn:oid:2.16.840.1.113883.6.238&amp;code=2184-0&amp;display=Dominican&#x27; -H &#x27;Accept: application/fhir+json&#x27;\n\n# Dev — returns generic &quot;vsacOpModifier&quot; business-rule error:\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$validate-code?url=http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.4.642.40.2.48.1|20250419&amp;system=urn:oid:2.16.840.1.113883.6.238&amp;code=2184-0&amp;display=Dominican&#x27; -H &#x27;Accept: application/fhir+json&#x27;</code></pre>\n<p><strong>Expected (prod)</strong>: <code>result: false</code> with specific errors — &quot;CodeSystem version &#x27;1.3&#x27; could not be found&quot; and &quot;code not found in value set&quot;.<br>\n<strong>Actual (dev)</strong>: <code>result: false</code> with generic error — &quot;Cannot process resource at \\&quot;exclude[0].filter\\&quot; due to the presence of the modifier extension vsacOpModifier&quot;.</p>\n<p>Also reproducible with codes <code>2148-5</code> (Mexican) and <code>2151-9</code> (Chicano) against the same ValueSet.</p>\n<p><strong>What differs</strong>: When validating codes against VSAC ValueSets that use vsacOpModifier, prod processes the ValueSet and returns proper validation results (e.g., unknown codesystem version, not-in-valueset issues), while dev bails out at ValueSet processing with a business-rule error about the modifier extension. Both return result=false, but for completely different reasons — prod gives specific, correct error details while dev gives a generic &quot;cannot process&quot; error.</p>\n<p><strong>How widespread</strong>: 3 records in the delta file, all POST /r4/ValueSet/$validate-code, all involving the same VSAC ValueSet (http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.4.642.40.2.48.1|20250419) with system urn:oid:2.16.840.1.113883.6.238.</p>\n<p>Search: grep -c &#x27;vsacOpModifier&#x27; results/deltas/deltas.ndjson → 3</p>\n<p><strong>Tolerance</strong>: <code>vsac-modifier-extension-error</code> (temp-tolerance) matches validate-code records where dev&#x27;s message contains &quot;vsacOpModifier&quot;. Eliminates 3 records.</p>\n<p><strong>Representative record</strong>: 64ff24e8-e8ff-456c-a0ed-0f222b9454fb</p>", "impact": null}, {"id": "2abe02d", "title": "Dev $expand returns empty string id on ValueSet response", "status": "closed", "labels": ["content-differs", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 11:31", "date_iso": "2026-02-07T11:31:49-06:00", "body_md": "Records-Impacted: 690\nTolerance-ID: expand-dev-empty-id\nRecord-ID: 2bbd9519-3a6b-4f55-8309-745d9f1b16a7\n\n## Repro\n\nAttempted to reproduce on 2026-02-07 but the bug appears to have been **fixed** on tx-dev.fhir.org since the data was collected (2026-02-06).\n\nTried 4 different $expand POST requests — none returned `\"id\":\"\"` from dev:\n\n```bash\n# Test 1: Inline ValueSet with SNOMED concept\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$expand' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"status\":\"active\",\"compose\":{\"include\":[{\"system\":\"http://snomed.info/sct\",\"concept\":[{\"code\":\"160245001\"}]}]}}}]}'\n\n# Test 2: Registered ValueSet by URL\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$expand' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/ValueSet/medicationrequest-category\"}]}'\n\n# Test 3: Inline ValueSet with LOINC\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$expand' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"compose\":{\"include\":[{\"system\":\"http://loinc.org\",\"concept\":[{\"code\":\"8480-6\"}]}]}}}]}'\n```\n\nAll three return a ValueSet without `\"id\":\"\"`. Both inline and registered ValueSet expansions now omit `id` entirely, matching prod behavior.\n\n**Status**: No longer reproducible — likely fixed between 2026-02-06 and 2026-02-07.\n\nDev $expand responses include `\"id\": \"\"` at the top level of the returned ValueSet resource. Prod does not include an `id` field at all.\n\n## What differs\n\nIn all 690 $expand delta records where dev returns a successful ValueSet expansion, the dev response includes `\"id\": \"\"` (an empty string). Prod omits the `id` field entirely, which is the correct behavior — per FHIR, string values must be non-empty if present. An empty string `\"\"` is invalid FHIR.\n\nThis affects all POST /r4/ValueSet/$expand records across all code systems (SNOMED, LOINC, ICD, etc.) — it's not specific to any particular ValueSet or code system.\n\n## How to reproduce\n\n```bash\ngrep '\"op\":\"expand\"' jobs/2026-02-round-1/results/deltas/deltas.ndjson | python3 -c \"\nimport json, sys\nfor line in sys.stdin:\n    rec = json.loads(line)\n    dev = json.loads(rec.get('devBody','{}'))\n    if dev.get('id') == '': print(rec['id'])\n\" | wc -l\n# Returns 690\n```\n\n## Example\n\n**Dev** (incorrect):\n```json\n{\"resourceType\":\"ValueSet\",\"status\":\"active\",\"id\":\"\",\"expansion\":{...}}\n```\n\n**Prod** (correct):\n```json\n{\"resourceType\":\"ValueSet\",\"status\":\"active\",\"expansion\":{...}}\n```", "body_html": "<p>Records-Impacted: 690<br>\nTolerance-ID: expand-dev-empty-id<br>\nRecord-ID: 2bbd9519-3a6b-4f55-8309-745d9f1b16a7</p>\n<h2>Repro</h2>\n<p>Attempted to reproduce on 2026-02-07 but the bug appears to have been <strong>fixed</strong> on tx-dev.fhir.org since the data was collected (2026-02-06).</p>\n<p>Tried 4 different $expand POST requests — none returned <code>&quot;id&quot;:&quot;&quot;</code> from dev:</p>\n<pre><code class=\"lang-bash\"># Test 1: Inline ValueSet with SNOMED concept\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;status&quot;:&quot;active&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;http://snomed.info/sct&quot;,&quot;concept&quot;:[{&quot;code&quot;:&quot;160245001&quot;}]}]}}}]}&#x27;\n\n# Test 2: Registered ValueSet by URL\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/ValueSet/medicationrequest-category&quot;}]}&#x27;\n\n# Test 3: Inline ValueSet with LOINC\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;http://loinc.org&quot;,&quot;concept&quot;:[{&quot;code&quot;:&quot;8480-6&quot;}]}]}}}]}&#x27;</code></pre>\n<p>All three return a ValueSet without <code>&quot;id&quot;:&quot;&quot;</code>. Both inline and registered ValueSet expansions now omit <code>id</code> entirely, matching prod behavior.</p>\n<p><strong>Status</strong>: No longer reproducible — likely fixed between 2026-02-06 and 2026-02-07.</p>\n<p>Dev $expand responses include <code>&quot;id&quot;: &quot;&quot;</code> at the top level of the returned ValueSet resource. Prod does not include an <code>id</code> field at all.</p>\n<h2>What differs</h2>\n<p>In all 690 $expand delta records where dev returns a successful ValueSet expansion, the dev response includes <code>&quot;id&quot;: &quot;&quot;</code> (an empty string). Prod omits the <code>id</code> field entirely, which is the correct behavior — per FHIR, string values must be non-empty if present. An empty string <code>&quot;&quot;</code> is invalid FHIR.</p>\n<p>This affects all POST /r4/ValueSet/$expand records across all code systems (SNOMED, LOINC, ICD, etc.) — it&#x27;s not specific to any particular ValueSet or code system.</p>\n<h2>How to reproduce</h2>\n<pre><code class=\"lang-bash\">grep &#x27;&quot;op&quot;:&quot;expand&quot;&#x27; jobs/2026-02-round-1/results/deltas/deltas.ndjson | python3 -c &quot;\nimport json, sys\nfor line in sys.stdin:\n    rec = json.loads(line)\n    dev = json.loads(rec.get(&#x27;devBody&#x27;,&#x27;{}&#x27;))\n    if dev.get(&#x27;id&#x27;) == &#x27;&#x27;: print(rec[&#x27;id&#x27;])\n&quot; | wc -l\n# Returns 690</code></pre>\n<h2>Example</h2>\n<p><strong>Dev</strong> (incorrect):</p>\n<pre><code class=\"lang-json\">{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;status&quot;:&quot;active&quot;,&quot;id&quot;:&quot;&quot;,&quot;expansion&quot;:{...}}</code></pre>\n<p><strong>Prod</strong> (correct):</p>\n<pre><code class=\"lang-json\">{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;status&quot;:&quot;active&quot;,&quot;expansion&quot;:{...}}</code></pre>", "impact": 690}, {"id": "e9c7e58", "title": "Dev returns empty-string expression/location in OperationOutcome issues", "status": "closed", "labels": ["P6", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 10:17", "date_iso": "2026-02-07T10:17:43-06:00", "body_md": "Records-Impacted: 318\nTolerance-ID: dev-empty-string-expression-location\nRecord-ID: 7de52d92-3166-495e-ac5e-af262b1019e4\n\n## Repro\n\n```bash\n# Prod\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$validate-code' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/ValueSet/observation-vitalsignresult\"},{\"name\":\"codeableConcept\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"http://loinc.org\",\"code\":\"109691-6\",\"display\":\"Influenza virus A Ag [Measurement] in Nasopharynx\"}]}}]}'\n\n# Dev\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$validate-code' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/ValueSet/observation-vitalsignresult\"},{\"name\":\"codeableConcept\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"http://loinc.org\",\"code\":\"109691-6\",\"display\":\"Influenza virus A Ag [Measurement] in Nasopharynx\"}]}}]}'\n```\n\nAt data collection time, prod omitted `expression` and `location` on the TX_GENERAL_CC_ERROR_MESSAGE issue (correct), while dev returned `\"expression\": [\"\"]` and `\"location\": [\"\"]` (invalid FHIR). As of 2026-02-07, dev no longer returns the empty-string fields — the bug appears fixed on the current dev server.\n\nDev returns `\"expression\": [\"\"]` and `\"location\": [\"\"]` on certain OperationOutcome issue entries in $validate-code responses, where prod correctly omits these fields entirely.\n\n## What differs\n\nIn $validate-code responses (both ValueSet and CodeSystem), dev includes `\"expression\": [\"\"]` and `\"location\": [\"\"]` on OperationOutcome issue entries that have no specific FHIRPath location. Prod omits these fields entirely, which is correct — FHIR requires strings to be non-empty if present. The empty string `\"\"` is invalid FHIR.\n\nThis occurs on issues with these message IDs:\n- TX_GENERAL_CC_ERROR_MESSAGE (311 records)\n- MSG_DRAFT (4 records)\n- MSG_DEPRECATED (3 records)\n\n## How widespread\n\n318 delta records show this pattern. All are $validate-code operations (both ValueSet/$validate-code and CodeSystem/$validate-code), all P6 priority.\n\nSearch: examined all records in deltas.ndjson where dev OperationOutcome issues contain empty-string expression or location arrays.\n\n## What the tolerance covers\n\nTolerance ID: `dev-empty-string-expression-location`. Normalizes by removing `expression: [\"\"]` and `location: [\"\"]` from OperationOutcome issues in dev responses, matching what prod does (omit the fields). This is a normalize tolerance (not skip) so other differences in these records still surface.\n\n## Representative record IDs\n\n- `7de52d92-3166-495e-ac5e-af262b1019e4` (ValueSet/$validate-code, TX_GENERAL_CC_ERROR_MESSAGE)\n- `dcdd2b94-db9...` (CodeSystem/$validate-code, TX_GENERAL_CC_ERROR_MESSAGE)", "body_html": "<p>Records-Impacted: 318<br>\nTolerance-ID: dev-empty-string-expression-location<br>\nRecord-ID: 7de52d92-3166-495e-ac5e-af262b1019e4</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod\ncurl -s &#x27;https://tx.fhir.org/r4/ValueSet/$validate-code&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/ValueSet/observation-vitalsignresult&quot;},{&quot;name&quot;:&quot;codeableConcept&quot;,&quot;valueCodeableConcept&quot;:{&quot;coding&quot;:[{&quot;system&quot;:&quot;http://loinc.org&quot;,&quot;code&quot;:&quot;109691-6&quot;,&quot;display&quot;:&quot;Influenza virus A Ag [Measurement] in Nasopharynx&quot;}]}}]}&#x27;\n\n# Dev\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$validate-code&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/ValueSet/observation-vitalsignresult&quot;},{&quot;name&quot;:&quot;codeableConcept&quot;,&quot;valueCodeableConcept&quot;:{&quot;coding&quot;:[{&quot;system&quot;:&quot;http://loinc.org&quot;,&quot;code&quot;:&quot;109691-6&quot;,&quot;display&quot;:&quot;Influenza virus A Ag [Measurement] in Nasopharynx&quot;}]}}]}&#x27;</code></pre>\n<p>At data collection time, prod omitted <code>expression</code> and <code>location</code> on the TX_GENERAL_CC_ERROR_MESSAGE issue (correct), while dev returned <code>&quot;expression&quot;: [&quot;&quot;]</code> and <code>&quot;location&quot;: [&quot;&quot;]</code> (invalid FHIR). As of 2026-02-07, dev no longer returns the empty-string fields — the bug appears fixed on the current dev server.</p>\n<p>Dev returns <code>&quot;expression&quot;: [&quot;&quot;]</code> and <code>&quot;location&quot;: [&quot;&quot;]</code> on certain OperationOutcome issue entries in $validate-code responses, where prod correctly omits these fields entirely.</p>\n<h2>What differs</h2>\n<p>In $validate-code responses (both ValueSet and CodeSystem), dev includes <code>&quot;expression&quot;: [&quot;&quot;]</code> and <code>&quot;location&quot;: [&quot;&quot;]</code> on OperationOutcome issue entries that have no specific FHIRPath location. Prod omits these fields entirely, which is correct — FHIR requires strings to be non-empty if present. The empty string <code>&quot;&quot;</code> is invalid FHIR.</p>\n<p>This occurs on issues with these message IDs:</p>\n<ul><li>TX_GENERAL_CC_ERROR_MESSAGE (311 records)</li><li>MSG_DRAFT (4 records)</li><li>MSG_DEPRECATED (3 records)</li></ul>\n<h2>How widespread</h2>\n<p>318 delta records show this pattern. All are $validate-code operations (both ValueSet/$validate-code and CodeSystem/$validate-code), all P6 priority.</p>\n<p>Search: examined all records in deltas.ndjson where dev OperationOutcome issues contain empty-string expression or location arrays.</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance ID: <code>dev-empty-string-expression-location</code>. Normalizes by removing <code>expression: [&quot;&quot;]</code> and <code>location: [&quot;&quot;]</code> from OperationOutcome issues in dev responses, matching what prod does (omit the fields). This is a normalize tolerance (not skip) so other differences in these records still surface.</p>\n<h2>Representative record IDs</h2>\n<ul><li><code>7de52d92-3166-495e-ac5e-af262b1019e4</code> (ValueSet/$validate-code, TX_GENERAL_CC_ERROR_MESSAGE)</li><li><code>dcdd2b94-db9...</code> (CodeSystem/$validate-code, TX_GENERAL_CC_ERROR_MESSAGE)</li></ul>", "impact": 318}];
const STATS = {"total": 24, "open": 22, "closed": 2, "labels": {"content-differs": 14, "tx-compare": 24, "P6": 5, "P4": 1, "dev-crash-on-error": 1, "result-disagrees": 2, "P3": 1}, "sortedLabels": ["tx-compare", "content-differs", "P6", "result-disagrees", "P4", "dev-crash-on-error", "P3"], "job": {"total": 7245, "matchedPerfectly": 0, "matchedEquiv": 4086, "knownIssues": 2705, "untriaged": 454}};

document.getElementById("gen-time").textContent = new Date().toLocaleString();

// Pipeline overview bar
(function() {
  const job = STATS.job;
  if (!job) return;
  const bar = document.getElementById("pipeline-bar");
  const segs = [
    { value: job.matchedPerfectly, label: "matched perfectly", cls: "seg-perfect" },
    { value: job.matchedEquiv, label: "considered equivalent by Claude", cls: "seg-equiv" },
    { value: job.knownIssues, label: "considered mismatches by Claude; bugs listed below", cls: "seg-known" },
    { value: job.untriaged, label: "untriaged", cls: "seg-untriaged" },
  ];
  const total = job.total;
  let html = "";
  for (const s of segs) {
    if (s.value === 0) continue;
    const pct = (s.value / total * 100);
    html += `<div class="pipeline-seg ${s.cls}" style="flex:${s.value}">
      <span class="seg-value">${s.value.toLocaleString()}</span>
      <span class="seg-label">${s.label}</span>
    </div>`;
  }
  bar.innerHTML = html;
})();

// Stats bar
(function() {
  const bar = document.getElementById("stats-bar");
  let html = `<div class="stat"><span class="stat-value">${STATS.total}</span> bugs total</div>`;
  html += `<div class="stat-divider"></div>`;
  html += `<div class="stat"><span class="stat-value" style="color:var(--status-open-fg)">${STATS.open}</span> open</div>`;
  html += `<div class="stat"><span class="stat-value">${STATS.closed}</span> closed</div>`;
  bar.innerHTML = html;
})();

// Label filter pills
(function() {
  const container = document.getElementById("label-filters");
  let html = "";
  for (const label of STATS.sortedLabels) {
    const c = STATS.labels[label] || 0;
    html += `<span class="filter-pill" data-label="${label}">${label} <span class="count">${c}</span></span>`;
  }
  container.innerHTML = html;
})();

// State
let activeLabels = new Set();
let activeStatus = "all";
let searchQuery = "";
let currentSort = "impact";

function renderBugList() {
  const list = document.getElementById("bug-list");
  // Sort bugs
  const sorted = [...BUGS];
  if (currentSort === "impact") {
    sorted.sort((a, b) => (b.impact || 0) - (a.impact || 0) || a.title.localeCompare(b.title));
  } else if (currentSort === "date") {
    sorted.sort((a, b) => (b.date_iso || "").localeCompare(a.date_iso || ""));
  } else if (currentSort === "title") {
    sorted.sort((a, b) => a.title.localeCompare(b.title));
  }

  let html = "";
  for (const bug of sorted) {
    const statusClass = bug.status === "open" ? "pill-status-open" : "pill-status-closed";
    const labels = bug.labels.map(l => `<span class="pill pill-label" data-label="${l}">${l}</span>`).join("");
    const impactPill = bug.impact ? `<span class="pill pill-impact">${bug.impact.toLocaleString()} records</span>` : "";

    html += `<div class="bug-card" data-status="${bug.status}" data-id="${bug.id}" data-labels="${bug.labels.join(",")}" data-impact="${bug.impact || 0}">
      <div class="bug-header" onclick="toggleBug(this)">
        <svg class="bug-expand-icon" viewBox="0 0 16 16" fill="currentColor">
          <path d="M6.22 3.22a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042L9.94 8 6.22 4.28a.75.75 0 0 1 0-1.06Z"/>
        </svg>
        <div class="bug-info">
          <div class="bug-title">${bug.title}</div>
          <div class="bug-meta">
            <span class="pill ${statusClass}">${bug.status}</span>
            ${labels}
            ${impactPill}
            <span class="bug-id">${bug.id}</span>
            <span class="bug-date">${bug.date}</span>
          </div>
        </div>
      </div>
      <div class="bug-body">${bug.body_html}</div>
    </div>`;
  }

  list.innerHTML = html;
  applyFilters();
}

function toggleBug(header) {
  header.parentElement.classList.toggle("expanded");
}

let allExpanded = false;
function toggleExpandAll() {
  allExpanded = !allExpanded;
  const cards = document.querySelectorAll(".bug-card:not(.hidden)");
  cards.forEach(c => c.classList.toggle("expanded", allExpanded));
  document.getElementById("expand-all-btn").textContent = allExpanded ? "Collapse all" : "Expand all";
}

function applyFilters() {
  const cards = document.querySelectorAll(".bug-card");
  const query = searchQuery.toLowerCase();
  let visibleCount = 0;

  cards.forEach(card => {
    const status = card.dataset.status;
    const cardLabels = card.dataset.labels ? card.dataset.labels.split(",") : [];
    const bugId = card.dataset.id;
    const bug = BUGS.find(b => b.id === bugId);

    let show = true;

    // Label filter: card must have at least one of the active labels
    if (activeLabels.size > 0) {
      if (!cardLabels.some(l => activeLabels.has(l))) {
        show = false;
      }
    }

    if (activeStatus !== "all" && status !== activeStatus) {
      show = false;
    }

    if (query && show && bug) {
      const searchable = (bug.title + " " + bug.body_md + " " + bug.labels.join(" ")).toLowerCase();
      if (!searchable.includes(query)) {
        show = false;
      }
    }

    card.classList.toggle("hidden", !show);
    if (show) visibleCount++;
  });

  document.getElementById("no-results").classList.toggle("hidden", visibleCount > 0);
}

// Search
document.getElementById("search").addEventListener("input", function() {
  searchQuery = this.value;
  applyFilters();
});

// Label filter pills
document.querySelectorAll(".filter-pill[data-label]").forEach(pill => {
  pill.addEventListener("click", function() {
    const label = this.dataset.label;
    if (activeLabels.has(label)) {
      activeLabels.delete(label);
      this.classList.remove("dimmed");
    } else {
      if (activeLabels.size === 0) {
        document.querySelectorAll(".filter-pill[data-label]").forEach(pp => {
          if (pp.dataset.label !== label) pp.classList.add("dimmed");
        });
        activeLabels.add(label);
      } else {
        activeLabels.add(label);
        this.classList.remove("dimmed");
      }
    }

    if (activeLabels.size === 0) {
      document.querySelectorAll(".filter-pill[data-label]").forEach(pp => {
        pp.classList.remove("dimmed");
      });
    }

    applyFilters();
  });
});

// Status filter buttons
document.querySelectorAll(".ctrl-btn[data-status]").forEach(btn => {
  btn.addEventListener("click", function() {
    document.querySelectorAll(".ctrl-btn[data-status]").forEach(b => b.classList.remove("active"));
    this.classList.add("active");
    activeStatus = this.dataset.status;
    applyFilters();
  });
});

// Sort buttons
document.querySelectorAll(".sort-btn").forEach(btn => {
  btn.addEventListener("click", function() {
    document.querySelectorAll(".sort-btn").forEach(b => b.classList.remove("active"));
    this.classList.add("active");
    currentSort = this.dataset.sort;
    renderBugList();
  });
});

// Initial render
renderBugList();
</script>
</body>
</html>