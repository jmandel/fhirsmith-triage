<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FHIRsmith tx-compare Bug Report</title>
<style>
:root {
  --bg: #ffffff;
  --bg-surface: #f6f8fa;
  --bg-card: #ffffff;
  --border: #d1d9e0;
  --border-light: #e8ecf0;
  --text: #1f2328;
  --text-secondary: #59636e;
  --text-muted: #818b98;
  --shadow: 0 1px 3px rgba(0,0,0,0.08), 0 1px 2px rgba(0,0,0,0.04);
  --shadow-hover: 0 4px 12px rgba(0,0,0,0.1), 0 2px 4px rgba(0,0,0,0.06);
  --radius: 8px;
  --radius-sm: 6px;
  --font: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans", Helvetica, Arial, sans-serif;
  --font-mono: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace;

  --pill-tx-bg: #ccfbf1; --pill-tx-fg: #115e59; --pill-tx-border: #5eead4;
  --pill-default-bg: #f3f4f6; --pill-default-fg: #4b5563; --pill-default-border: #d1d5db;

  --status-open-bg: #dcfce7; --status-open-fg: #166534; --status-open-border: #86efac;
  --status-closed-bg: #f3f4f6; --status-closed-fg: #6b7280; --status-closed-border: #d1d5db;
}

@media (prefers-color-scheme: dark) {
  :root {
    --bg: #0d1117;
    --bg-surface: #161b22;
    --bg-card: #1c2128;
    --border: #30363d;
    --border-light: #21262d;
    --text: #e6edf3;
    --text-secondary: #8b949e;
    --text-muted: #6e7681;
    --shadow: 0 1px 3px rgba(0,0,0,0.3), 0 1px 2px rgba(0,0,0,0.2);
    --shadow-hover: 0 4px 12px rgba(0,0,0,0.4), 0 2px 4px rgba(0,0,0,0.3);

    --pill-tx-bg: #042f2e; --pill-tx-fg: #5eead4; --pill-tx-border: #134e4a;
    --pill-default-bg: #1f2937; --pill-default-fg: #9ca3af; --pill-default-border: #374151;

    --status-open-bg: #052e16; --status-open-fg: #86efac; --status-open-border: #14532d;
    --status-closed-bg: #1f2937; --status-closed-fg: #9ca3af; --status-closed-border: #374151;
  }
}

*, *::before, *::after { box-sizing: border-box; }

body {
  font-family: var(--font);
  background: var(--bg);
  color: var(--text);
  margin: 0;
  padding: 0;
  line-height: 1.6;
}

.container {
  max-width: 960px;
  margin: 0 auto;
  padding: 24px 16px;
}

h1 {
  font-size: 24px;
  font-weight: 700;
  margin: 0 0 4px 0;
}

.subtitle {
  color: var(--text-muted);
  font-size: 14px;
  margin: 0 0 24px 0;
}

.stats-bar {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 20px;
  padding: 16px;
  background: var(--bg-surface);
  border: 1px solid var(--border-light);
  border-radius: var(--radius);
}

.stat {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 13px;
  color: var(--text-secondary);
  padding: 4px 10px;
  border-radius: var(--radius-sm);
  background: var(--bg-card);
  border: 1px solid var(--border-light);
}

.stat-value {
  font-weight: 700;
  color: var(--text);
  font-size: 15px;
}

.stat-divider {
  width: 1px;
  height: 24px;
  background: var(--border);
  margin: 0 4px;
}

.filter-bar {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-bottom: 20px;
  align-items: center;
}

.search-box {
  flex: 1;
  min-width: 200px;
  padding: 8px 12px;
  font-size: 14px;
  font-family: var(--font);
  background: var(--bg-card);
  color: var(--text);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  outline: none;
  transition: border-color 0.15s, box-shadow 0.15s;
}

.search-box:focus {
  border-color: #3b82f6;
  box-shadow: 0 0 0 3px rgba(59,130,246,0.15);
}

.search-box::placeholder {
  color: var(--text-muted);
}

.filter-pills {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.filter-pill {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 4px 10px;
  font-size: 12px;
  font-weight: 600;
  border-radius: 999px;
  cursor: pointer;
  user-select: none;
  transition: opacity 0.15s, transform 0.1s;
  border: 1px solid var(--pill-default-border);
  background: var(--pill-default-bg);
  color: var(--pill-default-fg);
}

.filter-pill[data-label="tx-compare"] {
  background: var(--pill-tx-bg);
  color: var(--pill-tx-fg);
  border-color: var(--pill-tx-border);
}

.filter-pill:hover {
  transform: translateY(-1px);
}

.filter-pill.dimmed {
  opacity: 0.35;
}

.filter-pill .count {
  font-weight: 400;
  opacity: 0.8;
}

.controls {
  display: flex;
  gap: 4px;
  margin-left: auto;
  flex-wrap: wrap;
}

.ctrl-btn {
  padding: 4px 10px;
  font-size: 12px;
  font-weight: 600;
  border-radius: var(--radius-sm);
  cursor: pointer;
  border: 1px solid var(--border);
  background: var(--bg-card);
  color: var(--text-secondary);
  font-family: var(--font);
  transition: background 0.15s, color 0.15s;
}

.ctrl-btn:hover {
  background: var(--bg-surface);
}

.ctrl-btn.active {
  background: var(--text);
  color: var(--bg);
  border-color: var(--text);
}

.bug-card {
  background: var(--bg-card);
  border: 1px solid var(--border-light);
  border-radius: var(--radius);
  margin-bottom: 8px;
  box-shadow: var(--shadow);
  transition: box-shadow 0.15s, border-color 0.15s;
  overflow: hidden;
}

.bug-card:hover {
  box-shadow: var(--shadow-hover);
  border-color: var(--border);
}

.bug-card.hidden {
  display: none;
}

.bug-header {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  padding: 12px 16px;
  cursor: pointer;
  user-select: none;
}

.bug-header:hover {
  background: var(--bg-surface);
}

.bug-expand-icon {
  flex-shrink: 0;
  width: 18px;
  height: 18px;
  margin-top: 2px;
  color: var(--text-muted);
  transition: transform 0.2s;
}

.bug-card.expanded .bug-expand-icon {
  transform: rotate(90deg);
}

.bug-info {
  flex: 1;
  min-width: 0;
}

.bug-title {
  font-size: 14px;
  font-weight: 600;
  line-height: 1.4;
  word-break: break-word;
}

.bug-meta {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 6px;
  margin-top: 6px;
}

.pill {
  display: inline-flex;
  align-items: center;
  padding: 1px 8px;
  font-size: 11px;
  font-weight: 600;
  border-radius: 999px;
  border: 1px solid;
  white-space: nowrap;
}

.pill-status-open {
  background: var(--status-open-bg);
  color: var(--status-open-fg);
  border-color: var(--status-open-border);
}

.pill-status-closed {
  background: var(--status-closed-bg);
  color: var(--status-closed-fg);
  border-color: var(--status-closed-border);
}

.pill-label {
  background: var(--pill-default-bg);
  color: var(--pill-default-fg);
  border-color: var(--pill-default-border);
}

.pill-label[data-label="tx-compare"] {
  background: var(--pill-tx-bg);
  color: var(--pill-tx-fg);
  border-color: var(--pill-tx-border);
}

.pill-impact {
  background: #fef3c7;
  color: #92400e;
  border-color: #fcd34d;
  font-family: var(--font-mono);
  font-size: 10px;
}

@media (prefers-color-scheme: dark) {
  .pill-impact {
    background: #3b2f0b;
    color: #fcd34d;
    border-color: #78350f;
  }
}

.bug-id {
  font-size: 11px;
  color: var(--text-muted);
  font-family: var(--font-mono);
}

.bug-date {
  font-size: 11px;
  color: var(--text-muted);
}

.bug-body {
  display: none;
  padding: 0 16px 16px 44px;
  border-top: 1px solid var(--border-light);
}

.bug-card.expanded .bug-body {
  display: block;
}

.bug-body h1, .bug-body h2, .bug-body h3,
.bug-body h4, .bug-body h5, .bug-body h6 {
  margin: 16px 0 8px 0;
  font-weight: 700;
  line-height: 1.3;
}

.bug-body h1 { font-size: 18px; }
.bug-body h2 { font-size: 16px; }
.bug-body h3 { font-size: 14px; }
.bug-body h4, .bug-body h5, .bug-body h6 { font-size: 13px; }

.bug-body p {
  margin: 8px 0;
  font-size: 13px;
  line-height: 1.65;
}

.bug-body ul, .bug-body ol {
  margin: 8px 0;
  padding-left: 24px;
  font-size: 13px;
}

.bug-body li {
  margin: 4px 0;
  line-height: 1.55;
}

.bug-body code {
  font-family: var(--font-mono);
  font-size: 12px;
  background: var(--bg-surface);
  padding: 2px 6px;
  border-radius: 4px;
  border: 1px solid var(--border-light);
}

.bug-body pre {
  background: var(--bg-surface);
  border: 1px solid var(--border-light);
  border-radius: var(--radius-sm);
  padding: 12px 16px;
  overflow-x: auto;
  margin: 12px 0;
}

.bug-body pre code {
  background: none;
  border: none;
  padding: 0;
  font-size: 12px;
  line-height: 1.5;
}

.bug-body hr {
  border: none;
  border-top: 1px solid var(--border-light);
  margin: 16px 0;
}

.bug-body strong { font-weight: 700; }
.bug-body em { font-style: italic; }
.bug-body a { color: #3b82f6; text-decoration: none; }
.bug-body a:hover { text-decoration: underline; }

.no-results {
  text-align: center;
  padding: 48px 16px;
  color: var(--text-muted);
  font-size: 14px;
}

.no-results.hidden {
  display: none;
}

@media (max-width: 640px) {
  .container { padding: 16px 12px; }
  .stats-bar { padding: 12px; gap: 6px; }
  .stat-divider { display: none; }
  .filter-bar { flex-direction: column; }
  .search-box { min-width: 100%; }
  .bug-body { padding: 0 12px 12px 12px; }
  .bug-header { padding: 10px 12px; }
  .controls { margin-left: 0; }
}
</style>
</head>
<body>
<div class="container">
  <h1>FHIRsmith tx-compare Bugs</h1>
  <p class="subtitle">Generated from git-bug &middot; <span id="gen-time"></span></p>

  <div class="stats-bar" id="stats-bar"></div>

  <div class="filter-bar">
    <input type="text" class="search-box" id="search" placeholder="Search bugs by title or body..." autocomplete="off">
    <div class="filter-pills" id="label-filters"></div>
    <div class="controls">
      <button class="ctrl-btn" id="expand-all-btn" onclick="toggleExpandAll()">Expand all</button>
      <span class="stat-divider"></span>
      <button class="ctrl-btn active" data-status="all">All</button>
      <button class="ctrl-btn" data-status="open">Open</button>
      <button class="ctrl-btn" data-status="closed">Closed</button>
      <span class="stat-divider"></span>
      <button class="ctrl-btn sort-btn active" data-sort="impact">Impact</button>
      <button class="ctrl-btn sort-btn" data-sort="date">Date</button>
      <button class="ctrl-btn sort-btn" data-sort="title">Title</button>
    </div>
  </div>

  <div id="bug-list"></div>
  <div class="no-results hidden" id="no-results">No bugs match your filters.</div>
</div>

<script>
const BUGS = [{"id": "2abe02d", "title": "Dev $expand returns empty string id on ValueSet response", "status": "open", "labels": ["content-differs", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 11:31", "date_iso": "2026-02-07T11:31:49-06:00", "body_md": "Records-Impacted: 690\nTolerance-ID: expand-dev-empty-id\nRecord-ID: 2bbd9519-3a6b-4f55-8309-745d9f1b16a7\n\nDev $expand responses include `\"id\": \"\"` at the top level of the returned ValueSet resource. Prod does not include an `id` field at all.\n\n## What differs\n\nIn all 690 $expand delta records where dev returns a successful ValueSet expansion, the dev response includes `\"id\": \"\"` (an empty string). Prod omits the `id` field entirely, which is the correct behavior — per FHIR, string values must be non-empty if present. An empty string `\"\"` is invalid FHIR.\n\nThis affects all POST /r4/ValueSet/$expand records across all code systems (SNOMED, LOINC, ICD, etc.) — it's not specific to any particular ValueSet or code system.\n\n## How to reproduce\n\n```bash\ngrep '\"op\":\"expand\"' jobs/2026-02-round-1/results/deltas/deltas.ndjson | python3 -c \"\nimport json, sys\nfor line in sys.stdin:\n    rec = json.loads(line)\n    dev = json.loads(rec.get('devBody','{}'))\n    if dev.get('id') == '': print(rec['id'])\n\" | wc -l\n# Returns 690\n```\n\n## Example\n\n**Dev** (incorrect):\n```json\n{\"resourceType\":\"ValueSet\",\"status\":\"active\",\"id\":\"\",\"expansion\":{...}}\n```\n\n**Prod** (correct):\n```json\n{\"resourceType\":\"ValueSet\",\"status\":\"active\",\"expansion\":{...}}\n```", "body_html": "<p>Records-Impacted: 690<br>\nTolerance-ID: expand-dev-empty-id<br>\nRecord-ID: 2bbd9519-3a6b-4f55-8309-745d9f1b16a7</p>\n<p>Dev $expand responses include <code>&quot;id&quot;: &quot;&quot;</code> at the top level of the returned ValueSet resource. Prod does not include an <code>id</code> field at all.</p>\n<h2>What differs</h2>\n<p>In all 690 $expand delta records where dev returns a successful ValueSet expansion, the dev response includes <code>&quot;id&quot;: &quot;&quot;</code> (an empty string). Prod omits the <code>id</code> field entirely, which is the correct behavior — per FHIR, string values must be non-empty if present. An empty string <code>&quot;&quot;</code> is invalid FHIR.</p>\n<p>This affects all POST /r4/ValueSet/$expand records across all code systems (SNOMED, LOINC, ICD, etc.) — it&#x27;s not specific to any particular ValueSet or code system.</p>\n<h2>How to reproduce</h2>\n<pre><code class=\"lang-bash\">grep &#x27;&quot;op&quot;:&quot;expand&quot;&#x27; jobs/2026-02-round-1/results/deltas/deltas.ndjson | python3 -c &quot;\nimport json, sys\nfor line in sys.stdin:\n    rec = json.loads(line)\n    dev = json.loads(rec.get(&#x27;devBody&#x27;,&#x27;{}&#x27;))\n    if dev.get(&#x27;id&#x27;) == &#x27;&#x27;: print(rec[&#x27;id&#x27;])\n&quot; | wc -l\n# Returns 690</code></pre>\n<h2>Example</h2>\n<p><strong>Dev</strong> (incorrect):</p>\n<pre><code class=\"lang-json\">{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;status&quot;:&quot;active&quot;,&quot;id&quot;:&quot;&quot;,&quot;expansion&quot;:{...}}</code></pre>\n<p><strong>Prod</strong> (correct):</p>\n<pre><code class=\"lang-json\">{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;status&quot;:&quot;active&quot;,&quot;expansion&quot;:{...}}</code></pre>", "impact": 690}, {"id": "d1b7d3b", "title": "Dev $expand echoes includeDefinition=false parameter in expansion", "status": "open", "labels": ["content-differs", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 11:31", "date_iso": "2026-02-07T11:31:56-06:00", "body_md": "Records-Impacted: 677\nTolerance-ID: expand-dev-includeDefinition-param\nRecord-ID: 2bbd9519-3a6b-4f55-8309-745d9f1b16a7\n\nDev $expand responses include an extra `includeDefinition` parameter (value: false) in the expansion.parameter array. Prod does not include this parameter.\n\n## What differs\n\nIn 677 of the 893 $expand delta records, dev includes `{\"name\":\"includeDefinition\",\"valueBoolean\":false}` in the `expansion.parameter` array. Prod omits this parameter entirely.\n\nThe `includeDefinition` parameter is an input parameter to the $expand operation. While it's valid to echo input parameters in the expansion.parameter array, prod doesn't do it for this parameter (presumably because false is the default). This is a behavioral difference — not a conformance violation per se, but a real difference in what the servers return.\n\n## How to reproduce\n\n```bash\ngrep '\"op\":\"expand\"' jobs/2026-02-round-1/results/deltas/deltas.ndjson | python3 -c \"\nimport json, sys\nfor line in sys.stdin:\n    rec = json.loads(line)\n    dev = json.loads(rec.get('devBody','{}'))\n    params = dev.get('expansion',{}).get('parameter',[])\n    if any(p.get('name')=='includeDefinition' for p in params): print(rec['id'])\n\" | wc -l\n# Returns 677\n```\n\n## Example\n\n**Dev** includes extra parameter:\n```json\n\"parameter\": [\n  {\"name\":\"excludeNested\",\"valueBoolean\":true},\n  {\"name\":\"includeDefinition\",\"valueBoolean\":false},  // <-- extra\n  {\"name\":\"offset\",\"valueInteger\":0},\n  ...\n]\n```\n\n**Prod** omits it:\n```json\n\"parameter\": [\n  {\"name\":\"excludeNested\",\"valueBoolean\":true},\n  {\"name\":\"offset\",\"valueInteger\":0},\n  ...\n]\n```", "body_html": "<p>Records-Impacted: 677<br>\nTolerance-ID: expand-dev-includeDefinition-param<br>\nRecord-ID: 2bbd9519-3a6b-4f55-8309-745d9f1b16a7</p>\n<p>Dev $expand responses include an extra <code>includeDefinition</code> parameter (value: false) in the expansion.parameter array. Prod does not include this parameter.</p>\n<h2>What differs</h2>\n<p>In 677 of the 893 $expand delta records, dev includes <code>{&quot;name&quot;:&quot;includeDefinition&quot;,&quot;valueBoolean&quot;:false}</code> in the <code>expansion.parameter</code> array. Prod omits this parameter entirely.</p>\n<p>The <code>includeDefinition</code> parameter is an input parameter to the $expand operation. While it&#x27;s valid to echo input parameters in the expansion.parameter array, prod doesn&#x27;t do it for this parameter (presumably because false is the default). This is a behavioral difference — not a conformance violation per se, but a real difference in what the servers return.</p>\n<h2>How to reproduce</h2>\n<pre><code class=\"lang-bash\">grep &#x27;&quot;op&quot;:&quot;expand&quot;&#x27; jobs/2026-02-round-1/results/deltas/deltas.ndjson | python3 -c &quot;\nimport json, sys\nfor line in sys.stdin:\n    rec = json.loads(line)\n    dev = json.loads(rec.get(&#x27;devBody&#x27;,&#x27;{}&#x27;))\n    params = dev.get(&#x27;expansion&#x27;,{}).get(&#x27;parameter&#x27;,[])\n    if any(p.get(&#x27;name&#x27;)==&#x27;includeDefinition&#x27; for p in params): print(rec[&#x27;id&#x27;])\n&quot; | wc -l\n# Returns 677</code></pre>\n<h2>Example</h2>\n<p><strong>Dev</strong> includes extra parameter:</p>\n<pre><code class=\"lang-json\">&quot;parameter&quot;: [\n  {&quot;name&quot;:&quot;excludeNested&quot;,&quot;valueBoolean&quot;:true},\n  {&quot;name&quot;:&quot;includeDefinition&quot;,&quot;valueBoolean&quot;:false},  // &lt;-- extra\n  {&quot;name&quot;:&quot;offset&quot;,&quot;valueInteger&quot;:0},\n  ...\n]</code></pre>\n<p><strong>Prod</strong> omits it:</p>\n<pre><code class=\"lang-json\">&quot;parameter&quot;: [\n  {&quot;name&quot;:&quot;excludeNested&quot;,&quot;valueBoolean&quot;:true},\n  {&quot;name&quot;:&quot;offset&quot;,&quot;valueInteger&quot;:0},\n  ...\n]</code></pre>", "impact": 677}, {"id": "4233647", "title": "Searchset Bundle formatting: empty entry array, extra pagination links, absolute URLs", "status": "open", "labels": ["P6", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 10:54", "date_iso": "2026-02-07T10:54:51-06:00", "body_md": "Records-Impacted: 491\nTolerance-ID: searchset-bundle-format\nRecord-ID: c97f36a4-973b-42c5-8b6d-58464195cfd5\n\n## What differs\n\nDev's searchset Bundle responses differ from prod in several ways:\n\n1. **`entry: []` on empty results**: When a search returns no results (total: 0), dev includes `entry: []` (an empty array). Prod omits the entry field entirely. Empty arrays violate FHIR's general rule that arrays, if present, must be non-empty.\n\n2. **Extra pagination link relations**: Dev returns `self`, `first`, and `last` link relations. Prod returns only `self`. This applies to both empty and non-empty search results.\n\n3. **Absolute vs relative link URLs**: Dev uses absolute URLs with full host prefix (e.g., `http://tx.fhir.org/r4/ValueSet?...&_offset=0`). Prod uses relative URLs (e.g., `ValueSet?&url=...`). Dev also appends `_offset=0` to search links.\n\n4. **Server-generated metadata**: Prod includes `id` and `meta.lastUpdated` on searchset Bundles. Dev omits these. (This is server-generated transient metadata and is the least significant difference.)\n\n## How widespread\n\nAffects all searchset Bundle responses for ValueSet and CodeSystem searches:\n- 337 empty ValueSet search Bundles\n- 154 empty CodeSystem search Bundles  \n- 7 non-empty searchset Bundles (these also have the extra links, and may have other substantive differences like total count disagreements)\n\nTotal: **498 records** in the deltas file.\n\nSearch used: Parsed all records with `ValueSet?` or `CodeSystem?` in the URL where prodBody contains a Bundle with type \"searchset\".\n\n## Representative record IDs\n\n- `c97f36a4-973b-42c5-8b6d-58464195cfd5` (empty ValueSet search, RadLex Playbook)\n- `4ab7655f-015d-4f44-b184-5ba0fd256926` (empty ValueSet search, DICOM)\n- `640875e4-3839-40d1-aaa1-0bf79bef77f2` (non-empty CodeSystem search, USPS)", "body_html": "<p>Records-Impacted: 491<br>\nTolerance-ID: searchset-bundle-format<br>\nRecord-ID: c97f36a4-973b-42c5-8b6d-58464195cfd5</p>\n<h2>What differs</h2>\n<p>Dev&#x27;s searchset Bundle responses differ from prod in several ways:</p>\n<ol><li>**<code>entry: []</code> on empty results**: When a search returns no results (total: 0), dev includes <code>entry: []</code> (an empty array). Prod omits the entry field entirely. Empty arrays violate FHIR&#x27;s general rule that arrays, if present, must be non-empty.</li></ol>\n<ol><li><strong>Extra pagination link relations</strong>: Dev returns <code>self</code>, <code>first</code>, and <code>last</code> link relations. Prod returns only <code>self</code>. This applies to both empty and non-empty search results.</li></ol>\n<ol><li><strong>Absolute vs relative link URLs</strong>: Dev uses absolute URLs with full host prefix (e.g., <code>http://tx.fhir.org/r4/ValueSet?...&amp;_offset=0</code>). Prod uses relative URLs (e.g., <code>ValueSet?&amp;url=...</code>). Dev also appends <code>_offset=0</code> to search links.</li></ol>\n<ol><li><strong>Server-generated metadata</strong>: Prod includes <code>id</code> and <code>meta.lastUpdated</code> on searchset Bundles. Dev omits these. (This is server-generated transient metadata and is the least significant difference.)</li></ol>\n<h2>How widespread</h2>\n<p>Affects all searchset Bundle responses for ValueSet and CodeSystem searches:</p>\n<ul><li>337 empty ValueSet search Bundles</li><li>154 empty CodeSystem search Bundles</li><li>7 non-empty searchset Bundles (these also have the extra links, and may have other substantive differences like total count disagreements)</li></ul>\n<p>Total: <strong>498 records</strong> in the deltas file.</p>\n<p>Search used: Parsed all records with <code>ValueSet?</code> or <code>CodeSystem?</code> in the URL where prodBody contains a Bundle with type &quot;searchset&quot;.</p>\n<h2>Representative record IDs</h2>\n<ul><li><code>c97f36a4-973b-42c5-8b6d-58464195cfd5</code> (empty ValueSet search, RadLex Playbook)</li><li><code>4ab7655f-015d-4f44-b184-5ba0fd256926</code> (empty ValueSet search, DICOM)</li><li><code>640875e4-3839-40d1-aaa1-0bf79bef77f2</code> (non-empty CodeSystem search, USPS)</li></ul>", "impact": 491}, {"id": "e9c7e58", "title": "Dev returns empty-string expression/location in OperationOutcome issues", "status": "open", "labels": ["P6", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 10:17", "date_iso": "2026-02-07T10:17:43-06:00", "body_md": "Records-Impacted: 318\nTolerance-ID: dev-empty-string-expression-location\nRecord-ID: 7de52d92-3166-495e-ac5e-af262b1019e4\n\nDev returns `\"expression\": [\"\"]` and `\"location\": [\"\"]` on certain OperationOutcome issue entries in $validate-code responses, where prod correctly omits these fields entirely.\n\n## What differs\n\nIn $validate-code responses (both ValueSet and CodeSystem), dev includes `\"expression\": [\"\"]` and `\"location\": [\"\"]` on OperationOutcome issue entries that have no specific FHIRPath location. Prod omits these fields entirely, which is correct — FHIR requires strings to be non-empty if present. The empty string `\"\"` is invalid FHIR.\n\nThis occurs on issues with these message IDs:\n- TX_GENERAL_CC_ERROR_MESSAGE (311 records)\n- MSG_DRAFT (4 records)\n- MSG_DEPRECATED (3 records)\n\n## How widespread\n\n318 delta records show this pattern. All are $validate-code operations (both ValueSet/$validate-code and CodeSystem/$validate-code), all P6 priority.\n\nSearch: examined all records in deltas.ndjson where dev OperationOutcome issues contain empty-string expression or location arrays.\n\n## What the tolerance covers\n\nTolerance ID: `dev-empty-string-expression-location`. Normalizes by removing `expression: [\"\"]` and `location: [\"\"]` from OperationOutcome issues in dev responses, matching what prod does (omit the fields). This is a normalize tolerance (not skip) so other differences in these records still surface.\n\n## Representative record IDs\n\n- `7de52d92-3166-495e-ac5e-af262b1019e4` (ValueSet/$validate-code, TX_GENERAL_CC_ERROR_MESSAGE)\n- `dcdd2b94-db9...` (CodeSystem/$validate-code, TX_GENERAL_CC_ERROR_MESSAGE)", "body_html": "<p>Records-Impacted: 318<br>\nTolerance-ID: dev-empty-string-expression-location<br>\nRecord-ID: 7de52d92-3166-495e-ac5e-af262b1019e4</p>\n<p>Dev returns <code>&quot;expression&quot;: [&quot;&quot;]</code> and <code>&quot;location&quot;: [&quot;&quot;]</code> on certain OperationOutcome issue entries in $validate-code responses, where prod correctly omits these fields entirely.</p>\n<h2>What differs</h2>\n<p>In $validate-code responses (both ValueSet and CodeSystem), dev includes <code>&quot;expression&quot;: [&quot;&quot;]</code> and <code>&quot;location&quot;: [&quot;&quot;]</code> on OperationOutcome issue entries that have no specific FHIRPath location. Prod omits these fields entirely, which is correct — FHIR requires strings to be non-empty if present. The empty string <code>&quot;&quot;</code> is invalid FHIR.</p>\n<p>This occurs on issues with these message IDs:</p>\n<ul><li>TX_GENERAL_CC_ERROR_MESSAGE (311 records)</li><li>MSG_DRAFT (4 records)</li><li>MSG_DEPRECATED (3 records)</li></ul>\n<h2>How widespread</h2>\n<p>318 delta records show this pattern. All are $validate-code operations (both ValueSet/$validate-code and CodeSystem/$validate-code), all P6 priority.</p>\n<p>Search: examined all records in deltas.ndjson where dev OperationOutcome issues contain empty-string expression or location arrays.</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance ID: <code>dev-empty-string-expression-location</code>. Normalizes by removing <code>expression: [&quot;&quot;]</code> and <code>location: [&quot;&quot;]</code> from OperationOutcome issues in dev responses, matching what prod does (omit the fields). This is a normalize tolerance (not skip) so other differences in these records still surface.</p>\n<h2>Representative record IDs</h2>\n<ul><li><code>7de52d92-3166-495e-ac5e-af262b1019e4</code> (ValueSet/$validate-code, TX_GENERAL_CC_ERROR_MESSAGE)</li><li><code>dcdd2b94-db9...</code> (CodeSystem/$validate-code, TX_GENERAL_CC_ERROR_MESSAGE)</li></ul>", "impact": 318}, {"id": "1c145d2", "title": "Dev returns 404 instead of 422 for  when referenced CodeSystem is not found", "status": "open", "labels": ["P4", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 11:00", "date_iso": "2026-02-07T11:00:00-06:00", "body_md": "Records-Impacted: 296\nTolerance-ID: expand-422-vs-404-codesystem-not-found\nRecord-ID: eee2c985-52e0-4520-b4e4-01766ede5a7d\n\n## What differs\n\nWhen a ValueSet $expand fails because a referenced CodeSystem definition cannot be found, prod returns HTTP 422 (Unprocessable Entity) while dev returns HTTP 404 (Not Found). The OperationOutcome error message is identical on both sides: \"A definition for CodeSystem '...' could not be found, so the value set cannot be expanded\". The issue code is `not-found` in both cases.\n\nAdditionally, dev includes `location: [null]` and `expression: [null]` arrays in the OperationOutcome issue (prod omits these), and dev omits the `text` narrative element that prod includes. These are secondary cosmetic differences; the primary issue is the status code mismatch.\n\n## How widespread\n\n296 records in this comparison batch. All are POST /r4/ValueSet/$expand operations where the error message contains \"could not be found, so the value set cannot be expanded\".\n\nSearch: `grep '\"prodStatus\":422,\"devStatus\":404' jobs/2026-02-round-1/results/deltas/deltas.ndjson | wc -l` → 296\n\nAll 296 have:\n- Operation: POST /r4/ValueSet/$expand\n- Prod status: 422\n- Dev status: 404\n- OperationOutcome issue code: not-found\n- Identical error message text\n\n## What the tolerance covers\n\nTolerance ID: `expand-422-vs-404-codesystem-not-found`\nMatches: POST /r4/ValueSet/$expand where prodStatus=422 and devStatus=404, and the OperationOutcome contains \"could not be found, so the value set cannot be expanded\".\nNormalizes: status code difference, strips null location/expression arrays from dev, strips text narrative from prod. Compares remaining OperationOutcome content.\nAffects: 296 records.\n\n## Representative record\n\nID: eee2c985-52e0-4520-b4e4-01766ede5a7d", "body_html": "<p>Records-Impacted: 296<br>\nTolerance-ID: expand-422-vs-404-codesystem-not-found<br>\nRecord-ID: eee2c985-52e0-4520-b4e4-01766ede5a7d</p>\n<h2>What differs</h2>\n<p>When a ValueSet $expand fails because a referenced CodeSystem definition cannot be found, prod returns HTTP 422 (Unprocessable Entity) while dev returns HTTP 404 (Not Found). The OperationOutcome error message is identical on both sides: &quot;A definition for CodeSystem &#x27;...&#x27; could not be found, so the value set cannot be expanded&quot;. The issue code is <code>not-found</code> in both cases.</p>\n<p>Additionally, dev includes <code>location: [null]</code> and <code>expression: [null]</code> arrays in the OperationOutcome issue (prod omits these), and dev omits the <code>text</code> narrative element that prod includes. These are secondary cosmetic differences; the primary issue is the status code mismatch.</p>\n<h2>How widespread</h2>\n<p>296 records in this comparison batch. All are POST /r4/ValueSet/$expand operations where the error message contains &quot;could not be found, so the value set cannot be expanded&quot;.</p>\n<p>Search: <code>grep &#x27;&quot;prodStatus&quot;:422,&quot;devStatus&quot;:404&#x27; jobs/2026-02-round-1/results/deltas/deltas.ndjson | wc -l</code> → 296</p>\n<p>All 296 have:</p>\n<ul><li>Operation: POST /r4/ValueSet/$expand</li><li>Prod status: 422</li><li>Dev status: 404</li><li>OperationOutcome issue code: not-found</li><li>Identical error message text</li></ul>\n<h2>What the tolerance covers</h2>\n<p>Tolerance ID: <code>expand-422-vs-404-codesystem-not-found</code><br>\nMatches: POST /r4/ValueSet/$expand where prodStatus=422 and devStatus=404, and the OperationOutcome contains &quot;could not be found, so the value set cannot be expanded&quot;.<br>\nNormalizes: status code difference, strips null location/expression arrays from dev, strips text narrative from prod. Compares remaining OperationOutcome content.<br>\nAffects: 296 records.</p>\n<h2>Representative record</h2>\n<p>ID: eee2c985-52e0-4520-b4e4-01766ede5a7d</p>", "impact": 296}, {"id": "17ad254", "title": "UCUM -code: dev returns human-readable display instead of code-as-display", "status": "open", "labels": ["content-differs", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 11:19", "date_iso": "2026-02-07T11:19:46-06:00", "body_md": "Records-Impacted: 220\nTolerance-ID: ucum-display-code-as-display\nRecord-ID: 6ae99904-538b-4241-89db-b15eab6e637e\n\n## What differs\n\nFor UCUM ($validate-code) operations, prod returns the UCUM code itself as the `display` parameter (e.g., `[in_i]`, `[lb_av]`, `mg`, `%`), while dev returns a human-readable name (e.g., `(inch)`, `(pound)`, `(milligram)`, `(percent)`).\n\nPer the FHIR UCUM guidance (https://terminology.hl7.org/UCUM.html): \"No standardized display value is defined. The UCUM code itself is used directly as the display.\" Prod follows this convention; dev does not.\n\nAll other parameters (result, system, code, version) agree between prod and dev. Display is the only difference.\n\nExamples:\n- code=[in_i]: prod display=\"[in_i]\", dev display=\"(inch)\"\n- code=[lb_av]: prod display=\"[lb_av]\", dev display=\"(pound)\"\n- code=[degF]: prod display=\"[degF]\", dev display=\"(degree Fahrenheit)\"\n- code=mg: prod display=\"mg\", dev display=\"(milligram)\"\n- code=%: prod display=\"%\", dev display=\"(percent)\"\n- code=mm[Hg]: prod display=\"mm[Hg]\", dev display=\"(millimeter of mercury column)\"\n- code=kg/m2: prod display=\"kg/m2\", dev display=\"(kilogram) / (meter ^ 2)\"\n\n## How widespread\n\n220 records in deltas.ndjson match this pattern. All are validate-code operations on system http://unitsofmeasure.org where display is the only diff. Found with:\n\n  grep '\"param\":\"display\"' deltas.ndjson | grep 'unitsofmeasure.org' | wc -l\n\nIn all 220 cases, prod's display equals the UCUM code exactly.\n\n## Tolerance\n\nTolerance ID: ucum-display-code-as-display\nMatches: validate-code operations on http://unitsofmeasure.org where display values differ\nNormalizes both sides to prod's display value (the code itself, per FHIR convention)\n\n## Representative record\n\n6ae99904-538b-4241-89db-b15eab6e637e (POST /r4/ValueSet/$validate-code, code=[in_i])", "body_html": "<p>Records-Impacted: 220<br>\nTolerance-ID: ucum-display-code-as-display<br>\nRecord-ID: 6ae99904-538b-4241-89db-b15eab6e637e</p>\n<h2>What differs</h2>\n<p>For UCUM ($validate-code) operations, prod returns the UCUM code itself as the <code>display</code> parameter (e.g., <code>[in_i]</code>, <code>[lb_av]</code>, <code>mg</code>, <code>%</code>), while dev returns a human-readable name (e.g., <code>(inch)</code>, <code>(pound)</code>, <code>(milligram)</code>, <code>(percent)</code>).</p>\n<p>Per the FHIR UCUM guidance (https://terminology.hl7.org/UCUM.html): &quot;No standardized display value is defined. The UCUM code itself is used directly as the display.&quot; Prod follows this convention; dev does not.</p>\n<p>All other parameters (result, system, code, version) agree between prod and dev. Display is the only difference.</p>\n<p>Examples:</p>\n<ul><li>code=[in_i]: prod display=&quot;[in_i]&quot;, dev display=&quot;(inch)&quot;</li><li>code=[lb_av]: prod display=&quot;[lb_av]&quot;, dev display=&quot;(pound)&quot;</li><li>code=[degF]: prod display=&quot;[degF]&quot;, dev display=&quot;(degree Fahrenheit)&quot;</li><li>code=mg: prod display=&quot;mg&quot;, dev display=&quot;(milligram)&quot;</li><li>code=%: prod display=&quot;%&quot;, dev display=&quot;(percent)&quot;</li><li>code=mm[Hg]: prod display=&quot;mm[Hg]&quot;, dev display=&quot;(millimeter of mercury column)&quot;</li><li>code=kg/m2: prod display=&quot;kg/m2&quot;, dev display=&quot;(kilogram) / (meter ^ 2)&quot;</li></ul>\n<h2>How widespread</h2>\n<p>220 records in deltas.ndjson match this pattern. All are validate-code operations on system http://unitsofmeasure.org where display is the only diff. Found with:</p>\n<p>grep &#x27;&quot;param&quot;:&quot;display&quot;&#x27; deltas.ndjson | grep &#x27;unitsofmeasure.org&#x27; | wc -l</p>\n<p>In all 220 cases, prod&#x27;s display equals the UCUM code exactly.</p>\n<h2>Tolerance</h2>\n<p>Tolerance ID: ucum-display-code-as-display<br>\nMatches: validate-code operations on http://unitsofmeasure.org where display values differ<br>\nNormalizes both sides to prod&#x27;s display value (the code itself, per FHIR convention)</p>\n<h2>Representative record</h2>\n<p>6ae99904-538b-4241-89db-b15eab6e637e (POST /r4/ValueSet/$validate-code, code=[in_i])</p>", "impact": 220}, {"id": "da50d17", "title": "SNOMED CT edition version skew: dev loads older editions than prod", "status": "open", "labels": ["content-differs", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 11:23", "date_iso": "2026-02-07T11:23:49-06:00", "body_md": "Records-Impacted: 181\nTolerance-ID: snomed-version-skew\nRecord-ID: e5716810-0ced-4937-85a5-5651fb884719\n\nDev returns different (generally older) SNOMED CT edition versions than prod across multiple modules.\n\n## What differs\n\nThe `version` parameter in $validate-code responses contains different SNOMED CT edition URIs:\n\n- International edition (900000000000207008): prod=20250201, dev=20240201 (256 records)\n- US edition (731000124108): prod=20250901, dev=20230301 (46 records, some with reversed newer dev versions)\n- Swedish edition (45991000052106): prod=20220531, dev=20231130 (13 records)\n- Plus other national editions with smaller counts\n\n## How widespread\n\n279 total records in the current comparison dataset show SNOMED version parameter differences:\n- 265 categorized as content-differs (version string is the only or primary diff)\n- 14 categorized as result-disagrees (validation result boolean differs — codes valid in one edition but not the other)\n\nAll are $validate-code operations. The version difference also correlates with display text differences in ~80 records (display names changed between editions).\n\nMatched by: system=http://snomed.info/sct AND version parameter contains snomed.info/sct AND prod version != dev version.\n\n## What the tolerance covers\n\nTolerance ID: snomed-version-skew\nNormalizes the `version` parameter to prod's value on both sides when both contain snomed.info/sct URIs with different version dates. This eliminates records where version is the only diff (~190 records). Records with additional diffs (display, message, result) still surface for separate triage.\n\n## Representative record IDs\n\n- e5716810-0ced-4937-85a5-5651fb884719 (International edition, version-only diff)\n- e85ce5f3-b23f-41c0-892e-5f7b2aa672ef (result-disagrees, code 116154003)", "body_html": "<p>Records-Impacted: 181<br>\nTolerance-ID: snomed-version-skew<br>\nRecord-ID: e5716810-0ced-4937-85a5-5651fb884719</p>\n<p>Dev returns different (generally older) SNOMED CT edition versions than prod across multiple modules.</p>\n<h2>What differs</h2>\n<p>The <code>version</code> parameter in $validate-code responses contains different SNOMED CT edition URIs:</p>\n<ul><li>International edition (900000000000207008): prod=20250201, dev=20240201 (256 records)</li><li>US edition (731000124108): prod=20250901, dev=20230301 (46 records, some with reversed newer dev versions)</li><li>Swedish edition (45991000052106): prod=20220531, dev=20231130 (13 records)</li><li>Plus other national editions with smaller counts</li></ul>\n<h2>How widespread</h2>\n<p>279 total records in the current comparison dataset show SNOMED version parameter differences:</p>\n<ul><li>265 categorized as content-differs (version string is the only or primary diff)</li><li>14 categorized as result-disagrees (validation result boolean differs — codes valid in one edition but not the other)</li></ul>\n<p>All are $validate-code operations. The version difference also correlates with display text differences in ~80 records (display names changed between editions).</p>\n<p>Matched by: system=http://snomed.info/sct AND version parameter contains snomed.info/sct AND prod version != dev version.</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance ID: snomed-version-skew<br>\nNormalizes the <code>version</code> parameter to prod&#x27;s value on both sides when both contain snomed.info/sct URIs with different version dates. This eliminates records where version is the only diff (~190 records). Records with additional diffs (display, message, result) still surface for separate triage.</p>\n<h2>Representative record IDs</h2>\n<ul><li>e5716810-0ced-4937-85a5-5651fb884719 (International edition, version-only diff)</li><li>e85ce5f3-b23f-41c0-892e-5f7b2aa672ef (result-disagrees, code 116154003)</li></ul>", "impact": 181}, {"id": "d3b49ff", "title": "v2-0360 $lookup returns version 3.0.0 vs prod 2.0.0 with extra definition/designation", "status": "open", "labels": ["P6", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 10:13", "date_iso": "2026-02-07T10:13:12-06:00", "body_md": "Records-Impacted: 157\nTolerance-ID: v2-0360-lookup-version-skew\nRecord-ID: 80a780e6-8842-43a9-a260-889ce87f76ac\n\n## What differs\n\n$lookup on CodeSystem v2-0360 (DegreeLicenseCertificate) returns different version and content between prod and dev:\n\n1. **Version**: prod returns `version: \"2.0.0\"`, dev returns `version: \"3.0.0\"`\n2. **Definition parameter**: dev returns a top-level `definition` parameter (`\"Registered Nurse\"`); prod returns the definition only as a property (code=definition)\n3. **Designation parameter**: dev returns a `designation` parameter with `preferredForLanguage` use coding; prod does not include designation\n\nThese differences reflect that dev has loaded a newer edition (3.0.0) of the v2-0360 CodeSystem than prod (2.0.0). The structural differences (definition as top-level param, extra designation) are consistent with the newer version having richer content.\n\n## How widespread\n\nAll 157 $lookup deltas are for this same system and show the identical pattern. All use code=RN.\n\n```\ngrep '\"op\":\"lookup\"' jobs/2026-02-round-1/results/deltas/deltas.ndjson | wc -l\n# 157\n\ngrep '\"op\":\"lookup\"' jobs/2026-02-round-1/results/deltas/deltas.ndjson | grep -c 'v2-0360'\n# 157\n```\n\nRequest properties that predict this difference:\n- Operation: $lookup\n- System: http://terminology.hl7.org/CodeSystem/v2-0360\n- FHIR version: /r4/\n\n## Tolerance\n\nTolerance ID: `v2-0360-lookup-version-skew`\nMatches: $lookup requests on v2-0360 system\nNormalizes: strips version, definition, and designation parameters from both sides; removes property with code=definition from both sides\nAffects: 157 records\n\n## Representative record\n\nID: `80a780e6-8842-43a9-a260-889ce87f76ac`\nURL: GET /r4/CodeSystem/$lookup?system=http://terminology.hl7.org/CodeSystem/v2-0360&code=RN", "body_html": "<p>Records-Impacted: 157<br>\nTolerance-ID: v2-0360-lookup-version-skew<br>\nRecord-ID: 80a780e6-8842-43a9-a260-889ce87f76ac</p>\n<h2>What differs</h2>\n<p>$lookup on CodeSystem v2-0360 (DegreeLicenseCertificate) returns different version and content between prod and dev:</p>\n<ol><li><strong>Version</strong>: prod returns <code>version: &quot;2.0.0&quot;</code>, dev returns <code>version: &quot;3.0.0&quot;</code></li><li><strong>Definition parameter</strong>: dev returns a top-level <code>definition</code> parameter (<code>&quot;Registered Nurse&quot;</code>); prod returns the definition only as a property (code=definition)</li><li><strong>Designation parameter</strong>: dev returns a <code>designation</code> parameter with <code>preferredForLanguage</code> use coding; prod does not include designation</li></ol>\n<p>These differences reflect that dev has loaded a newer edition (3.0.0) of the v2-0360 CodeSystem than prod (2.0.0). The structural differences (definition as top-level param, extra designation) are consistent with the newer version having richer content.</p>\n<h2>How widespread</h2>\n<p>All 157 $lookup deltas are for this same system and show the identical pattern. All use code=RN.</p>\n<pre><code>grep &#x27;&quot;op&quot;:&quot;lookup&quot;&#x27; jobs/2026-02-round-1/results/deltas/deltas.ndjson | wc -l\n# 157\n\ngrep &#x27;&quot;op&quot;:&quot;lookup&quot;&#x27; jobs/2026-02-round-1/results/deltas/deltas.ndjson | grep -c &#x27;v2-0360&#x27;\n# 157</code></pre>\n<p>Request properties that predict this difference:</p>\n<ul><li>Operation: $lookup</li><li>System: http://terminology.hl7.org/CodeSystem/v2-0360</li><li>FHIR version: /r4/</li></ul>\n<h2>Tolerance</h2>\n<p>Tolerance ID: <code>v2-0360-lookup-version-skew</code><br>\nMatches: $lookup requests on v2-0360 system<br>\nNormalizes: strips version, definition, and designation parameters from both sides; removes property with code=definition from both sides<br>\nAffects: 157 records</p>\n<h2>Representative record</h2>\n<p>ID: <code>80a780e6-8842-43a9-a260-889ce87f76ac</code><br>\nURL: GET /r4/CodeSystem/$lookup?system=http://terminology.hl7.org/CodeSystem/v2-0360&amp;code=RN</p>", "impact": 157}, {"id": "cf90495", "title": "Wrong Display Name message format differs: different display option count, formatting, and language tags", "status": "open", "labels": ["P6", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 10:22", "date_iso": "2026-02-07T10:22:21-06:00", "body_md": "Records-Impacted: 44\nTolerance-ID: invalid-display-message-format\nRecord-ID: beb4276b-f937-46c3-81ab-7f63cb7798b7\n\n## What differs\n\nWhen $validate-code detects a wrong display name, prod and dev return different error message text in both the `message` parameter and `issues` OperationOutcome `details.text`.\n\nSpecific differences:\n- **Display option count**: Prod may list duplicate display options (e.g., \"6 choices\" with repeats), while dev de-duplicates (e.g., \"3 choices\" with unique entries)\n- **Language tags**: Dev appends language tags like `(en)` after each display option; prod does not\n- **Example**: For `urn:ietf:bcp:47#en-US`:\n  - Prod: \"Valid display is one of 6 choices: 'English (Region=United States)', 'English (United States)', 'English (Region=United States)', ...\"\n  - Dev: \"Valid display is one of 3 choices: 'English (Region=United States)' (en), 'English (United States)' (en) or 'English (Region=United States)' (en) ...\"\n\nThe core validation result (`result: false`) agrees in all but 1 of 41 records. The difference is confined to the human-readable error message text.\n\n## How widespread\n\n44 delta records have `invalid-display` issue type with only `message` and `issues` diffs. 41 records contain \"Wrong Display Name\" in the delta text.\n\nSearch: `grep -c 'Wrong Display Name' jobs/2026-02-round-1/results/deltas/deltas.ndjson` → 41\nSearch: `grep -c 'invalid-display' jobs/2026-02-round-1/results/deltas/deltas.ndjson` → 53 (44 with only message/issues diffs)\n\nAffected operations: $validate-code on both CodeSystem and ValueSet\nAffected systems: urn:ietf:bcp:47, http://snomed.info/sct, and others\n\n## What the tolerance covers\n\nTolerance ID: `invalid-display-message-format`\nMatches: validate-code records where both prod and dev have `invalid-display` issue type and only the message/issues text differs. Normalizes the message and issues text to prod's version.\nExpected elimination: ~44 records.\n\n## Representative record ID\n\n`beb4276b-f937-46c3-81ab-7f63cb7798b7` — grep -n 'beb4276b-f937-46c3-81ab-7f63cb7798b7' jobs/2026-02-round-1/comparison.ndjson", "body_html": "<p>Records-Impacted: 44<br>\nTolerance-ID: invalid-display-message-format<br>\nRecord-ID: beb4276b-f937-46c3-81ab-7f63cb7798b7</p>\n<h2>What differs</h2>\n<p>When $validate-code detects a wrong display name, prod and dev return different error message text in both the <code>message</code> parameter and <code>issues</code> OperationOutcome <code>details.text</code>.</p>\n<p>Specific differences:</p>\n<ul><li><strong>Display option count</strong>: Prod may list duplicate display options (e.g., &quot;6 choices&quot; with repeats), while dev de-duplicates (e.g., &quot;3 choices&quot; with unique entries)</li><li><strong>Language tags</strong>: Dev appends language tags like <code>(en)</code> after each display option; prod does not</li><li><strong>Example</strong>: For <code>urn:ietf:bcp:47#en-US</code>:</li><li>Prod: &quot;Valid display is one of 6 choices: &#x27;English (Region=United States)&#x27;, &#x27;English (United States)&#x27;, &#x27;English (Region=United States)&#x27;, ...&quot;</li><li>Dev: &quot;Valid display is one of 3 choices: &#x27;English (Region=United States)&#x27; (en), &#x27;English (United States)&#x27; (en) or &#x27;English (Region=United States)&#x27; (en) ...&quot;</li></ul>\n<p>The core validation result (<code>result: false</code>) agrees in all but 1 of 41 records. The difference is confined to the human-readable error message text.</p>\n<h2>How widespread</h2>\n<p>44 delta records have <code>invalid-display</code> issue type with only <code>message</code> and <code>issues</code> diffs. 41 records contain &quot;Wrong Display Name&quot; in the delta text.</p>\n<p>Search: <code>grep -c &#x27;Wrong Display Name&#x27; jobs/2026-02-round-1/results/deltas/deltas.ndjson</code> → 41<br>\nSearch: <code>grep -c &#x27;invalid-display&#x27; jobs/2026-02-round-1/results/deltas/deltas.ndjson</code> → 53 (44 with only message/issues diffs)</p>\n<p>Affected operations: $validate-code on both CodeSystem and ValueSet<br>\nAffected systems: urn:ietf:bcp:47, http://snomed.info/sct, and others</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance ID: <code>invalid-display-message-format</code><br>\nMatches: validate-code records where both prod and dev have <code>invalid-display</code> issue type and only the message/issues text differs. Normalizes the message and issues text to prod&#x27;s version.<br>\nExpected elimination: ~44 records.</p>\n<h2>Representative record ID</h2>\n<p><code>beb4276b-f937-46c3-81ab-7f63cb7798b7</code> — grep -n &#x27;beb4276b-f937-46c3-81ab-7f63cb7798b7&#x27; jobs/2026-02-round-1/comparison.ndjson</p>", "impact": 44}, {"id": "515117b", "title": "Dev $expand reports different used-codesystem versions than prod", "status": "open", "labels": ["content-differs", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 11:32", "date_iso": "2026-02-07T11:32:05-06:00", "body_md": "Records-Impacted: 37\nTolerance-ID: expand-used-codesystem-version-skew\nRecord-ID: 2bbd9519-3a6b-4f55-8309-745d9f1b16a7\n\nDev $expand responses report different code system versions in the `used-codesystem` expansion parameter compared to prod. This is the $expand counterpart of the existing SNOMED version skew bug (da50d17), but affects multiple code systems and is specific to expansion metadata rather than validate-code Parameters.\n\n## What differs\n\nIn 37 $expand delta records, the `used-codesystem` expansion parameter reports a different version in dev than prod. This affects multiple code systems:\n\n- (empty/missing): 14 records\n- http://hl7.org/fhir/sid/icd-9-cm: 11 records\n- http://snomed.info/sct: 6 records\n- http://terminology.hl7.org/CodeSystem/medicationrequest-category: 2 records\n- http://loinc.org: 2 records\n- http://terminology.hl7.org/CodeSystem/v3-NullFlavor: 1 record\n- http://hl7.org/fhir/sid/icd-10-cm: 1 record\n\nExamples:\n- SNOMED US: prod `20250901`, dev `20230301`\n- medicationrequest-category: prod `4.0.1`, dev `1.0.0`\n\nThis indicates dev loads different (generally older) editions of these code systems.\n\n## How to reproduce\n\n```bash\ngrep '\"op\":\"expand\"' jobs/2026-02-round-1/results/deltas/deltas.ndjson | python3 -c \"\nimport json, sys\nfor line in sys.stdin:\n    rec = json.loads(line)\n    dev = json.loads(rec.get('devBody','{}'))\n    prod = json.loads(rec.get('prodBody','{}'))\n    d = {p.get('name'):p for p in dev.get('expansion',{}).get('parameter',[])}\n    p = {p.get('name'):p for p in prod.get('expansion',{}).get('parameter',[])}\n    du = d.get('used-codesystem',{}).get('valueUri','')\n    pu = p.get('used-codesystem',{}).get('valueUri','')\n    if du != pu: print(f'{rec[\\\"id\\\"]}: prod={pu} dev={du}')\n\" | wc -l\n# Returns 37\n```", "body_html": "<p>Records-Impacted: 37<br>\nTolerance-ID: expand-used-codesystem-version-skew<br>\nRecord-ID: 2bbd9519-3a6b-4f55-8309-745d9f1b16a7</p>\n<p>Dev $expand responses report different code system versions in the <code>used-codesystem</code> expansion parameter compared to prod. This is the $expand counterpart of the existing SNOMED version skew bug (da50d17), but affects multiple code systems and is specific to expansion metadata rather than validate-code Parameters.</p>\n<h2>What differs</h2>\n<p>In 37 $expand delta records, the <code>used-codesystem</code> expansion parameter reports a different version in dev than prod. This affects multiple code systems:</p>\n<ul><li>(empty/missing): 14 records</li><li>http://hl7.org/fhir/sid/icd-9-cm: 11 records</li><li>http://snomed.info/sct: 6 records</li><li>http://terminology.hl7.org/CodeSystem/medicationrequest-category: 2 records</li><li>http://loinc.org: 2 records</li><li>http://terminology.hl7.org/CodeSystem/v3-NullFlavor: 1 record</li><li>http://hl7.org/fhir/sid/icd-10-cm: 1 record</li></ul>\n<p>Examples:</p>\n<ul><li>SNOMED US: prod <code>20250901</code>, dev <code>20230301</code></li><li>medicationrequest-category: prod <code>4.0.1</code>, dev <code>1.0.0</code></li></ul>\n<p>This indicates dev loads different (generally older) editions of these code systems.</p>\n<h2>How to reproduce</h2>\n<pre><code class=\"lang-bash\">grep &#x27;&quot;op&quot;:&quot;expand&quot;&#x27; jobs/2026-02-round-1/results/deltas/deltas.ndjson | python3 -c &quot;\nimport json, sys\nfor line in sys.stdin:\n    rec = json.loads(line)\n    dev = json.loads(rec.get(&#x27;devBody&#x27;,&#x27;{}&#x27;))\n    prod = json.loads(rec.get(&#x27;prodBody&#x27;,&#x27;{}&#x27;))\n    d = {p.get(&#x27;name&#x27;):p for p in dev.get(&#x27;expansion&#x27;,{}).get(&#x27;parameter&#x27;,[])}\n    p = {p.get(&#x27;name&#x27;):p for p in prod.get(&#x27;expansion&#x27;,{}).get(&#x27;parameter&#x27;,[])}\n    du = d.get(&#x27;used-codesystem&#x27;,{}).get(&#x27;valueUri&#x27;,&#x27;&#x27;)\n    pu = p.get(&#x27;used-codesystem&#x27;,{}).get(&#x27;valueUri&#x27;,&#x27;&#x27;)\n    if du != pu: print(f&#x27;{rec[\\&quot;id\\&quot;]}: prod={pu} dev={du}&#x27;)\n&quot; | wc -l\n# Returns 37</code></pre>", "impact": 37}, {"id": "51f23f5", "title": "DICOM CID 29 AcquisitionModality ValueSet missing from dev", "status": "open", "labels": ["P3", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 10:50", "date_iso": "2026-02-07T10:50:05-06:00", "body_md": "Records-Impacted: 10\nTolerance-ID: dicom-cid29-missing\nRecord-ID: 3e3359d1-7391-4620-8b72-552f197f21cf\n\n## What differs\n\nWhen searching for the DICOM CID 29 AcquisitionModality ValueSet by URL (`/r4/ValueSet?url=http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_29.html`), prod returns a Bundle with `total: 1` containing the full ValueSet resource (id: `dicom-cid-29-AcquisitionModality`, 51 DICOM modality codes). Dev returns an empty Bundle with `total: 0`.\n\nDirect reads by ID (`/r4/ValueSet/dicom-cid-29-AcquisitionModality`) return 200 on prod with the full ValueSet, and 404 on dev with \"ValueSet/dicom-cid-29-AcquisitionModality not found\".\n\nThe ValueSet has URL `http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_29.html`, version `2025.3.20250714`, and uses system `http://dicom.nema.org/resources/ontology/DCM`.\n\n## How widespread\n\n10 records in the delta file:\n- 5x P3 (prod=200, dev=404): direct read `/r4/ValueSet/dicom-cid-29-AcquisitionModality`\n- 5x P6 (both 200, content differs): URL search returning empty Bundle vs populated Bundle\n\nSearch: `grep 'dicom-cid-29\\|sect_CID_29' deltas.ndjson` finds all 10.\n\n## Representative record IDs\n\n- `3e3359d1-7391-4620-8b72-552f197f21cf` (P6 URL search)\n- `ab5f8ed0-5149-4967-af3a-3c649cbb10c5` (P3 direct read)", "body_html": "<p>Records-Impacted: 10<br>\nTolerance-ID: dicom-cid29-missing<br>\nRecord-ID: 3e3359d1-7391-4620-8b72-552f197f21cf</p>\n<h2>What differs</h2>\n<p>When searching for the DICOM CID 29 AcquisitionModality ValueSet by URL (<code>/r4/ValueSet?url=http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_29.html</code>), prod returns a Bundle with <code>total: 1</code> containing the full ValueSet resource (id: <code>dicom-cid-29-AcquisitionModality</code>, 51 DICOM modality codes). Dev returns an empty Bundle with <code>total: 0</code>.</p>\n<p>Direct reads by ID (<code>/r4/ValueSet/dicom-cid-29-AcquisitionModality</code>) return 200 on prod with the full ValueSet, and 404 on dev with &quot;ValueSet/dicom-cid-29-AcquisitionModality not found&quot;.</p>\n<p>The ValueSet has URL <code>http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_29.html</code>, version <code>2025.3.20250714</code>, and uses system <code>http://dicom.nema.org/resources/ontology/DCM</code>.</p>\n<h2>How widespread</h2>\n<p>10 records in the delta file:</p>\n<ul><li>5x P3 (prod=200, dev=404): direct read <code>/r4/ValueSet/dicom-cid-29-AcquisitionModality</code></li><li>5x P6 (both 200, content differs): URL search returning empty Bundle vs populated Bundle</li></ul>\n<p>Search: <code>grep &#x27;dicom-cid-29\\|sect_CID_29&#x27; deltas.ndjson</code> finds all 10.</p>\n<h2>Representative record IDs</h2>\n<ul><li><code>3e3359d1-7391-4620-8b72-552f197f21cf</code> (P6 URL search)</li><li><code>ab5f8ed0-5149-4967-af3a-3c649cbb10c5</code> (P3 direct read)</li></ul>", "impact": 10}, {"id": "e09cff6", "title": "BCP-47 display text format: dev returns 'Region=...' instead of standard format", "status": "open", "labels": ["P6", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 10:45", "date_iso": "2026-02-07T10:45:20-06:00", "body_md": "Records-Impacted: 7\nTolerance-ID: bcp47-display-format\nRecord-ID: da702ab4-7ced-4b69-945c-0b5bbbc088c0\n\n## What differs\n\nFor BCP-47 language codes (system urn:ietf:bcp:47), dev returns display text with explicit subtag labels like \"English (Region=United States)\" while prod returns the standard format \"English (United States)\".\n\nSpecific example for code en-US:\n- prod: \"English (United States)\"\n- dev: \"English (Region=United States)\"\n\nThe \"Region=\" prefix in dev's display text is non-standard. The IANA/BCP-47 convention is to show the region name without a label prefix.\n\n## How widespread\n\n7 P6 $validate-code records in the current delta set match this pattern — all are urn:ietf:bcp:47 validate-code operations for code en-US where the only difference (after diagnostics stripping and parameter sorting) is the display parameter value.\n\nSearch: grep -c 'Region=' deltas.ndjson → 10 total hits (7 are this display-only P6 pattern; 2 are P1 case-sensitivity issues for en-us; 1 is an $expand with transient metadata diffs where \"Region=\" appears only in diagnostics).\n\n## What the tolerance covers\n\nTolerance: bcp47-display-format. Matches $validate-code records where system=urn:ietf:bcp:47, both prod and dev return display parameters, and the values differ. Canonicalizes dev display to match prod. Expected to eliminate 7 records.\n\n## Representative record\n\nda702ab4-7ced-4b69-945c-0b5bbbc088c0 — POST /r4/ValueSet/$validate-code? for en-US in urn:ietf:bcp:47", "body_html": "<p>Records-Impacted: 7<br>\nTolerance-ID: bcp47-display-format<br>\nRecord-ID: da702ab4-7ced-4b69-945c-0b5bbbc088c0</p>\n<h2>What differs</h2>\n<p>For BCP-47 language codes (system urn:ietf:bcp:47), dev returns display text with explicit subtag labels like &quot;English (Region=United States)&quot; while prod returns the standard format &quot;English (United States)&quot;.</p>\n<p>Specific example for code en-US:</p>\n<ul><li>prod: &quot;English (United States)&quot;</li><li>dev: &quot;English (Region=United States)&quot;</li></ul>\n<p>The &quot;Region=&quot; prefix in dev&#x27;s display text is non-standard. The IANA/BCP-47 convention is to show the region name without a label prefix.</p>\n<h2>How widespread</h2>\n<p>7 P6 $validate-code records in the current delta set match this pattern — all are urn:ietf:bcp:47 validate-code operations for code en-US where the only difference (after diagnostics stripping and parameter sorting) is the display parameter value.</p>\n<p>Search: grep -c &#x27;Region=&#x27; deltas.ndjson → 10 total hits (7 are this display-only P6 pattern; 2 are P1 case-sensitivity issues for en-us; 1 is an $expand with transient metadata diffs where &quot;Region=&quot; appears only in diagnostics).</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance: bcp47-display-format. Matches $validate-code records where system=urn:ietf:bcp:47, both prod and dev return display parameters, and the values differ. Canonicalizes dev display to match prod. Expected to eliminate 7 records.</p>\n<h2>Representative record</h2>\n<p>da702ab4-7ced-4b69-945c-0b5bbbc088c0 — POST /r4/ValueSet/$validate-code? for en-US in urn:ietf:bcp:47</p>", "impact": 7}, {"id": "933fdcc", "title": "Dev fails to process VSAC ValueSets with vsacOpModifier extension", "status": "open", "labels": ["content-differs", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 11:27", "date_iso": "2026-02-07T11:27:58-06:00", "body_md": "Dev returns a generic error \"Cannot process resource at \\\"exclude[0].filter\\\" due to the presence of the modifier extension vsacOpModifier\" instead of processing VSAC ValueSets that use the vsacOpModifier extension in their exclude filters.\n\n**What differs**: When validating codes against VSAC ValueSets that use vsacOpModifier, prod processes the ValueSet and returns proper validation results (e.g., unknown codesystem version, not-in-valueset issues), while dev bails out at ValueSet processing with a business-rule error about the modifier extension. Both return result=false, but for completely different reasons — prod gives specific, correct error details while dev gives a generic \"cannot process\" error.\n\n**How widespread**: 3 records in the delta file, all POST /r4/ValueSet/$validate-code, all involving the same VSAC ValueSet (http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.4.642.40.2.48.1|20250419) with system urn:oid:2.16.840.1.113883.6.238.\n\nSearch: grep -c 'vsacOpModifier' results/deltas/deltas.ndjson → 3\n\n**Tolerance**: `vsac-modifier-extension-error` (temp-tolerance) matches validate-code records where dev's message contains \"vsacOpModifier\". Eliminates 3 records.\n\n**Representative record**: 64ff24e8-e8ff-456c-a0ed-0f222b9454fb", "body_html": "<p>Dev returns a generic error &quot;Cannot process resource at \\&quot;exclude[0].filter\\&quot; due to the presence of the modifier extension vsacOpModifier&quot; instead of processing VSAC ValueSets that use the vsacOpModifier extension in their exclude filters.</p>\n<p><strong>What differs</strong>: When validating codes against VSAC ValueSets that use vsacOpModifier, prod processes the ValueSet and returns proper validation results (e.g., unknown codesystem version, not-in-valueset issues), while dev bails out at ValueSet processing with a business-rule error about the modifier extension. Both return result=false, but for completely different reasons — prod gives specific, correct error details while dev gives a generic &quot;cannot process&quot; error.</p>\n<p><strong>How widespread</strong>: 3 records in the delta file, all POST /r4/ValueSet/$validate-code, all involving the same VSAC ValueSet (http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.4.642.40.2.48.1|20250419) with system urn:oid:2.16.840.1.113883.6.238.</p>\n<p>Search: grep -c &#x27;vsacOpModifier&#x27; results/deltas/deltas.ndjson → 3</p>\n<p><strong>Tolerance</strong>: <code>vsac-modifier-extension-error</code> (temp-tolerance) matches validate-code records where dev&#x27;s message contains &quot;vsacOpModifier&quot;. Eliminates 3 records.</p>\n<p><strong>Representative record</strong>: 64ff24e8-e8ff-456c-a0ed-0f222b9454fb</p>", "impact": null}];
const STATS = {"total": 13, "open": 13, "closed": 0, "labels": {"content-differs": 6, "tx-compare": 13, "P6": 5, "P4": 1, "P3": 1}, "sortedLabels": ["tx-compare", "content-differs", "P6", "P4", "P3"]};

document.getElementById("gen-time").textContent = new Date().toLocaleString();

// Stats bar
(function() {
  const bar = document.getElementById("stats-bar");
  let html = `<div class="stat"><span class="stat-value">${STATS.total}</span> total</div>`;
  html += `<div class="stat-divider"></div>`;
  html += `<div class="stat"><span class="stat-value" style="color:var(--status-open-fg)">${STATS.open}</span> open</div>`;
  html += `<div class="stat"><span class="stat-value">${STATS.closed}</span> closed</div>`;
  const totalImpact = BUGS.reduce((s, b) => s + (b.impact || 0), 0);
  if (totalImpact > 0) {
    html += `<div class="stat-divider"></div>`;
    html += `<div class="stat"><span class="stat-value">${totalImpact.toLocaleString()}</span> records impacted</div>`;
  }
  bar.innerHTML = html;
})();

// Label filter pills
(function() {
  const container = document.getElementById("label-filters");
  let html = "";
  for (const label of STATS.sortedLabels) {
    const c = STATS.labels[label] || 0;
    html += `<span class="filter-pill" data-label="${label}">${label} <span class="count">${c}</span></span>`;
  }
  container.innerHTML = html;
})();

// State
let activeLabels = new Set();
let activeStatus = "all";
let searchQuery = "";
let currentSort = "impact";

function renderBugList() {
  const list = document.getElementById("bug-list");
  // Sort bugs
  const sorted = [...BUGS];
  if (currentSort === "impact") {
    sorted.sort((a, b) => (b.impact || 0) - (a.impact || 0) || a.title.localeCompare(b.title));
  } else if (currentSort === "date") {
    sorted.sort((a, b) => (b.date_iso || "").localeCompare(a.date_iso || ""));
  } else if (currentSort === "title") {
    sorted.sort((a, b) => a.title.localeCompare(b.title));
  }

  let html = "";
  for (const bug of sorted) {
    const statusClass = bug.status === "open" ? "pill-status-open" : "pill-status-closed";
    const labels = bug.labels.map(l => `<span class="pill pill-label" data-label="${l}">${l}</span>`).join("");
    const impactPill = bug.impact ? `<span class="pill pill-impact">${bug.impact.toLocaleString()} records</span>` : "";

    html += `<div class="bug-card" data-status="${bug.status}" data-id="${bug.id}" data-labels="${bug.labels.join(",")}" data-impact="${bug.impact || 0}">
      <div class="bug-header" onclick="toggleBug(this)">
        <svg class="bug-expand-icon" viewBox="0 0 16 16" fill="currentColor">
          <path d="M6.22 3.22a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042L9.94 8 6.22 4.28a.75.75 0 0 1 0-1.06Z"/>
        </svg>
        <div class="bug-info">
          <div class="bug-title">${bug.title}</div>
          <div class="bug-meta">
            <span class="pill ${statusClass}">${bug.status}</span>
            ${labels}
            ${impactPill}
            <span class="bug-id">${bug.id}</span>
            <span class="bug-date">${bug.date}</span>
          </div>
        </div>
      </div>
      <div class="bug-body">${bug.body_html}</div>
    </div>`;
  }

  list.innerHTML = html;
  applyFilters();
}

function toggleBug(header) {
  header.parentElement.classList.toggle("expanded");
}

let allExpanded = false;
function toggleExpandAll() {
  allExpanded = !allExpanded;
  const cards = document.querySelectorAll(".bug-card:not(.hidden)");
  cards.forEach(c => c.classList.toggle("expanded", allExpanded));
  document.getElementById("expand-all-btn").textContent = allExpanded ? "Collapse all" : "Expand all";
}

function applyFilters() {
  const cards = document.querySelectorAll(".bug-card");
  const query = searchQuery.toLowerCase();
  let visibleCount = 0;

  cards.forEach(card => {
    const status = card.dataset.status;
    const cardLabels = card.dataset.labels ? card.dataset.labels.split(",") : [];
    const bugId = card.dataset.id;
    const bug = BUGS.find(b => b.id === bugId);

    let show = true;

    // Label filter: card must have at least one of the active labels
    if (activeLabels.size > 0) {
      if (!cardLabels.some(l => activeLabels.has(l))) {
        show = false;
      }
    }

    if (activeStatus !== "all" && status !== activeStatus) {
      show = false;
    }

    if (query && show && bug) {
      const searchable = (bug.title + " " + bug.body_md + " " + bug.labels.join(" ")).toLowerCase();
      if (!searchable.includes(query)) {
        show = false;
      }
    }

    card.classList.toggle("hidden", !show);
    if (show) visibleCount++;
  });

  document.getElementById("no-results").classList.toggle("hidden", visibleCount > 0);
}

// Search
document.getElementById("search").addEventListener("input", function() {
  searchQuery = this.value;
  applyFilters();
});

// Label filter pills
document.querySelectorAll(".filter-pill[data-label]").forEach(pill => {
  pill.addEventListener("click", function() {
    const label = this.dataset.label;
    if (activeLabels.has(label)) {
      activeLabels.delete(label);
      this.classList.remove("dimmed");
    } else {
      if (activeLabels.size === 0) {
        document.querySelectorAll(".filter-pill[data-label]").forEach(pp => {
          if (pp.dataset.label !== label) pp.classList.add("dimmed");
        });
        activeLabels.add(label);
      } else {
        activeLabels.add(label);
        this.classList.remove("dimmed");
      }
    }

    if (activeLabels.size === 0) {
      document.querySelectorAll(".filter-pill[data-label]").forEach(pp => {
        pp.classList.remove("dimmed");
      });
    }

    applyFilters();
  });
});

// Status filter buttons
document.querySelectorAll(".ctrl-btn[data-status]").forEach(btn => {
  btn.addEventListener("click", function() {
    document.querySelectorAll(".ctrl-btn[data-status]").forEach(b => b.classList.remove("active"));
    this.classList.add("active");
    activeStatus = this.dataset.status;
    applyFilters();
  });
});

// Sort buttons
document.querySelectorAll(".sort-btn").forEach(btn => {
  btn.addEventListener("click", function() {
    document.querySelectorAll(".sort-btn").forEach(b => b.classList.remove("active"));
    this.classList.add("active");
    currentSort = this.dataset.sort;
    renderBugList();
  });
});

// Initial render
renderBugList();
</script>
</body>
</html>