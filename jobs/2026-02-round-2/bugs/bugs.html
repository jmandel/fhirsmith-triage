<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FHIRsmith tx-compare Bug Report</title>
<style>
:root {
  --bg: #ffffff;
  --bg-surface: #f6f8fa;
  --bg-card: #ffffff;
  --border: #d1d9e0;
  --border-light: #e8ecf0;
  --text: #1f2328;
  --text-secondary: #59636e;
  --text-muted: #818b98;
  --shadow: 0 1px 3px rgba(0,0,0,0.08), 0 1px 2px rgba(0,0,0,0.04);
  --shadow-hover: 0 4px 12px rgba(0,0,0,0.1), 0 2px 4px rgba(0,0,0,0.06);
  --radius: 8px;
  --radius-sm: 6px;
  --font: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans", Helvetica, Arial, sans-serif;
  --font-mono: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace;

  --pill-tx-bg: #ccfbf1; --pill-tx-fg: #115e59; --pill-tx-border: #5eead4;
  --pill-default-bg: #f3f4f6; --pill-default-fg: #4b5563; --pill-default-border: #d1d5db;

  --status-open-bg: #dcfce7; --status-open-fg: #166534; --status-open-border: #86efac;
  --status-closed-bg: #f3f4f6; --status-closed-fg: #6b7280; --status-closed-border: #d1d5db;
}

@media (prefers-color-scheme: dark) {
  :root {
    --bg: #0d1117;
    --bg-surface: #161b22;
    --bg-card: #1c2128;
    --border: #30363d;
    --border-light: #21262d;
    --text: #e6edf3;
    --text-secondary: #8b949e;
    --text-muted: #6e7681;
    --shadow: 0 1px 3px rgba(0,0,0,0.3), 0 1px 2px rgba(0,0,0,0.2);
    --shadow-hover: 0 4px 12px rgba(0,0,0,0.4), 0 2px 4px rgba(0,0,0,0.3);

    --pill-tx-bg: #042f2e; --pill-tx-fg: #5eead4; --pill-tx-border: #134e4a;
    --pill-default-bg: #1f2937; --pill-default-fg: #9ca3af; --pill-default-border: #374151;

    --status-open-bg: #052e16; --status-open-fg: #86efac; --status-open-border: #14532d;
    --status-closed-bg: #1f2937; --status-closed-fg: #9ca3af; --status-closed-border: #374151;
  }
}

*, *::before, *::after { box-sizing: border-box; }

body {
  font-family: var(--font);
  background: var(--bg);
  color: var(--text);
  margin: 0;
  padding: 0;
  line-height: 1.6;
}

.container {
  max-width: 960px;
  margin: 0 auto;
  padding: 24px 16px;
}

h1 {
  font-size: 24px;
  font-weight: 700;
  margin: 0 0 4px 0;
}

.subtitle {
  color: var(--text-muted);
  font-size: 14px;
  margin: 0 0 24px 0;
}

.stats-bar {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 20px;
  padding: 16px;
  background: var(--bg-surface);
  border: 1px solid var(--border-light);
  border-radius: var(--radius);
}

.stat {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 13px;
  color: var(--text-secondary);
  padding: 4px 10px;
  border-radius: var(--radius-sm);
  background: var(--bg-card);
  border: 1px solid var(--border-light);
}

.stat-value {
  font-weight: 700;
  color: var(--text);
  font-size: 15px;
}

.stat-divider {
  width: 1px;
  height: 24px;
  background: var(--border);
  margin: 0 4px;
}

.filter-bar {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-bottom: 20px;
  align-items: center;
}

.search-box {
  flex: 1;
  min-width: 200px;
  padding: 8px 12px;
  font-size: 14px;
  font-family: var(--font);
  background: var(--bg-card);
  color: var(--text);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  outline: none;
  transition: border-color 0.15s, box-shadow 0.15s;
}

.search-box:focus {
  border-color: #3b82f6;
  box-shadow: 0 0 0 3px rgba(59,130,246,0.15);
}

.search-box::placeholder {
  color: var(--text-muted);
}

.filter-pills {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.filter-pill {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 4px 10px;
  font-size: 12px;
  font-weight: 600;
  border-radius: 999px;
  cursor: pointer;
  user-select: none;
  transition: opacity 0.15s, transform 0.1s;
  border: 1px solid var(--pill-default-border);
  background: var(--pill-default-bg);
  color: var(--pill-default-fg);
}

.filter-pill[data-label="tx-compare"] {
  background: var(--pill-tx-bg);
  color: var(--pill-tx-fg);
  border-color: var(--pill-tx-border);
}

.filter-pill:hover {
  transform: translateY(-1px);
}

.filter-pill.dimmed {
  opacity: 0.35;
}

.filter-pill .count {
  font-weight: 400;
  opacity: 0.8;
}

.controls {
  display: flex;
  gap: 4px;
  margin-left: auto;
  flex-wrap: wrap;
}

.ctrl-btn {
  padding: 4px 10px;
  font-size: 12px;
  font-weight: 600;
  border-radius: var(--radius-sm);
  cursor: pointer;
  border: 1px solid var(--border);
  background: var(--bg-card);
  color: var(--text-secondary);
  font-family: var(--font);
  transition: background 0.15s, color 0.15s;
}

.ctrl-btn:hover {
  background: var(--bg-surface);
}

.ctrl-btn.active {
  background: var(--text);
  color: var(--bg);
  border-color: var(--text);
}

.bug-card {
  background: var(--bg-card);
  border: 1px solid var(--border-light);
  border-radius: var(--radius);
  margin-bottom: 8px;
  box-shadow: var(--shadow);
  transition: box-shadow 0.15s, border-color 0.15s;
  overflow: hidden;
}

.bug-card:hover {
  box-shadow: var(--shadow-hover);
  border-color: var(--border);
}

.bug-card.hidden {
  display: none;
}

.bug-header {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  padding: 12px 16px;
  cursor: pointer;
  user-select: none;
}

.bug-header:hover {
  background: var(--bg-surface);
}

.bug-expand-icon {
  flex-shrink: 0;
  width: 18px;
  height: 18px;
  margin-top: 2px;
  color: var(--text-muted);
  transition: transform 0.2s;
}

.bug-card.expanded .bug-expand-icon {
  transform: rotate(90deg);
}

.bug-info {
  flex: 1;
  min-width: 0;
}

.bug-title {
  font-size: 14px;
  font-weight: 600;
  line-height: 1.4;
  word-break: break-word;
}

.bug-meta {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 6px;
  margin-top: 6px;
}

.pill {
  display: inline-flex;
  align-items: center;
  padding: 1px 8px;
  font-size: 11px;
  font-weight: 600;
  border-radius: 999px;
  border: 1px solid;
  white-space: nowrap;
}

.pill-status-open {
  background: var(--status-open-bg);
  color: var(--status-open-fg);
  border-color: var(--status-open-border);
}

.pill-status-closed {
  background: var(--status-closed-bg);
  color: var(--status-closed-fg);
  border-color: var(--status-closed-border);
}

.pill-label {
  background: var(--pill-default-bg);
  color: var(--pill-default-fg);
  border-color: var(--pill-default-border);
}

.pill-label[data-label="tx-compare"] {
  background: var(--pill-tx-bg);
  color: var(--pill-tx-fg);
  border-color: var(--pill-tx-border);
}

.pill-impact {
  background: #fef3c7;
  color: #92400e;
  border-color: #fcd34d;
  font-family: var(--font-mono);
  font-size: 10px;
}

@media (prefers-color-scheme: dark) {
  .pill-impact {
    background: #3b2f0b;
    color: #fcd34d;
    border-color: #78350f;
  }
}

.bug-id {
  font-size: 11px;
  color: var(--text-muted);
  font-family: var(--font-mono);
}

.bug-date {
  font-size: 11px;
  color: var(--text-muted);
}

.bug-body {
  display: none;
  padding: 0 16px 16px 44px;
  border-top: 1px solid var(--border-light);
}

.bug-card.expanded .bug-body {
  display: block;
}

.bug-body h1, .bug-body h2, .bug-body h3,
.bug-body h4, .bug-body h5, .bug-body h6 {
  margin: 16px 0 8px 0;
  font-weight: 700;
  line-height: 1.3;
}

.bug-body h1 { font-size: 18px; }
.bug-body h2 { font-size: 16px; }
.bug-body h3 { font-size: 14px; }
.bug-body h4, .bug-body h5, .bug-body h6 { font-size: 13px; }

.bug-body p {
  margin: 8px 0;
  font-size: 13px;
  line-height: 1.65;
}

.bug-body ul, .bug-body ol {
  margin: 8px 0;
  padding-left: 24px;
  font-size: 13px;
}

.bug-body li {
  margin: 4px 0;
  line-height: 1.55;
}

.bug-body code {
  font-family: var(--font-mono);
  font-size: 12px;
  background: var(--bg-surface);
  padding: 2px 6px;
  border-radius: 4px;
  border: 1px solid var(--border-light);
}

.bug-body pre {
  background: var(--bg-surface);
  border: 1px solid var(--border-light);
  border-radius: var(--radius-sm);
  padding: 12px 16px;
  overflow-x: auto;
  margin: 12px 0;
}

.bug-body pre code {
  background: none;
  border: none;
  padding: 0;
  font-size: 12px;
  line-height: 1.5;
}

.bug-body hr {
  border: none;
  border-top: 1px solid var(--border-light);
  margin: 16px 0;
}

.bug-body strong { font-weight: 700; }
.bug-body em { font-style: italic; }
.bug-body a { color: #3b82f6; text-decoration: none; }
.bug-body a:hover { text-decoration: underline; }

.no-results {
  text-align: center;
  padding: 48px 16px;
  color: var(--text-muted);
  font-size: 14px;
}

.no-results.hidden {
  display: none;
}

.pipeline-bar {
  display: flex;
  gap: 0;
  margin-bottom: 12px;
  border-radius: var(--radius);
  overflow: hidden;
  border: 1px solid var(--border-light);
  font-size: 12px;
  line-height: 1.3;
}

.pipeline-bar:empty {
  display: none;
}

.pipeline-seg {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 10px 8px;
  min-width: 0;
  text-align: center;
}

.pipeline-seg .seg-value {
  font-weight: 700;
  font-size: 16px;
  font-family: var(--font-mono);
}

.pipeline-seg .seg-label {
  font-size: 10px;
  opacity: 0.8;
  margin-top: 2px;
}

.seg-perfect { background: #dcfce7; color: #166534; }
.seg-equiv { background: #dbeafe; color: #1e40af; }
.seg-known { background: #fef3c7; color: #92400e; }
.seg-untriaged { background: #fee2e2; color: #991b1b; }

@media (prefers-color-scheme: dark) {
  .seg-perfect { background: #052e16; color: #86efac; }
  .seg-equiv { background: #172554; color: #93c5fd; }
  .seg-known { background: #3b2f0b; color: #fcd34d; }
  .seg-untriaged { background: #450a0a; color: #fca5a5; }
}

@media (max-width: 640px) {
  .container { padding: 16px 12px; }
  .stats-bar { padding: 12px; gap: 6px; }
  .stat-divider { display: none; }
  .filter-bar { flex-direction: column; }
  .search-box { min-width: 100%; }
  .bug-body { padding: 0 12px 12px 12px; }
  .bug-header { padding: 10px 12px; }
  .controls { margin-left: 0; }
  .pipeline-bar { font-size: 10px; }
  .pipeline-seg .seg-value { font-size: 13px; }
}
</style>
</head>
<body>
<div class="container">
  <h1>FHIRsmith tx-compare Bugs</h1>
  <p class="subtitle">Generated from git-bug &middot; <span id="gen-time"></span></p>

  <div class="pipeline-bar" id="pipeline-bar"></div>
  <div class="stats-bar" id="stats-bar"></div>

  <div class="filter-bar">
    <input type="text" class="search-box" id="search" placeholder="Search bugs by title or body..." autocomplete="off">
    <div class="filter-pills" id="label-filters"></div>
    <div class="controls">
      <button class="ctrl-btn" id="expand-all-btn" onclick="toggleExpandAll()">Expand all</button>
      <span class="stat-divider"></span>
      <button class="ctrl-btn active" data-status="all">All</button>
      <button class="ctrl-btn" data-status="open">Open</button>
      <button class="ctrl-btn" data-status="closed">Closed</button>
      <span class="stat-divider"></span>
      <button class="ctrl-btn sort-btn active" data-sort="impact">Impact</button>
      <button class="ctrl-btn sort-btn" data-sort="date">Date</button>
      <button class="ctrl-btn sort-btn" data-sort="title">Title</button>
    </div>
  </div>

  <div id="bug-list"></div>
  <div class="no-results hidden" id="no-results">No bugs match your filters.</div>
</div>

<script>
const BUGS = [{"id": "a9cf20c", "title": "Dev omits deprecated location field on OperationOutcome issues", "status": "open", "labels": ["content-differs", "reproduced", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 15:13", "date_iso": "2026-02-07T15:13:01-06:00", "body_md": "Records-Impacted: 3019\nTolerance-ID: oo-missing-location-field\nRecord-ID: 59eff7c6-9fd2-45b2-8f27-c790368bcc54\n\n## Repro\n\n```bash\n# Prod\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$validate-code?url=http:%2F%2Fcts.nlm.nih.gov%2Ffhir%2FValueSet%2F2.16.840.1.114222.4.11.1066&code=1223P0106X&_format=json&system=http:%2F%2Fnucc.org%2Fprovider-taxonomy' \\\n  -H 'Accept: application/fhir+json' | jq '.parameter[] | select(.name == \"issues\") | .resource.issue[0] | {severity, code, location, expression}'\n\n# Dev\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$validate-code?url=http:%2F%2Fcts.nlm.nih.gov%2Ffhir%2FValueSet%2F2.16.840.1.114222.4.11.1066&code=1223P0106X&_format=json&system=http:%2F%2Fnucc.org%2Fprovider-taxonomy' \\\n  -H 'Accept: application/fhir+json' | jq '.parameter[] | select(.name == \"issues\") | .resource.issue[0] | {severity, code, location, expression}'\n```\n\nProd returns `\"location\": [\"system\"]`, dev returns `\"location\": null` (field is omitted).\n\n## What differs\n\nProd includes both `location` and `expression` arrays on OperationOutcome issues. Dev includes only `expression`, omitting `location` entirely.\n\nIn FHIR R4, `location` (0..*) is deprecated in favor of `expression`, but it is still a defined field. Prod populates both; dev omits `location`.\n\nIn every observed case, `location` and `expression` have identical values (e.g., both `[\"system\"]` or both `[\"code\"]`).\n\nExample from prod:\n```json\n{\n  \"severity\": \"error\",\n  \"code\": \"not-found\",\n  \"details\": { ... },\n  \"location\": [\"system\"],\n  \"expression\": [\"system\"]\n}\n```\n\nDev returns the same issue without `location`:\n```json\n{\n  \"severity\": \"error\",\n  \"code\": \"not-found\",\n  \"details\": { ... },\n  \"expression\": [\"system\"]\n}\n```\n\n## How widespread\n\n3019 out of 9838 delta records exhibit this pattern (31% of all deltas). All are `validate-code` operations (3018 `content-differs`, 1 `status-mismatch`).\n\nSearch: compared parsed prod and dev bodies for all deltas, checking for OperationOutcome issues where prod has `location` and dev does not. In all 3628 individual OO issues across these 3019 records, `location` exactly equals `expression`.\n\nMost common location values:\n- `[\"code\"]`: 1073\n- `[\"Coding.system\"]`: 802\n- `[\"Coding.code\"]`: 622\n- `[\"system\"]`: 463\n- `[\"CodeableConcept.coding[0].code\"]`: 283\n\n## What the tolerance covers\n\nTolerance `oo-missing-location-field` normalizes by stripping `location` from prod's OO issues when dev lacks it and `location` equals `expression`. This eliminates 3019 records from the deltas (where this is the only remaining difference after other tolerances).\n\n## Representative record\n\n`grep -n '59eff7c6-9fd2-45b2-8f27-c790368bcc54' jobs/2026-02-round-2/comparison.ndjson`", "body_html": "<p>Records-Impacted: 3019<br>\nTolerance-ID: oo-missing-location-field<br>\nRecord-ID: 59eff7c6-9fd2-45b2-8f27-c790368bcc54</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod\ncurl -s &#x27;https://tx.fhir.org/r4/ValueSet/$validate-code?url=http:%2F%2Fcts.nlm.nih.gov%2Ffhir%2FValueSet%2F2.16.840.1.114222.4.11.1066&amp;code=1223P0106X&amp;_format=json&amp;system=http:%2F%2Fnucc.org%2Fprovider-taxonomy&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; | jq &#x27;.parameter[] | select(.name == &quot;issues&quot;) | .resource.issue[0] | {severity, code, location, expression}&#x27;\n\n# Dev\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$validate-code?url=http:%2F%2Fcts.nlm.nih.gov%2Ffhir%2FValueSet%2F2.16.840.1.114222.4.11.1066&amp;code=1223P0106X&amp;_format=json&amp;system=http:%2F%2Fnucc.org%2Fprovider-taxonomy&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; | jq &#x27;.parameter[] | select(.name == &quot;issues&quot;) | .resource.issue[0] | {severity, code, location, expression}&#x27;</code></pre>\n<p>Prod returns <code>&quot;location&quot;: [&quot;system&quot;]</code>, dev returns <code>&quot;location&quot;: null</code> (field is omitted).</p>\n<h2>What differs</h2>\n<p>Prod includes both <code>location</code> and <code>expression</code> arrays on OperationOutcome issues. Dev includes only <code>expression</code>, omitting <code>location</code> entirely.</p>\n<p>In FHIR R4, <code>location</code> (0..*) is deprecated in favor of <code>expression</code>, but it is still a defined field. Prod populates both; dev omits <code>location</code>.</p>\n<p>In every observed case, <code>location</code> and <code>expression</code> have identical values (e.g., both <code>[&quot;system&quot;]</code> or both <code>[&quot;code&quot;]</code>).</p>\n<p>Example from prod:</p>\n<pre><code class=\"lang-json\">{\n  &quot;severity&quot;: &quot;error&quot;,\n  &quot;code&quot;: &quot;not-found&quot;,\n  &quot;details&quot;: { ... },\n  &quot;location&quot;: [&quot;system&quot;],\n  &quot;expression&quot;: [&quot;system&quot;]\n}</code></pre>\n<p>Dev returns the same issue without <code>location</code>:</p>\n<pre><code class=\"lang-json\">{\n  &quot;severity&quot;: &quot;error&quot;,\n  &quot;code&quot;: &quot;not-found&quot;,\n  &quot;details&quot;: { ... },\n  &quot;expression&quot;: [&quot;system&quot;]\n}</code></pre>\n<h2>How widespread</h2>\n<p>3019 out of 9838 delta records exhibit this pattern (31% of all deltas). All are <code>validate-code</code> operations (3018 <code>content-differs</code>, 1 <code>status-mismatch</code>).</p>\n<p>Search: compared parsed prod and dev bodies for all deltas, checking for OperationOutcome issues where prod has <code>location</code> and dev does not. In all 3628 individual OO issues across these 3019 records, <code>location</code> exactly equals <code>expression</code>.</p>\n<p>Most common location values:</p>\n<ul><li><code>[&quot;code&quot;]</code>: 1073</li><li><code>[&quot;Coding.system&quot;]</code>: 802</li><li><code>[&quot;Coding.code&quot;]</code>: 622</li><li><code>[&quot;system&quot;]</code>: 463</li><li><code>[&quot;CodeableConcept.coding[0].code&quot;]</code>: 283</li></ul>\n<h2>What the tolerance covers</h2>\n<p>Tolerance <code>oo-missing-location-field</code> normalizes by stripping <code>location</code> from prod&#x27;s OO issues when dev lacks it and <code>location</code> equals <code>expression</code>. This eliminates 3019 records from the deltas (where this is the only remaining difference after other tolerances).</p>\n<h2>Representative record</h2>\n<p><code>grep -n &#x27;59eff7c6-9fd2-45b2-8f27-c790368bcc54&#x27; jobs/2026-02-round-2/comparison.ndjson</code></p>", "impact": 3019}, {"id": "cd4b7d1", "title": "Dev returns 400 instead of 422 for error responses across validate-code and expand operations", "status": "open", "labels": ["reproduced", "status-mismatch", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 15:22", "date_iso": "2026-02-07T15:22:58-06:00", "body_md": "Records-Impacted: 1897\nTolerance-ID: error-status-422-vs-400\nRecord-ID: e5639442-a91b-4de0-b1d9-9b901023b6c1\n\n## Repro\n\n```bash\n# Prod\ncurl -s -w \"\\nHTTP Status: %{http_code}\\n\" \\\n  'https://tx.fhir.org/r4/ValueSet/$validate-code?url=http://hl7.org/fhir/us/davinci-pdex-plan-net/ValueSet/PractitionerRoleVS&code=ho&_format=json&system=http://hl7.org/fhir/us/davinci-pdex-plan-net/CodeSystem/ProviderRoleCS' \\\n  -H 'Accept: application/fhir+json'\n\n# Dev\ncurl -s -w \"\\nHTTP Status: %{http_code}\\n\" \\\n  'https://tx-dev.fhir.org/r4/ValueSet/$validate-code?url=http://hl7.org/fhir/us/davinci-pdex-plan-net/ValueSet/PractitionerRoleVS&code=ho&_format=json&system=http://hl7.org/fhir/us/davinci-pdex-plan-net/CodeSystem/ProviderRoleCS' \\\n  -H 'Accept: application/fhir+json'\n```\n\nProd returns HTTP 422 with OperationOutcome (issue code \"not-found\"). Dev returns HTTP 400 with the same OperationOutcome content. Both agree on the error semantics (same error code, same error message), differing only in HTTP status.\n\n## What differs\n\nProd returns HTTP 422 (Unprocessable Entity) while dev returns HTTP 400 (Bad Request) for error responses. Both servers return OperationOutcome resources with error-level issues and agree on the error semantics (same error codes, same error messages). The only difference is the HTTP status code.\n\nExample: a $validate-code request for a ValueSet that doesn't exist. Both return OperationOutcome with issue code \"not-found\" and text \"A definition for the value Set '...' could not be found\", but prod uses 422 and dev uses 400.\n\n## How widespread\n\n1897 records in the comparison dataset show this pattern (prod=422, dev=400). All 1897 have OperationOutcome on both sides.\n\nBreakdown by operation type:\n- validate-code: 1331 records\n- expand: 566 records\n\nBoth GET and POST requests are affected. The pattern spans all FHIR versions (/r4/, etc.) and all code systems/ValueSets.\n\nFound via: grep -c '\"prodStatus\":422,\"devStatus\":400' results/deltas/deltas.ndjson\n\n## What the tolerance covers\n\nTolerance ID: error-status-422-vs-400\nMatches: any record where prod.status=422, dev.status=400, and both response bodies are OperationOutcome resources (resourceType check).\nAction: skip (since the status code difference IS the categorization trigger — normalizing bodies doesn't change the status-mismatch category).\nEliminates: 1897 records.\n\n## Representative record\n\ne5639442-a91b-4de0-b1d9-9b901023b6c1 — GET /r4/ValueSet/$validate-code for PractitionerRoleVS (davinci-pdex-plan-net). Prod=422, dev=400, both return \"not-found\" OperationOutcome.", "body_html": "<p>Records-Impacted: 1897<br>\nTolerance-ID: error-status-422-vs-400<br>\nRecord-ID: e5639442-a91b-4de0-b1d9-9b901023b6c1</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod\ncurl -s -w &quot;\\nHTTP Status: %{http_code}\\n&quot; \\\n  &#x27;https://tx.fhir.org/r4/ValueSet/$validate-code?url=http://hl7.org/fhir/us/davinci-pdex-plan-net/ValueSet/PractitionerRoleVS&amp;code=ho&amp;_format=json&amp;system=http://hl7.org/fhir/us/davinci-pdex-plan-net/CodeSystem/ProviderRoleCS&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;\n\n# Dev\ncurl -s -w &quot;\\nHTTP Status: %{http_code}\\n&quot; \\\n  &#x27;https://tx-dev.fhir.org/r4/ValueSet/$validate-code?url=http://hl7.org/fhir/us/davinci-pdex-plan-net/ValueSet/PractitionerRoleVS&amp;code=ho&amp;_format=json&amp;system=http://hl7.org/fhir/us/davinci-pdex-plan-net/CodeSystem/ProviderRoleCS&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;</code></pre>\n<p>Prod returns HTTP 422 with OperationOutcome (issue code &quot;not-found&quot;). Dev returns HTTP 400 with the same OperationOutcome content. Both agree on the error semantics (same error code, same error message), differing only in HTTP status.</p>\n<h2>What differs</h2>\n<p>Prod returns HTTP 422 (Unprocessable Entity) while dev returns HTTP 400 (Bad Request) for error responses. Both servers return OperationOutcome resources with error-level issues and agree on the error semantics (same error codes, same error messages). The only difference is the HTTP status code.</p>\n<p>Example: a $validate-code request for a ValueSet that doesn&#x27;t exist. Both return OperationOutcome with issue code &quot;not-found&quot; and text &quot;A definition for the value Set &#x27;...&#x27; could not be found&quot;, but prod uses 422 and dev uses 400.</p>\n<h2>How widespread</h2>\n<p>1897 records in the comparison dataset show this pattern (prod=422, dev=400). All 1897 have OperationOutcome on both sides.</p>\n<p>Breakdown by operation type:</p>\n<ul><li>validate-code: 1331 records</li><li>expand: 566 records</li></ul>\n<p>Both GET and POST requests are affected. The pattern spans all FHIR versions (/r4/, etc.) and all code systems/ValueSets.</p>\n<p>Found via: grep -c &#x27;&quot;prodStatus&quot;:422,&quot;devStatus&quot;:400&#x27; results/deltas/deltas.ndjson</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance ID: error-status-422-vs-400<br>\nMatches: any record where prod.status=422, dev.status=400, and both response bodies are OperationOutcome resources (resourceType check).<br>\nAction: skip (since the status code difference IS the categorization trigger — normalizing bodies doesn&#x27;t change the status-mismatch category).<br>\nEliminates: 1897 records.</p>\n<h2>Representative record</h2>\n<p>e5639442-a91b-4de0-b1d9-9b901023b6c1 — GET /r4/ValueSet/$validate-code for PractitionerRoleVS (davinci-pdex-plan-net). Prod=422, dev=400, both return &quot;not-found&quot; OperationOutcome.</p>", "impact": 1897}, {"id": "2337986", "title": "Dev returns 404 instead of 422 when ValueSet not found for $expand", "status": "open", "labels": ["reproduced", "status-mismatch", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 15:17", "date_iso": "2026-02-07T15:17:11-06:00", "body_md": "Records-Impacted: 756\nTolerance-ID: expand-valueset-not-found-status-mismatch\nRecord-ID: 8b7a9262-90d3-4753-a197-9a631ffdcf2f\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$expand?url=http:%2F%2Fhl7.org%2Ffhir%2Fus%2Fdavinci-pdex-plan-net%2FValueSet%2FPractitionerRoleVS&_format=json' \\\n  -H 'Accept: application/fhir+json'\n\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$expand?url=http:%2F%2Fhl7.org%2Ffhir%2Fus%2Fdavinci-pdex-plan-net%2FValueSet%2FPractitionerRoleVS&_format=json' \\\n  -H 'Accept: application/fhir+json'\n```\n\nProd returns HTTP 422 with `issue.code: \"unknown\"` and `issue.details.text`, dev returns HTTP 404 with `issue.code: \"not-found\"` and `issue.diagnostics`.\n\n\nWhen a ValueSet cannot be found for a $expand operation, prod returns HTTP 422 (Unprocessable Entity) with an OperationOutcome using issue code `unknown` and `details.text`, while dev returns HTTP 404 (Not Found) with issue code `not-found` and `diagnostics`. Both communicate the same semantic meaning (\"this ValueSet doesn't exist\"), but the HTTP status code and OperationOutcome structure differ.\n\nProd response (status 422):\n- issue.code: \"unknown\"\n- issue.details.text: \"Unable to find value set for URL \\\"...\\\"\"\n\nDev response (status 404):\n- issue.code: \"not-found\"\n- issue.diagnostics: \"ValueSet not found: ...\"\n\n\n756 records in the comparison dataset show this exact pattern (prod=422, dev=404). All are $expand operations (722 GET, 34 POST) across many different ValueSet URLs. The pattern is universal — every prod=422/dev=404 status mismatch is an $expand of an unknown ValueSet.\n\nSearch used: `grep -c '\"prodStatus\":422,\"devStatus\":404' results/deltas/deltas.ndjson`\n\n\nTolerance ID: `expand-valueset-not-found-status-mismatch`\nMatches: $expand operations where prod=422 and dev=404, and both responses are OperationOutcomes indicating a ValueSet was not found.\nRecords eliminated: 756", "body_html": "<p>Records-Impacted: 756<br>\nTolerance-ID: expand-valueset-not-found-status-mismatch<br>\nRecord-ID: 8b7a9262-90d3-4753-a197-9a631ffdcf2f</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/ValueSet/$expand?url=http:%2F%2Fhl7.org%2Ffhir%2Fus%2Fdavinci-pdex-plan-net%2FValueSet%2FPractitionerRoleVS&amp;_format=json&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand?url=http:%2F%2Fhl7.org%2Ffhir%2Fus%2Fdavinci-pdex-plan-net%2FValueSet%2FPractitionerRoleVS&amp;_format=json&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;</code></pre>\n<p>Prod returns HTTP 422 with <code>issue.code: &quot;unknown&quot;</code> and <code>issue.details.text</code>, dev returns HTTP 404 with <code>issue.code: &quot;not-found&quot;</code> and <code>issue.diagnostics</code>.</p>\n<p>When a ValueSet cannot be found for a $expand operation, prod returns HTTP 422 (Unprocessable Entity) with an OperationOutcome using issue code <code>unknown</code> and <code>details.text</code>, while dev returns HTTP 404 (Not Found) with issue code <code>not-found</code> and <code>diagnostics</code>. Both communicate the same semantic meaning (&quot;this ValueSet doesn&#x27;t exist&quot;), but the HTTP status code and OperationOutcome structure differ.</p>\n<p>Prod response (status 422):</p>\n<ul><li>issue.code: &quot;unknown&quot;</li><li>issue.details.text: &quot;Unable to find value set for URL \\&quot;...\\&quot;&quot;</li></ul>\n<p>Dev response (status 404):</p>\n<ul><li>issue.code: &quot;not-found&quot;</li><li>issue.diagnostics: &quot;ValueSet not found: ...&quot;</li></ul>\n<p>756 records in the comparison dataset show this exact pattern (prod=422, dev=404). All are $expand operations (722 GET, 34 POST) across many different ValueSet URLs. The pattern is universal — every prod=422/dev=404 status mismatch is an $expand of an unknown ValueSet.</p>\n<p>Search used: <code>grep -c &#x27;&quot;prodStatus&quot;:422,&quot;devStatus&quot;:404&#x27; results/deltas/deltas.ndjson</code></p>\n<p>Tolerance ID: <code>expand-valueset-not-found-status-mismatch</code><br>\nMatches: $expand operations where prod=422 and dev=404, and both responses are OperationOutcomes indicating a ValueSet was not found.<br>\nRecords eliminated: 756</p>", "impact": 756}, {"id": "f2b2cef", "title": "Dev : missing valueset-unclosed extension and spurious expansion.total on incomplete expansions", "status": "open", "labels": ["content-differs", "reproduced", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 15:52", "date_iso": "2026-02-07T15:52:32-06:00", "body_md": "Records-Impacted: 292\nTolerance-ID: expand-unclosed-extension-and-total\nRecord-ID: b6156665-797d-4483-971c-62c00a0816b8\n\n\n```bash\ncurl -s https://tx.fhir.org/r4/ValueSet/\\$expand \\\n  -H \"Accept: application/fhir+json\" \\\n  -H \"Content-Type: application/fhir+json\" \\\n  --data-binary @- << 'REQUEST'\n{\n  \"resourceType\": \"Parameters\",\n  \"parameter\": [\n    {\n      \"name\": \"count\",\n      \"valueInteger\": 1000\n    },\n    {\n      \"name\": \"offset\",\n      \"valueInteger\": 0\n    },\n    {\n      \"name\": \"valueSet\",\n      \"resource\": {\n        \"resourceType\": \"ValueSet\",\n        \"status\": \"active\",\n        \"compose\": {\n          \"inactive\": true,\n          \"include\": [\n            {\n              \"system\": \"http://snomed.info/sct\",\n              \"filter\": [\n                {\n                  \"property\": \"concept\",\n                  \"op\": \"is-a\",\n                  \"value\": \"404684003\"\n                }\n              ]\n            }\n          ]\n        }\n      }\n    }\n  ]\n}\nREQUEST\n\ncurl -s https://tx-dev.fhir.org/r4/ValueSet/\\$expand \\\n  -H \"Accept: application/fhir+json\" \\\n  -H \"Content-Type: application/fhir+json\" \\\n  --data-binary @- << 'REQUEST'\n{\n  \"resourceType\": \"Parameters\",\n  \"parameter\": [\n    {\n      \"name\": \"count\",\n      \"valueInteger\": 1000\n    },\n    {\n      \"name\": \"offset\",\n      \"valueInteger\": 0\n    },\n    {\n      \"name\": \"valueSet\",\n      \"resource\": {\n        \"resourceType\": \"ValueSet\",\n        \"status\": \"active\",\n        \"compose\": {\n          \"inactive\": true,\n          \"include\": [\n            {\n              \"system\": \"http://snomed.info/sct\",\n              \"filter\": [\n                {\n                  \"property\": \"concept\",\n                  \"op\": \"is-a\",\n                  \"value\": \"404684003\"\n                }\n              ]\n            }\n          ]\n        }\n      }\n    }\n  ]\n}\nREQUEST\n```\n\nProd returns `expansion.extension` with `valueset-unclosed: true` and no `expansion.total`. Dev returns `expansion.total: 124412` with no unclosed extension.\n\n\nFor $expand operations that return incomplete/truncated expansions (e.g., SNOMED CT is-a queries requesting count=1000 from a set with 124,412 total codes):\n\n1. **Prod includes `expansion.extension` with `valueset-unclosed: true`; dev omits it.** Per the FHIR R4 spec, this extension signals that an expansion is incomplete due to inclusion of post-coordinated or unbounded value sets. Prod correctly marks these expansions as unclosed; dev does not.\n\n2. **Dev includes `expansion.total` (e.g., 124412); prod omits it.** The `total` field is optional (0..1) per spec. Prod omits it on these incomplete expansions; dev includes it. Since these expansions are truncated to the `count` parameter (e.g., 1000 codes returned), the behavioral difference is: dev tells the client the full count but doesn't signal incompleteness, while prod signals incompleteness but doesn't provide the full count.\n\nThese two differences always co-occur in the same records — every record where prod has `valueset-unclosed` but dev doesn't also has dev providing `total` while prod doesn't.\n\n\n292 records in the comparison dataset show both patterns simultaneously. All are successful (200/200) $expand operations. The pattern is predicted by: prod expansion has `valueset-unclosed` extension present AND dev expansion has `total` present but prod expansion does not.\n\nSearch: analyzed all 810 successful expand deltas; 292 match the combined pattern `unclosed=prod-only AND total=dev-only`. No records show unclosed prod-only without total dev-only or vice versa.\n\n\nTolerance `expand-unclosed-extension-and-total` matches $expand records where:\n- Both return 200 with expansion data\n- Prod has the `valueset-unclosed` extension but dev doesn't\n- Dev has `expansion.total` but prod doesn't\n\nIt normalizes by removing the `valueset-unclosed` extension from prod's expansion.extension array and removing `total` from dev's expansion object.\n\n\nb6156665-797d-4483-971c-62c00a0816b8: POST /r4/ValueSet/$expand — SNOMED CT is-a 404684003 (Clinical finding), count=1000. Prod returns 1000 codes with `valueset-unclosed: true` and no total. Dev returns 1000 codes with `total: 124412` and no unclosed extension.", "body_html": "<p>Records-Impacted: 292<br>\nTolerance-ID: expand-unclosed-extension-and-total<br>\nRecord-ID: b6156665-797d-4483-971c-62c00a0816b8</p>\n<pre><code class=\"lang-bash\">curl -s https://tx.fhir.org/r4/ValueSet/\\$expand \\\n  -H &quot;Accept: application/fhir+json&quot; \\\n  -H &quot;Content-Type: application/fhir+json&quot; \\\n  --data-binary @- &lt;&lt; &#x27;REQUEST&#x27;\n{\n  &quot;resourceType&quot;: &quot;Parameters&quot;,\n  &quot;parameter&quot;: [\n    {\n      &quot;name&quot;: &quot;count&quot;,\n      &quot;valueInteger&quot;: 1000\n    },\n    {\n      &quot;name&quot;: &quot;offset&quot;,\n      &quot;valueInteger&quot;: 0\n    },\n    {\n      &quot;name&quot;: &quot;valueSet&quot;,\n      &quot;resource&quot;: {\n        &quot;resourceType&quot;: &quot;ValueSet&quot;,\n        &quot;status&quot;: &quot;active&quot;,\n        &quot;compose&quot;: {\n          &quot;inactive&quot;: true,\n          &quot;include&quot;: [\n            {\n              &quot;system&quot;: &quot;http://snomed.info/sct&quot;,\n              &quot;filter&quot;: [\n                {\n                  &quot;property&quot;: &quot;concept&quot;,\n                  &quot;op&quot;: &quot;is-a&quot;,\n                  &quot;value&quot;: &quot;404684003&quot;\n                }\n              ]\n            }\n          ]\n        }\n      }\n    }\n  ]\n}\nREQUEST\n\ncurl -s https://tx-dev.fhir.org/r4/ValueSet/\\$expand \\\n  -H &quot;Accept: application/fhir+json&quot; \\\n  -H &quot;Content-Type: application/fhir+json&quot; \\\n  --data-binary @- &lt;&lt; &#x27;REQUEST&#x27;\n{\n  &quot;resourceType&quot;: &quot;Parameters&quot;,\n  &quot;parameter&quot;: [\n    {\n      &quot;name&quot;: &quot;count&quot;,\n      &quot;valueInteger&quot;: 1000\n    },\n    {\n      &quot;name&quot;: &quot;offset&quot;,\n      &quot;valueInteger&quot;: 0\n    },\n    {\n      &quot;name&quot;: &quot;valueSet&quot;,\n      &quot;resource&quot;: {\n        &quot;resourceType&quot;: &quot;ValueSet&quot;,\n        &quot;status&quot;: &quot;active&quot;,\n        &quot;compose&quot;: {\n          &quot;inactive&quot;: true,\n          &quot;include&quot;: [\n            {\n              &quot;system&quot;: &quot;http://snomed.info/sct&quot;,\n              &quot;filter&quot;: [\n                {\n                  &quot;property&quot;: &quot;concept&quot;,\n                  &quot;op&quot;: &quot;is-a&quot;,\n                  &quot;value&quot;: &quot;404684003&quot;\n                }\n              ]\n            }\n          ]\n        }\n      }\n    }\n  ]\n}\nREQUEST</code></pre>\n<p>Prod returns <code>expansion.extension</code> with <code>valueset-unclosed: true</code> and no <code>expansion.total</code>. Dev returns <code>expansion.total: 124412</code> with no unclosed extension.</p>\n<p>For $expand operations that return incomplete/truncated expansions (e.g., SNOMED CT is-a queries requesting count=1000 from a set with 124,412 total codes):</p>\n<ol><li>**Prod includes <code>expansion.extension</code> with <code>valueset-unclosed: true</code>; dev omits it.** Per the FHIR R4 spec, this extension signals that an expansion is incomplete due to inclusion of post-coordinated or unbounded value sets. Prod correctly marks these expansions as unclosed; dev does not.</li></ol>\n<ol><li>**Dev includes <code>expansion.total</code> (e.g., 124412); prod omits it.** The <code>total</code> field is optional (0..1) per spec. Prod omits it on these incomplete expansions; dev includes it. Since these expansions are truncated to the <code>count</code> parameter (e.g., 1000 codes returned), the behavioral difference is: dev tells the client the full count but doesn&#x27;t signal incompleteness, while prod signals incompleteness but doesn&#x27;t provide the full count.</li></ol>\n<p>These two differences always co-occur in the same records — every record where prod has <code>valueset-unclosed</code> but dev doesn&#x27;t also has dev providing <code>total</code> while prod doesn&#x27;t.</p>\n<p>292 records in the comparison dataset show both patterns simultaneously. All are successful (200/200) $expand operations. The pattern is predicted by: prod expansion has <code>valueset-unclosed</code> extension present AND dev expansion has <code>total</code> present but prod expansion does not.</p>\n<p>Search: analyzed all 810 successful expand deltas; 292 match the combined pattern <code>unclosed=prod-only AND total=dev-only</code>. No records show unclosed prod-only without total dev-only or vice versa.</p>\n<p>Tolerance <code>expand-unclosed-extension-and-total</code> matches $expand records where:</p>\n<ul><li>Both return 200 with expansion data</li><li>Prod has the <code>valueset-unclosed</code> extension but dev doesn&#x27;t</li><li>Dev has <code>expansion.total</code> but prod doesn&#x27;t</li></ul>\n<p>It normalizes by removing the <code>valueset-unclosed</code> extension from prod&#x27;s expansion.extension array and removing <code>total</code> from dev&#x27;s expansion object.</p>\n<p>b6156665-797d-4483-971c-62c00a0816b8: POST /r4/ValueSet/$expand — SNOMED CT is-a 404684003 (Clinical finding), count=1000. Prod returns 1000 codes with <code>valueset-unclosed: true</code> and no total. Dev returns 1000 codes with <code>total: 124412</code> and no unclosed extension.</p>", "impact": 292}, {"id": "4336772", "title": "Dev  returns only root concept for v3 hierarchical ValueSets (missing child codes)", "status": "open", "labels": ["content-differs", "reproduced", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 15:45", "date_iso": "2026-02-07T15:45:40-06:00", "body_md": "Records-Impacted: 246\nTolerance-ID: expand-v3-hierarchical-incomplete\nRecord-ID: 18d8209b-15f4-486d-8009-25ed8cb2cbcb\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$expand?url=http://terminology.hl7.org/ValueSet/v3-PurposeOfUse&_format=json' \\\n  -H 'Accept: application/fhir+json'\n\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$expand?url=http://terminology.hl7.org/ValueSet/v3-PurposeOfUse&_format=json' \\\n  -H 'Accept: application/fhir+json'\n```\n\nProd returns `expansion.total=63` with 63 codes (PurposeOfUse root + 62 child codes like HMARKT, HOPERAT, TREAT, etc.). Dev returns `expansion.total=1` with only the root abstract concept `PurposeOfUse`.\n\n\nWhen expanding v3 ValueSets that include hierarchical concepts from `terminology.hl7.org/CodeSystem/v3-ActReason`, dev returns only the root abstract concept while prod returns the full hierarchy of child codes.\n\nFor example, expanding `http://terminology.hl7.org/ValueSet/v3-PurposeOfUse`:\n- Prod: `expansion.total=63`, contains 63 codes (PurposeOfUse root + 62 child codes like HMARKT, HOPERAT, TREAT, etc.)\n- Dev: `expansion.total=1`, contains only the root abstract concept `PurposeOfUse`\n\nThe same pattern affects 4 distinct v3 ValueSets:\n- `v3-ActEncounterCode`: prod=12 codes, dev=1 (209 records)\n- `v3-ServiceDeliveryLocationRoleType`: prod=139 codes, dev=1 (24 records)\n- `v3-PurposeOfUse`: prod=63 codes, dev=1 (6 records)\n- `v3-ActPharmacySupplyType`: prod=35 codes, dev=1 (7 records)\n\nIn all cases, dev returns only the root concept and completely omits the descendant codes that should be included in the expansion.\n\n\n246 records across the 4 ValueSets listed above. Found via:\n```bash\ngrep '\"op\":\"expand\"' jobs/2026-02-round-2/results/deltas/deltas.ndjson | python3 -c '...' # script checking prod_total>1 and dev_total==1\n```\n\nAll are GET requests to `/r4/ValueSet/$expand` with `url=http://terminology.hl7.org/ValueSet/v3-*`.\n\n\nTolerance ID: `expand-v3-hierarchical-incomplete`. Matches expand operations where both prod and dev return 200, the ValueSet URL matches `terminology.hl7.org/ValueSet/v3-`, and dev expansion total is 1 while prod expansion total is greater than 1. Skips these records. Eliminates 246 records.\n\n\nBug 6edc96c mentions these 246 records in a comment as potentially a separate root cause from the version skew issue. This bug tracks the specific failure to expand hierarchical v3 ValueSets.", "body_html": "<p>Records-Impacted: 246<br>\nTolerance-ID: expand-v3-hierarchical-incomplete<br>\nRecord-ID: 18d8209b-15f4-486d-8009-25ed8cb2cbcb</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/ValueSet/$expand?url=http://terminology.hl7.org/ValueSet/v3-PurposeOfUse&amp;_format=json&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand?url=http://terminology.hl7.org/ValueSet/v3-PurposeOfUse&amp;_format=json&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;</code></pre>\n<p>Prod returns <code>expansion.total=63</code> with 63 codes (PurposeOfUse root + 62 child codes like HMARKT, HOPERAT, TREAT, etc.). Dev returns <code>expansion.total=1</code> with only the root abstract concept <code>PurposeOfUse</code>.</p>\n<p>When expanding v3 ValueSets that include hierarchical concepts from <code>terminology.hl7.org/CodeSystem/v3-ActReason</code>, dev returns only the root abstract concept while prod returns the full hierarchy of child codes.</p>\n<p>For example, expanding <code>http://terminology.hl7.org/ValueSet/v3-PurposeOfUse</code>:</p>\n<ul><li>Prod: <code>expansion.total=63</code>, contains 63 codes (PurposeOfUse root + 62 child codes like HMARKT, HOPERAT, TREAT, etc.)</li><li>Dev: <code>expansion.total=1</code>, contains only the root abstract concept <code>PurposeOfUse</code></li></ul>\n<p>The same pattern affects 4 distinct v3 ValueSets:</p>\n<ul><li><code>v3-ActEncounterCode</code>: prod=12 codes, dev=1 (209 records)</li><li><code>v3-ServiceDeliveryLocationRoleType</code>: prod=139 codes, dev=1 (24 records)</li><li><code>v3-PurposeOfUse</code>: prod=63 codes, dev=1 (6 records)</li><li><code>v3-ActPharmacySupplyType</code>: prod=35 codes, dev=1 (7 records)</li></ul>\n<p>In all cases, dev returns only the root concept and completely omits the descendant codes that should be included in the expansion.</p>\n<p>246 records across the 4 ValueSets listed above. Found via:</p>\n<pre><code class=\"lang-bash\">grep &#x27;&quot;op&quot;:&quot;expand&quot;&#x27; jobs/2026-02-round-2/results/deltas/deltas.ndjson | python3 -c &#x27;...&#x27; # script checking prod_total&gt;1 and dev_total==1</code></pre>\n<p>All are GET requests to <code>/r4/ValueSet/$expand</code> with <code>url=http://terminology.hl7.org/ValueSet/v3-*</code>.</p>\n<p>Tolerance ID: <code>expand-v3-hierarchical-incomplete</code>. Matches expand operations where both prod and dev return 200, the ValueSet URL matches <code>terminology.hl7.org/ValueSet/v3-</code>, and dev expansion total is 1 while prod expansion total is greater than 1. Skips these records. Eliminates 246 records.</p>\n<p>Bug 6edc96c mentions these 246 records in a comment as potentially a separate root cause from the version skew issue. This bug tracks the specific failure to expand hierarchical v3 ValueSets.</p>", "impact": 246}, {"id": "167be81", "title": "Dev returns result=false for valid v3 terminology codes in ValueSet $validate-code", "status": "open", "labels": ["reproduced", "result-disagrees", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 15:28", "date_iso": "2026-02-07T15:28:00-06:00", "body_md": "Records-Impacted: 187\nTolerance-ID: v3-valueset-validate-code-result-disagrees\nRecord-ID: 92d4fd1a-70fc-4497-adb5-309a3f564716\n\n## Repro\n\n```bash\n# Prod\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$validate-code?url=http:%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fconsent-category&code=INFA&_format=json&system=http:%2F%2Fterminology.hl7.org%2FCodeSystem%2Fv3-ActCode' \\\n  -H 'Accept: application/fhir+json'\n\n# Dev\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$validate-code?url=http:%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fconsent-category&code=INFA&_format=json&system=http:%2F%2Fterminology.hl7.org%2FCodeSystem%2Fv3-ActCode' \\\n  -H 'Accept: application/fhir+json'\n```\n\nProd returns `result: true` (code is valid in the ValueSet), dev returns `result: false` with error message \"The provided code 'http://terminology.hl7.org/CodeSystem/v3-ActCode#INFA' was not found in the value set 'http://hl7.org/fhir/ValueSet/consent-category|4.0.1'\".\n\nThe bug reproduces across multiple ValueSets:\n- encounter-participant-type with code CON from v3-ParticipationType\n- v3-ActEncounterCode with code AMB from v3-ActCode\n\n## What differs\n\nProd returns `result: true` for $validate-code of HL7 v3 terminology codes against their corresponding ValueSets. Dev returns `result: false` with message \"The provided code was not found in the value set.\"\n\nBoth servers agree on the CodeSystem version, code, and display text — dev can look up the code successfully in the CodeSystem. But dev fails to determine that the code is a member of the ValueSet.\n\nExample (this record): GET /r4/ValueSet/$validate-code with system=v3-ActCode, code=INFA, url=consent-category.\n- Prod: result=true, version=9.0.0, display=\"information access\"\n- Dev: result=false, version=9.0.0, display=\"information access\", message=\"code not found in value set consent-category|4.0.1\"\n\n## How widespread\n\n187 records across 5 ValueSets, all GET requests, all r4, all using terminology.hl7.org/CodeSystem/v3-* systems:\n\n- 103 records: v3-ActEncounterCode ValueSet (codes AMB, IMP, HH, EMER from v3-ActCode)\n- 69 records: encounter-participant-type ValueSet (codes CON, ADM, ATND from v3-ParticipationType)\n- 9 records: consent-category ValueSet (code INFA from v3-ActCode)\n- 4 records: v3-ServiceDeliveryLocationRoleType ValueSet (codes ER, CARD, SLEEP from v3-RoleCode)\n- 2 records: v3-PurposeOfUse ValueSet (code HMARKT from v3-ActReason)\n\nSearch used: grep 'result-disagrees' deltas.ndjson, filtered to terminology.hl7.org/CodeSystem/v3-* systems.\n\n## What the tolerance covers\n\nTolerance `v3-valueset-validate-code-result-disagrees` skips records where:\n- Operation is ValueSet/$validate-code\n- System is terminology.hl7.org/CodeSystem/v3-*\n- prodResult=true, devResult=false\n- Both sides report the same CodeSystem version\n\nEliminates 187 records.", "body_html": "<p>Records-Impacted: 187<br>\nTolerance-ID: v3-valueset-validate-code-result-disagrees<br>\nRecord-ID: 92d4fd1a-70fc-4497-adb5-309a3f564716</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod\ncurl -s &#x27;https://tx.fhir.org/r4/ValueSet/$validate-code?url=http:%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fconsent-category&amp;code=INFA&amp;_format=json&amp;system=http:%2F%2Fterminology.hl7.org%2FCodeSystem%2Fv3-ActCode&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;\n\n# Dev\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$validate-code?url=http:%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fconsent-category&amp;code=INFA&amp;_format=json&amp;system=http:%2F%2Fterminology.hl7.org%2FCodeSystem%2Fv3-ActCode&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;</code></pre>\n<p>Prod returns <code>result: true</code> (code is valid in the ValueSet), dev returns <code>result: false</code> with error message &quot;The provided code &#x27;http://terminology.hl7.org/CodeSystem/v3-ActCode#INFA&#x27; was not found in the value set &#x27;http://hl7.org/fhir/ValueSet/consent-category|4.0.1&#x27;&quot;.</p>\n<p>The bug reproduces across multiple ValueSets:</p>\n<ul><li>encounter-participant-type with code CON from v3-ParticipationType</li><li>v3-ActEncounterCode with code AMB from v3-ActCode</li></ul>\n<h2>What differs</h2>\n<p>Prod returns <code>result: true</code> for $validate-code of HL7 v3 terminology codes against their corresponding ValueSets. Dev returns <code>result: false</code> with message &quot;The provided code was not found in the value set.&quot;</p>\n<p>Both servers agree on the CodeSystem version, code, and display text — dev can look up the code successfully in the CodeSystem. But dev fails to determine that the code is a member of the ValueSet.</p>\n<p>Example (this record): GET /r4/ValueSet/$validate-code with system=v3-ActCode, code=INFA, url=consent-category.</p>\n<ul><li>Prod: result=true, version=9.0.0, display=&quot;information access&quot;</li><li>Dev: result=false, version=9.0.0, display=&quot;information access&quot;, message=&quot;code not found in value set consent-category|4.0.1&quot;</li></ul>\n<h2>How widespread</h2>\n<p>187 records across 5 ValueSets, all GET requests, all r4, all using terminology.hl7.org/CodeSystem/v3-* systems:</p>\n<ul><li>103 records: v3-ActEncounterCode ValueSet (codes AMB, IMP, HH, EMER from v3-ActCode)</li><li>69 records: encounter-participant-type ValueSet (codes CON, ADM, ATND from v3-ParticipationType)</li><li>9 records: consent-category ValueSet (code INFA from v3-ActCode)</li><li>4 records: v3-ServiceDeliveryLocationRoleType ValueSet (codes ER, CARD, SLEEP from v3-RoleCode)</li><li>2 records: v3-PurposeOfUse ValueSet (code HMARKT from v3-ActReason)</li></ul>\n<p>Search used: grep &#x27;result-disagrees&#x27; deltas.ndjson, filtered to terminology.hl7.org/CodeSystem/v3-* systems.</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance <code>v3-valueset-validate-code-result-disagrees</code> skips records where:</p>\n<ul><li>Operation is ValueSet/$validate-code</li><li>System is terminology.hl7.org/CodeSystem/v3-*</li><li>prodResult=true, devResult=false</li><li>Both sides report the same CodeSystem version</li></ul>\n<p>Eliminates 187 records.</p>", "impact": 187}, {"id": "2ed80bd", "title": "Dev  omits expansion.total when prod includes it", "status": "open", "labels": ["content-differs", "reproduced", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 16:18", "date_iso": "2026-02-07T16:18:44-06:00", "body_md": "Records-Impacted: 47\nTolerance-ID: expand-dev-missing-total\nRecord-ID: a1f653a2-a199-4228-a7f7-2522abde6953\n\n## Repro\n\n```bash\n# Prod\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$expand' -H 'Accept: application/fhir+json' -H 'Content-Type: application/fhir+json' -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"system-version\",\"valueUri\":\"http://snomed.info/sct|http://snomed.info/sct/11000315107\"},{\"name\":\"displayLanguage\",\"valueCode\":\"fr\"},{\"name\":\"includeDefinition\",\"valueBoolean\":false},{\"name\":\"excludeNested\",\"valueBoolean\":true},{\"name\":\"cache-id\",\"valueId\":\"4d94febc-fb6a-407d-a69c-29b8de3c56c3\"},{\"name\":\"count\",\"valueInteger\":1000},{\"name\":\"offset\",\"valueInteger\":0},{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"status\":\"active\",\"compose\":{\"inactive\":true,\"include\":[{\"system\":\"urn:iso:std:iso:3166:-2\"}]}}}]}' | jq '.expansion | {total, contains_count: (.contains | length)}'\n\n# Dev\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$expand' -H 'Accept: application/fhir+json' -H 'Content-Type: application/fhir+json' -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"system-version\",\"valueUri\":\"http://snomed.info/sct|http://snomed.info/sct/11000315107\"},{\"name\":\"displayLanguage\",\"valueCode\":\"fr\"},{\"name\":\"includeDefinition\",\"valueBoolean\":false},{\"name\":\"excludeNested\",\"valueBoolean\":true},{\"name\":\"cache-id\",\"valueId\":\"4d94febc-fb6a-407d-a69c-29b8de3c56c3\"},{\"name\":\"count\",\"valueInteger\":1000},{\"name\":\"offset\",\"valueInteger\":0},{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"status\":\"active\",\"compose\":{\"inactive\":true,\"include\":[{\"system\":\"urn:iso:std:iso:3166:-2\"}]}}}]}' | jq '.expansion | {total, contains_count: (.contains | length)}'\n```\n\nProd returns `\"total\": 5099` with 1000 contains entries. Dev returns `\"total\": null` (field missing) with 1000 contains entries.\n\n## What differs\n\nIn $expand responses (POST /r4/ValueSet/$expand), prod returns `expansion.total` (the total count of matching concepts) while dev omits it entirely. The `total` field is a 0..1 optional integer in FHIR R4's ValueSet.expansion, documented as \"Total concept count; permits server pagination.\" Without it, clients cannot determine how many pages exist in a paged expansion.\n\nExamples:\n- Prod: `\"total\": 5099` with 1000 contains (paged)\n- Dev: no `total` field, same 1000 contains\n\nBoth servers return identical `contains` arrays and `offset` values in all sampled records.\n\n## How widespread\n\n47 records in deltas.ndjson show this pattern (prod has expansion.total, dev omits it). Breakdown:\n- 33 records with total=5099 (paged SNOMED expansions with count=1000)\n- 13 records with total=0 (empty expansions)\n- 1 record with total=249 (ISO 3166 codes, also has contains count mismatch)\n\nSearch: All 47 are expand operations, all POST /r4/ValueSet/$expand, all with both statuses 200.\n\nNote: There is a separate existing tolerance (expand-unclosed-extension-and-total, bug f2b2cef) for the reverse case where prod omits total on unclosed expansions but dev includes it. That bug is about the valueset-unclosed extension. This bug is different — neither side has the unclosed extension; dev simply fails to include `total` in complete expansions.\n\n## What the tolerance covers\n\nTolerance ID: expand-dev-missing-total\nMatches: $expand responses (POST /r4/ValueSet/$expand) where both sides return 200, prod has expansion.total, and dev doesn't.\nNormalizes by removing expansion.total from prod (since dev lacks it) to prevent re-triaging.", "body_html": "<p>Records-Impacted: 47<br>\nTolerance-ID: expand-dev-missing-total<br>\nRecord-ID: a1f653a2-a199-4228-a7f7-2522abde6953</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod\ncurl -s &#x27;https://tx.fhir.org/r4/ValueSet/$expand&#x27; -H &#x27;Accept: application/fhir+json&#x27; -H &#x27;Content-Type: application/fhir+json&#x27; -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;system-version&quot;,&quot;valueUri&quot;:&quot;http://snomed.info/sct|http://snomed.info/sct/11000315107&quot;},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueCode&quot;:&quot;fr&quot;},{&quot;name&quot;:&quot;includeDefinition&quot;,&quot;valueBoolean&quot;:false},{&quot;name&quot;:&quot;excludeNested&quot;,&quot;valueBoolean&quot;:true},{&quot;name&quot;:&quot;cache-id&quot;,&quot;valueId&quot;:&quot;4d94febc-fb6a-407d-a69c-29b8de3c56c3&quot;},{&quot;name&quot;:&quot;count&quot;,&quot;valueInteger&quot;:1000},{&quot;name&quot;:&quot;offset&quot;,&quot;valueInteger&quot;:0},{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;status&quot;:&quot;active&quot;,&quot;compose&quot;:{&quot;inactive&quot;:true,&quot;include&quot;:[{&quot;system&quot;:&quot;urn:iso:std:iso:3166:-2&quot;}]}}}]}&#x27; | jq &#x27;.expansion | {total, contains_count: (.contains | length)}&#x27;\n\n# Dev\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand&#x27; -H &#x27;Accept: application/fhir+json&#x27; -H &#x27;Content-Type: application/fhir+json&#x27; -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;system-version&quot;,&quot;valueUri&quot;:&quot;http://snomed.info/sct|http://snomed.info/sct/11000315107&quot;},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueCode&quot;:&quot;fr&quot;},{&quot;name&quot;:&quot;includeDefinition&quot;,&quot;valueBoolean&quot;:false},{&quot;name&quot;:&quot;excludeNested&quot;,&quot;valueBoolean&quot;:true},{&quot;name&quot;:&quot;cache-id&quot;,&quot;valueId&quot;:&quot;4d94febc-fb6a-407d-a69c-29b8de3c56c3&quot;},{&quot;name&quot;:&quot;count&quot;,&quot;valueInteger&quot;:1000},{&quot;name&quot;:&quot;offset&quot;,&quot;valueInteger&quot;:0},{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;status&quot;:&quot;active&quot;,&quot;compose&quot;:{&quot;inactive&quot;:true,&quot;include&quot;:[{&quot;system&quot;:&quot;urn:iso:std:iso:3166:-2&quot;}]}}}]}&#x27; | jq &#x27;.expansion | {total, contains_count: (.contains | length)}&#x27;</code></pre>\n<p>Prod returns <code>&quot;total&quot;: 5099</code> with 1000 contains entries. Dev returns <code>&quot;total&quot;: null</code> (field missing) with 1000 contains entries.</p>\n<h2>What differs</h2>\n<p>In $expand responses (POST /r4/ValueSet/$expand), prod returns <code>expansion.total</code> (the total count of matching concepts) while dev omits it entirely. The <code>total</code> field is a 0..1 optional integer in FHIR R4&#x27;s ValueSet.expansion, documented as &quot;Total concept count; permits server pagination.&quot; Without it, clients cannot determine how many pages exist in a paged expansion.</p>\n<p>Examples:</p>\n<ul><li>Prod: <code>&quot;total&quot;: 5099</code> with 1000 contains (paged)</li><li>Dev: no <code>total</code> field, same 1000 contains</li></ul>\n<p>Both servers return identical <code>contains</code> arrays and <code>offset</code> values in all sampled records.</p>\n<h2>How widespread</h2>\n<p>47 records in deltas.ndjson show this pattern (prod has expansion.total, dev omits it). Breakdown:</p>\n<ul><li>33 records with total=5099 (paged SNOMED expansions with count=1000)</li><li>13 records with total=0 (empty expansions)</li><li>1 record with total=249 (ISO 3166 codes, also has contains count mismatch)</li></ul>\n<p>Search: All 47 are expand operations, all POST /r4/ValueSet/$expand, all with both statuses 200.</p>\n<p>Note: There is a separate existing tolerance (expand-unclosed-extension-and-total, bug f2b2cef) for the reverse case where prod omits total on unclosed expansions but dev includes it. That bug is about the valueset-unclosed extension. This bug is different — neither side has the unclosed extension; dev simply fails to include <code>total</code> in complete expansions.</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance ID: expand-dev-missing-total<br>\nMatches: $expand responses (POST /r4/ValueSet/$expand) where both sides return 200, prod has expansion.total, and dev doesn&#x27;t.<br>\nNormalizes by removing expansion.total from prod (since dev lacks it) to prevent re-triaging.</p>", "impact": 47}, {"id": "6edc96c", "title": "Dev loads different versions of HL7 terminology CodeSystems (terminology.hl7.org) than prod", "status": "open", "labels": ["content-differs", "reproduced", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 15:33", "date_iso": "2026-02-07T15:33:34-06:00", "body_md": "Records-Impacted: 32\nTolerance-ID: hl7-terminology-cs-version-skew\nRecord-ID: 04364a8a-acce-491a-8018-9ac010d47d21\n\n## Repro\n\n```bash\n# Prod\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$validate-code?url=http:%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fconsent-category&code=idscl&_format=json&system=http:%2F%2Fterminology.hl7.org%2FCodeSystem%2Fconsentcategorycodes' -H 'Accept: application/fhir+json' | jq -r '.parameter[] | select(.name == \"message\") | .valueString'\n\n# Dev\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$validate-code?url=http:%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fconsent-category&code=idscl&_format=json&system=http:%2F%2Fterminology.hl7.org%2FCodeSystem%2Fconsentcategorycodes' -H 'Accept: application/fhir+json' | jq -r '.parameter[] | select(.name == \"message\") | .valueString'\n```\n\nProd returns `version '4.0.1'`, dev returns `version '1.0.1'`.\n\n## What differs\n\nFor CodeSystems under `http://terminology.hl7.org/CodeSystem/*`, prod reports version `4.0.1` in error messages and OperationOutcome issue text, while dev reports different versions:\n\n- `consentcategorycodes`: prod=4.0.1, dev=1.0.1\n- `goal-achievement`: prod=4.0.1, dev=1.0.1\n- `consentpolicycodes`: prod=4.0.1, dev=3.0.1\n- `v2-0116`: prod=2.9, dev=3.0.0\n\nThe version difference appears in:\n1. The `message` parameter valueString (e.g., \"Unknown code 'idscl' in the CodeSystem '...' version '4.0.1'\" vs \"version '1.0.1'\")\n2. The `issues` OperationOutcome `details.text` field\n\nBoth servers agree on the validation result (e.g., result=false for invalid codes). The core terminology behavior is the same — only the loaded CodeSystem edition version differs.\n\n## How widespread\n\n32 records in the delta file are affected, all validate-code operations on HL7 terminology CodeSystems. Found via:\n\n```\ngrep for records where prod has version '4.0.1' and dev has '1.0.1' or '3.0.1',\nplus v2-0116 where prod=2.9, dev=3.0.0\n```\n\nAll are GET requests to `/r4/ValueSet/$validate-code` or `/r4/CodeSystem/$validate-code`.\n\n## What the tolerance covers\n\nTolerance ID: `hl7-terminology-cs-version-skew`. Matches validate-code records where the system is under `terminology.hl7.org/CodeSystem/` and the message/issues text differs only in the version string pattern. Normalizes version strings in message text and OperationOutcome issue details.text from dev's version to prod's version.", "body_html": "<p>Records-Impacted: 32<br>\nTolerance-ID: hl7-terminology-cs-version-skew<br>\nRecord-ID: 04364a8a-acce-491a-8018-9ac010d47d21</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod\ncurl -s &#x27;https://tx.fhir.org/r4/ValueSet/$validate-code?url=http:%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fconsent-category&amp;code=idscl&amp;_format=json&amp;system=http:%2F%2Fterminology.hl7.org%2FCodeSystem%2Fconsentcategorycodes&#x27; -H &#x27;Accept: application/fhir+json&#x27; | jq -r &#x27;.parameter[] | select(.name == &quot;message&quot;) | .valueString&#x27;\n\n# Dev\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$validate-code?url=http:%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fconsent-category&amp;code=idscl&amp;_format=json&amp;system=http:%2F%2Fterminology.hl7.org%2FCodeSystem%2Fconsentcategorycodes&#x27; -H &#x27;Accept: application/fhir+json&#x27; | jq -r &#x27;.parameter[] | select(.name == &quot;message&quot;) | .valueString&#x27;</code></pre>\n<p>Prod returns <code>version &#x27;4.0.1&#x27;</code>, dev returns <code>version &#x27;1.0.1&#x27;</code>.</p>\n<h2>What differs</h2>\n<p>For CodeSystems under <code>http://terminology.hl7.org/CodeSystem/*</code>, prod reports version <code>4.0.1</code> in error messages and OperationOutcome issue text, while dev reports different versions:</p>\n<ul><li><code>consentcategorycodes</code>: prod=4.0.1, dev=1.0.1</li><li><code>goal-achievement</code>: prod=4.0.1, dev=1.0.1</li><li><code>consentpolicycodes</code>: prod=4.0.1, dev=3.0.1</li><li><code>v2-0116</code>: prod=2.9, dev=3.0.0</li></ul>\n<p>The version difference appears in:</p>\n<ol><li>The <code>message</code> parameter valueString (e.g., &quot;Unknown code &#x27;idscl&#x27; in the CodeSystem &#x27;...&#x27; version &#x27;4.0.1&#x27;&quot; vs &quot;version &#x27;1.0.1&#x27;&quot;)</li><li>The <code>issues</code> OperationOutcome <code>details.text</code> field</li></ol>\n<p>Both servers agree on the validation result (e.g., result=false for invalid codes). The core terminology behavior is the same — only the loaded CodeSystem edition version differs.</p>\n<h2>How widespread</h2>\n<p>32 records in the delta file are affected, all validate-code operations on HL7 terminology CodeSystems. Found via:</p>\n<pre><code>grep for records where prod has version &#x27;4.0.1&#x27; and dev has &#x27;1.0.1&#x27; or &#x27;3.0.1&#x27;,\nplus v2-0116 where prod=2.9, dev=3.0.0</code></pre>\n<p>All are GET requests to <code>/r4/ValueSet/$validate-code</code> or <code>/r4/CodeSystem/$validate-code</code>.</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance ID: <code>hl7-terminology-cs-version-skew</code>. Matches validate-code records where the system is under <code>terminology.hl7.org/CodeSystem/</code> and the message/issues text differs only in the version string pattern. Normalizes version strings in message text and OperationOutcome issue details.text from dev&#x27;s version to prod&#x27;s version.</p>", "impact": 32}, {"id": "bd89513", "title": "Dev returns extra message/issues for display language resolution on validate-code result=true", "status": "open", "labels": ["content-differs", "reproduced", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 16:05", "date_iso": "2026-02-07T16:05:31-06:00", "body_md": "Records-Impacted: 19\nTolerance-ID: dev-extra-display-lang-not-found-message\nRecord-ID: 299d1b7f-b8f7-4cee-95ab-fa83da75ea80\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$validate-code?' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"codeableConcept\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"urn:iso:std:iso:3166\",\"code\":\"FR\",\"display\":\"France\"}]}},{\"name\":\"displayLanguage\",\"valueCode\":\"fr\"},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true},{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"id\":\"jurisdiction\",\"url\":\"http://hl7.org/fhir/ValueSet/jurisdiction\",\"version\":\"4.0.1\",\"compose\":{\"include\":[{\"system\":\"urn:iso:std:iso:3166\"},{\"system\":\"urn:iso:std:iso:3166:-2\"},{\"system\":\"http://unstats.un.org/unsd/methods/m49/m49.htm\",\"filter\":[{\"property\":\"class\",\"op\":\"=\",\"value\":\"region\"}]}]}}}]}'\n\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$validate-code?' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"codeableConcept\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"urn:iso:std:iso:3166\",\"code\":\"FR\",\"display\":\"France\"}]}},{\"name\":\"displayLanguage\",\"valueCode\":\"fr\"},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true},{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"id\":\"jurisdiction\",\"url\":\"http://hl7.org/fhir/ValueSet/jurisdiction\",\"version\":\"4.0.1\",\"compose\":{\"include\":[{\"system\":\"urn:iso:std:iso:3166\"},{\"system\":\"urn:iso:std:iso:3166:-2\"},{\"system\":\"http://unstats.un.org/unsd/methods/m49/m49.htm\",\"filter\":[{\"property\":\"class\",\"op\":\"=\",\"value\":\"region\"}]}]}}}]}'\n```\n\nProd returns parameters: result, system, code, version, display, codeableConcept, diagnostics.\n\nDev returns the same parameters plus message (\"There are no valid display names found for the code urn:iso:std:iso:3166#FR for language(s) 'fr'. The display is 'France' which is the default language display\") and issues (OperationOutcome with informational severity).\n\n\nWhen $validate-code returns result=true and a displayLanguage parameter was specified in the request, dev returns extra message and issues parameters that prod omits entirely. The dev message reads: \"There are no valid display names found for the code <system>#<code> for language(s) '<lang>'. The display is '<display>' which is the default language display.\" The issues parameter contains an OperationOutcome with an informational issue (code=invalid, tx-issue-type=invalid-display).\n\nProd returns only: result, system, code, version, display, codeableConcept, diagnostics.\nDev returns all the above plus: message and issues with the display-language-not-found informational feedback.\n\nBoth servers agree on result=true, and the validated code/display/version are identical.\n\n\n19 records in deltas match this pattern. All are POST /r4/ValueSet/$validate-code with result=true where prod has no message/issues and dev has \"no valid display names found\" message+issues. 17 of 19 involve urn:iso:std:iso:3166 codes (FR, FRA) with displayLanguage=fr or fr-FR. 2 involve urn:iso:std:iso:3166 with no explicit displayLanguage.\n\nSearch: grep 'There are no valid display names found' jobs/2026-02-round-2/results/deltas/deltas.ndjson | wc -l returns 21 total, but 2 of those have differing prod issues too (SNOMED, different root cause). The 19 clean matches are where prod lacks both message and issues entirely.\n\n\nTolerance dev-extra-display-lang-not-found-message matches validate-code Parameters responses where result=true, prod has no message parameter, and dev has a message containing \"There are no valid display names found\". It normalizes by stripping the extra message and issues from dev. Eliminates 19 records.", "body_html": "<p>Records-Impacted: 19<br>\nTolerance-ID: dev-extra-display-lang-not-found-message<br>\nRecord-ID: 299d1b7f-b8f7-4cee-95ab-fa83da75ea80</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/ValueSet/$validate-code?&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;codeableConcept&quot;,&quot;valueCodeableConcept&quot;:{&quot;coding&quot;:[{&quot;system&quot;:&quot;urn:iso:std:iso:3166&quot;,&quot;code&quot;:&quot;FR&quot;,&quot;display&quot;:&quot;France&quot;}]}},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueCode&quot;:&quot;fr&quot;},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true},{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;id&quot;:&quot;jurisdiction&quot;,&quot;url&quot;:&quot;http://hl7.org/fhir/ValueSet/jurisdiction&quot;,&quot;version&quot;:&quot;4.0.1&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;urn:iso:std:iso:3166&quot;},{&quot;system&quot;:&quot;urn:iso:std:iso:3166:-2&quot;},{&quot;system&quot;:&quot;http://unstats.un.org/unsd/methods/m49/m49.htm&quot;,&quot;filter&quot;:[{&quot;property&quot;:&quot;class&quot;,&quot;op&quot;:&quot;=&quot;,&quot;value&quot;:&quot;region&quot;}]}]}}}]}&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$validate-code?&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;codeableConcept&quot;,&quot;valueCodeableConcept&quot;:{&quot;coding&quot;:[{&quot;system&quot;:&quot;urn:iso:std:iso:3166&quot;,&quot;code&quot;:&quot;FR&quot;,&quot;display&quot;:&quot;France&quot;}]}},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueCode&quot;:&quot;fr&quot;},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true},{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;id&quot;:&quot;jurisdiction&quot;,&quot;url&quot;:&quot;http://hl7.org/fhir/ValueSet/jurisdiction&quot;,&quot;version&quot;:&quot;4.0.1&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;urn:iso:std:iso:3166&quot;},{&quot;system&quot;:&quot;urn:iso:std:iso:3166:-2&quot;},{&quot;system&quot;:&quot;http://unstats.un.org/unsd/methods/m49/m49.htm&quot;,&quot;filter&quot;:[{&quot;property&quot;:&quot;class&quot;,&quot;op&quot;:&quot;=&quot;,&quot;value&quot;:&quot;region&quot;}]}]}}}]}&#x27;</code></pre>\n<p>Prod returns parameters: result, system, code, version, display, codeableConcept, diagnostics.</p>\n<p>Dev returns the same parameters plus message (&quot;There are no valid display names found for the code urn:iso:std:iso:3166#FR for language(s) &#x27;fr&#x27;. The display is &#x27;France&#x27; which is the default language display&quot;) and issues (OperationOutcome with informational severity).</p>\n<p>When $validate-code returns result=true and a displayLanguage parameter was specified in the request, dev returns extra message and issues parameters that prod omits entirely. The dev message reads: &quot;There are no valid display names found for the code &lt;system&gt;#&lt;code&gt; for language(s) &#x27;&lt;lang&gt;&#x27;. The display is &#x27;&lt;display&gt;&#x27; which is the default language display.&quot; The issues parameter contains an OperationOutcome with an informational issue (code=invalid, tx-issue-type=invalid-display).</p>\n<p>Prod returns only: result, system, code, version, display, codeableConcept, diagnostics.<br>\nDev returns all the above plus: message and issues with the display-language-not-found informational feedback.</p>\n<p>Both servers agree on result=true, and the validated code/display/version are identical.</p>\n<p>19 records in deltas match this pattern. All are POST /r4/ValueSet/$validate-code with result=true where prod has no message/issues and dev has &quot;no valid display names found&quot; message+issues. 17 of 19 involve urn:iso:std:iso:3166 codes (FR, FRA) with displayLanguage=fr or fr-FR. 2 involve urn:iso:std:iso:3166 with no explicit displayLanguage.</p>\n<p>Search: grep &#x27;There are no valid display names found&#x27; jobs/2026-02-round-2/results/deltas/deltas.ndjson | wc -l returns 21 total, but 2 of those have differing prod issues too (SNOMED, different root cause). The 19 clean matches are where prod lacks both message and issues entirely.</p>\n<p>Tolerance dev-extra-display-lang-not-found-message matches validate-code Parameters responses where result=true, prod has no message parameter, and dev has a message containing &quot;There are no valid display names found&quot;. It normalizes by stripping the extra message and issues from dev. Eliminates 19 records.</p>", "impact": 19}, {"id": "c7004d3", "title": "Dev omits valueset-toocostly extension and adds spurious used-codesystem on  for grammar-based code systems", "status": "open", "labels": ["content-differs", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 16:25", "date_iso": "2026-02-07T16:25:28-06:00", "body_md": "Records-Impacted: 13\nTolerance-ID: expand-toocostly-extension-and-used-codesystem\nRecord-ID: a272aa8c-96d7-4905-a75a-ea21d67b83fc\n\n## What differs\n\nFor $expand on grammar-based code systems (primarily BCP-13 MIME types via `urn:ietf:bcp:13`, plus one Brazilian ICD-10 ValueSet), both prod and dev return 200 with an empty expansion (total=0, no `contains`). However:\n\n1. **Prod includes `expansion.extension` with `valueset-toocostly: true`; dev omits it.** This extension signals that the expansion could not be performed because the code system is grammar-based or too costly to enumerate. Prod correctly marks these expansions; dev does not.\n\n2. **Dev includes `expansion.parameter` with `used-codesystem` (e.g., `urn:ietf:bcp:13`); prod omits it.** Dev reports which code system it consulted, even though the expansion returned no results. Prod does not report a used-codesystem on these too-costly expansions.\n\nBoth differences always co-occur in the same records.\n\n## How widespread\n\n13 records in the current comparison dataset show both patterns simultaneously. All are successful (200/200) $expand operations. 12 of 13 involve `http://hl7.org/fhir/ValueSet/mimetypes` (BCP-13 MIME types). One involves a Brazilian ValueSet that includes LOINC and a Brazilian ICD-10 code system.\n\nSearch: `grep 'valueset-toocostly' deltas.ndjson` found 25 records total; of those, 13 have both sides returning 200 (the rest have status mismatches handled by other tolerances).\n\n## What the tolerance covers\n\nTolerance `expand-toocostly-extension-and-used-codesystem` matches $expand records where both return 200, prod has the `valueset-toocostly` extension but dev doesn't, and normalizes by:\n- Removing the `valueset-toocostly` extension from prod\n- Removing any dev-only `used-codesystem` parameters\n\nEliminates 13 records from the delta file.\n\n## Representative record\n\na272aa8c-96d7-4905-a75a-ea21d67b83fc: POST /r4/ValueSet/$expand — BCP-13 MIME types (http://hl7.org/fhir/ValueSet/mimetypes). Prod returns empty expansion with `valueset-toocostly: true` extension and `limitedExpansion: true` parameter. Dev returns empty expansion with `limitedExpansion: true` and `used-codesystem: urn:ietf:bcp:13` but no toocostly extension.", "body_html": "<p>Records-Impacted: 13<br>\nTolerance-ID: expand-toocostly-extension-and-used-codesystem<br>\nRecord-ID: a272aa8c-96d7-4905-a75a-ea21d67b83fc</p>\n<h2>What differs</h2>\n<p>For $expand on grammar-based code systems (primarily BCP-13 MIME types via <code>urn:ietf:bcp:13</code>, plus one Brazilian ICD-10 ValueSet), both prod and dev return 200 with an empty expansion (total=0, no <code>contains</code>). However:</p>\n<ol><li>**Prod includes <code>expansion.extension</code> with <code>valueset-toocostly: true</code>; dev omits it.** This extension signals that the expansion could not be performed because the code system is grammar-based or too costly to enumerate. Prod correctly marks these expansions; dev does not.</li></ol>\n<ol><li>**Dev includes <code>expansion.parameter</code> with <code>used-codesystem</code> (e.g., <code>urn:ietf:bcp:13</code>); prod omits it.** Dev reports which code system it consulted, even though the expansion returned no results. Prod does not report a used-codesystem on these too-costly expansions.</li></ol>\n<p>Both differences always co-occur in the same records.</p>\n<h2>How widespread</h2>\n<p>13 records in the current comparison dataset show both patterns simultaneously. All are successful (200/200) $expand operations. 12 of 13 involve <code>http://hl7.org/fhir/ValueSet/mimetypes</code> (BCP-13 MIME types). One involves a Brazilian ValueSet that includes LOINC and a Brazilian ICD-10 code system.</p>\n<p>Search: <code>grep &#x27;valueset-toocostly&#x27; deltas.ndjson</code> found 25 records total; of those, 13 have both sides returning 200 (the rest have status mismatches handled by other tolerances).</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance <code>expand-toocostly-extension-and-used-codesystem</code> matches $expand records where both return 200, prod has the <code>valueset-toocostly</code> extension but dev doesn&#x27;t, and normalizes by:</p>\n<ul><li>Removing the <code>valueset-toocostly</code> extension from prod</li><li>Removing any dev-only <code>used-codesystem</code> parameters</li></ul>\n<p>Eliminates 13 records from the delta file.</p>\n<h2>Representative record</h2>\n<p>a272aa8c-96d7-4905-a75a-ea21d67b83fc: POST /r4/ValueSet/$expand — BCP-13 MIME types (http://hl7.org/fhir/ValueSet/mimetypes). Prod returns empty expansion with <code>valueset-toocostly: true</code> extension and <code>limitedExpansion: true</code> parameter. Dev returns empty expansion with <code>limitedExpansion: true</code> and <code>used-codesystem: urn:ietf:bcp:13</code> but no toocostly extension.</p>", "impact": 13}, {"id": "801aef1", "title": "Dev adds expression field on informational OperationOutcome issues where prod omits it", "status": "open", "labels": ["content-differs", "reproduced", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 15:59", "date_iso": "2026-02-07T15:59:16-06:00", "body_md": "Records-Impacted: 6\nTolerance-ID: oo-extra-expression-on-info-issues\nRecord-ID: 9160e659-1af6-4bc6-9c89-e0a8b4df55cf\n\n## Repro\n\n```bash\n# Prod\ncurl -s 'https://tx.fhir.org/r4/CodeSystem/$validate-code?system=http%3A%2F%2Funitsofmeasure.org&code=TEST' \\\n  -H 'Accept: application/fhir+json' | \\\n  jq '.parameter[] | select(.name == \"issues\") | .resource.issue[] | select(.severity == \"information\") | {severity, code, expression}'\n\n# Dev\ncurl -s 'https://tx-dev.fhir.org/r4/CodeSystem/$validate-code?system=http%3A%2F%2Funitsofmeasure.org&code=TEST' \\\n  -H 'Accept: application/fhir+json' | \\\n  jq '.parameter[] | select(.name == \"issues\") | .resource.issue[] | select(.severity == \"information\") | {severity, code, expression}'\n```\n\nProd returns `\"expression\": null` (field absent) on the informational issue, dev returns `\"expression\": [\"code\"]`.\n\n## What differs\n\nIn $validate-code responses, both prod and dev return OperationOutcome issues. On error-severity issues, both include `expression: [\"code\"]`. On information-severity issues, prod omits the `expression` field entirely while dev includes `expression: [\"code\"]`.\n\nFor example, on `GET /r4/CodeSystem/$validate-code?system=http%3A%2F%2Funitsofmeasure.org&code=TEST`:\n- Prod: informational issue has no `expression` field\n- Dev: informational issue has `\"expression\": [\"code\"]`\n\nThe `expression` value is semantically correct (the issue relates to the `code` parameter), so dev is providing more complete information, but the difference in field presence is a real behavioral divergence.\n\n## How widespread\n\n6 records across the dataset exhibit this pattern:\n- 4 SNOMED CT records (all `code=K29` variants on different FHIR version paths)\n- 1 UCUM record (`code=TEST`)\n- 1 SNOMED CT POST record (`code=freetext`)\n\nAll are `$validate-code` or `$batch-validate-code` operations where the code is invalid and the informational issue provides supplementary error context (e.g., UCUM parse error, SNOMED expression parse error).\n\nSearch: node script checking all 3948 delta records for issues where dev has `expression` and prod lacks it on the same positional issue.\n\n## What the tolerance covers\n\nTolerance `oo-extra-expression-on-info-issues` matches validate-code Parameters responses where any OperationOutcome information-severity issue in dev has `expression` that prod lacks. Normalizes by removing the extra `expression` from dev to match prod. Eliminates 6 records.", "body_html": "<p>Records-Impacted: 6<br>\nTolerance-ID: oo-extra-expression-on-info-issues<br>\nRecord-ID: 9160e659-1af6-4bc6-9c89-e0a8b4df55cf</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod\ncurl -s &#x27;https://tx.fhir.org/r4/CodeSystem/$validate-code?system=http%3A%2F%2Funitsofmeasure.org&amp;code=TEST&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; | \\\n  jq &#x27;.parameter[] | select(.name == &quot;issues&quot;) | .resource.issue[] | select(.severity == &quot;information&quot;) | {severity, code, expression}&#x27;\n\n# Dev\ncurl -s &#x27;https://tx-dev.fhir.org/r4/CodeSystem/$validate-code?system=http%3A%2F%2Funitsofmeasure.org&amp;code=TEST&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; | \\\n  jq &#x27;.parameter[] | select(.name == &quot;issues&quot;) | .resource.issue[] | select(.severity == &quot;information&quot;) | {severity, code, expression}&#x27;</code></pre>\n<p>Prod returns <code>&quot;expression&quot;: null</code> (field absent) on the informational issue, dev returns <code>&quot;expression&quot;: [&quot;code&quot;]</code>.</p>\n<h2>What differs</h2>\n<p>In $validate-code responses, both prod and dev return OperationOutcome issues. On error-severity issues, both include <code>expression: [&quot;code&quot;]</code>. On information-severity issues, prod omits the <code>expression</code> field entirely while dev includes <code>expression: [&quot;code&quot;]</code>.</p>\n<p>For example, on <code>GET /r4/CodeSystem/$validate-code?system=http%3A%2F%2Funitsofmeasure.org&amp;code=TEST</code>:</p>\n<ul><li>Prod: informational issue has no <code>expression</code> field</li><li>Dev: informational issue has <code>&quot;expression&quot;: [&quot;code&quot;]</code></li></ul>\n<p>The <code>expression</code> value is semantically correct (the issue relates to the <code>code</code> parameter), so dev is providing more complete information, but the difference in field presence is a real behavioral divergence.</p>\n<h2>How widespread</h2>\n<p>6 records across the dataset exhibit this pattern:</p>\n<ul><li>4 SNOMED CT records (all <code>code=K29</code> variants on different FHIR version paths)</li><li>1 UCUM record (<code>code=TEST</code>)</li><li>1 SNOMED CT POST record (<code>code=freetext</code>)</li></ul>\n<p>All are <code>$validate-code</code> or <code>$batch-validate-code</code> operations where the code is invalid and the informational issue provides supplementary error context (e.g., UCUM parse error, SNOMED expression parse error).</p>\n<p>Search: node script checking all 3948 delta records for issues where dev has <code>expression</code> and prod lacks it on the same positional issue.</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance <code>oo-extra-expression-on-info-issues</code> matches validate-code Parameters responses where any OperationOutcome information-severity issue in dev has <code>expression</code> that prod lacks. Normalizes by removing the extra <code>expression</code> from dev to match prod. Eliminates 6 records.</p>", "impact": 6}, {"id": "b6d19d8", "title": "Dev omits system/code/version/display params on CodeSystem/$validate-code with codeableConcept containing unknown system", "status": "open", "labels": ["content-differs", "reproduced", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 16:12", "date_iso": "2026-02-07T16:12:17-06:00", "body_md": "Records-Impacted: 5\nTolerance-ID: cc-validate-code-missing-known-coding-params\nRecord-ID: 84b0cee7-5f7e-4fbc-af8a-aed5ad7a91d4\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r5/CodeSystem/$validate-code' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"codeableConcept\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.smartypower.app/CodeSystem/smartypower-cognitive-tests\",\"code\":\"SP-QUICKSTOP\",\"display\":\"QuickStop Response Inhibition Test\"},{\"system\":\"http://loinc.org\",\"code\":\"72106-8\",\"display\":\"Cognitive functioning [Interpretation]\"}],\"text\":\"Go/No-Go task measuring response inhibition and impulse control\"}},{\"name\":\"displayLanguage\",\"valueString\":\"en\"},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true}]}'\n\ncurl -s 'https://tx-dev.fhir.org/r5/CodeSystem/$validate-code' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"codeableConcept\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.smartypower.app/CodeSystem/smartypower-cognitive-tests\",\"code\":\"SP-QUICKSTOP\",\"display\":\"QuickStop Response Inhibition Test\"},{\"system\":\"http://loinc.org\",\"code\":\"72106-8\",\"display\":\"Cognitive functioning [Interpretation]\"}],\"text\":\"Go/No-Go task measuring response inhibition and impulse control\"}},{\"name\":\"displayLanguage\",\"valueString\":\"en\"},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true}]}'\n```\n\nProd returns `system=http://loinc.org`, `code=72106-8`, `display=Total score [MMSE]`, plus 2 OperationOutcome issues (UNKNOWN_CODESYSTEM + Display_Name_for__should_be_one_of__instead_of). Dev returns no system/code/display params and only 1 issue (UNKNOWN_CODESYSTEM).\n\n\nWhen CodeSystem/$validate-code is called with a codeableConcept containing multiple codings — one from an unknown CodeSystem and one from a known CodeSystem — and result=false:\n\n- **Prod** validates the known coding and returns `system`, `code`, `version`, `display` parameters for it. When the known coding also has issues (e.g. invalid-display), prod includes those as additional OperationOutcome issues.\n- **Dev** only reports the unknown system error and omits the `system`, `code`, `version`, `display` parameters entirely. Dev also omits any additional OperationOutcome issues related to the known coding.\n\nFor example, with a codeableConcept containing a LOINC coding (known) and a smartypower coding (unknown):\n- Prod returns: system=http://loinc.org, code=72106-8, version=2.81, display=\"Total score [MMSE]\", plus 2 issues (UNKNOWN_CODESYSTEM + invalid-display)\n- Dev returns: no system/code/version/display params, only 1 issue (UNKNOWN_CODESYSTEM)\n\n\n5 records in deltas. All are CodeSystem/$validate-code (both /r4 and /r5) with codeableConcept containing one unknown and one known coding. Both sides agree result=false.\n\nSearch: `grep '\"missing-in-dev\",\"param\":\"system\"' results/deltas/deltas.ndjson | wc -l` → 5\n\nThe 5 records involve 2 unknown systems:\n- https://fhir.smartypower.app/CodeSystem/smartypower-cognitive-tests (2 records, LOINC known coding)\n- http://fhir.essilorluxottica.com/fhir/CodeSystem/el-observation-code-cs (3 records, SNOMED known coding)\n\n\nTolerance ID: cc-validate-code-missing-known-coding-params\nMatches: validate-code with codeableConcept, result=false on both sides, x-caused-by-unknown-system present, where prod has system/code params that dev lacks.\nNormalizes by adding prod's system/code/version/display params to dev and canonicalizing issues to prod's set.\nEliminates: 5 records.\n\n\n- 84b0cee7-5f7e-4fbc-af8a-aed5ad7a91d4 (LOINC + smartypower, /r5)\n- 6f70f14a-81e1-427e-9eed-1b2c53801296 (SNOMED + essilorluxottica, /r4)", "body_html": "<p>Records-Impacted: 5<br>\nTolerance-ID: cc-validate-code-missing-known-coding-params<br>\nRecord-ID: 84b0cee7-5f7e-4fbc-af8a-aed5ad7a91d4</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r5/CodeSystem/$validate-code&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;codeableConcept&quot;,&quot;valueCodeableConcept&quot;:{&quot;coding&quot;:[{&quot;system&quot;:&quot;https://fhir.smartypower.app/CodeSystem/smartypower-cognitive-tests&quot;,&quot;code&quot;:&quot;SP-QUICKSTOP&quot;,&quot;display&quot;:&quot;QuickStop Response Inhibition Test&quot;},{&quot;system&quot;:&quot;http://loinc.org&quot;,&quot;code&quot;:&quot;72106-8&quot;,&quot;display&quot;:&quot;Cognitive functioning [Interpretation]&quot;}],&quot;text&quot;:&quot;Go/No-Go task measuring response inhibition and impulse control&quot;}},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueString&quot;:&quot;en&quot;},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true}]}&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r5/CodeSystem/$validate-code&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;codeableConcept&quot;,&quot;valueCodeableConcept&quot;:{&quot;coding&quot;:[{&quot;system&quot;:&quot;https://fhir.smartypower.app/CodeSystem/smartypower-cognitive-tests&quot;,&quot;code&quot;:&quot;SP-QUICKSTOP&quot;,&quot;display&quot;:&quot;QuickStop Response Inhibition Test&quot;},{&quot;system&quot;:&quot;http://loinc.org&quot;,&quot;code&quot;:&quot;72106-8&quot;,&quot;display&quot;:&quot;Cognitive functioning [Interpretation]&quot;}],&quot;text&quot;:&quot;Go/No-Go task measuring response inhibition and impulse control&quot;}},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueString&quot;:&quot;en&quot;},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true}]}&#x27;</code></pre>\n<p>Prod returns <code>system=http://loinc.org</code>, <code>code=72106-8</code>, <code>display=Total score [MMSE]</code>, plus 2 OperationOutcome issues (UNKNOWN_CODESYSTEM + Display_Name_for<strong>should_be_one_of</strong>instead_of). Dev returns no system/code/display params and only 1 issue (UNKNOWN_CODESYSTEM).</p>\n<p>When CodeSystem/$validate-code is called with a codeableConcept containing multiple codings — one from an unknown CodeSystem and one from a known CodeSystem — and result=false:</p>\n<ul><li><strong>Prod</strong> validates the known coding and returns <code>system</code>, <code>code</code>, <code>version</code>, <code>display</code> parameters for it. When the known coding also has issues (e.g. invalid-display), prod includes those as additional OperationOutcome issues.</li><li><strong>Dev</strong> only reports the unknown system error and omits the <code>system</code>, <code>code</code>, <code>version</code>, <code>display</code> parameters entirely. Dev also omits any additional OperationOutcome issues related to the known coding.</li></ul>\n<p>For example, with a codeableConcept containing a LOINC coding (known) and a smartypower coding (unknown):</p>\n<ul><li>Prod returns: system=http://loinc.org, code=72106-8, version=2.81, display=&quot;Total score [MMSE]&quot;, plus 2 issues (UNKNOWN_CODESYSTEM + invalid-display)</li><li>Dev returns: no system/code/version/display params, only 1 issue (UNKNOWN_CODESYSTEM)</li></ul>\n<p>5 records in deltas. All are CodeSystem/$validate-code (both /r4 and /r5) with codeableConcept containing one unknown and one known coding. Both sides agree result=false.</p>\n<p>Search: <code>grep &#x27;&quot;missing-in-dev&quot;,&quot;param&quot;:&quot;system&quot;&#x27; results/deltas/deltas.ndjson | wc -l</code> → 5</p>\n<p>The 5 records involve 2 unknown systems:</p>\n<ul><li>https://fhir.smartypower.app/CodeSystem/smartypower-cognitive-tests (2 records, LOINC known coding)</li><li>http://fhir.essilorluxottica.com/fhir/CodeSystem/el-observation-code-cs (3 records, SNOMED known coding)</li></ul>\n<p>Tolerance ID: cc-validate-code-missing-known-coding-params<br>\nMatches: validate-code with codeableConcept, result=false on both sides, x-caused-by-unknown-system present, where prod has system/code params that dev lacks.<br>\nNormalizes by adding prod&#x27;s system/code/version/display params to dev and canonicalizing issues to prod&#x27;s set.<br>\nEliminates: 5 records.</p>\n<ul><li>84b0cee7-5f7e-4fbc-af8a-aed5ad7a91d4 (LOINC + smartypower, /r5)</li><li>6f70f14a-81e1-427e-9eed-1b2c53801296 (SNOMED + essilorluxottica, /r4)</li></ul>", "impact": 5}, {"id": "e18fdef", "title": "Dev returns 404 for LOINC answer list ValueSet $expand (appends |4.0.1 to canonical URL)", "status": "closed", "labels": ["missing-resource", "not-reproduced", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-07 15:10", "date_iso": "2026-02-07T15:10:47-06:00", "body_md": "Records-Impacted: 2\nTolerance-ID: loinc-answer-list-expand-404\nRecord-ID: 7cf61657-1a32-4b8f-a4c6-f626df7381e0\n\n\n```bash\ncurl -s https://tx.fhir.org/r4/ValueSet/\\$expand \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://loinc.org/vs/LL379-9\"}]}'\n\ncurl -s https://tx-dev.fhir.org/r4/ValueSet/\\$expand \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://loinc.org/vs/LL379-9\"}]}'\n```\n\n**Result:** Both servers now return 200 with identical ValueSet expansions containing 7 codes. The bug is no longer reproduced - the dev server previously returned 404 with \"ValueSet not found: http://loinc.org/vs/LL379-9|4.0.1\" but now correctly expands the LOINC answer list.\n\n\nWhen expanding the LOINC answer list ValueSet `http://loinc.org/vs/LL379-9` via `POST /r4/ValueSet/$expand`, prod returns 200 with a successful expansion (7 codes), while dev **previously** returned 404 with:\n\n    ValueSet not found: http://loinc.org/vs/LL379-9|4.0.1\n\nDev was appending `|4.0.1` (the FHIR R4 version) to the ValueSet canonical URL when resolving it, causing the lookup to fail.\n\n\n2 records in the comparison dataset showed this exact pattern — both are `POST /r4/ValueSet/$expand` for the same LOINC answer list LL379-9, both with prod=200/dev=404, and both with the same `|4.0.1` suffix in the dev error message.\n\nSearch:\n- `grep 'LL379-9' deltas.ndjson` → 2 records\n- `grep 'missing-resource' deltas.ndjson` → 3 total (1 is a separate CodeSystem/SOP issue)\n- All 2 matching records had identical error diagnostic\n\nThe full comparison.ndjson had 64 records referencing LL379-9, but the other 62 are `GET /r4/ValueSet?_elements=url,version` (search/list operations, not expand) and succeeded on both servers.\n\n\nTolerance ID: `loinc-answer-list-expand-404`\nMatched: `missing-resource` category, `POST /r4/ValueSet/$expand`, dev 404 with diagnostics containing `|4.0.1`\nEliminated: 2 records", "body_html": "<p>Records-Impacted: 2<br>\nTolerance-ID: loinc-answer-list-expand-404<br>\nRecord-ID: 7cf61657-1a32-4b8f-a4c6-f626df7381e0</p>\n<pre><code class=\"lang-bash\">curl -s https://tx.fhir.org/r4/ValueSet/\\$expand \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://loinc.org/vs/LL379-9&quot;}]}&#x27;\n\ncurl -s https://tx-dev.fhir.org/r4/ValueSet/\\$expand \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://loinc.org/vs/LL379-9&quot;}]}&#x27;</code></pre>\n<p><strong>Result:</strong> Both servers now return 200 with identical ValueSet expansions containing 7 codes. The bug is no longer reproduced - the dev server previously returned 404 with &quot;ValueSet not found: http://loinc.org/vs/LL379-9|4.0.1&quot; but now correctly expands the LOINC answer list.</p>\n<p>When expanding the LOINC answer list ValueSet <code>http://loinc.org/vs/LL379-9</code> via <code>POST /r4/ValueSet/$expand</code>, prod returns 200 with a successful expansion (7 codes), while dev <strong>previously</strong> returned 404 with:</p>\n<p>ValueSet not found: http://loinc.org/vs/LL379-9|4.0.1</p>\n<p>Dev was appending <code>|4.0.1</code> (the FHIR R4 version) to the ValueSet canonical URL when resolving it, causing the lookup to fail.</p>\n<p>2 records in the comparison dataset showed this exact pattern — both are <code>POST /r4/ValueSet/$expand</code> for the same LOINC answer list LL379-9, both with prod=200/dev=404, and both with the same <code>|4.0.1</code> suffix in the dev error message.</p>\n<p>Search:</p>\n<ul><li><code>grep &#x27;LL379-9&#x27; deltas.ndjson</code> → 2 records</li><li><code>grep &#x27;missing-resource&#x27; deltas.ndjson</code> → 3 total (1 is a separate CodeSystem/SOP issue)</li><li>All 2 matching records had identical error diagnostic</li></ul>\n<p>The full comparison.ndjson had 64 records referencing LL379-9, but the other 62 are <code>GET /r4/ValueSet?_elements=url,version</code> (search/list operations, not expand) and succeeded on both servers.</p>\n<p>Tolerance ID: <code>loinc-answer-list-expand-404</code><br>\nMatched: <code>missing-resource</code> category, <code>POST /r4/ValueSet/$expand</code>, dev 404 with diagnostics containing <code>|4.0.1</code><br>\nEliminated: 2 records</p>", "impact": 2}];
const STATS = {"total": 13, "open": 12, "closed": 1, "labels": {"content-differs": 9, "reproduced": 11, "tx-compare": 13, "status-mismatch": 2, "result-disagrees": 1, "missing-resource": 1, "not-reproduced": 1}, "sortedLabels": ["tx-compare", "reproduced", "content-differs", "status-mismatch", "result-disagrees", "missing-resource", "not-reproduced"], "job": {"total": 32233, "matchedPerfectly": 0, "matchedEquiv": 10231, "knownIssues": 18129, "untriaged": 3873}};

document.getElementById("gen-time").textContent = new Date().toLocaleString();

// Pipeline overview bar
(function() {
  const job = STATS.job;
  if (!job) return;
  const bar = document.getElementById("pipeline-bar");
  const segs = [
    { value: job.matchedPerfectly, label: "matched perfectly", cls: "seg-perfect" },
    { value: job.matchedEquiv, label: "considered equivalent by Claude", cls: "seg-equiv" },
    { value: job.knownIssues, label: "considered mismatches by Claude; bugs listed below", cls: "seg-known" },
    { value: job.untriaged, label: "untriaged", cls: "seg-untriaged" },
  ];
  const total = job.total;
  let html = "";
  for (const s of segs) {
    if (s.value === 0) continue;
    const pct = (s.value / total * 100);
    html += `<div class="pipeline-seg ${s.cls}" style="flex:${s.value}">
      <span class="seg-value">${s.value.toLocaleString()}</span>
      <span class="seg-label">${s.label}</span>
    </div>`;
  }
  bar.innerHTML = html;
})();

// Stats bar
(function() {
  const bar = document.getElementById("stats-bar");
  let html = `<div class="stat"><span class="stat-value">${STATS.total}</span> bugs total</div>`;
  html += `<div class="stat-divider"></div>`;
  html += `<div class="stat"><span class="stat-value" style="color:var(--status-open-fg)">${STATS.open}</span> open</div>`;
  html += `<div class="stat"><span class="stat-value">${STATS.closed}</span> closed</div>`;
  bar.innerHTML = html;
})();

// Label filter pills
(function() {
  const container = document.getElementById("label-filters");
  let html = "";
  for (const label of STATS.sortedLabels) {
    const c = STATS.labels[label] || 0;
    html += `<span class="filter-pill" data-label="${label}">${label} <span class="count">${c}</span></span>`;
  }
  container.innerHTML = html;
})();

// State
let activeLabels = new Set();
let activeStatus = "all";
let searchQuery = "";
let currentSort = "impact";

function renderBugList() {
  const list = document.getElementById("bug-list");
  // Sort bugs
  const sorted = [...BUGS];
  if (currentSort === "impact") {
    sorted.sort((a, b) => (b.impact || 0) - (a.impact || 0) || a.title.localeCompare(b.title));
  } else if (currentSort === "date") {
    sorted.sort((a, b) => (b.date_iso || "").localeCompare(a.date_iso || ""));
  } else if (currentSort === "title") {
    sorted.sort((a, b) => a.title.localeCompare(b.title));
  }

  let html = "";
  for (const bug of sorted) {
    const statusClass = bug.status === "open" ? "pill-status-open" : "pill-status-closed";
    const labels = bug.labels.map(l => `<span class="pill pill-label" data-label="${l}">${l}</span>`).join("");
    const impactPill = bug.impact ? `<span class="pill pill-impact">${bug.impact.toLocaleString()} records</span>` : "";

    html += `<div class="bug-card" data-status="${bug.status}" data-id="${bug.id}" data-labels="${bug.labels.join(",")}" data-impact="${bug.impact || 0}">
      <div class="bug-header" onclick="toggleBug(this)">
        <svg class="bug-expand-icon" viewBox="0 0 16 16" fill="currentColor">
          <path d="M6.22 3.22a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042L9.94 8 6.22 4.28a.75.75 0 0 1 0-1.06Z"/>
        </svg>
        <div class="bug-info">
          <div class="bug-title">${bug.title}</div>
          <div class="bug-meta">
            <span class="pill ${statusClass}">${bug.status}</span>
            ${labels}
            ${impactPill}
            <span class="bug-id">${bug.id}</span>
            <span class="bug-date">${bug.date}</span>
          </div>
        </div>
      </div>
      <div class="bug-body">${bug.body_html}</div>
    </div>`;
  }

  list.innerHTML = html;
  applyFilters();
}

function toggleBug(header) {
  header.parentElement.classList.toggle("expanded");
}

let allExpanded = false;
function toggleExpandAll() {
  allExpanded = !allExpanded;
  const cards = document.querySelectorAll(".bug-card:not(.hidden)");
  cards.forEach(c => c.classList.toggle("expanded", allExpanded));
  document.getElementById("expand-all-btn").textContent = allExpanded ? "Collapse all" : "Expand all";
}

function applyFilters() {
  const cards = document.querySelectorAll(".bug-card");
  const query = searchQuery.toLowerCase();
  let visibleCount = 0;

  cards.forEach(card => {
    const status = card.dataset.status;
    const cardLabels = card.dataset.labels ? card.dataset.labels.split(",") : [];
    const bugId = card.dataset.id;
    const bug = BUGS.find(b => b.id === bugId);

    let show = true;

    // Label filter: card must have at least one of the active labels
    if (activeLabels.size > 0) {
      if (!cardLabels.some(l => activeLabels.has(l))) {
        show = false;
      }
    }

    if (activeStatus !== "all" && status !== activeStatus) {
      show = false;
    }

    if (query && show && bug) {
      const searchable = (bug.title + " " + bug.body_md + " " + bug.labels.join(" ")).toLowerCase();
      if (!searchable.includes(query)) {
        show = false;
      }
    }

    card.classList.toggle("hidden", !show);
    if (show) visibleCount++;
  });

  document.getElementById("no-results").classList.toggle("hidden", visibleCount > 0);
}

// Search
document.getElementById("search").addEventListener("input", function() {
  searchQuery = this.value;
  applyFilters();
});

// Label filter pills
document.querySelectorAll(".filter-pill[data-label]").forEach(pill => {
  pill.addEventListener("click", function() {
    const label = this.dataset.label;
    if (activeLabels.has(label)) {
      activeLabels.delete(label);
      this.classList.remove("dimmed");
    } else {
      if (activeLabels.size === 0) {
        document.querySelectorAll(".filter-pill[data-label]").forEach(pp => {
          if (pp.dataset.label !== label) pp.classList.add("dimmed");
        });
        activeLabels.add(label);
      } else {
        activeLabels.add(label);
        this.classList.remove("dimmed");
      }
    }

    if (activeLabels.size === 0) {
      document.querySelectorAll(".filter-pill[data-label]").forEach(pp => {
        pp.classList.remove("dimmed");
      });
    }

    applyFilters();
  });
});

// Status filter buttons
document.querySelectorAll(".ctrl-btn[data-status]").forEach(btn => {
  btn.addEventListener("click", function() {
    document.querySelectorAll(".ctrl-btn[data-status]").forEach(b => b.classList.remove("active"));
    this.classList.add("active");
    activeStatus = this.dataset.status;
    applyFilters();
  });
});

// Sort buttons
document.querySelectorAll(".sort-btn").forEach(btn => {
  btn.addEventListener("click", function() {
    document.querySelectorAll(".sort-btn").forEach(b => b.classList.remove("active"));
    this.classList.add("active");
    currentSort = this.dataset.sort;
    renderBugList();
  });
});

// Initial render
renderBugList();
</script>
</body>
</html>