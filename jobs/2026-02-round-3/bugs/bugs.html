<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FHIRsmith tx-compare Bug Report</title>
<style>
:root {
  --bg: #ffffff;
  --bg-surface: #f6f8fa;
  --bg-card: #ffffff;
  --border: #d1d9e0;
  --border-light: #e8ecf0;
  --text: #1f2328;
  --text-secondary: #59636e;
  --text-muted: #818b98;
  --shadow: 0 1px 3px rgba(0,0,0,0.08), 0 1px 2px rgba(0,0,0,0.04);
  --shadow-hover: 0 4px 12px rgba(0,0,0,0.1), 0 2px 4px rgba(0,0,0,0.06);
  --radius: 8px;
  --radius-sm: 6px;
  --font: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans", Helvetica, Arial, sans-serif;
  --font-mono: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace;

  --pill-tx-bg: #ccfbf1; --pill-tx-fg: #115e59; --pill-tx-border: #5eead4;
  --pill-round-bg: #ede9fe; --pill-round-fg: #5b21b6; --pill-round-border: #c4b5fd;
  --pill-default-bg: #f3f4f6; --pill-default-fg: #4b5563; --pill-default-border: #d1d5db;

  --status-open-bg: #dcfce7; --status-open-fg: #166534; --status-open-border: #86efac;
  --status-closed-bg: #f3f4f6; --status-closed-fg: #6b7280; --status-closed-border: #d1d5db;
}

@media (prefers-color-scheme: dark) {
  :root {
    --bg: #0d1117;
    --bg-surface: #161b22;
    --bg-card: #1c2128;
    --border: #30363d;
    --border-light: #21262d;
    --text: #e6edf3;
    --text-secondary: #8b949e;
    --text-muted: #6e7681;
    --shadow: 0 1px 3px rgba(0,0,0,0.3), 0 1px 2px rgba(0,0,0,0.2);
    --shadow-hover: 0 4px 12px rgba(0,0,0,0.4), 0 2px 4px rgba(0,0,0,0.3);

    --pill-tx-bg: #042f2e; --pill-tx-fg: #5eead4; --pill-tx-border: #134e4a;
    --pill-round-bg: #2e1065; --pill-round-fg: #c4b5fd; --pill-round-border: #4c1d95;
    --pill-default-bg: #1f2937; --pill-default-fg: #9ca3af; --pill-default-border: #374151;

    --status-open-bg: #052e16; --status-open-fg: #86efac; --status-open-border: #14532d;
    --status-closed-bg: #1f2937; --status-closed-fg: #9ca3af; --status-closed-border: #374151;
  }
}

*, *::before, *::after { box-sizing: border-box; }

body {
  font-family: var(--font);
  background: var(--bg);
  color: var(--text);
  margin: 0;
  padding: 0;
  line-height: 1.6;
}

.container {
  max-width: 960px;
  margin: 0 auto;
  padding: 24px 16px;
}

h1 {
  font-size: 24px;
  font-weight: 700;
  margin: 0 0 4px 0;
}

.subtitle {
  color: var(--text-muted);
  font-size: 14px;
  margin: 0 0 24px 0;
}

.stats-bar {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 20px;
  padding: 16px;
  background: var(--bg-surface);
  border: 1px solid var(--border-light);
  border-radius: var(--radius);
}

.stat {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 13px;
  color: var(--text-secondary);
  padding: 4px 10px;
  border-radius: var(--radius-sm);
  background: var(--bg-card);
  border: 1px solid var(--border-light);
}

.stat-value {
  font-weight: 700;
  color: var(--text);
  font-size: 15px;
}

.stat-divider {
  width: 1px;
  height: 24px;
  background: var(--border);
  margin: 0 4px;
}

.filter-bar {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-bottom: 20px;
  align-items: center;
}

.search-box {
  flex: 1;
  min-width: 200px;
  padding: 8px 12px;
  font-size: 14px;
  font-family: var(--font);
  background: var(--bg-card);
  color: var(--text);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  outline: none;
  transition: border-color 0.15s, box-shadow 0.15s;
}

.search-box:focus {
  border-color: #3b82f6;
  box-shadow: 0 0 0 3px rgba(59,130,246,0.15);
}

.search-box::placeholder {
  color: var(--text-muted);
}

.filter-pills {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.filter-pill {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 4px 10px;
  font-size: 12px;
  font-weight: 600;
  border-radius: 999px;
  cursor: pointer;
  user-select: none;
  transition: opacity 0.15s, transform 0.1s;
  border: 1px solid var(--pill-default-border);
  background: var(--pill-default-bg);
  color: var(--pill-default-fg);
}

.filter-pill[data-label="tx-compare"] {
  background: var(--pill-tx-bg);
  color: var(--pill-tx-fg);
  border-color: var(--pill-tx-border);
}

.filter-pill[data-label^="round:"] {
  background: var(--pill-round-bg);
  color: var(--pill-round-fg);
  border-color: var(--pill-round-border);
}

.filter-pill:hover {
  transform: translateY(-1px);
}

.filter-pill.active {
  box-shadow: 0 0 0 2px var(--text);
}

.filter-pill.dimmed {
  opacity: 0.35;
}

.filter-pill .count {
  font-weight: 400;
  opacity: 0.8;
}

.controls {
  display: flex;
  gap: 4px;
  margin-left: auto;
  flex-wrap: wrap;
}

.ctrl-btn {
  padding: 4px 10px;
  font-size: 12px;
  font-weight: 600;
  border-radius: var(--radius-sm);
  cursor: pointer;
  border: 1px solid var(--border);
  background: var(--bg-card);
  color: var(--text-secondary);
  font-family: var(--font);
  transition: background 0.15s, color 0.15s;
}

.ctrl-btn:hover {
  background: var(--bg-surface);
}

.ctrl-btn.active {
  background: var(--text);
  color: var(--bg);
  border-color: var(--text);
}

.bug-card {
  background: var(--bg-card);
  border: 1px solid var(--border-light);
  border-radius: var(--radius);
  margin-bottom: 8px;
  box-shadow: var(--shadow);
  transition: box-shadow 0.15s, border-color 0.15s;
  overflow: hidden;
}

.bug-card:hover {
  box-shadow: var(--shadow-hover);
  border-color: var(--border);
}

.bug-card.hidden {
  display: none;
}

.bug-header {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  padding: 12px 16px;
  cursor: pointer;
  user-select: none;
}

.bug-header:hover {
  background: var(--bg-surface);
}

.bug-expand-icon {
  flex-shrink: 0;
  width: 18px;
  height: 18px;
  margin-top: 2px;
  color: var(--text-muted);
  transition: transform 0.2s;
}

.bug-card.expanded .bug-expand-icon {
  transform: rotate(90deg);
}

.bug-info {
  flex: 1;
  min-width: 0;
}

.bug-title {
  font-size: 14px;
  font-weight: 600;
  line-height: 1.4;
  word-break: break-word;
}

.bug-meta {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 6px;
  margin-top: 6px;
}

.pill {
  display: inline-flex;
  align-items: center;
  padding: 1px 8px;
  font-size: 11px;
  font-weight: 600;
  border-radius: 999px;
  border: 1px solid;
  white-space: nowrap;
}

.pill-status-open {
  background: var(--status-open-bg);
  color: var(--status-open-fg);
  border-color: var(--status-open-border);
}

.pill-status-closed {
  background: var(--status-closed-bg);
  color: var(--status-closed-fg);
  border-color: var(--status-closed-border);
}

.pill-label {
  background: var(--pill-default-bg);
  color: var(--pill-default-fg);
  border-color: var(--pill-default-border);
}

.pill-label[data-label="tx-compare"] {
  background: var(--pill-tx-bg);
  color: var(--pill-tx-fg);
  border-color: var(--pill-tx-border);
}

.pill-label[data-label^="round:"] {
  background: var(--pill-round-bg);
  color: var(--pill-round-fg);
  border-color: var(--pill-round-border);
}

.pill-impact {
  background: #fef3c7;
  color: #92400e;
  border-color: #fcd34d;
  font-family: var(--font-mono);
  font-size: 10px;
}

@media (prefers-color-scheme: dark) {
  .pill-impact {
    background: #3b2f0b;
    color: #fcd34d;
    border-color: #78350f;
  }
}

.bug-id {
  font-size: 11px;
  color: var(--text-muted);
  font-family: var(--font-mono);
}

.copy-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 22px;
  height: 22px;
  padding: 0;
  border: 1px solid var(--border-light);
  border-radius: 4px;
  background: var(--bg-card);
  color: var(--text-muted);
  cursor: pointer;
  transition: background 0.15s, color 0.15s, border-color 0.15s;
}

.copy-btn:hover {
  background: var(--bg-surface);
  color: var(--text-secondary);
  border-color: var(--border);
}

.copy-btn.copied {
  color: var(--status-open-fg);
  border-color: var(--status-open-border);
  background: var(--status-open-bg);
  animation: copy-flash 0.3s ease-out;
}

@keyframes copy-flash {
  0% { transform: scale(1.3); }
  100% { transform: scale(1); }
}

.bug-date {
  font-size: 11px;
  color: var(--text-muted);
}

.bug-body {
  display: none;
  padding: 0 16px 16px 44px;
  border-top: 1px solid var(--border-light);
}

.bug-card.expanded .bug-body {
  display: block;
}

.bug-body h1, .bug-body h2, .bug-body h3,
.bug-body h4, .bug-body h5, .bug-body h6 {
  margin: 16px 0 8px 0;
  font-weight: 700;
  line-height: 1.3;
}

.bug-body h1 { font-size: 18px; }
.bug-body h2 { font-size: 16px; }
.bug-body h3 { font-size: 14px; }
.bug-body h4, .bug-body h5, .bug-body h6 { font-size: 13px; }

.bug-body p {
  margin: 8px 0;
  font-size: 13px;
  line-height: 1.65;
}

.bug-body ul, .bug-body ol {
  margin: 8px 0;
  padding-left: 24px;
  font-size: 13px;
}

.bug-body li {
  margin: 4px 0;
  line-height: 1.55;
}

.bug-body code {
  font-family: var(--font-mono);
  font-size: 12px;
  background: var(--bg-surface);
  padding: 2px 6px;
  border-radius: 4px;
  border: 1px solid var(--border-light);
}

.bug-body pre {
  background: var(--bg-surface);
  border: 1px solid var(--border-light);
  border-radius: var(--radius-sm);
  padding: 12px 16px;
  overflow-x: auto;
  margin: 12px 0;
}

.bug-body pre code {
  background: none;
  border: none;
  padding: 0;
  font-size: 12px;
  line-height: 1.5;
}

.bug-body hr {
  border: none;
  border-top: 1px solid var(--border-light);
  margin: 16px 0;
}

.bug-body strong { font-weight: 700; }
.bug-body em { font-style: italic; }
.bug-body a { color: #3b82f6; text-decoration: none; }
.bug-body a:hover { text-decoration: underline; }

.no-results {
  text-align: center;
  padding: 48px 16px;
  color: var(--text-muted);
  font-size: 14px;
}

.no-results.hidden {
  display: none;
}

.pipeline-bar {
  display: flex;
  gap: 0;
  margin-bottom: 12px;
  border-radius: var(--radius);
  overflow: hidden;
  border: 1px solid var(--border-light);
  font-size: 12px;
  line-height: 1.3;
}

.pipeline-bar:empty {
  display: none;
}

.pipeline-seg {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 10px 8px;
  min-width: 0;
  text-align: center;
}

.pipeline-seg .seg-value {
  font-weight: 700;
  font-size: 16px;
  font-family: var(--font-mono);
}

.pipeline-seg .seg-label {
  font-size: 10px;
  opacity: 0.8;
  margin-top: 2px;
}

.seg-perfect { background: #dcfce7; color: #166534; }
.seg-equiv { background: #dbeafe; color: #1e40af; }
.seg-known { background: #fef3c7; color: #92400e; }
.seg-untriaged { background: #fee2e2; color: #991b1b; }

@media (prefers-color-scheme: dark) {
  .seg-perfect { background: #052e16; color: #86efac; }
  .seg-equiv { background: #172554; color: #93c5fd; }
  .seg-known { background: #3b2f0b; color: #fcd34d; }
  .seg-untriaged { background: #450a0a; color: #fca5a5; }
}

@media (max-width: 640px) {
  .container { padding: 16px 12px; }
  .stats-bar { padding: 12px; gap: 6px; }
  .stat-divider { display: none; }
  .filter-bar { flex-direction: column; }
  .search-box { min-width: 100%; }
  .bug-body { padding: 0 12px 12px 12px; }
  .bug-header { padding: 10px 12px; }
  .controls { margin-left: 0; }
  .pipeline-bar { font-size: 10px; }
  .pipeline-seg .seg-value { font-size: 13px; }
}
</style>
</head>
<body>
<div class="container">
  <h1>FHIRsmith tx-compare Bugs</h1>
  <p class="subtitle">Generated from git-bug &middot; <span id="gen-time"></span></p>

  <div class="pipeline-bar" id="pipeline-bar"></div>
  <div class="stats-bar" id="stats-bar"></div>

  <div class="filter-bar">
    <input type="text" class="search-box" id="search" placeholder="Search bugs by title or body..." autocomplete="off">
    <div class="filter-pills" id="label-filters"></div>
    <div class="controls">
      <button class="ctrl-btn" id="expand-all-btn" onclick="toggleExpandAll()">Expand all</button>
      <span class="stat-divider"></span>
      <button class="ctrl-btn" data-status="all">All</button>
      <button class="ctrl-btn active" data-status="open">Open</button>
      <button class="ctrl-btn" data-status="closed">Closed</button>
      <span class="stat-divider"></span>
      <button class="ctrl-btn sort-btn active" data-sort="impact">Impact</button>
      <button class="ctrl-btn sort-btn" data-sort="date">Date</button>
      <button class="ctrl-btn sort-btn" data-sort="title">Title</button>
    </div>
  </div>

  <div id="bug-list"></div>
  <div class="no-results hidden" id="no-results">No bugs match your filters.</div>
</div>

<script>
const BUGS = [{"id": "dc0132b", "title": "Dev SNOMED  returns URI-based name and omits most properties", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-2", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 10:52", "date_iso": "2026-02-08T10:52:57-06:00", "body_md": "Records-Impacted: 2170\nTolerance-ID: snomed-lookup-name-and-properties\nRecord-ID: 1a78565a-0d41-448b-b6cc-ae96754dd093\n\n## Repro\n\n```bash\n# Prod\ncurl -s 'https://tx.fhir.org/r4/CodeSystem/$lookup?system=http://snomed.info/sct&code=446050000' -H 'Accept: application/fhir+json'\n\n# Dev\ncurl -s 'https://tx-dev.fhir.org/r4/CodeSystem/$lookup?system=http://snomed.info/sct&code=446050000' -H 'Accept: application/fhir+json'\n```\n\nProd returns `name: \"SNOMED CT\"` with properties `copyright`, `moduleId`, `normalForm`, `normalFormTerse`, `parent`. Dev returns `name: \"http://snomed.info/sct|http://snomed.info/sct/900000000000207008/version/20250201\"` with only the `inactive` property.\n\n## What differs\n\nFor SNOMED CT CodeSystem/$lookup requests, dev differs from prod in three ways:\n\n1. **`name` parameter**: Prod returns the human-readable code system name `\"SNOMED CT\"`. Dev returns a system|version URI like `\"http://snomed.info/sct|http://snomed.info/sct/900000000000207008/version/20250201\"`. Per the FHIR R4 $lookup spec, the `name` output parameter (1..1 string) is defined as \"A display name for the code system\", so prod's value is correct.\n\n2. **Missing properties**: Prod returns properties `copyright`, `moduleId`, `normalForm`, `normalFormTerse`, `parent` (and `child` when applicable). Dev returns only `inactive`. Per the FHIR spec, \"If no properties are specified, the server chooses what to return\", but dev returns significantly fewer SNOMED-specific properties than prod.\n\n3. **Missing `abstract` parameter on R5**: For R5 SNOMED lookups (2170 of 2176 R5 records), prod returns `abstract: false` but dev omits the parameter entirely.\n\n## How widespread\n\n2186 SNOMED $lookup delta records match the name + properties pattern. The tolerance eliminates 2170 of them. The remaining 16 have additional differences beyond what this tolerance covers (e.g., designation content differences).\n\nSearch: `grep '$lookup.*snomed' jobs/2026-02-round-2/results/deltas/deltas.ndjson | wc -l` → 2187 (before tolerance)\n\nAll three issues co-occur on every affected record.\n\n## What the tolerance covers\n\nTolerance `snomed-lookup-name-and-properties` normalizes by:\n- Setting dev's `name` to prod's value (`\"SNOMED CT\"`)\n- Removing properties from prod that dev doesn't have (copyright, moduleId, normalForm, normalFormTerse, parent, child)\n- Removing `abstract` from prod when dev doesn't have it (R5 lookups)\n\n## Representative record\n\n1a78565a-0d41-448b-b6cc-ae96754dd093 — `GET /r4/CodeSystem/$lookup?system=http://snomed.info/sct&code=446050000`", "body_html": "<p>Records-Impacted: 2170<br>\nTolerance-ID: snomed-lookup-name-and-properties<br>\nRecord-ID: 1a78565a-0d41-448b-b6cc-ae96754dd093</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod\ncurl -s &#x27;https://tx.fhir.org/r4/CodeSystem/$lookup?system=http://snomed.info/sct&amp;code=446050000&#x27; -H &#x27;Accept: application/fhir+json&#x27;\n\n# Dev\ncurl -s &#x27;https://tx-dev.fhir.org/r4/CodeSystem/$lookup?system=http://snomed.info/sct&amp;code=446050000&#x27; -H &#x27;Accept: application/fhir+json&#x27;</code></pre>\n<p>Prod returns <code>name: &quot;SNOMED CT&quot;</code> with properties <code>copyright</code>, <code>moduleId</code>, <code>normalForm</code>, <code>normalFormTerse</code>, <code>parent</code>. Dev returns <code>name: &quot;http://snomed.info/sct|http://snomed.info/sct/900000000000207008/version/20250201&quot;</code> with only the <code>inactive</code> property.</p>\n<h2>What differs</h2>\n<p>For SNOMED CT CodeSystem/$lookup requests, dev differs from prod in three ways:</p>\n<ol><li>**<code>name</code> parameter**: Prod returns the human-readable code system name <code>&quot;SNOMED CT&quot;</code>. Dev returns a system|version URI like <code>&quot;http://snomed.info/sct|http://snomed.info/sct/900000000000207008/version/20250201&quot;</code>. Per the FHIR R4 $lookup spec, the <code>name</code> output parameter (1..1 string) is defined as &quot;A display name for the code system&quot;, so prod&#x27;s value is correct.</li></ol>\n<ol><li><strong>Missing properties</strong>: Prod returns properties <code>copyright</code>, <code>moduleId</code>, <code>normalForm</code>, <code>normalFormTerse</code>, <code>parent</code> (and <code>child</code> when applicable). Dev returns only <code>inactive</code>. Per the FHIR spec, &quot;If no properties are specified, the server chooses what to return&quot;, but dev returns significantly fewer SNOMED-specific properties than prod.</li></ol>\n<ol><li>**Missing <code>abstract</code> parameter on R5**: For R5 SNOMED lookups (2170 of 2176 R5 records), prod returns <code>abstract: false</code> but dev omits the parameter entirely.</li></ol>\n<h2>How widespread</h2>\n<p>2186 SNOMED $lookup delta records match the name + properties pattern. The tolerance eliminates 2170 of them. The remaining 16 have additional differences beyond what this tolerance covers (e.g., designation content differences).</p>\n<p>Search: <code>grep &#x27;$lookup.*snomed&#x27; jobs/2026-02-round-2/results/deltas/deltas.ndjson | wc -l</code> → 2187 (before tolerance)</p>\n<p>All three issues co-occur on every affected record.</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance <code>snomed-lookup-name-and-properties</code> normalizes by:</p>\n<ul><li>Setting dev&#x27;s <code>name</code> to prod&#x27;s value (<code>&quot;SNOMED CT&quot;</code>)</li><li>Removing properties from prod that dev doesn&#x27;t have (copyright, moduleId, normalForm, normalFormTerse, parent, child)</li><li>Removing <code>abstract</code> from prod when dev doesn&#x27;t have it (R5 lookups)</li></ul>\n<h2>Representative record</h2>\n<p>1a78565a-0d41-448b-b6cc-ae96754dd093 — <code>GET /r4/CodeSystem/$lookup?system=http://snomed.info/sct&amp;code=446050000</code></p>", "impact": 2170}, {"id": "cd4b7d1", "title": "Dev returns 400 instead of 422 for error responses across validate-code and expand operations", "status": "open", "labels": ["code-defect", "reproduced", "round:2026-02-round-2", "status-mismatch", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 10:52", "date_iso": "2026-02-08T10:52:57-06:00", "body_md": "Records-Impacted: 1897\nTolerance-ID: error-status-422-vs-400\nRecord-ID: e5639442-a91b-4de0-b1d9-9b901023b6c1\n\n## Repro\n\n```bash\n# Prod\ncurl -s -w \"\\nHTTP Status: %{http_code}\\n\" \\\n  'https://tx.fhir.org/r4/ValueSet/$validate-code?url=http://hl7.org/fhir/us/davinci-pdex-plan-net/ValueSet/PractitionerRoleVS&code=ho&_format=json&system=http://hl7.org/fhir/us/davinci-pdex-plan-net/CodeSystem/ProviderRoleCS' \\\n  -H 'Accept: application/fhir+json'\n\n# Dev\ncurl -s -w \"\\nHTTP Status: %{http_code}\\n\" \\\n  'https://tx-dev.fhir.org/r4/ValueSet/$validate-code?url=http://hl7.org/fhir/us/davinci-pdex-plan-net/ValueSet/PractitionerRoleVS&code=ho&_format=json&system=http://hl7.org/fhir/us/davinci-pdex-plan-net/CodeSystem/ProviderRoleCS' \\\n  -H 'Accept: application/fhir+json'\n```\n\nProd returns HTTP 422 with OperationOutcome (issue code \"not-found\"). Dev returns HTTP 400 with the same OperationOutcome content. Both agree on the error semantics (same error code, same error message), differing only in HTTP status.\n\n## What differs\n\nProd returns HTTP 422 (Unprocessable Entity) while dev returns HTTP 400 (Bad Request) for error responses. Both servers return OperationOutcome resources with error-level issues and agree on the error semantics (same error codes, same error messages). The only difference is the HTTP status code.\n\nExample: a $validate-code request for a ValueSet that doesn't exist. Both return OperationOutcome with issue code \"not-found\" and text \"A definition for the value Set '...' could not be found\", but prod uses 422 and dev uses 400.\n\n## How widespread\n\n1897 records in the comparison dataset show this pattern (prod=422, dev=400). All 1897 have OperationOutcome on both sides.\n\nBreakdown by operation type:\n- validate-code: 1331 records\n- expand: 566 records\n\nBoth GET and POST requests are affected. The pattern spans all FHIR versions (/r4/, etc.) and all code systems/ValueSets.\n\nFound via: grep -c '\"prodStatus\":422,\"devStatus\":400' results/deltas/deltas.ndjson\n\n## What the tolerance covers\n\nTolerance ID: error-status-422-vs-400\nMatches: any record where prod.status=422, dev.status=400, and both response bodies are OperationOutcome resources (resourceType check).\nAction: skip (since the status code difference IS the categorization trigger — normalizing bodies doesn't change the status-mismatch category).\nEliminates: 1897 records.\n\n## Representative record\n\ne5639442-a91b-4de0-b1d9-9b901023b6c1 — GET /r4/ValueSet/$validate-code for PractitionerRoleVS (davinci-pdex-plan-net). Prod=422, dev=400, both return \"not-found\" OperationOutcome.\n\n## Root Cause\n\n**Classification**: code-level defect\n\n**Prod** returns HTTP 422 for all terminology operation errors via two mechanisms:\n\n1. For `$validate-code`, when the ValueSet is not found, it creates an OperationOutcome directly and sets `response.HTTPCode := 422`:\n[`server/tx_operations.pas#L611-L616`](https://github.com/HealthIntersections/fhirserver/blob/ec46dff3fe631ddeeaa000a3ca9530e0dd8c9eac/server/tx_operations.pas#L611-L616)\n— When `oOut` (OperationOutcome) is non-nil, the response code is hardcoded to 422. Same pattern at [line 882-887](https://github.com/HealthIntersections/fhirserver/blob/ec46dff3fe631ddeeaa000a3ca9530e0dd8c9eac/server/tx_operations.pas#L882-L887) for the POST path.\n\n2. For `$expand` and other operations, `ETerminologyError` exceptions propagate to the general handler in `endpoint_storage.pas` which sends `HTTP_ERR_BUSINESS_RULES_FAILED`:\n[`server/endpoint_storage.pas#L1553-L1561`](https://github.com/HealthIntersections/fhirserver/blob/ec46dff3fe631ddeeaa000a3ca9530e0dd8c9eac/server/endpoint_storage.pas#L1553-L1561)\n— `HTTP_ERR_BUSINESS_RULES_FAILED` is defined as `422` in [`library/fhir/fhir_objects.pas#L900`](https://github.com/HealthIntersections/fhirserver/blob/ec46dff3fe631ddeeaa000a3ca9530e0dd8c9eac/library/fhir/fhir_objects.pas#L900).\n\n**Dev** returns HTTP 400 because error `Issue` objects are created with `statusCode = 400`:\n[`tx/workers/validate.js#L2212`](https://github.com/HealthIntersections/FHIRsmith/blob/6440990b4d0f5ca87b48093bad6ac2868067a49e/tx/workers/validate.js#L2212)\n— \"ValueSet not found\" Issue is constructed with `400` as the last parameter. The catch block at [`tx/workers/validate.js#L2034-L2037`](https://github.com/HealthIntersections/FHIRsmith/blob/6440990b4d0f5ca87b48093bad6ac2868067a49e/tx/workers/validate.js#L2034-L2037) uses `error.statusCode || 500`, so it sends 400. The same pattern appears throughout expand.js (e.g., [lines 515-533](https://github.com/HealthIntersections/FHIRsmith/blob/6440990b4d0f5ca87b48093bad6ac2868067a49e/tx/workers/expand.js#L515-L533)).\n\n**Fix**: Change the `statusCode` from `400` to `422` in all Issue constructors and `.handleAsOO()` calls across `validate.js` and `expand.js` where the error represents a terminology operation failure (not-found, invalid filter, missing supplement, etc.). The `Issue` constructor default at `operation-outcome.js:14` is already `500`, so each call site needs updating. Alternatively, change the error handler catch blocks (e.g., `validate.js:2037`, `expand.js:1555`) to always use `422` when the error is a terminology-level Issue, matching prod's convention that all terminology OperationOutcome responses use HTTP 422.", "body_html": "<p>Records-Impacted: 1897<br>\nTolerance-ID: error-status-422-vs-400<br>\nRecord-ID: e5639442-a91b-4de0-b1d9-9b901023b6c1</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod\ncurl -s -w &quot;\\nHTTP Status: %{http_code}\\n&quot; \\\n  &#x27;https://tx.fhir.org/r4/ValueSet/$validate-code?url=http://hl7.org/fhir/us/davinci-pdex-plan-net/ValueSet/PractitionerRoleVS&amp;code=ho&amp;_format=json&amp;system=http://hl7.org/fhir/us/davinci-pdex-plan-net/CodeSystem/ProviderRoleCS&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;\n\n# Dev\ncurl -s -w &quot;\\nHTTP Status: %{http_code}\\n&quot; \\\n  &#x27;https://tx-dev.fhir.org/r4/ValueSet/$validate-code?url=http://hl7.org/fhir/us/davinci-pdex-plan-net/ValueSet/PractitionerRoleVS&amp;code=ho&amp;_format=json&amp;system=http://hl7.org/fhir/us/davinci-pdex-plan-net/CodeSystem/ProviderRoleCS&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;</code></pre>\n<p>Prod returns HTTP 422 with OperationOutcome (issue code &quot;not-found&quot;). Dev returns HTTP 400 with the same OperationOutcome content. Both agree on the error semantics (same error code, same error message), differing only in HTTP status.</p>\n<h2>What differs</h2>\n<p>Prod returns HTTP 422 (Unprocessable Entity) while dev returns HTTP 400 (Bad Request) for error responses. Both servers return OperationOutcome resources with error-level issues and agree on the error semantics (same error codes, same error messages). The only difference is the HTTP status code.</p>\n<p>Example: a $validate-code request for a ValueSet that doesn&#x27;t exist. Both return OperationOutcome with issue code &quot;not-found&quot; and text &quot;A definition for the value Set &#x27;...&#x27; could not be found&quot;, but prod uses 422 and dev uses 400.</p>\n<h2>How widespread</h2>\n<p>1897 records in the comparison dataset show this pattern (prod=422, dev=400). All 1897 have OperationOutcome on both sides.</p>\n<p>Breakdown by operation type:</p>\n<ul><li>validate-code: 1331 records</li><li>expand: 566 records</li></ul>\n<p>Both GET and POST requests are affected. The pattern spans all FHIR versions (/r4/, etc.) and all code systems/ValueSets.</p>\n<p>Found via: grep -c &#x27;&quot;prodStatus&quot;:422,&quot;devStatus&quot;:400&#x27; results/deltas/deltas.ndjson</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance ID: error-status-422-vs-400<br>\nMatches: any record where prod.status=422, dev.status=400, and both response bodies are OperationOutcome resources (resourceType check).<br>\nAction: skip (since the status code difference IS the categorization trigger — normalizing bodies doesn&#x27;t change the status-mismatch category).<br>\nEliminates: 1897 records.</p>\n<h2>Representative record</h2>\n<p>e5639442-a91b-4de0-b1d9-9b901023b6c1 — GET /r4/ValueSet/$validate-code for PractitionerRoleVS (davinci-pdex-plan-net). Prod=422, dev=400, both return &quot;not-found&quot; OperationOutcome.</p>\n<h2>Root Cause</h2>\n<p><strong>Classification</strong>: code-level defect</p>\n<p><strong>Prod</strong> returns HTTP 422 for all terminology operation errors via two mechanisms:</p>\n<ol><li>For <code>$validate-code</code>, when the ValueSet is not found, it creates an OperationOutcome directly and sets <code>response.HTTPCode := 422</code>:</li></ol>\n<p><a href=\"https://github.com/HealthIntersections/fhirserver/blob/ec46dff3fe631ddeeaa000a3ca9530e0dd8c9eac/server/tx_operations.pas#L611-L616\" target=\"_blank\"><code>server/tx_operations.pas#L611-L616</code></a><br>\n— When <code>oOut</code> (OperationOutcome) is non-nil, the response code is hardcoded to 422. Same pattern at <a href=\"https://github.com/HealthIntersections/fhirserver/blob/ec46dff3fe631ddeeaa000a3ca9530e0dd8c9eac/server/tx_operations.pas#L882-L887\" target=\"_blank\">line 882-887</a> for the POST path.</p>\n<ol><li>For <code>$expand</code> and other operations, <code>ETerminologyError</code> exceptions propagate to the general handler in <code>endpoint_storage.pas</code> which sends <code>HTTP_ERR_BUSINESS_RULES_FAILED</code>:</li></ol>\n<p><a href=\"https://github.com/HealthIntersections/fhirserver/blob/ec46dff3fe631ddeeaa000a3ca9530e0dd8c9eac/server/endpoint_storage.pas#L1553-L1561\" target=\"_blank\"><code>server/endpoint_storage.pas#L1553-L1561</code></a><br>\n— <code>HTTP_ERR_BUSINESS_RULES_FAILED</code> is defined as <code>422</code> in <a href=\"https://github.com/HealthIntersections/fhirserver/blob/ec46dff3fe631ddeeaa000a3ca9530e0dd8c9eac/library/fhir/fhir_objects.pas#L900\" target=\"_blank\"><code>library/fhir/fhir_objects.pas#L900</code></a>.</p>\n<p><strong>Dev</strong> returns HTTP 400 because error <code>Issue</code> objects are created with <code>statusCode = 400</code>:<br>\n<a href=\"https://github.com/HealthIntersections/FHIRsmith/blob/6440990b4d0f5ca87b48093bad6ac2868067a49e/tx/workers/validate.js#L2212\" target=\"_blank\"><code>tx/workers/validate.js#L2212</code></a><br>\n— &quot;ValueSet not found&quot; Issue is constructed with <code>400</code> as the last parameter. The catch block at <a href=\"https://github.com/HealthIntersections/FHIRsmith/blob/6440990b4d0f5ca87b48093bad6ac2868067a49e/tx/workers/validate.js#L2034-L2037\" target=\"_blank\"><code>tx/workers/validate.js#L2034-L2037</code></a> uses <code>error.statusCode || 500</code>, so it sends 400. The same pattern appears throughout expand.js (e.g., <a href=\"https://github.com/HealthIntersections/FHIRsmith/blob/6440990b4d0f5ca87b48093bad6ac2868067a49e/tx/workers/expand.js#L515-L533\" target=\"_blank\">lines 515-533</a>).</p>\n<p><strong>Fix</strong>: Change the <code>statusCode</code> from <code>400</code> to <code>422</code> in all Issue constructors and <code>.handleAsOO()</code> calls across <code>validate.js</code> and <code>expand.js</code> where the error represents a terminology operation failure (not-found, invalid filter, missing supplement, etc.). The <code>Issue</code> constructor default at <code>operation-outcome.js:14</code> is already <code>500</code>, so each call site needs updating. Alternatively, change the error handler catch blocks (e.g., <code>validate.js:2037</code>, <code>expand.js:1555</code>) to always use <code>422</code> when the error is a terminology-level Issue, matching prod&#x27;s convention that all terminology OperationOutcome responses use HTTP 422.</p>", "impact": 1897}, {"id": "2337986", "title": "Dev returns 404 instead of 422 when ValueSet not found for $expand", "status": "open", "labels": ["code-defect", "reproduced", "round:2026-02-round-2", "status-mismatch", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 10:52", "date_iso": "2026-02-08T10:52:56-06:00", "body_md": "Records-Impacted: 756\nTolerance-ID: expand-valueset-not-found-status-mismatch\nRecord-ID: 8b7a9262-90d3-4753-a197-9a631ffdcf2f\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$expand?url=http:%2F%2Fhl7.org%2Ffhir%2Fus%2Fdavinci-pdex-plan-net%2FValueSet%2FPractitionerRoleVS&_format=json' \\\n  -H 'Accept: application/fhir+json'\n\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$expand?url=http:%2F%2Fhl7.org%2Ffhir%2Fus%2Fdavinci-pdex-plan-net%2FValueSet%2FPractitionerRoleVS&_format=json' \\\n  -H 'Accept: application/fhir+json'\n```\n\nProd returns HTTP 422 with `issue.code: \"unknown\"` and `issue.details.text`, dev returns HTTP 404 with `issue.code: \"not-found\"` and `issue.diagnostics`.\n\n\nWhen a ValueSet cannot be found for a $expand operation, prod returns HTTP 422 (Unprocessable Entity) with an OperationOutcome using issue code `unknown` and `details.text`, while dev returns HTTP 404 (Not Found) with issue code `not-found` and `diagnostics`. Both communicate the same semantic meaning (\"this ValueSet doesn't exist\"), but the HTTP status code and OperationOutcome structure differ.\n\nProd response (status 422):\n- issue.code: \"unknown\"\n- issue.details.text: \"Unable to find value set for URL \\\"...\\\"\"\n\nDev response (status 404):\n- issue.code: \"not-found\"\n- issue.diagnostics: \"ValueSet not found: ...\"\n\n\n756 records in the comparison dataset show this exact pattern (prod=422, dev=404). All are $expand operations (722 GET, 34 POST) across many different ValueSet URLs. The pattern is universal — every prod=422/dev=404 status mismatch is an $expand of an unknown ValueSet.\n\nSearch used: `grep -c '\"prodStatus\":422,\"devStatus\":404' results/deltas/deltas.ndjson`\n\n\nTolerance ID: `expand-valueset-not-found-status-mismatch`\nMatches: $expand operations where prod=422 and dev=404, and both responses are OperationOutcomes indicating a ValueSet was not found.\nRecords eliminated: 756\n\n## Root Cause\n\n**Classification**: code-level defect\n\n**Prod** returns HTTP 422 with issue code `unknown` for unfound ValueSets:\n[`server/tx_operations.pas#L335-L336`](https://github.com/HealthIntersections/fhirserver/blob/ec46dff3fe631ddeeaa000a3ca9530e0dd8c9eac/server/tx_operations.pas#L335-L336)\n— Raises `ETerminologyError` with `itUnknown` when ValueSet URL lookup fails during $expand.\n\n[`server/endpoint_storage.pas#L1553-L1561`](https://github.com/HealthIntersections/fhirserver/blob/ec46dff3fe631ddeeaa000a3ca9530e0dd8c9eac/server/endpoint_storage.pas#L1553-L1561)\n— All `ETerminologyError` exceptions are caught and returned with `HTTP_ERR_BUSINESS_RULES_FAILED` (422), preserving the exception's `issueType` (`itUnknown` -> `\"unknown\"`) in the OperationOutcome.\n\n**Dev** returns HTTP 404 with issue code `not-found`:\n[`tx/workers/expand.js#L1669-L1672`](https://github.com/HealthIntersections/FHIRsmith/blob/6440990b4d0f5ca87b48093bad6ac2868067a49e/tx/workers/expand.js#L1669-L1672)\n— When `findValueSet` returns null, the expand handler returns `res.status(404)` with issue code `not-found` and puts the error message only in `diagnostics`.\n\nThere are two divergences:\n1. **HTTP status**: Dev uses 404 instead of 422. Prod treats all terminology errors as \"business rules failed\" (422), regardless of whether the issue is \"not found\" or something else.\n2. **Issue code**: Dev uses `not-found` instead of `unknown`. Prod uses `itUnknown` because the error semantics are \"the system doesn't know this ValueSet\", not a pure resource-not-found.\n\n**Fix**: In `tx/workers/expand.js` line 1670, change `res.status(404)` to `res.status(422)` and change the issue code from `'not-found'` to `'unknown'` to match prod's behavior. The same fix should be applied to `tx/workers/related.js` line 1670 which has identical code.", "body_html": "<p>Records-Impacted: 756<br>\nTolerance-ID: expand-valueset-not-found-status-mismatch<br>\nRecord-ID: 8b7a9262-90d3-4753-a197-9a631ffdcf2f</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/ValueSet/$expand?url=http:%2F%2Fhl7.org%2Ffhir%2Fus%2Fdavinci-pdex-plan-net%2FValueSet%2FPractitionerRoleVS&amp;_format=json&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand?url=http:%2F%2Fhl7.org%2Ffhir%2Fus%2Fdavinci-pdex-plan-net%2FValueSet%2FPractitionerRoleVS&amp;_format=json&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;</code></pre>\n<p>Prod returns HTTP 422 with <code>issue.code: &quot;unknown&quot;</code> and <code>issue.details.text</code>, dev returns HTTP 404 with <code>issue.code: &quot;not-found&quot;</code> and <code>issue.diagnostics</code>.</p>\n<p>When a ValueSet cannot be found for a $expand operation, prod returns HTTP 422 (Unprocessable Entity) with an OperationOutcome using issue code <code>unknown</code> and <code>details.text</code>, while dev returns HTTP 404 (Not Found) with issue code <code>not-found</code> and <code>diagnostics</code>. Both communicate the same semantic meaning (&quot;this ValueSet doesn&#x27;t exist&quot;), but the HTTP status code and OperationOutcome structure differ.</p>\n<p>Prod response (status 422):</p>\n<ul><li>issue.code: &quot;unknown&quot;</li><li>issue.details.text: &quot;Unable to find value set for URL \\&quot;...\\&quot;&quot;</li></ul>\n<p>Dev response (status 404):</p>\n<ul><li>issue.code: &quot;not-found&quot;</li><li>issue.diagnostics: &quot;ValueSet not found: ...&quot;</li></ul>\n<p>756 records in the comparison dataset show this exact pattern (prod=422, dev=404). All are $expand operations (722 GET, 34 POST) across many different ValueSet URLs. The pattern is universal — every prod=422/dev=404 status mismatch is an $expand of an unknown ValueSet.</p>\n<p>Search used: <code>grep -c &#x27;&quot;prodStatus&quot;:422,&quot;devStatus&quot;:404&#x27; results/deltas/deltas.ndjson</code></p>\n<p>Tolerance ID: <code>expand-valueset-not-found-status-mismatch</code><br>\nMatches: $expand operations where prod=422 and dev=404, and both responses are OperationOutcomes indicating a ValueSet was not found.<br>\nRecords eliminated: 756</p>\n<h2>Root Cause</h2>\n<p><strong>Classification</strong>: code-level defect</p>\n<p><strong>Prod</strong> returns HTTP 422 with issue code <code>unknown</code> for unfound ValueSets:<br>\n<a href=\"https://github.com/HealthIntersections/fhirserver/blob/ec46dff3fe631ddeeaa000a3ca9530e0dd8c9eac/server/tx_operations.pas#L335-L336\" target=\"_blank\"><code>server/tx_operations.pas#L335-L336</code></a><br>\n— Raises <code>ETerminologyError</code> with <code>itUnknown</code> when ValueSet URL lookup fails during $expand.</p>\n<p><a href=\"https://github.com/HealthIntersections/fhirserver/blob/ec46dff3fe631ddeeaa000a3ca9530e0dd8c9eac/server/endpoint_storage.pas#L1553-L1561\" target=\"_blank\"><code>server/endpoint_storage.pas#L1553-L1561</code></a><br>\n— All <code>ETerminologyError</code> exceptions are caught and returned with <code>HTTP_ERR_BUSINESS_RULES_FAILED</code> (422), preserving the exception&#x27;s <code>issueType</code> (<code>itUnknown</code> -&gt; <code>&quot;unknown&quot;</code>) in the OperationOutcome.</p>\n<p><strong>Dev</strong> returns HTTP 404 with issue code <code>not-found</code>:<br>\n<a href=\"https://github.com/HealthIntersections/FHIRsmith/blob/6440990b4d0f5ca87b48093bad6ac2868067a49e/tx/workers/expand.js#L1669-L1672\" target=\"_blank\"><code>tx/workers/expand.js#L1669-L1672</code></a><br>\n— When <code>findValueSet</code> returns null, the expand handler returns <code>res.status(404)</code> with issue code <code>not-found</code> and puts the error message only in <code>diagnostics</code>.</p>\n<p>There are two divergences:</p>\n<ol><li><strong>HTTP status</strong>: Dev uses 404 instead of 422. Prod treats all terminology errors as &quot;business rules failed&quot; (422), regardless of whether the issue is &quot;not found&quot; or something else.</li><li><strong>Issue code</strong>: Dev uses <code>not-found</code> instead of <code>unknown</code>. Prod uses <code>itUnknown</code> because the error semantics are &quot;the system doesn&#x27;t know this ValueSet&quot;, not a pure resource-not-found.</li></ol>\n<p><strong>Fix</strong>: In <code>tx/workers/expand.js</code> line 1670, change <code>res.status(404)</code> to <code>res.status(422)</code> and change the issue code from <code>&#x27;not-found&#x27;</code> to <code>&#x27;unknown&#x27;</code> to match prod&#x27;s behavior. The same fix should be applied to <code>tx/workers/related.js</code> line 1670 which has identical code.</p>", "impact": 756}, {"id": "bd89513", "title": "Dev returns extra message/issues for display language resolution on validate-code result=true", "status": "open", "labels": ["code-defect", "content-differs", "reproduced", "result-disagrees", "round:2026-02-round-2", "round:2026-02-round-3", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-11 20:37", "date_iso": "2026-02-11T20:37:15-06:00", "body_md": "Records-Impacted: 603+\nTolerance-ID: dev-extra-display-lang-not-found-message, prod-display-comment-default-display-lang, display-comment-vs-invalid-display-issues, display-lang-invalid-display-different-coding, display-lang-result-disagrees\nRecord-ID: 299d1b7f-b8f7-4cee-95ab-fa83da75ea80, c9f3b468-dc3d-47f5-a305-0346bf5b4cab, 92e9d6ed-f142-49e9-9bf1-3451af87c593, 71ec4cbd-849a-447d-94a4-5ed9565baf20, 1b420213-1e39-4839-96e8-77cc1f98ca44\n\n## What differs\n\nWhen $validate-code is called with a `displayLanguage` parameter, dev handles \"no valid display names found for the requested language\" differently from prod. The root cause is that dev does not pass `defLang` to `hasDisplay` in the `checkDisplays` method, making display validation stricter than prod. This manifests in five variants:\n\n**Variant 1 — extra message/issues (dev-extra-display-lang-not-found-message):** Both servers agree result=true. Prod omits message/issues entirely. Dev returns extra `message` (\"There are no valid display names found for the code ...\") and `issues` (OperationOutcome with informational severity, tx-issue-type=`invalid-display`). Affected systems: SNOMED, ISO 3166, M49 regions.\n\n**Variant 2 — display-comment vs no issues (prod-display-comment-default-display-lang, 372 records):** Both agree result=true. Prod returns `issues` with tx-issue-type=`display-comment` (\"X is the default display; the code system has no Display Names for the language Y\"). Dev either had its issues stripped by dev-extra-display-lang-not-found-message or never had issues. After existing tolerances run, prod's display-comment issue is the only remaining difference.\n\n**Variant 3 — display-comment vs invalid-display (display-comment-vs-invalid-display-issues, 153 records):** Both agree result=true. Prod has a `display-comment` issue (information severity) and possibly other issues. Dev has `invalid-display` issue (warning severity) instead. After stripping the display-comment from prod and corresponding extra invalid-display from dev, the remaining issues match. Includes 21 records where dev also has an extra `message` about \"Wrong Display Name ... Valid display is ...\" that prod lacks.\n\n**Variant 4 — result-disagrees (display-lang-result-disagrees):** Prod returns result=true. Dev returns result=false with \"Wrong Display Name\" error. When the provided display doesn't exactly match the default display AND no language-specific displays exist, dev rejects it while prod accepts via default language fallback. Most severe manifestation.\n\n**Variant 5 — invalid-display on different codings (display-lang-invalid-display-different-coding, 78 records):** Both agree result=true, both have same number of issues after earlier tolerances strip display-comment. But the remaining `invalid-display` issues reference different codings — prod flags one coding (e.g., LOINC at coding[1]) while dev flags a different one (e.g., SNOMED at coding[0]). The non-invalid-display issues (status-check, etc.) are identical. This is a multi-coding CodeableConcept pattern where displayLanguage causes each server to flag a different coding for the display warning.\n\n## How widespread\n\n603+ records across round 3, affecting validate-code operations with `displayLanguage` parameter across multiple code systems (SNOMED, LOINC, ISO 3166, M49 regions, UCUM, ISO 11073).\n\n## Tolerances\n\n- `dev-extra-display-lang-not-found-message`: Matches validate-code where result=true on both sides, prod has no message, dev has message containing \"no valid display names found\". Strips dev's extra message/issues.\n- `prod-display-comment-default-display-lang`: Matches when prod has display-comment issues about \"is the default display\" and dev has no issues (after earlier tolerances ran). Strips prod's display-comment issues. Eliminates 372 records.\n- `display-comment-vs-invalid-display-issues`: Matches when prod has display-comment issues and dev also has issues (not yet stripped). Strips display-comment from prod, strips extra dev-only invalid-display issues, and strips dev's extra wrong-display-name message. Eliminates 153 records.\n- `display-lang-invalid-display-different-coding`: Matches when both sides have same number of issues but invalid-display issues differ in text/expression (referencing different codings). Normalizes dev's invalid-display issues to prod values. Eliminates 78 records.\n- `display-lang-result-disagrees`: Matches when prod result=true, dev result=false, and dev's message contains \"Wrong Display Name\" + \"no valid display names found\". Normalizes dev's result to true and strips error message/issues.\n\n## Repro\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$validate-code?' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"codeableConcept\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"urn:iso:std:iso:3166\",\"code\":\"FR\",\"display\":\"France\"}]}},{\"name\":\"displayLanguage\",\"valueCode\":\"fr\"},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true},{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"id\":\"jurisdiction\",\"url\":\"http://hl7.org/fhir/ValueSet/jurisdiction\",\"version\":\"4.0.1\",\"compose\":{\"include\":[{\"system\":\"urn:iso:std:iso:3166\"},{\"system\":\"urn:iso:std:iso:3166:-2\"},{\"system\":\"http://unstats.un.org/unsd/methods/m49/m49.htm\",\"filter\":[{\"property\":\"class\",\"op\":\"=\",\"value\":\"region\"}]}]}}}]}'\n\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$validate-code?' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"codeableConcept\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"urn:iso:std:iso:3166\",\"code\":\"FR\",\"display\":\"France\"}]}},{\"name\":\"displayLanguage\",\"valueCode\":\"fr\"},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true},{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"id\":\"jurisdiction\",\"url\":\"http://hl7.org/fhir/ValueSet/jurisdiction\",\"version\":\"4.0.1\",\"compose\":{\"include\":[{\"system\":\"urn:iso:std:iso:3166\"},{\"system\":\"urn:iso:std:iso:3166:-2\"},{\"system\":\"http://unstats.un.org/unsd/methods/m49/m49.htm\",\"filter\":[{\"property\":\"class\",\"op\":\"=\",\"value\":\"region\"}]}]}}}]}'\n```\n\n## Root Cause\n\n**Classification**: code-level defect\n\n**Prod** passes `defLang` to `hasDisplay` when checking whether the provided display matches known designations, so default-language displays count as a match and the display warning block is skipped entirely:\n[`library/ftx/fhir_valuesets.pas#L1768`](https://github.com/HealthIntersections/fhirserver/blob/ec46dff3fe631ddeeaa000a3ca9530e0dd8c9eac/library/ftx/fhir_valuesets.pas#L1768)\n— `list.hasDisplay(FParams.workingLanguages, defLang, c.display, ...)` finds \"France\" via the default language fallback, so no display error is generated.\n\n**Dev** passes `null` instead of `defLang` to `hasDisplay` in the `checkDisplays` method, so default-language displays are not considered a match. This causes the code to enter the display-not-found path and emit the `NO_VALID_DISPLAY_FOUND_NONE_FOR_LANG_OK` informational message:\n[`tx/workers/validate.js#L1343`](https://github.com/HealthIntersections/FHIRsmith/blob/6440990b4d0f5ca87b48093bad6ac2868067a49e/tx/workers/validate.js#L1343)\n— `list.hasDisplay(this.params.workingLanguages(), null, c.display, ...)` does not find \"France\" because `_langsMatch` skips the default-language shortcut when `defLang` is `null`:\n[`tx/library/designations.js#L778-L781`](https://github.com/HealthIntersections/FHIRsmith/blob/6440990b4d0f5ca87b48093bad6ac2868067a49e/tx/library/designations.js#L778-L781)\n\n**Fix**: In `checkDisplays` at `tx/workers/validate.js` line 1343, change the second argument of `list.hasDisplay(...)` from `null` to `defLang` (which is already passed as a parameter to `checkDisplays`), matching what prod does at `fhir_valuesets.pas` line 1768.", "body_html": "<p>Records-Impacted: 603+<br>\nTolerance-ID: dev-extra-display-lang-not-found-message, prod-display-comment-default-display-lang, display-comment-vs-invalid-display-issues, display-lang-invalid-display-different-coding, display-lang-result-disagrees<br>\nRecord-ID: 299d1b7f-b8f7-4cee-95ab-fa83da75ea80, c9f3b468-dc3d-47f5-a305-0346bf5b4cab, 92e9d6ed-f142-49e9-9bf1-3451af87c593, 71ec4cbd-849a-447d-94a4-5ed9565baf20, 1b420213-1e39-4839-96e8-77cc1f98ca44</p>\n<h2>What differs</h2>\n<p>When $validate-code is called with a <code>displayLanguage</code> parameter, dev handles &quot;no valid display names found for the requested language&quot; differently from prod. The root cause is that dev does not pass <code>defLang</code> to <code>hasDisplay</code> in the <code>checkDisplays</code> method, making display validation stricter than prod. This manifests in five variants:</p>\n<p><strong>Variant 1 — extra message/issues (dev-extra-display-lang-not-found-message):</strong> Both servers agree result=true. Prod omits message/issues entirely. Dev returns extra <code>message</code> (&quot;There are no valid display names found for the code ...&quot;) and <code>issues</code> (OperationOutcome with informational severity, tx-issue-type=<code>invalid-display</code>). Affected systems: SNOMED, ISO 3166, M49 regions.</p>\n<p><strong>Variant 2 — display-comment vs no issues (prod-display-comment-default-display-lang, 372 records):</strong> Both agree result=true. Prod returns <code>issues</code> with tx-issue-type=<code>display-comment</code> (&quot;X is the default display; the code system has no Display Names for the language Y&quot;). Dev either had its issues stripped by dev-extra-display-lang-not-found-message or never had issues. After existing tolerances run, prod&#x27;s display-comment issue is the only remaining difference.</p>\n<p><strong>Variant 3 — display-comment vs invalid-display (display-comment-vs-invalid-display-issues, 153 records):</strong> Both agree result=true. Prod has a <code>display-comment</code> issue (information severity) and possibly other issues. Dev has <code>invalid-display</code> issue (warning severity) instead. After stripping the display-comment from prod and corresponding extra invalid-display from dev, the remaining issues match. Includes 21 records where dev also has an extra <code>message</code> about &quot;Wrong Display Name ... Valid display is ...&quot; that prod lacks.</p>\n<p><strong>Variant 4 — result-disagrees (display-lang-result-disagrees):</strong> Prod returns result=true. Dev returns result=false with &quot;Wrong Display Name&quot; error. When the provided display doesn&#x27;t exactly match the default display AND no language-specific displays exist, dev rejects it while prod accepts via default language fallback. Most severe manifestation.</p>\n<p><strong>Variant 5 — invalid-display on different codings (display-lang-invalid-display-different-coding, 78 records):</strong> Both agree result=true, both have same number of issues after earlier tolerances strip display-comment. But the remaining <code>invalid-display</code> issues reference different codings — prod flags one coding (e.g., LOINC at coding[1]) while dev flags a different one (e.g., SNOMED at coding[0]). The non-invalid-display issues (status-check, etc.) are identical. This is a multi-coding CodeableConcept pattern where displayLanguage causes each server to flag a different coding for the display warning.</p>\n<h2>How widespread</h2>\n<p>603+ records across round 3, affecting validate-code operations with <code>displayLanguage</code> parameter across multiple code systems (SNOMED, LOINC, ISO 3166, M49 regions, UCUM, ISO 11073).</p>\n<h2>Tolerances</h2>\n<ul><li><code>dev-extra-display-lang-not-found-message</code>: Matches validate-code where result=true on both sides, prod has no message, dev has message containing &quot;no valid display names found&quot;. Strips dev&#x27;s extra message/issues.</li><li><code>prod-display-comment-default-display-lang</code>: Matches when prod has display-comment issues about &quot;is the default display&quot; and dev has no issues (after earlier tolerances ran). Strips prod&#x27;s display-comment issues. Eliminates 372 records.</li><li><code>display-comment-vs-invalid-display-issues</code>: Matches when prod has display-comment issues and dev also has issues (not yet stripped). Strips display-comment from prod, strips extra dev-only invalid-display issues, and strips dev&#x27;s extra wrong-display-name message. Eliminates 153 records.</li><li><code>display-lang-invalid-display-different-coding</code>: Matches when both sides have same number of issues but invalid-display issues differ in text/expression (referencing different codings). Normalizes dev&#x27;s invalid-display issues to prod values. Eliminates 78 records.</li><li><code>display-lang-result-disagrees</code>: Matches when prod result=true, dev result=false, and dev&#x27;s message contains &quot;Wrong Display Name&quot; + &quot;no valid display names found&quot;. Normalizes dev&#x27;s result to true and strips error message/issues.</li></ul>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/ValueSet/$validate-code?&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;codeableConcept&quot;,&quot;valueCodeableConcept&quot;:{&quot;coding&quot;:[{&quot;system&quot;:&quot;urn:iso:std:iso:3166&quot;,&quot;code&quot;:&quot;FR&quot;,&quot;display&quot;:&quot;France&quot;}]}},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueCode&quot;:&quot;fr&quot;},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true},{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;id&quot;:&quot;jurisdiction&quot;,&quot;url&quot;:&quot;http://hl7.org/fhir/ValueSet/jurisdiction&quot;,&quot;version&quot;:&quot;4.0.1&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;urn:iso:std:iso:3166&quot;},{&quot;system&quot;:&quot;urn:iso:std:iso:3166:-2&quot;},{&quot;system&quot;:&quot;http://unstats.un.org/unsd/methods/m49/m49.htm&quot;,&quot;filter&quot;:[{&quot;property&quot;:&quot;class&quot;,&quot;op&quot;:&quot;=&quot;,&quot;value&quot;:&quot;region&quot;}]}]}}}]}&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$validate-code?&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;codeableConcept&quot;,&quot;valueCodeableConcept&quot;:{&quot;coding&quot;:[{&quot;system&quot;:&quot;urn:iso:std:iso:3166&quot;,&quot;code&quot;:&quot;FR&quot;,&quot;display&quot;:&quot;France&quot;}]}},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueCode&quot;:&quot;fr&quot;},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true},{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;id&quot;:&quot;jurisdiction&quot;,&quot;url&quot;:&quot;http://hl7.org/fhir/ValueSet/jurisdiction&quot;,&quot;version&quot;:&quot;4.0.1&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;urn:iso:std:iso:3166&quot;},{&quot;system&quot;:&quot;urn:iso:std:iso:3166:-2&quot;},{&quot;system&quot;:&quot;http://unstats.un.org/unsd/methods/m49/m49.htm&quot;,&quot;filter&quot;:[{&quot;property&quot;:&quot;class&quot;,&quot;op&quot;:&quot;=&quot;,&quot;value&quot;:&quot;region&quot;}]}]}}}]}&#x27;</code></pre>\n<h2>Root Cause</h2>\n<p><strong>Classification</strong>: code-level defect</p>\n<p><strong>Prod</strong> passes <code>defLang</code> to <code>hasDisplay</code> when checking whether the provided display matches known designations, so default-language displays count as a match and the display warning block is skipped entirely:<br>\n<a href=\"https://github.com/HealthIntersections/fhirserver/blob/ec46dff3fe631ddeeaa000a3ca9530e0dd8c9eac/library/ftx/fhir_valuesets.pas#L1768\" target=\"_blank\"><code>library/ftx/fhir_valuesets.pas#L1768</code></a><br>\n— <code>list.hasDisplay(FParams.workingLanguages, defLang, c.display, ...)</code> finds &quot;France&quot; via the default language fallback, so no display error is generated.</p>\n<p><strong>Dev</strong> passes <code>null</code> instead of <code>defLang</code> to <code>hasDisplay</code> in the <code>checkDisplays</code> method, so default-language displays are not considered a match. This causes the code to enter the display-not-found path and emit the <code>NO_VALID_DISPLAY_FOUND_NONE_FOR_LANG_OK</code> informational message:<br>\n<a href=\"https://github.com/HealthIntersections/FHIRsmith/blob/6440990b4d0f5ca87b48093bad6ac2868067a49e/tx/workers/validate.js#L1343\" target=\"_blank\"><code>tx/workers/validate.js#L1343</code></a><br>\n— <code>list.hasDisplay(this.params.workingLanguages(), null, c.display, ...)</code> does not find &quot;France&quot; because <code>_langsMatch</code> skips the default-language shortcut when <code>defLang</code> is <code>null</code>:<br>\n<a href=\"https://github.com/HealthIntersections/FHIRsmith/blob/6440990b4d0f5ca87b48093bad6ac2868067a49e/tx/library/designations.js#L778-L781\" target=\"_blank\"><code>tx/library/designations.js#L778-L781</code></a></p>\n<p><strong>Fix</strong>: In <code>checkDisplays</code> at <code>tx/workers/validate.js</code> line 1343, change the second argument of <code>list.hasDisplay(...)</code> from <code>null</code> to <code>defLang</code> (which is already passed as a parameter to <code>checkDisplays</code>), matching what prod does at <code>fhir_valuesets.pas</code> line 1768.</p>", "impact": 603}, {"id": "f2b2cef", "title": "Dev : missing valueset-unclosed extension and spurious expansion.total on incomplete expansions", "status": "open", "labels": ["code-defect", "content-differs", "reproduced", "round:2026-02-round-2", "round:2026-02-round-3", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-11 19:26", "date_iso": "2026-02-11T19:26:39-06:00", "body_md": "Records-Impacted: 352\nTolerance-ID: expand-unclosed-extension-and-total\nRecord-ID: b6156665-797d-4483-971c-62c00a0816b8\n\n## What differs\n\nFor $expand operations that return incomplete/truncated expansions (e.g., SNOMED CT is-a queries requesting count=1000 from a set with 124,412 total codes):\n\n1. **Prod includes `expansion.extension` with `valueset-unclosed: true`; dev omits it.** Per the FHIR R4 spec, this extension signals that an expansion is incomplete due to inclusion of post-coordinated or unbounded value sets. Prod correctly marks these expansions as unclosed; dev does not.\n\n2. **Dev includes `expansion.total` (e.g., 124412); prod omits it.** The `total` field is optional (0..1) per spec. Prod omits it on these incomplete expansions; dev includes it. Since these expansions are truncated to the `count` parameter (e.g., 1000 codes returned), the behavioral difference is: dev tells the client the full count but doesn't signal incompleteness, while prod signals incompleteness but doesn't provide the full count.\n\nThese two differences frequently co-occur in the same records — most records where prod has `valueset-unclosed` but dev doesn't also have dev providing `total` while prod doesn't. However, some records show only the extension difference (both sides have null total), particularly when both sides hit the count limit and neither calculates a total.\n\n## How widespread\n\n- **Round 2**: 292 records in the comparison dataset showed both patterns simultaneously. All were successful (200/200) $expand operations.\n- **Round 3**: 60 records eliminated by the tolerance. Of these, 29 had only the extension difference (both sides total=null), and 32 had both extension + total differences. All are SNOMED CT filter expansions (is-a, descendent-of).\n\nTotal across rounds: ~352 records impacted.\n\n## Tolerances\n\n- `expand-unclosed-extension-and-total`: Matches $expand records where prod has `valueset-unclosed` extension but dev doesn't. Normalizes by stripping the extension from prod's expansion and stripping dev's total when prod doesn't have one.\n\n## Representative record IDs\n\n- `b6156665-797d-4483-971c-62c00a0816b8` (round 2): POST /r4/ValueSet/$expand — SNOMED CT is-a 404684003 (Clinical finding), count=1000\n- `95392d8c-d8b0-4386-8b73-f50df7c71001` (round 3): POST /r4/ValueSet/$expand — SNOMED CT is-a 404684003 (Clinical finding), count=1000\n\n## Root Cause\n\n**Classification**: code-level defect\n\n**Prod** calls `cs.isNotClosed()` per-filter to check if the code system's expansion is unclosed:\n[`library/ftx/fhir_valuesets.pas#L4028-L4029`](https://github.com/HealthIntersections/fhirserver/blob/ec46dff3fe631ddeeaa000a3ca9530e0dd8c9eac/library/ftx/fhir_valuesets.pas#L4028-L4029)\n— After each filter is applied, calls `cs.isNotClosed(opContext, filter, f)`. For SNOMED CT, this unconditionally returns `true`:\n[`library/ftx/ftx_sct_services.pas#L5354-L5357`](https://github.com/HealthIntersections/fhirserver/blob/ec46dff3fe631ddeeaa000a3ca9530e0dd8c9eac/library/ftx/ftx_sct_services.pas#L5354-L5357)\n\n**Dev** uses a separate `filtersNotClosed()` method that SNOMED doesn't override:\n[`tx/workers/expand.js#L816-L818`](https://github.com/HealthIntersections/FHIRsmith/blob/6440990b4d0f5ca87b48093bad6ac2868067a49e/tx/workers/expand.js#L816-L818)\n— Calls `cs.filtersNotClosed(prep)` after executing filters. The SNOMED provider (`tx/cs/cs-snomed.js`) does not override this method, so it inherits the base class default which returns `false`:\n[`tx/cs/cs-api.js#L557`](https://github.com/HealthIntersections/FHIRsmith/blob/6440990b4d0f5ca87b48093bad6ac2868067a49e/tx/cs/cs-api.js#L557)\n\nThe consequence is that `notClosed` stays `false` for SNOMED filter expansions. This causes both symptoms: (1) the `valueset-unclosed` extension is not added (expand.js L1296-1297), and (2) `expansion.total` is set (expand.js L1308-1311) because the code falls into the else branch that only runs when `notClosed` is `false`.\n\n**Fix**: Add `async filtersNotClosed() { return true; }` to the SNOMED provider class in `tx/cs/cs-snomed.js`, matching the existing `isNotClosed() { return true; }` at line 950.\n\n## Repro\n\n```bash\ncurl -s https://tx.fhir.org/r4/ValueSet/\\$expand \\\n  -H \"Accept: application/fhir+json\" \\\n  -H \"Content-Type: application/fhir+json\" \\\n  --data-binary @- << 'REQUEST'\n{\n  \"resourceType\": \"Parameters\",\n  \"parameter\": [\n    {\n      \"name\": \"count\",\n      \"valueInteger\": 1000\n    },\n    {\n      \"name\": \"offset\",\n      \"valueInteger\": 0\n    },\n    {\n      \"name\": \"valueSet\",\n      \"resource\": {\n        \"resourceType\": \"ValueSet\",\n        \"status\": \"active\",\n        \"compose\": {\n          \"inactive\": true,\n          \"include\": [\n            {\n              \"system\": \"http://snomed.info/sct\",\n              \"filter\": [\n                {\n                  \"property\": \"concept\",\n                  \"op\": \"is-a\",\n                  \"value\": \"404684003\"\n                }\n              ]\n            }\n          ]\n        }\n      }\n    }\n  ]\n}\nREQUEST\n```\n\nProd returns `expansion.extension` with `valueset-unclosed: true` and no `expansion.total`. Dev returns `expansion.total` (e.g. 124412) with no unclosed extension.", "body_html": "<p>Records-Impacted: 352<br>\nTolerance-ID: expand-unclosed-extension-and-total<br>\nRecord-ID: b6156665-797d-4483-971c-62c00a0816b8</p>\n<h2>What differs</h2>\n<p>For $expand operations that return incomplete/truncated expansions (e.g., SNOMED CT is-a queries requesting count=1000 from a set with 124,412 total codes):</p>\n<ol><li>**Prod includes <code>expansion.extension</code> with <code>valueset-unclosed: true</code>; dev omits it.** Per the FHIR R4 spec, this extension signals that an expansion is incomplete due to inclusion of post-coordinated or unbounded value sets. Prod correctly marks these expansions as unclosed; dev does not.</li></ol>\n<ol><li>**Dev includes <code>expansion.total</code> (e.g., 124412); prod omits it.** The <code>total</code> field is optional (0..1) per spec. Prod omits it on these incomplete expansions; dev includes it. Since these expansions are truncated to the <code>count</code> parameter (e.g., 1000 codes returned), the behavioral difference is: dev tells the client the full count but doesn&#x27;t signal incompleteness, while prod signals incompleteness but doesn&#x27;t provide the full count.</li></ol>\n<p>These two differences frequently co-occur in the same records — most records where prod has <code>valueset-unclosed</code> but dev doesn&#x27;t also have dev providing <code>total</code> while prod doesn&#x27;t. However, some records show only the extension difference (both sides have null total), particularly when both sides hit the count limit and neither calculates a total.</p>\n<h2>How widespread</h2>\n<ul><li><strong>Round 2</strong>: 292 records in the comparison dataset showed both patterns simultaneously. All were successful (200/200) $expand operations.</li><li><strong>Round 3</strong>: 60 records eliminated by the tolerance. Of these, 29 had only the extension difference (both sides total=null), and 32 had both extension + total differences. All are SNOMED CT filter expansions (is-a, descendent-of).</li></ul>\n<p>Total across rounds: ~352 records impacted.</p>\n<h2>Tolerances</h2>\n<ul><li><code>expand-unclosed-extension-and-total</code>: Matches $expand records where prod has <code>valueset-unclosed</code> extension but dev doesn&#x27;t. Normalizes by stripping the extension from prod&#x27;s expansion and stripping dev&#x27;s total when prod doesn&#x27;t have one.</li></ul>\n<h2>Representative record IDs</h2>\n<ul><li><code>b6156665-797d-4483-971c-62c00a0816b8</code> (round 2): POST /r4/ValueSet/$expand — SNOMED CT is-a 404684003 (Clinical finding), count=1000</li><li><code>95392d8c-d8b0-4386-8b73-f50df7c71001</code> (round 3): POST /r4/ValueSet/$expand — SNOMED CT is-a 404684003 (Clinical finding), count=1000</li></ul>\n<h2>Root Cause</h2>\n<p><strong>Classification</strong>: code-level defect</p>\n<p><strong>Prod</strong> calls <code>cs.isNotClosed()</code> per-filter to check if the code system&#x27;s expansion is unclosed:<br>\n<a href=\"https://github.com/HealthIntersections/fhirserver/blob/ec46dff3fe631ddeeaa000a3ca9530e0dd8c9eac/library/ftx/fhir_valuesets.pas#L4028-L4029\" target=\"_blank\"><code>library/ftx/fhir_valuesets.pas#L4028-L4029</code></a><br>\n— After each filter is applied, calls <code>cs.isNotClosed(opContext, filter, f)</code>. For SNOMED CT, this unconditionally returns <code>true</code>:<br>\n<a href=\"https://github.com/HealthIntersections/fhirserver/blob/ec46dff3fe631ddeeaa000a3ca9530e0dd8c9eac/library/ftx/ftx_sct_services.pas#L5354-L5357\" target=\"_blank\"><code>library/ftx/ftx_sct_services.pas#L5354-L5357</code></a></p>\n<p><strong>Dev</strong> uses a separate <code>filtersNotClosed()</code> method that SNOMED doesn&#x27;t override:<br>\n<a href=\"https://github.com/HealthIntersections/FHIRsmith/blob/6440990b4d0f5ca87b48093bad6ac2868067a49e/tx/workers/expand.js#L816-L818\" target=\"_blank\"><code>tx/workers/expand.js#L816-L818</code></a><br>\n— Calls <code>cs.filtersNotClosed(prep)</code> after executing filters. The SNOMED provider (<code>tx/cs/cs-snomed.js</code>) does not override this method, so it inherits the base class default which returns <code>false</code>:<br>\n<a href=\"https://github.com/HealthIntersections/FHIRsmith/blob/6440990b4d0f5ca87b48093bad6ac2868067a49e/tx/cs/cs-api.js#L557\" target=\"_blank\"><code>tx/cs/cs-api.js#L557</code></a></p>\n<p>The consequence is that <code>notClosed</code> stays <code>false</code> for SNOMED filter expansions. This causes both symptoms: (1) the <code>valueset-unclosed</code> extension is not added (expand.js L1296-1297), and (2) <code>expansion.total</code> is set (expand.js L1308-1311) because the code falls into the else branch that only runs when <code>notClosed</code> is <code>false</code>.</p>\n<p><strong>Fix</strong>: Add <code>async filtersNotClosed() { return true; }</code> to the SNOMED provider class in <code>tx/cs/cs-snomed.js</code>, matching the existing <code>isNotClosed() { return true; }</code> at line 950.</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\">curl -s https://tx.fhir.org/r4/ValueSet/\\$expand \\\n  -H &quot;Accept: application/fhir+json&quot; \\\n  -H &quot;Content-Type: application/fhir+json&quot; \\\n  --data-binary @- &lt;&lt; &#x27;REQUEST&#x27;\n{\n  &quot;resourceType&quot;: &quot;Parameters&quot;,\n  &quot;parameter&quot;: [\n    {\n      &quot;name&quot;: &quot;count&quot;,\n      &quot;valueInteger&quot;: 1000\n    },\n    {\n      &quot;name&quot;: &quot;offset&quot;,\n      &quot;valueInteger&quot;: 0\n    },\n    {\n      &quot;name&quot;: &quot;valueSet&quot;,\n      &quot;resource&quot;: {\n        &quot;resourceType&quot;: &quot;ValueSet&quot;,\n        &quot;status&quot;: &quot;active&quot;,\n        &quot;compose&quot;: {\n          &quot;inactive&quot;: true,\n          &quot;include&quot;: [\n            {\n              &quot;system&quot;: &quot;http://snomed.info/sct&quot;,\n              &quot;filter&quot;: [\n                {\n                  &quot;property&quot;: &quot;concept&quot;,\n                  &quot;op&quot;: &quot;is-a&quot;,\n                  &quot;value&quot;: &quot;404684003&quot;\n                }\n              ]\n            }\n          ]\n        }\n      }\n    }\n  ]\n}\nREQUEST</code></pre>\n<p>Prod returns <code>expansion.extension</code> with <code>valueset-unclosed: true</code> and no <code>expansion.total</code>. Dev returns <code>expansion.total</code> (e.g. 124412) with no unclosed extension.</p>", "impact": 352}, {"id": "b9034b0", "title": "validate-code: display text differs for LOINC, ISO 3166, UCUM, BCP-13 codes with same version", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-3", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-11 20:30", "date_iso": "2026-02-11T20:30:35-06:00", "body_md": "Records-Impacted: 275\nTolerance-ID: validate-code-display-text-differs\nRecord-ID: 4da8e1fd-f8a0-4474-b81b-57cbd5b0b4b6\n\n## Repro\n\n```bash\n# Example 1: LOINC 8478-0 via ValueSet/$validate-code (en-US)\n\n# Prod\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$validate-code' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"codeableConcept\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"http://loinc.org\",\"code\":\"8478-0\",\"display\":\"Mean blood pressure\"},{\"system\":\"http://snomed.info/sct\",\"code\":\"6797001\",\"display\":\"Mean blood pressure (observable entity)\"}]}},{\"name\":\"displayLanguage\",\"valueString\":\"en-US\"},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true},{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"url\":\"http://hl7.org/fhir/ValueSet/observation-vitalsignresult\",\"version\":\"4.0.1\",\"compose\":{\"include\":[{\"system\":\"http://loinc.org\",\"concept\":[{\"code\":\"85353-1\"},{\"code\":\"9279-1\"},{\"code\":\"8867-4\"},{\"code\":\"2708-6\"},{\"code\":\"8310-5\"},{\"code\":\"8302-2\"},{\"code\":\"9843-4\"},{\"code\":\"29463-7\"},{\"code\":\"39156-5\"},{\"code\":\"85354-9\"},{\"code\":\"8480-6\"},{\"code\":\"8462-4\"},{\"code\":\"8478-0\"}]}]}}}]}'\n\n# Dev\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$validate-code' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"codeableConcept\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"http://loinc.org\",\"code\":\"8478-0\",\"display\":\"Mean blood pressure\"},{\"system\":\"http://snomed.info/sct\",\"code\":\"6797001\",\"display\":\"Mean blood pressure (observable entity)\"}]}},{\"name\":\"displayLanguage\",\"valueString\":\"en-US\"},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true},{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"url\":\"http://hl7.org/fhir/ValueSet/observation-vitalsignresult\",\"version\":\"4.0.1\",\"compose\":{\"include\":[{\"system\":\"http://loinc.org\",\"concept\":[{\"code\":\"85353-1\"},{\"code\":\"9279-1\"},{\"code\":\"8867-4\"},{\"code\":\"2708-6\"},{\"code\":\"8310-5\"},{\"code\":\"8302-2\"},{\"code\":\"9843-4\"},{\"code\":\"29463-7\"},{\"code\":\"39156-5\"},{\"code\":\"85354-9\"},{\"code\":\"8480-6\"},{\"code\":\"8462-4\"},{\"code\":\"8478-0\"}]}]}}}]}'\n\n# Example 2: LOINC 718-7 via CodeSystem/$validate-code (de displayLanguage)\n\n# Prod\ncurl -s 'https://tx.fhir.org/r4/CodeSystem/$validate-code' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"codeableConcept\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"http://loinc.org\",\"code\":\"718-7\"}]}},{\"name\":\"displayLanguage\",\"valueString\":\"de\"},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true}]}'\n\n# Dev\ncurl -s 'https://tx-dev.fhir.org/r4/CodeSystem/$validate-code' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"codeableConcept\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"http://loinc.org\",\"code\":\"718-7\"}]}},{\"name\":\"displayLanguage\",\"valueString\":\"de\"},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true}]}'\n```\n\n**Example 1** (LOINC 8478-0, en-US): Both return `\"result\": true`, `\"code\": \"8478-0\"`, `\"version\": \"2.81\"`.\n- **Prod**: `\"display\": \"Mean blood pressure\"`\n- **Dev**: `\"display\": \"Mean arterial pressure\"`\n\n**Example 2** (LOINC 718-7, de): Both return `\"result\": true`, `\"code\": \"718-7\"`, `\"version\": \"2.81\"`.\n- **Prod**: `\"display\": \"Hämoglobin\"`\n- **Dev**: `\"display\": \"Hämoglobin [Masse/Volumen] in Blut\"`\n\n## What differs\n\nIn $validate-code responses, the `display` parameter returned for the same code and same version differs between prod and dev. Both servers agree on result, system, code, and version — only the display text (the human-readable name) differs.\n\nExamples:\n- LOINC 8478-0 (v2.81): prod=\"Mean blood pressure\", dev=\"Mean arterial pressure\"\n- LOINC 8480-6 (v2.81, de-DE displayLanguage): prod=\"Blutdruck systolisch\", dev=\"Systolischer Blutdruck\"\n- LOINC 718-7 (v2.81, de-DE): prod=\"Hämoglobin\", dev=\"Hämoglobin [Masse/Volumen] in Blut\"\n- ISO 3166 DE (v2018): prod=\"Deutschland\", dev=\"Germany\"\n- UCUM mL (v2.2): prod=\"ml\", dev=\"mL\"\n- BCP-13 application/pdf: prod=\"PDF\", dev=\"application/pdf\"\n\nProd tends to return a shorter/common name, dev returns a different designation (sometimes longer, sometimes different language, sometimes different case).\n\n## How widespread\n\n275 validate-code delta records where `display` is the only difference. Breakdown by system:\n- http://loinc.org: 261 records\n- urn:iso:std:iso:3166: 10 records\n- http://unitsofmeasure.org: 2 records\n- urn:ietf:bcp:13: 2 records\n\nFound via: `grep '\"type\":\"value-differs\",\"param\":\"display\"' results/deltas/deltas.ndjson` then filtering to records where display is the sole diff.\n\nThis is the same class of issue as the previously filed and closed SNOMED display text bug (39d9af6) — both servers load the same version of each code system but pick different designations/display names for the same code.\n\n## What the tolerance covers\n\nTolerance ID: `validate-code-display-text-differs`. Matches validate-code Parameters responses where both sides are Parameters, the system is NOT http://snomed.info/sct (already handled by snomed-same-version-display-differs) and NOT urn:ietf:bcp:47 (already handled by bcp47-display-format), the display values differ, but everything else matches. Normalizes both sides to prod's display value.\n\n## Representative records\n\n- 4da8e1fd-f8a0-4474-b81b-57cbd5b0b4b6 (LOINC 8478-0, \"Mean blood pressure\" vs \"Mean arterial pressure\")", "body_html": "<p>Records-Impacted: 275<br>\nTolerance-ID: validate-code-display-text-differs<br>\nRecord-ID: 4da8e1fd-f8a0-4474-b81b-57cbd5b0b4b6</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Example 1: LOINC 8478-0 via ValueSet/$validate-code (en-US)\n\n# Prod\ncurl -s &#x27;https://tx.fhir.org/r4/ValueSet/$validate-code&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;codeableConcept&quot;,&quot;valueCodeableConcept&quot;:{&quot;coding&quot;:[{&quot;system&quot;:&quot;http://loinc.org&quot;,&quot;code&quot;:&quot;8478-0&quot;,&quot;display&quot;:&quot;Mean blood pressure&quot;},{&quot;system&quot;:&quot;http://snomed.info/sct&quot;,&quot;code&quot;:&quot;6797001&quot;,&quot;display&quot;:&quot;Mean blood pressure (observable entity)&quot;}]}},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueString&quot;:&quot;en-US&quot;},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true},{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;url&quot;:&quot;http://hl7.org/fhir/ValueSet/observation-vitalsignresult&quot;,&quot;version&quot;:&quot;4.0.1&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;http://loinc.org&quot;,&quot;concept&quot;:[{&quot;code&quot;:&quot;85353-1&quot;},{&quot;code&quot;:&quot;9279-1&quot;},{&quot;code&quot;:&quot;8867-4&quot;},{&quot;code&quot;:&quot;2708-6&quot;},{&quot;code&quot;:&quot;8310-5&quot;},{&quot;code&quot;:&quot;8302-2&quot;},{&quot;code&quot;:&quot;9843-4&quot;},{&quot;code&quot;:&quot;29463-7&quot;},{&quot;code&quot;:&quot;39156-5&quot;},{&quot;code&quot;:&quot;85354-9&quot;},{&quot;code&quot;:&quot;8480-6&quot;},{&quot;code&quot;:&quot;8462-4&quot;},{&quot;code&quot;:&quot;8478-0&quot;}]}]}}}]}&#x27;\n\n# Dev\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$validate-code&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;codeableConcept&quot;,&quot;valueCodeableConcept&quot;:{&quot;coding&quot;:[{&quot;system&quot;:&quot;http://loinc.org&quot;,&quot;code&quot;:&quot;8478-0&quot;,&quot;display&quot;:&quot;Mean blood pressure&quot;},{&quot;system&quot;:&quot;http://snomed.info/sct&quot;,&quot;code&quot;:&quot;6797001&quot;,&quot;display&quot;:&quot;Mean blood pressure (observable entity)&quot;}]}},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueString&quot;:&quot;en-US&quot;},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true},{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;url&quot;:&quot;http://hl7.org/fhir/ValueSet/observation-vitalsignresult&quot;,&quot;version&quot;:&quot;4.0.1&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;http://loinc.org&quot;,&quot;concept&quot;:[{&quot;code&quot;:&quot;85353-1&quot;},{&quot;code&quot;:&quot;9279-1&quot;},{&quot;code&quot;:&quot;8867-4&quot;},{&quot;code&quot;:&quot;2708-6&quot;},{&quot;code&quot;:&quot;8310-5&quot;},{&quot;code&quot;:&quot;8302-2&quot;},{&quot;code&quot;:&quot;9843-4&quot;},{&quot;code&quot;:&quot;29463-7&quot;},{&quot;code&quot;:&quot;39156-5&quot;},{&quot;code&quot;:&quot;85354-9&quot;},{&quot;code&quot;:&quot;8480-6&quot;},{&quot;code&quot;:&quot;8462-4&quot;},{&quot;code&quot;:&quot;8478-0&quot;}]}]}}}]}&#x27;\n\n# Example 2: LOINC 718-7 via CodeSystem/$validate-code (de displayLanguage)\n\n# Prod\ncurl -s &#x27;https://tx.fhir.org/r4/CodeSystem/$validate-code&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;codeableConcept&quot;,&quot;valueCodeableConcept&quot;:{&quot;coding&quot;:[{&quot;system&quot;:&quot;http://loinc.org&quot;,&quot;code&quot;:&quot;718-7&quot;}]}},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueString&quot;:&quot;de&quot;},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true}]}&#x27;\n\n# Dev\ncurl -s &#x27;https://tx-dev.fhir.org/r4/CodeSystem/$validate-code&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;codeableConcept&quot;,&quot;valueCodeableConcept&quot;:{&quot;coding&quot;:[{&quot;system&quot;:&quot;http://loinc.org&quot;,&quot;code&quot;:&quot;718-7&quot;}]}},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueString&quot;:&quot;de&quot;},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true}]}&#x27;</code></pre>\n<p><strong>Example 1</strong> (LOINC 8478-0, en-US): Both return <code>&quot;result&quot;: true</code>, <code>&quot;code&quot;: &quot;8478-0&quot;</code>, <code>&quot;version&quot;: &quot;2.81&quot;</code>.</p>\n<ul><li><strong>Prod</strong>: <code>&quot;display&quot;: &quot;Mean blood pressure&quot;</code></li><li><strong>Dev</strong>: <code>&quot;display&quot;: &quot;Mean arterial pressure&quot;</code></li></ul>\n<p><strong>Example 2</strong> (LOINC 718-7, de): Both return <code>&quot;result&quot;: true</code>, <code>&quot;code&quot;: &quot;718-7&quot;</code>, <code>&quot;version&quot;: &quot;2.81&quot;</code>.</p>\n<ul><li><strong>Prod</strong>: <code>&quot;display&quot;: &quot;Hämoglobin&quot;</code></li><li><strong>Dev</strong>: <code>&quot;display&quot;: &quot;Hämoglobin [Masse/Volumen] in Blut&quot;</code></li></ul>\n<h2>What differs</h2>\n<p>In $validate-code responses, the <code>display</code> parameter returned for the same code and same version differs between prod and dev. Both servers agree on result, system, code, and version — only the display text (the human-readable name) differs.</p>\n<p>Examples:</p>\n<ul><li>LOINC 8478-0 (v2.81): prod=&quot;Mean blood pressure&quot;, dev=&quot;Mean arterial pressure&quot;</li><li>LOINC 8480-6 (v2.81, de-DE displayLanguage): prod=&quot;Blutdruck systolisch&quot;, dev=&quot;Systolischer Blutdruck&quot;</li><li>LOINC 718-7 (v2.81, de-DE): prod=&quot;Hämoglobin&quot;, dev=&quot;Hämoglobin [Masse/Volumen] in Blut&quot;</li><li>ISO 3166 DE (v2018): prod=&quot;Deutschland&quot;, dev=&quot;Germany&quot;</li><li>UCUM mL (v2.2): prod=&quot;ml&quot;, dev=&quot;mL&quot;</li><li>BCP-13 application/pdf: prod=&quot;PDF&quot;, dev=&quot;application/pdf&quot;</li></ul>\n<p>Prod tends to return a shorter/common name, dev returns a different designation (sometimes longer, sometimes different language, sometimes different case).</p>\n<h2>How widespread</h2>\n<p>275 validate-code delta records where <code>display</code> is the only difference. Breakdown by system:</p>\n<ul><li><a href=\"http://loinc.org:\" target=\"_blank\">http://loinc.org:</a> 261 records</li><li>urn:iso:std:iso:3166: 10 records</li><li><a href=\"http://unitsofmeasure.org:\" target=\"_blank\">http://unitsofmeasure.org:</a> 2 records</li><li>urn:ietf:bcp:13: 2 records</li></ul>\n<p>Found via: <code>grep &#x27;&quot;type&quot;:&quot;value-differs&quot;,&quot;param&quot;:&quot;display&quot;&#x27; results/deltas/deltas.ndjson</code> then filtering to records where display is the sole diff.</p>\n<p>This is the same class of issue as the previously filed and closed SNOMED display text bug (39d9af6) — both servers load the same version of each code system but pick different designations/display names for the same code.</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance ID: <code>validate-code-display-text-differs</code>. Matches validate-code Parameters responses where both sides are Parameters, the system is NOT <a href=\"http://snomed.info/sct\" target=\"_blank\">http://snomed.info/sct</a> (already handled by snomed-same-version-display-differs) and NOT urn:ietf:bcp:47 (already handled by bcp47-display-format), the display values differ, but everything else matches. Normalizes both sides to prod&#x27;s display value.</p>\n<h2>Representative records</h2>\n<ul><li>4da8e1fd-f8a0-4474-b81b-57cbd5b0b4b6 (LOINC 8478-0, &quot;Mean blood pressure&quot; vs &quot;Mean arterial pressure&quot;)</li></ul>", "impact": 275}, {"id": "4336772", "title": "Dev  returns only root concept for v3 hierarchical ValueSets (missing child codes)", "status": "open", "labels": ["code-defect", "content-differs", "reproduced", "round:2026-02-round-2", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 10:52", "date_iso": "2026-02-08T10:52:56-06:00", "body_md": "Records-Impacted: 246\nTolerance-ID: expand-v3-hierarchical-incomplete\nRecord-ID: 18d8209b-15f4-486d-8009-25ed8cb2cbcb\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$expand?url=http://terminology.hl7.org/ValueSet/v3-PurposeOfUse&_format=json' \\\n  -H 'Accept: application/fhir+json'\n\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$expand?url=http://terminology.hl7.org/ValueSet/v3-PurposeOfUse&_format=json' \\\n  -H 'Accept: application/fhir+json'\n```\n\nProd returns `expansion.total=63` with 63 codes (PurposeOfUse root + 62 child codes like HMARKT, HOPERAT, TREAT, etc.). Dev returns `expansion.total=1` with only the root abstract concept `PurposeOfUse`.\n\n\nWhen expanding v3 ValueSets that include hierarchical concepts from `terminology.hl7.org/CodeSystem/v3-ActReason`, dev returns only the root abstract concept while prod returns the full hierarchy of child codes.\n\nFor example, expanding `http://terminology.hl7.org/ValueSet/v3-PurposeOfUse`:\n- Prod: `expansion.total=63`, contains 63 codes (PurposeOfUse root + 62 child codes like HMARKT, HOPERAT, TREAT, etc.)\n- Dev: `expansion.total=1`, contains only the root abstract concept `PurposeOfUse`\n\nThe same pattern affects 4 distinct v3 ValueSets:\n- `v3-ActEncounterCode`: prod=12 codes, dev=1 (209 records)\n- `v3-ServiceDeliveryLocationRoleType`: prod=139 codes, dev=1 (24 records)\n- `v3-PurposeOfUse`: prod=63 codes, dev=1 (6 records)\n- `v3-ActPharmacySupplyType`: prod=35 codes, dev=1 (7 records)\n\nIn all cases, dev returns only the root concept and completely omits the descendant codes that should be included in the expansion.\n\n\n246 records across the 4 ValueSets listed above. Found via:\n```bash\ngrep '\"op\":\"expand\"' jobs/2026-02-round-2/results/deltas/deltas.ndjson | python3 -c '...' # script checking prod_total>1 and dev_total==1\n```\n\nAll are GET requests to `/r4/ValueSet/$expand` with `url=http://terminology.hl7.org/ValueSet/v3-*`.\n\n\nTolerance ID: `expand-v3-hierarchical-incomplete`. Matches expand operations where both prod and dev return 200, the ValueSet URL matches `terminology.hl7.org/ValueSet/v3-`, and dev expansion total is 1 while prod expansion total is greater than 1. Skips these records. Eliminates 246 records.\n\n\nBug 6edc96c mentions these 246 records in a comment as potentially a separate root cause from the version skew issue. This bug tracks the specific failure to expand hierarchical v3 ValueSets.\n\n## Root Cause\n\n**Classification**: code-level defect\n\n**Prod** resolves parent-child hierarchy from CodeSystem property definitions by matching on URI:\n[`library/ftx/fhir_codesystem_service.pas#L438-L458`](https://github.com/HealthIntersections/fhirserver/blob/ec46dff3fe631ddeeaa000a3ca9530e0dd8c9eac/library/ftx/fhir_codesystem_service.pas#L438-L458)\n— Iterates CodeSystem property definitions and matches any property where `code = 'parent'` OR `uri = 'http://hl7.org/fhir/concept-properties#parent'`. Then uses the matched property's actual `code` (e.g. `subsumedBy`) to find concept-level property entries and build parent-child relationships.\n\n**Dev** only matches hardcoded property code names `parent` and `child`:\n[`tx/library/codesystem.js#L507-L523`](https://github.com/HealthIntersections/FHIRsmith/blob/6440990b4d0f5ca87b48093bad6ac2868067a49e/tx/library/codesystem.js#L507-L523)\n— The `_buildHierarchyMaps` method checks `property.code === 'parent'` and `property.code === 'child'` but never consults the CodeSystem's property definitions to discover that `subsumedBy` maps to the standard parent URI `http://hl7.org/fhir/concept-properties#parent`.\n\nThe v3 CodeSystems (e.g. `v3-ActReason`) define their parent property as `{code: \"subsumedBy\", uri: \"http://hl7.org/fhir/concept-properties#parent\"}`. Since the dev server only checks for the literal string `\"parent\"`, it never builds the hierarchy for these code systems. When ValueSets like `v3-PurposeOfUse` use a `filter: [{property: \"concept\", op: \"is-a\", value: \"PurposeOfUse\"}]`, the `_addDescendants` call in `cs-cs.js` finds zero descendants because the `parentToChildrenMap` was never populated.\n\n**Fix**: In `_buildHierarchyMaps` (or `buildMaps`), consult the CodeSystem's top-level `property` definitions to identify which property codes map to `http://hl7.org/fhir/concept-properties#parent` (or `#child`), then use those codes when scanning concept properties — matching the prod server's approach.", "body_html": "<p>Records-Impacted: 246<br>\nTolerance-ID: expand-v3-hierarchical-incomplete<br>\nRecord-ID: 18d8209b-15f4-486d-8009-25ed8cb2cbcb</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/ValueSet/$expand?url=http://terminology.hl7.org/ValueSet/v3-PurposeOfUse&amp;_format=json&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand?url=http://terminology.hl7.org/ValueSet/v3-PurposeOfUse&amp;_format=json&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;</code></pre>\n<p>Prod returns <code>expansion.total=63</code> with 63 codes (PurposeOfUse root + 62 child codes like HMARKT, HOPERAT, TREAT, etc.). Dev returns <code>expansion.total=1</code> with only the root abstract concept <code>PurposeOfUse</code>.</p>\n<p>When expanding v3 ValueSets that include hierarchical concepts from <code>terminology.hl7.org/CodeSystem/v3-ActReason</code>, dev returns only the root abstract concept while prod returns the full hierarchy of child codes.</p>\n<p>For example, expanding <code>http://terminology.hl7.org/ValueSet/v3-PurposeOfUse</code>:</p>\n<ul><li>Prod: <code>expansion.total=63</code>, contains 63 codes (PurposeOfUse root + 62 child codes like HMARKT, HOPERAT, TREAT, etc.)</li><li>Dev: <code>expansion.total=1</code>, contains only the root abstract concept <code>PurposeOfUse</code></li></ul>\n<p>The same pattern affects 4 distinct v3 ValueSets:</p>\n<ul><li><code>v3-ActEncounterCode</code>: prod=12 codes, dev=1 (209 records)</li><li><code>v3-ServiceDeliveryLocationRoleType</code>: prod=139 codes, dev=1 (24 records)</li><li><code>v3-PurposeOfUse</code>: prod=63 codes, dev=1 (6 records)</li><li><code>v3-ActPharmacySupplyType</code>: prod=35 codes, dev=1 (7 records)</li></ul>\n<p>In all cases, dev returns only the root concept and completely omits the descendant codes that should be included in the expansion.</p>\n<p>246 records across the 4 ValueSets listed above. Found via:</p>\n<pre><code class=\"lang-bash\">grep &#x27;&quot;op&quot;:&quot;expand&quot;&#x27; jobs/2026-02-round-2/results/deltas/deltas.ndjson | python3 -c &#x27;...&#x27; # script checking prod_total&gt;1 and dev_total==1</code></pre>\n<p>All are GET requests to <code>/r4/ValueSet/$expand</code> with <code>url=http://terminology.hl7.org/ValueSet/v3-*</code>.</p>\n<p>Tolerance ID: <code>expand-v3-hierarchical-incomplete</code>. Matches expand operations where both prod and dev return 200, the ValueSet URL matches <code>terminology.hl7.org/ValueSet/v3-</code>, and dev expansion total is 1 while prod expansion total is greater than 1. Skips these records. Eliminates 246 records.</p>\n<p>Bug 6edc96c mentions these 246 records in a comment as potentially a separate root cause from the version skew issue. This bug tracks the specific failure to expand hierarchical v3 ValueSets.</p>\n<h2>Root Cause</h2>\n<p><strong>Classification</strong>: code-level defect</p>\n<p><strong>Prod</strong> resolves parent-child hierarchy from CodeSystem property definitions by matching on URI:<br>\n<a href=\"https://github.com/HealthIntersections/fhirserver/blob/ec46dff3fe631ddeeaa000a3ca9530e0dd8c9eac/library/ftx/fhir_codesystem_service.pas#L438-L458\" target=\"_blank\"><code>library/ftx/fhir_codesystem_service.pas#L438-L458</code></a><br>\n— Iterates CodeSystem property definitions and matches any property where <code>code = &#x27;parent&#x27;</code> OR <code>uri = &#x27;http://hl7.org/fhir/concept-properties#parent&#x27;</code>. Then uses the matched property&#x27;s actual <code>code</code> (e.g. <code>subsumedBy</code>) to find concept-level property entries and build parent-child relationships.</p>\n<p><strong>Dev</strong> only matches hardcoded property code names <code>parent</code> and <code>child</code>:<br>\n<a href=\"https://github.com/HealthIntersections/FHIRsmith/blob/6440990b4d0f5ca87b48093bad6ac2868067a49e/tx/library/codesystem.js#L507-L523\" target=\"_blank\"><code>tx/library/codesystem.js#L507-L523</code></a><br>\n— The <code>_buildHierarchyMaps</code> method checks <code>property.code === &#x27;parent&#x27;</code> and <code>property.code === &#x27;child&#x27;</code> but never consults the CodeSystem&#x27;s property definitions to discover that <code>subsumedBy</code> maps to the standard parent URI <code>http://hl7.org/fhir/concept-properties#parent</code>.</p>\n<p>The v3 CodeSystems (e.g. <code>v3-ActReason</code>) define their parent property as <code>{code: &quot;subsumedBy&quot;, uri: &quot;http://hl7.org/fhir/concept-properties#parent&quot;}</code>. Since the dev server only checks for the literal string <code>&quot;parent&quot;</code>, it never builds the hierarchy for these code systems. When ValueSets like <code>v3-PurposeOfUse</code> use a <code>filter: [{property: &quot;concept&quot;, op: &quot;is-a&quot;, value: &quot;PurposeOfUse&quot;}]</code>, the <code>_addDescendants</code> call in <code>cs-cs.js</code> finds zero descendants because the <code>parentToChildrenMap</code> was never populated.</p>\n<p><strong>Fix</strong>: In <code>_buildHierarchyMaps</code> (or <code>buildMaps</code>), consult the CodeSystem&#x27;s top-level <code>property</code> definitions to identify which property codes map to <code>http://hl7.org/fhir/concept-properties#parent</code> (or <code>#child</code>), then use those codes when scanning concept properties — matching the prod server&#x27;s approach.</p>", "impact": 246}, {"id": "167be81", "title": "Dev returns result=false for valid v3 terminology codes in ValueSet $validate-code", "status": "open", "labels": ["code-defect", "reproduced", "result-disagrees", "round:2026-02-round-2", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 10:52", "date_iso": "2026-02-08T10:52:55-06:00", "body_md": "Records-Impacted: 187\nTolerance-ID: v3-valueset-validate-code-result-disagrees\nRecord-ID: 92d4fd1a-70fc-4497-adb5-309a3f564716\n\n## Repro\n\n```bash\n# Prod\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$validate-code?url=http:%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fconsent-category&code=INFA&_format=json&system=http:%2F%2Fterminology.hl7.org%2FCodeSystem%2Fv3-ActCode' \\\n  -H 'Accept: application/fhir+json'\n\n# Dev\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$validate-code?url=http:%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fconsent-category&code=INFA&_format=json&system=http:%2F%2Fterminology.hl7.org%2FCodeSystem%2Fv3-ActCode' \\\n  -H 'Accept: application/fhir+json'\n```\n\nProd returns `result: true` (code is valid in the ValueSet), dev returns `result: false` with error message \"The provided code 'http://terminology.hl7.org/CodeSystem/v3-ActCode#INFA' was not found in the value set 'http://hl7.org/fhir/ValueSet/consent-category|4.0.1'\".\n\nThe bug reproduces across multiple ValueSets:\n- encounter-participant-type with code CON from v3-ParticipationType\n- v3-ActEncounterCode with code AMB from v3-ActCode\n\n## Root Cause\n\n**Classification**: code-level defect\n\nHL7 v3 CodeSystems (e.g., v3-ActCode, v3-ParticipationType, v3-RoleCode) use a **flat concept list** with a property named `subsumedBy` to define hierarchy. This property is declared with `uri: \"http://hl7.org/fhir/concept-properties#parent\"` — the standard FHIR URI for parent relationships — but with the non-standard property code `subsumedBy` instead of `parent`.\n\n**Prod** resolves hierarchy by matching on the property URI, not just the code:\n[`fhir_codesystem_service.pas#L438-L458`](https://github.com/HealthIntersections/fhirserver/blob/ec46dff3fe631ddeeaa000a3ca9530e0dd8c9eac/library/ftx/fhir_codesystem_service.pas#L438-L458)\n— In `loadCodeSystem`, iterates the CodeSystem's `property` declarations and matches any property where `prop.code = 'parent'` **or** `prop.uri = 'http://hl7.org/fhir/concept-properties#parent'`. This finds the `subsumedBy` property via its URI. Then uses `prop.code` (= `subsumedBy`) to look up concept-level properties and build parent-child relationships.\n\n**Dev** only matches on hardcoded property code names `parent` and `child`:\n[`tx/library/codesystem.js#L507-L523`](https://github.com/HealthIntersections/FHIRsmith/blob/6440990b4d0f5ca87b48093bad6ac2868067a49e/tx/library/codesystem.js#L507-L523)\n— In `_buildHierarchyMaps`, checks `property.code === 'parent'` and `property.code === 'child'` only. Never consults the CodeSystem's property declarations or their URIs. Since v3 CodeSystems use `subsumedBy` (not `parent`), no hierarchy relationships are built. `getDescendants('_ActConsentType')` returns empty, so `is-a` filter matching in `checkConceptSet` finds no descendants, and validation returns false.\n\n**Fix**: In `_buildHierarchyMaps`, look up the CodeSystem's `property` declarations to find which property code maps to `http://hl7.org/fhir/concept-properties#parent` (and `#child`), then use those codes when scanning concept properties — matching the prod server's approach.\n\n## What differs\n\nProd returns `result: true` for $validate-code of HL7 v3 terminology codes against their corresponding ValueSets. Dev returns `result: false` with message \"The provided code was not found in the value set.\"\n\nBoth servers agree on the CodeSystem version, code, and display text — dev can look up the code successfully in the CodeSystem. But dev fails to determine that the code is a member of the ValueSet.\n\nExample (this record): GET /r4/ValueSet/$validate-code with system=v3-ActCode, code=INFA, url=consent-category.\n- Prod: result=true, version=9.0.0, display=\"information access\"\n- Dev: result=false, version=9.0.0, display=\"information access\", message=\"code not found in value set consent-category|4.0.1\"\n\n## How widespread\n\n187 records across 5 ValueSets, all GET requests, all r4, all using terminology.hl7.org/CodeSystem/v3-* systems:\n\n- 103 records: v3-ActEncounterCode ValueSet (codes AMB, IMP, HH, EMER from v3-ActCode)\n- 69 records: encounter-participant-type ValueSet (codes CON, ADM, ATND from v3-ParticipationType)\n- 9 records: consent-category ValueSet (code INFA from v3-ActCode)\n- 4 records: v3-ServiceDeliveryLocationRoleType ValueSet (codes ER, CARD, SLEEP from v3-RoleCode)\n- 2 records: v3-PurposeOfUse ValueSet (code HMARKT from v3-ActReason)\n\nSearch used: grep 'result-disagrees' deltas.ndjson, filtered to terminology.hl7.org/CodeSystem/v3-* systems.\n\n## What the tolerance covers\n\nTolerance `v3-valueset-validate-code-result-disagrees` skips records where:\n- Operation is ValueSet/$validate-code\n- System is terminology.hl7.org/CodeSystem/v3-*\n- prodResult=true, devResult=false\n- Both sides report the same CodeSystem version\n\nEliminates 187 records.", "body_html": "<p>Records-Impacted: 187<br>\nTolerance-ID: v3-valueset-validate-code-result-disagrees<br>\nRecord-ID: 92d4fd1a-70fc-4497-adb5-309a3f564716</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod\ncurl -s &#x27;https://tx.fhir.org/r4/ValueSet/$validate-code?url=http:%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fconsent-category&amp;code=INFA&amp;_format=json&amp;system=http:%2F%2Fterminology.hl7.org%2FCodeSystem%2Fv3-ActCode&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;\n\n# Dev\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$validate-code?url=http:%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fconsent-category&amp;code=INFA&amp;_format=json&amp;system=http:%2F%2Fterminology.hl7.org%2FCodeSystem%2Fv3-ActCode&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;</code></pre>\n<p>Prod returns <code>result: true</code> (code is valid in the ValueSet), dev returns <code>result: false</code> with error message &quot;The provided code &#x27;<a href=\"http://terminology.hl7.org/CodeSystem/v3-ActCode#INFA&#x27;\" target=\"_blank\">http://terminology.hl7.org/CodeSystem/v3-ActCode#INFA&#x27;</a> was not found in the value set &#x27;<a href=\"http://hl7.org/fhir/ValueSet/consent-category|4.0.1&#x27;&quot;.\" target=\"_blank\">http://hl7.org/fhir/ValueSet/consent-category|4.0.1&#x27;&quot;.</a></p>\n<p>The bug reproduces across multiple ValueSets:</p>\n<ul><li>encounter-participant-type with code CON from v3-ParticipationType</li><li>v3-ActEncounterCode with code AMB from v3-ActCode</li></ul>\n<h2>Root Cause</h2>\n<p><strong>Classification</strong>: code-level defect</p>\n<p>HL7 v3 CodeSystems (e.g., v3-ActCode, v3-ParticipationType, v3-RoleCode) use a <strong>flat concept list</strong> with a property named <code>subsumedBy</code> to define hierarchy. This property is declared with <code>uri: &quot;http://hl7.org/fhir/concept-properties#parent&quot;</code> — the standard FHIR URI for parent relationships — but with the non-standard property code <code>subsumedBy</code> instead of <code>parent</code>.</p>\n<p><strong>Prod</strong> resolves hierarchy by matching on the property URI, not just the code:<br>\n<a href=\"https://github.com/HealthIntersections/fhirserver/blob/ec46dff3fe631ddeeaa000a3ca9530e0dd8c9eac/library/ftx/fhir_codesystem_service.pas#L438-L458\" target=\"_blank\"><code>fhir_codesystem_service.pas#L438-L458</code></a><br>\n— In <code>loadCodeSystem</code>, iterates the CodeSystem&#x27;s <code>property</code> declarations and matches any property where <code>prop.code = &#x27;parent&#x27;</code> <strong>or</strong> <code>prop.uri = &#x27;http://hl7.org/fhir/concept-properties#parent&#x27;</code>. This finds the <code>subsumedBy</code> property via its URI. Then uses <code>prop.code</code> (= <code>subsumedBy</code>) to look up concept-level properties and build parent-child relationships.</p>\n<p><strong>Dev</strong> only matches on hardcoded property code names <code>parent</code> and <code>child</code>:<br>\n<a href=\"https://github.com/HealthIntersections/FHIRsmith/blob/6440990b4d0f5ca87b48093bad6ac2868067a49e/tx/library/codesystem.js#L507-L523\" target=\"_blank\"><code>tx/library/codesystem.js#L507-L523</code></a><br>\n— In <code>_buildHierarchyMaps</code>, checks <code>property.code === &#x27;parent&#x27;</code> and <code>property.code === &#x27;child&#x27;</code> only. Never consults the CodeSystem&#x27;s property declarations or their URIs. Since v3 CodeSystems use <code>subsumedBy</code> (not <code>parent</code>), no hierarchy relationships are built. <code>getDescendants(&#x27;_ActConsentType&#x27;)</code> returns empty, so <code>is-a</code> filter matching in <code>checkConceptSet</code> finds no descendants, and validation returns false.</p>\n<p><strong>Fix</strong>: In <code>_buildHierarchyMaps</code>, look up the CodeSystem&#x27;s <code>property</code> declarations to find which property code maps to <code>http://hl7.org/fhir/concept-properties#parent</code> (and <code>#child</code>), then use those codes when scanning concept properties — matching the prod server&#x27;s approach.</p>\n<h2>What differs</h2>\n<p>Prod returns <code>result: true</code> for $validate-code of HL7 v3 terminology codes against their corresponding ValueSets. Dev returns <code>result: false</code> with message &quot;The provided code was not found in the value set.&quot;</p>\n<p>Both servers agree on the CodeSystem version, code, and display text — dev can look up the code successfully in the CodeSystem. But dev fails to determine that the code is a member of the ValueSet.</p>\n<p>Example (this record): GET /r4/ValueSet/$validate-code with system=v3-ActCode, code=INFA, url=consent-category.</p>\n<ul><li>Prod: result=true, version=9.0.0, display=&quot;information access&quot;</li><li>Dev: result=false, version=9.0.0, display=&quot;information access&quot;, message=&quot;code not found in value set consent-category|4.0.1&quot;</li></ul>\n<h2>How widespread</h2>\n<p>187 records across 5 ValueSets, all GET requests, all r4, all using terminology.hl7.org/CodeSystem/v3-* systems:</p>\n<ul><li>103 records: v3-ActEncounterCode ValueSet (codes AMB, IMP, HH, EMER from v3-ActCode)</li><li>69 records: encounter-participant-type ValueSet (codes CON, ADM, ATND from v3-ParticipationType)</li><li>9 records: consent-category ValueSet (code INFA from v3-ActCode)</li><li>4 records: v3-ServiceDeliveryLocationRoleType ValueSet (codes ER, CARD, SLEEP from v3-RoleCode)</li><li>2 records: v3-PurposeOfUse ValueSet (code HMARKT from v3-ActReason)</li></ul>\n<p>Search used: grep &#x27;result-disagrees&#x27; deltas.ndjson, filtered to terminology.hl7.org/CodeSystem/v3-* systems.</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance <code>v3-valueset-validate-code-result-disagrees</code> skips records where:</p>\n<ul><li>Operation is ValueSet/$validate-code</li><li>System is terminology.hl7.org/CodeSystem/v3-*</li><li>prodResult=true, devResult=false</li><li>Both sides report the same CodeSystem version</li></ul>\n<p>Eliminates 187 records.</p>", "impact": 187}, {"id": "c66245d", "title": "Dev crashes (500) on $expand when CodeSystem content mode prevents expansion", "status": "open", "labels": ["dev-crash-on-error", "reproduced", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:37", "date_iso": "2026-02-08T13:37:59-06:00", "body_md": "Records-Impacted: 186\nTolerance-ID: expand-dev-crash-on-error\nRecord-ID: f39ee3d3-8249-4e0c-a8a6-c2d5d1ffdcbd\n\n\n```bash\ncurl -s -w '\\nHTTP_STATUS:%{http_code}\\n' 'https://tx.fhir.org/r4/ValueSet/$expand' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"compose\":{\"include\":[{\"system\":\"http://hl7.org/fhir/sid/icd-9-cm\"}]}}}]}'\n\ncurl -s -w '\\nHTTP_STATUS:%{http_code}\\n' 'https://tx-dev.fhir.org/r4/ValueSet/$expand' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"compose\":{\"include\":[{\"system\":\"http://hl7.org/fhir/sid/icd-9-cm\"}]}}}]}'\n```\n\nProd returns HTTP 422 with `\"is a fragment, so this expansion is not permitted\"`. Dev returns HTTP 500 with `\"is a contentMode() {\\r\\n    return this.codeSystem.content;\\r\\n  }, so this expansion is not permitted\"` — a JavaScript function body leaked into the error message.\n\n\nWhen a $expand request fails because a CodeSystem's content mode (fragment, not-present) prevents expansion, prod returns HTTP 422 with a clear OperationOutcome. Dev returns HTTP 500 with an error message that leaks internal implementation details.\n\nThree distinct error sub-patterns in dev:\n\n1. **Source code leak in error text** (178 records): Dev interpolates a JavaScript function body into the error message. Instead of \"is a fragment, so this expansion is not permitted\", dev returns \"is a contentMode() {\\r\\n    return this.codeSystem.content;\\r\\n  }, so this expansion is not permitted\". The `.contentMode` property accessor is being `.toString()`'d instead of invoked.\n\n2. **exp.addParamUri is not a function** (4 records): Dev crashes with a JS TypeError when attempting to expand ValueSets referencing CodeSystem `https://codesystem.x12.org/005010/1365`.\n\n3. **TerminologyError is not a constructor** (4 records): Dev crashes with a JS TypeError when attempting to expand ValueSets referencing `http://terminology.hl7.org/CodeSystem/v2-0360|2.7`.\n\nAdditional differences in all 186 records:\n- HTTP status: prod=422, dev=500\n- Issue code: prod uses `invalid`, dev uses `business-rule`\n- Dev includes `location: [null]` and `expression: [null]` (arrays containing null — invalid FHIR)\n- Dev omits the `text` narrative that prod includes\n\n\nAll 186 records are POST /r4/ValueSet/$expand with prod=422, dev=500. This accounts for all `dev-crash-on-error` records in the current delta set.\n\nCode systems involved in sub-pattern 1:\n- http://hl7.org/fhir/sid/icd-9-cm (154 records)\n- https://fhir.progyny.com/CodeSystem/identifier-type-cs (24 records)\n\nSearch: `grep -c 'contentMode()' results/deltas/deltas.ndjson` → 178\nSearch: `grep '\"dev-crash-on-error\"' results/deltas/deltas.ndjson | wc -l` → 186\n\n\nTolerance `expand-dev-crash-on-error` skips all records matching POST /r4/ValueSet/$expand with prod.status=422 and dev.status=500. Eliminates all 186 records.", "body_html": "<p>Records-Impacted: 186<br>\nTolerance-ID: expand-dev-crash-on-error<br>\nRecord-ID: f39ee3d3-8249-4e0c-a8a6-c2d5d1ffdcbd</p>\n<pre><code class=\"lang-bash\">curl -s -w &#x27;\\nHTTP_STATUS:%{http_code}\\n&#x27; &#x27;https://tx.fhir.org/r4/ValueSet/$expand&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;http://hl7.org/fhir/sid/icd-9-cm&quot;}]}}}]}&#x27;\n\ncurl -s -w &#x27;\\nHTTP_STATUS:%{http_code}\\n&#x27; &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;http://hl7.org/fhir/sid/icd-9-cm&quot;}]}}}]}&#x27;</code></pre>\n<p>Prod returns HTTP 422 with <code>&quot;is a fragment, so this expansion is not permitted&quot;</code>. Dev returns HTTP 500 with <code>&quot;is a contentMode() {\\r\\n    return this.codeSystem.content;\\r\\n  }, so this expansion is not permitted&quot;</code> — a JavaScript function body leaked into the error message.</p>\n<p>When a $expand request fails because a CodeSystem&#x27;s content mode (fragment, not-present) prevents expansion, prod returns HTTP 422 with a clear OperationOutcome. Dev returns HTTP 500 with an error message that leaks internal implementation details.</p>\n<p>Three distinct error sub-patterns in dev:</p>\n<ol><li><strong>Source code leak in error text</strong> (178 records): Dev interpolates a JavaScript function body into the error message. Instead of &quot;is a fragment, so this expansion is not permitted&quot;, dev returns &quot;is a contentMode() {\\r\\n    return this.codeSystem.content;\\r\\n  }, so this expansion is not permitted&quot;. The <code>.contentMode</code> property accessor is being <code>.toString()</code>&#x27;d instead of invoked.</li></ol>\n<ol><li><strong>exp.addParamUri is not a function</strong> (4 records): Dev crashes with a JS TypeError when attempting to expand ValueSets referencing CodeSystem <code>https://codesystem.x12.org/005010/1365</code>.</li></ol>\n<ol><li><strong>TerminologyError is not a constructor</strong> (4 records): Dev crashes with a JS TypeError when attempting to expand ValueSets referencing <code>http://terminology.hl7.org/CodeSystem/v2-0360|2.7</code>.</li></ol>\n<p>Additional differences in all 186 records:</p>\n<ul><li>HTTP status: prod=422, dev=500</li><li>Issue code: prod uses <code>invalid</code>, dev uses <code>business-rule</code></li><li>Dev includes <code>location: [null]</code> and <code>expression: [null]</code> (arrays containing null — invalid FHIR)</li><li>Dev omits the <code>text</code> narrative that prod includes</li></ul>\n<p>All 186 records are POST /r4/ValueSet/$expand with prod=422, dev=500. This accounts for all <code>dev-crash-on-error</code> records in the current delta set.</p>\n<p>Code systems involved in sub-pattern 1:</p>\n<ul><li><a href=\"http://hl7.org/fhir/sid/icd-9-cm\" target=\"_blank\">http://hl7.org/fhir/sid/icd-9-cm</a> (154 records)</li><li><a href=\"https://fhir.progyny.com/CodeSystem/identifier-type-cs\" target=\"_blank\">https://fhir.progyny.com/CodeSystem/identifier-type-cs</a> (24 records)</li></ul>\n<p>Search: <code>grep -c &#x27;contentMode()&#x27; results/deltas/deltas.ndjson</code> → 178<br>\nSearch: <code>grep &#x27;&quot;dev-crash-on-error&quot;&#x27; results/deltas/deltas.ndjson | wc -l</code> → 186</p>\n<p>Tolerance <code>expand-dev-crash-on-error</code> skips all records matching POST /r4/ValueSet/$expand with prod.status=422 and dev.status=500. Eliminates all 186 records.</p>", "impact": 186}, {"id": "b6d19d8", "title": "Dev omits system/code/version/display params on CodeSystem/$validate-code with codeableConcept containing unknown system", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-2", "round:2026-02-round-3", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-11 20:42", "date_iso": "2026-02-11T20:42:51-06:00", "body_md": "Records-Impacted: 171\nTolerance-ID: cc-validate-code-missing-known-coding-params, validate-code-xcaused-unknown-system-disagree\nRecord-ID: 84b0cee7-5f7e-4fbc-af8a-aed5ad7a91d4, 2e1dab4e-07c3-4a29-8bab-983289ba6a7d\n\n## Repro\n\n```bash\ncurl -s 'https://tx.fhir.org/r5/CodeSystem/$validate-code' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"codeableConcept\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.smartypower.app/CodeSystem/smartypower-cognitive-tests\",\"code\":\"SP-QUICKSTOP\",\"display\":\"QuickStop Response Inhibition Test\"},{\"system\":\"http://loinc.org\",\"code\":\"72106-8\",\"display\":\"Cognitive functioning [Interpretation]\"}],\"text\":\"Go/No-Go task measuring response inhibition and impulse control\"}},{\"name\":\"displayLanguage\",\"valueString\":\"en\"},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true}]}'\n\ncurl -s 'https://tx-dev.fhir.org/r5/CodeSystem/$validate-code' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"codeableConcept\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.smartypower.app/CodeSystem/smartypower-cognitive-tests\",\"code\":\"SP-QUICKSTOP\",\"display\":\"QuickStop Response Inhibition Test\"},{\"system\":\"http://loinc.org\",\"code\":\"72106-8\",\"display\":\"Cognitive functioning [Interpretation]\"}],\"text\":\"Go/No-Go task measuring response inhibition and impulse control\"}},{\"name\":\"displayLanguage\",\"valueString\":\"en\"},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true}]}'\n```\n\n## What differs\n\nWhen `$validate-code` is called with a CodeableConcept containing multiple codings and `result=false` on both sides, prod returns system/code/display params for the known coding while dev omits them. Additionally, when both sides disagree on which system is unknown, all downstream params (code, display, system, version, message, issues) diverge.\n\nThree sub-patterns:\n\n**Pattern 1: Same unknown system, dev omits known-coding params (155 records, tolerance `cc-validate-code-missing-known-coding-params`)**\n\nWhen the CodeableConcept contains one coding with an unknown system version and one coding from a known system (LOINC in 140 cases, SNOMED in 15), and both sides agree on the same `x-caused-by-unknown-system` value:\n- Prod validates the known coding and returns `system`, `code`, `display` params for it, plus any related informational OperationOutcome issues (e.g., display-language warnings)\n- Dev only returns `result=false` with the unknown-system error, omitting `system`/`code`/`display` params and the informational issues for the known coding entirely\n\nAll 155 records are POST `/r4/CodeSystem/$validate-code` (153 records) or `/r5/CodeSystem/$validate-code` (2 records). All involve multi-coding CodeableConcepts where one SNOMED CT edition version is unavailable on the server.\n\n**Pattern 2: Dev omits known-coding params with truly unknown system (5 records, also in tolerance `cc-validate-code-missing-known-coding-params`)**\n\nSame as Pattern 1, but the unknown system is a completely unrecognized CodeSystem URI (e.g., smartypower-cognitive-tests, el-observation-code-cs) rather than an unavailable version of a known system.\n\n**Pattern 3: x-caused-by-unknown-system disagrees (11 records, tolerance `validate-code-xcaused-unknown-system-disagree`)**\n\nWhen both sides encounter unknown system versions, they disagree on *which* system to report as unknown. Sub-patterns include LOINC/SNOMED version skew, missing x-caused-by-unknown-system, Cerner/RxNorm disagreements, and b-zion count mismatches.\n\n## Tolerance details\n\n- `cc-validate-code-missing-known-coding-params`: Matches validate-code with result=false, same x-caused-by-unknown-system on both sides, where prod has code/system params that dev lacks. Normalizes by copying prod's code/system/display params and issues to dev. Eliminates 155 records (round 3) + 5 records (round 2, Pattern 2).\n- `validate-code-xcaused-unknown-system-disagree`: Matches validate-code, both result=false, where x-caused-by-unknown-system values differ between sides. Normalizes by replacing dev's error-related params with prod's values. Eliminates 11 records. (round 3)\n\nTotal: 171 records impacted across both tolerances.\n\n## Representative records\n\n- 2e1dab4e-07c3-4a29-8bab-983289ba6a7d (Pattern 1: LOINC + SNOMED unknown version, /r4)\n- 84b0cee7-5f7e-4fbc-af8a-aed5ad7a91d4 (Pattern 2: LOINC + smartypower, /r5)\n- 6f70f14a-81e1-427e-9eed-1b2c53801296 (Pattern 2: SNOMED + essilorluxottica, /r4)\n- ebda357c-2153-47cc-800c-61aac44fedb2 (Pattern 3: LOINC/SNOMED version skew, /r4)\n- 64d09ecc-5a88-4173-889c-2cd0681a59fc (Pattern 3: b-zion count mismatch, /r4)", "body_html": "<p>Records-Impacted: 171<br>\nTolerance-ID: cc-validate-code-missing-known-coding-params, validate-code-xcaused-unknown-system-disagree<br>\nRecord-ID: 84b0cee7-5f7e-4fbc-af8a-aed5ad7a91d4, 2e1dab4e-07c3-4a29-8bab-983289ba6a7d</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r5/CodeSystem/$validate-code&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;codeableConcept&quot;,&quot;valueCodeableConcept&quot;:{&quot;coding&quot;:[{&quot;system&quot;:&quot;https://fhir.smartypower.app/CodeSystem/smartypower-cognitive-tests&quot;,&quot;code&quot;:&quot;SP-QUICKSTOP&quot;,&quot;display&quot;:&quot;QuickStop Response Inhibition Test&quot;},{&quot;system&quot;:&quot;http://loinc.org&quot;,&quot;code&quot;:&quot;72106-8&quot;,&quot;display&quot;:&quot;Cognitive functioning [Interpretation]&quot;}],&quot;text&quot;:&quot;Go/No-Go task measuring response inhibition and impulse control&quot;}},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueString&quot;:&quot;en&quot;},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true}]}&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r5/CodeSystem/$validate-code&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;codeableConcept&quot;,&quot;valueCodeableConcept&quot;:{&quot;coding&quot;:[{&quot;system&quot;:&quot;https://fhir.smartypower.app/CodeSystem/smartypower-cognitive-tests&quot;,&quot;code&quot;:&quot;SP-QUICKSTOP&quot;,&quot;display&quot;:&quot;QuickStop Response Inhibition Test&quot;},{&quot;system&quot;:&quot;http://loinc.org&quot;,&quot;code&quot;:&quot;72106-8&quot;,&quot;display&quot;:&quot;Cognitive functioning [Interpretation]&quot;}],&quot;text&quot;:&quot;Go/No-Go task measuring response inhibition and impulse control&quot;}},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueString&quot;:&quot;en&quot;},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true}]}&#x27;</code></pre>\n<h2>What differs</h2>\n<p>When <code>$validate-code</code> is called with a CodeableConcept containing multiple codings and <code>result=false</code> on both sides, prod returns system/code/display params for the known coding while dev omits them. Additionally, when both sides disagree on which system is unknown, all downstream params (code, display, system, version, message, issues) diverge.</p>\n<p>Three sub-patterns:</p>\n<p>**Pattern 1: Same unknown system, dev omits known-coding params (155 records, tolerance <code>cc-validate-code-missing-known-coding-params</code>)**</p>\n<p>When the CodeableConcept contains one coding with an unknown system version and one coding from a known system (LOINC in 140 cases, SNOMED in 15), and both sides agree on the same <code>x-caused-by-unknown-system</code> value:</p>\n<ul><li>Prod validates the known coding and returns <code>system</code>, <code>code</code>, <code>display</code> params for it, plus any related informational OperationOutcome issues (e.g., display-language warnings)</li><li>Dev only returns <code>result=false</code> with the unknown-system error, omitting <code>system</code>/<code>code</code>/<code>display</code> params and the informational issues for the known coding entirely</li></ul>\n<p>All 155 records are POST <code>/r4/CodeSystem/$validate-code</code> (153 records) or <code>/r5/CodeSystem/$validate-code</code> (2 records). All involve multi-coding CodeableConcepts where one SNOMED CT edition version is unavailable on the server.</p>\n<p>**Pattern 2: Dev omits known-coding params with truly unknown system (5 records, also in tolerance <code>cc-validate-code-missing-known-coding-params</code>)**</p>\n<p>Same as Pattern 1, but the unknown system is a completely unrecognized CodeSystem URI (e.g., smartypower-cognitive-tests, el-observation-code-cs) rather than an unavailable version of a known system.</p>\n<p>**Pattern 3: x-caused-by-unknown-system disagrees (11 records, tolerance <code>validate-code-xcaused-unknown-system-disagree</code>)**</p>\n<p>When both sides encounter unknown system versions, they disagree on <em>which</em> system to report as unknown. Sub-patterns include LOINC/SNOMED version skew, missing x-caused-by-unknown-system, Cerner/RxNorm disagreements, and b-zion count mismatches.</p>\n<h2>Tolerance details</h2>\n<ul><li><code>cc-validate-code-missing-known-coding-params</code>: Matches validate-code with result=false, same x-caused-by-unknown-system on both sides, where prod has code/system params that dev lacks. Normalizes by copying prod&#x27;s code/system/display params and issues to dev. Eliminates 155 records (round 3) + 5 records (round 2, Pattern 2).</li><li><code>validate-code-xcaused-unknown-system-disagree</code>: Matches validate-code, both result=false, where x-caused-by-unknown-system values differ between sides. Normalizes by replacing dev&#x27;s error-related params with prod&#x27;s values. Eliminates 11 records. (round 3)</li></ul>\n<p>Total: 171 records impacted across both tolerances.</p>\n<h2>Representative records</h2>\n<ul><li>2e1dab4e-07c3-4a29-8bab-983289ba6a7d (Pattern 1: LOINC + SNOMED unknown version, /r4)</li><li>84b0cee7-5f7e-4fbc-af8a-aed5ad7a91d4 (Pattern 2: LOINC + smartypower, /r5)</li><li>6f70f14a-81e1-427e-9eed-1b2c53801296 (Pattern 2: SNOMED + essilorluxottica, /r4)</li><li>ebda357c-2153-47cc-800c-61aac44fedb2 (Pattern 3: LOINC/SNOMED version skew, /r4)</li><li>64d09ecc-5a88-4173-889c-2cd0681a59fc (Pattern 3: b-zion count mismatch, /r4)</li></ul>", "impact": 171}, {"id": "7b694ba", "title": "validate-code: dev omits version params for secondary codings in multi-coding CodeableConcept responses", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-3", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-11 20:28", "date_iso": "2026-02-11T20:28:13-06:00", "body_md": "Records-Impacted: 148\nTolerance-ID: validate-code-missing-extra-version-params\nRecord-ID: 1f21c334-667f-4e2a-ae2c-6e73b8760cce\n\n## Repro\n\n```bash\n# Prod\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$validate-code' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"codeableConcept\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"http://loinc.org\",\"code\":\"85354-9\",\"display\":\"Blood pressure panel with all children optional\"},{\"system\":\"http://snomed.info/sct\",\"code\":\"75367002\",\"display\":\"Blood pressure (observable entity)\"}]}},{\"name\":\"displayLanguage\",\"valueString\":\"en-US\"},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true},{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"id\":\"observation-vitalsignresult\",\"meta\":{\"lastUpdated\":\"2019-11-01T09:29:23.356+11:00\",\"profile\":[\"http://hl7.org/fhir/StructureDefinition/shareablevalueset\"]},\"extension\":[{\"url\":\"http://hl7.org/fhir/StructureDefinition/structuredefinition-wg\",\"valueCode\":\"oo\"}],\"url\":\"http://hl7.org/fhir/ValueSet/observation-vitalsignresult\",\"identifier\":[{\"system\":\"urn:ietf:rfc:3986\",\"value\":\"urn:oid:2.16.840.1.113883.3.88.12.80.62\"}],\"version\":\"4.0.1\",\"name\":\"VitalSigns\",\"title\":\"Vital Signs\",\"status\":\"active\",\"experimental\":false,\"date\":\"2019-11-01T09:29:23+11:00\",\"publisher\":\"FHIR project team\",\"contact\":[{\"telecom\":[{\"system\":\"url\",\"value\":\"http://hl7.org/fhir\"}]}],\"description\":\"This value set indicates the allowed vital sign result types.\",\"copyright\":\"This content from LOINC is copyright 1995 Regenstrief Institute, Inc.\",\"compose\":{\"include\":[{\"system\":\"http://loinc.org\",\"concept\":[{\"code\":\"85353-1\"},{\"code\":\"9279-1\"},{\"code\":\"8867-4\"},{\"code\":\"2708-6\"},{\"code\":\"8310-5\"},{\"code\":\"8302-2\"},{\"code\":\"9843-4\"},{\"code\":\"29463-7\"},{\"code\":\"39156-5\"},{\"code\":\"85354-9\"},{\"code\":\"8480-6\"},{\"code\":\"8462-4\"},{\"code\":\"8478-0\"}]}]}}}]}'\n\n# Dev\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$validate-code' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"codeableConcept\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"http://loinc.org\",\"code\":\"85354-9\",\"display\":\"Blood pressure panel with all children optional\"},{\"system\":\"http://snomed.info/sct\",\"code\":\"75367002\",\"display\":\"Blood pressure (observable entity)\"}]}},{\"name\":\"displayLanguage\",\"valueString\":\"en-US\"},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true},{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"id\":\"observation-vitalsignresult\",\"meta\":{\"lastUpdated\":\"2019-11-01T09:29:23.356+11:00\",\"profile\":[\"http://hl7.org/fhir/StructureDefinition/shareablevalueset\"]},\"extension\":[{\"url\":\"http://hl7.org/fhir/StructureDefinition/structuredefinition-wg\",\"valueCode\":\"oo\"}],\"url\":\"http://hl7.org/fhir/ValueSet/observation-vitalsignresult\",\"identifier\":[{\"system\":\"urn:ietf:rfc:3986\",\"value\":\"urn:oid:2.16.840.1.113883.3.88.12.80.62\"}],\"version\":\"4.0.1\",\"name\":\"VitalSigns\",\"title\":\"Vital Signs\",\"status\":\"active\",\"experimental\":false,\"date\":\"2019-11-01T09:29:23+11:00\",\"publisher\":\"FHIR project team\",\"contact\":[{\"telecom\":[{\"system\":\"url\",\"value\":\"http://hl7.org/fhir\"}]}],\"description\":\"This value set indicates the allowed vital sign result types.\",\"copyright\":\"This content from LOINC is copyright 1995 Regenstrief Institute, Inc.\",\"compose\":{\"include\":[{\"system\":\"http://loinc.org\",\"concept\":[{\"code\":\"85353-1\"},{\"code\":\"9279-1\"},{\"code\":\"8867-4\"},{\"code\":\"2708-6\"},{\"code\":\"8310-5\"},{\"code\":\"8302-2\"},{\"code\":\"9843-4\"},{\"code\":\"29463-7\"},{\"code\":\"39156-5\"},{\"code\":\"85354-9\"},{\"code\":\"8480-6\"},{\"code\":\"8462-4\"},{\"code\":\"8478-0\"}]}]}}}]}'\n```\n\n**Prod** returns two `version` parameters:\n> `\"version\": \"http://snomed.info/sct/900000000000207008/version/20250201\"` (SNOMED CT)\n> `\"version\": \"2.81\"` (LOINC)\n\n**Dev** returns only one `version` parameter:\n> `\"version\": \"2.81\"` (LOINC only -- SNOMED version is missing)\n\n## What differs\n\nWhen $validate-code is called with a CodeableConcept containing multiple codings from different code systems, prod returns `version` parameters for all systems involved in validation, while dev returns fewer (typically only the primary system's version). For example:\n\n- **Request**: CodeableConcept with LOINC 85354-9 + SNOMED 75367002 against observation-vitalsignresult ValueSet\n- **Prod**: returns `version: \"2.81\"` (LOINC) AND `version: \"http://snomed.info/sct/900000000000207008/version/20250201\"` (SNOMED)\n- **Dev**: returns only `version: \"2.81\"` (LOINC), omitting the SNOMED version\n\nThe version parameter tells clients which code system edition was used during validation. Omitting it for secondary codings loses this provenance information.\n\nThis also affects single-coding and no-CodeableConcept cases on CodeSystem/$validate-code where dev returns 0 version params and prod returns 1, as well as cases with 3 vs 1 version params.\n\n## How widespread\n\n~459 records in comparison.ndjson have version count mismatch (prod > dev). Of these, 148 have version count as the sole remaining difference after the full tolerance pipeline — these are directly eliminated by this tolerance. The remaining ~311 records also have the version mismatch normalized but remain as deltas due to other differences (display text, message text, etc.).\n\nBreakdown by version count (raw):\n- prod=1 dev=0: 187 records\n- prod=2 dev=1: 119 records\n- prod=3 dev=1: 140 records\n\nBy request type:\n- Multi-coding CodeableConcept: 414 records\n- Single-coding CodeableConcept: 29 records\n- No CodeableConcept: 3 records (CodeSystem/$validate-code)\n\nFound via:\n```python\nprod_versions = [p for p in prod.parameter if p.name == 'version']\ndev_versions = [p for p in dev.parameter if p.name == 'version']\nif len(prod_versions) > len(dev_versions): count += 1\n```\n\n## What the tolerance covers\n\nTolerance ID: `validate-code-missing-extra-version-params`\nMatches validate-code records where prod has more `version` parameters than dev.\nNormalizes by adding the missing version values from prod to dev, then applying stable sort by name+value on both sides for consistent ordering.\nEliminates 148 records directly. Normalizes version params on ~311 additional records (reducing noise for other tolerance passes).", "body_html": "<p>Records-Impacted: 148<br>\nTolerance-ID: validate-code-missing-extra-version-params<br>\nRecord-ID: 1f21c334-667f-4e2a-ae2c-6e73b8760cce</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod\ncurl -s &#x27;https://tx.fhir.org/r4/ValueSet/$validate-code&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;codeableConcept&quot;,&quot;valueCodeableConcept&quot;:{&quot;coding&quot;:[{&quot;system&quot;:&quot;http://loinc.org&quot;,&quot;code&quot;:&quot;85354-9&quot;,&quot;display&quot;:&quot;Blood pressure panel with all children optional&quot;},{&quot;system&quot;:&quot;http://snomed.info/sct&quot;,&quot;code&quot;:&quot;75367002&quot;,&quot;display&quot;:&quot;Blood pressure (observable entity)&quot;}]}},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueString&quot;:&quot;en-US&quot;},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true},{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;id&quot;:&quot;observation-vitalsignresult&quot;,&quot;meta&quot;:{&quot;lastUpdated&quot;:&quot;2019-11-01T09:29:23.356+11:00&quot;,&quot;profile&quot;:[&quot;http://hl7.org/fhir/StructureDefinition/shareablevalueset&quot;]},&quot;extension&quot;:[{&quot;url&quot;:&quot;http://hl7.org/fhir/StructureDefinition/structuredefinition-wg&quot;,&quot;valueCode&quot;:&quot;oo&quot;}],&quot;url&quot;:&quot;http://hl7.org/fhir/ValueSet/observation-vitalsignresult&quot;,&quot;identifier&quot;:[{&quot;system&quot;:&quot;urn:ietf:rfc:3986&quot;,&quot;value&quot;:&quot;urn:oid:2.16.840.1.113883.3.88.12.80.62&quot;}],&quot;version&quot;:&quot;4.0.1&quot;,&quot;name&quot;:&quot;VitalSigns&quot;,&quot;title&quot;:&quot;Vital Signs&quot;,&quot;status&quot;:&quot;active&quot;,&quot;experimental&quot;:false,&quot;date&quot;:&quot;2019-11-01T09:29:23+11:00&quot;,&quot;publisher&quot;:&quot;FHIR project team&quot;,&quot;contact&quot;:[{&quot;telecom&quot;:[{&quot;system&quot;:&quot;url&quot;,&quot;value&quot;:&quot;http://hl7.org/fhir&quot;}]}],&quot;description&quot;:&quot;This value set indicates the allowed vital sign result types.&quot;,&quot;copyright&quot;:&quot;This content from LOINC is copyright 1995 Regenstrief Institute, Inc.&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;http://loinc.org&quot;,&quot;concept&quot;:[{&quot;code&quot;:&quot;85353-1&quot;},{&quot;code&quot;:&quot;9279-1&quot;},{&quot;code&quot;:&quot;8867-4&quot;},{&quot;code&quot;:&quot;2708-6&quot;},{&quot;code&quot;:&quot;8310-5&quot;},{&quot;code&quot;:&quot;8302-2&quot;},{&quot;code&quot;:&quot;9843-4&quot;},{&quot;code&quot;:&quot;29463-7&quot;},{&quot;code&quot;:&quot;39156-5&quot;},{&quot;code&quot;:&quot;85354-9&quot;},{&quot;code&quot;:&quot;8480-6&quot;},{&quot;code&quot;:&quot;8462-4&quot;},{&quot;code&quot;:&quot;8478-0&quot;}]}]}}}]}&#x27;\n\n# Dev\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$validate-code&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;codeableConcept&quot;,&quot;valueCodeableConcept&quot;:{&quot;coding&quot;:[{&quot;system&quot;:&quot;http://loinc.org&quot;,&quot;code&quot;:&quot;85354-9&quot;,&quot;display&quot;:&quot;Blood pressure panel with all children optional&quot;},{&quot;system&quot;:&quot;http://snomed.info/sct&quot;,&quot;code&quot;:&quot;75367002&quot;,&quot;display&quot;:&quot;Blood pressure (observable entity)&quot;}]}},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueString&quot;:&quot;en-US&quot;},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true},{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;id&quot;:&quot;observation-vitalsignresult&quot;,&quot;meta&quot;:{&quot;lastUpdated&quot;:&quot;2019-11-01T09:29:23.356+11:00&quot;,&quot;profile&quot;:[&quot;http://hl7.org/fhir/StructureDefinition/shareablevalueset&quot;]},&quot;extension&quot;:[{&quot;url&quot;:&quot;http://hl7.org/fhir/StructureDefinition/structuredefinition-wg&quot;,&quot;valueCode&quot;:&quot;oo&quot;}],&quot;url&quot;:&quot;http://hl7.org/fhir/ValueSet/observation-vitalsignresult&quot;,&quot;identifier&quot;:[{&quot;system&quot;:&quot;urn:ietf:rfc:3986&quot;,&quot;value&quot;:&quot;urn:oid:2.16.840.1.113883.3.88.12.80.62&quot;}],&quot;version&quot;:&quot;4.0.1&quot;,&quot;name&quot;:&quot;VitalSigns&quot;,&quot;title&quot;:&quot;Vital Signs&quot;,&quot;status&quot;:&quot;active&quot;,&quot;experimental&quot;:false,&quot;date&quot;:&quot;2019-11-01T09:29:23+11:00&quot;,&quot;publisher&quot;:&quot;FHIR project team&quot;,&quot;contact&quot;:[{&quot;telecom&quot;:[{&quot;system&quot;:&quot;url&quot;,&quot;value&quot;:&quot;http://hl7.org/fhir&quot;}]}],&quot;description&quot;:&quot;This value set indicates the allowed vital sign result types.&quot;,&quot;copyright&quot;:&quot;This content from LOINC is copyright 1995 Regenstrief Institute, Inc.&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;http://loinc.org&quot;,&quot;concept&quot;:[{&quot;code&quot;:&quot;85353-1&quot;},{&quot;code&quot;:&quot;9279-1&quot;},{&quot;code&quot;:&quot;8867-4&quot;},{&quot;code&quot;:&quot;2708-6&quot;},{&quot;code&quot;:&quot;8310-5&quot;},{&quot;code&quot;:&quot;8302-2&quot;},{&quot;code&quot;:&quot;9843-4&quot;},{&quot;code&quot;:&quot;29463-7&quot;},{&quot;code&quot;:&quot;39156-5&quot;},{&quot;code&quot;:&quot;85354-9&quot;},{&quot;code&quot;:&quot;8480-6&quot;},{&quot;code&quot;:&quot;8462-4&quot;},{&quot;code&quot;:&quot;8478-0&quot;}]}]}}}]}&#x27;</code></pre>\n<p><strong>Prod</strong> returns two <code>version</code> parameters:<br>\n&gt; <code>&quot;version&quot;: &quot;http://snomed.info/sct/900000000000207008/version/20250201&quot;</code> (SNOMED CT)<br>\n&gt; <code>&quot;version&quot;: &quot;2.81&quot;</code> (LOINC)</p>\n<p><strong>Dev</strong> returns only one <code>version</code> parameter:<br>\n&gt; <code>&quot;version&quot;: &quot;2.81&quot;</code> (LOINC only -- SNOMED version is missing)</p>\n<h2>What differs</h2>\n<p>When $validate-code is called with a CodeableConcept containing multiple codings from different code systems, prod returns <code>version</code> parameters for all systems involved in validation, while dev returns fewer (typically only the primary system&#x27;s version). For example:</p>\n<ul><li><strong>Request</strong>: CodeableConcept with LOINC 85354-9 + SNOMED 75367002 against observation-vitalsignresult ValueSet</li><li><strong>Prod</strong>: returns <code>version: &quot;2.81&quot;</code> (LOINC) AND <code>version: &quot;http://snomed.info/sct/900000000000207008/version/20250201&quot;</code> (SNOMED)</li><li><strong>Dev</strong>: returns only <code>version: &quot;2.81&quot;</code> (LOINC), omitting the SNOMED version</li></ul>\n<p>The version parameter tells clients which code system edition was used during validation. Omitting it for secondary codings loses this provenance information.</p>\n<p>This also affects single-coding and no-CodeableConcept cases on CodeSystem/$validate-code where dev returns 0 version params and prod returns 1, as well as cases with 3 vs 1 version params.</p>\n<h2>How widespread</h2>\n<p>~459 records in comparison.ndjson have version count mismatch (prod &gt; dev). Of these, 148 have version count as the sole remaining difference after the full tolerance pipeline — these are directly eliminated by this tolerance. The remaining ~311 records also have the version mismatch normalized but remain as deltas due to other differences (display text, message text, etc.).</p>\n<p>Breakdown by version count (raw):</p>\n<ul><li>prod=1 dev=0: 187 records</li><li>prod=2 dev=1: 119 records</li><li>prod=3 dev=1: 140 records</li></ul>\n<p>By request type:</p>\n<ul><li>Multi-coding CodeableConcept: 414 records</li><li>Single-coding CodeableConcept: 29 records</li><li>No CodeableConcept: 3 records (CodeSystem/$validate-code)</li></ul>\n<p>Found via:</p>\n<pre><code class=\"lang-python\">prod_versions = [p for p in prod.parameter if p.name == &#x27;version&#x27;]\ndev_versions = [p for p in dev.parameter if p.name == &#x27;version&#x27;]\nif len(prod_versions) &gt; len(dev_versions): count += 1</code></pre>\n<h2>What the tolerance covers</h2>\n<p>Tolerance ID: <code>validate-code-missing-extra-version-params</code><br>\nMatches validate-code records where prod has more <code>version</code> parameters than dev.<br>\nNormalizes by adding the missing version values from prod to dev, then applying stable sort by name+value on both sides for consistent ordering.<br>\nEliminates 148 records directly. Normalizes version params on ~311 additional records (reducing noise for other tolerance passes).</p>", "impact": 148}, {"id": "e4e45bc", "title": "Dev returns 200 instead of 422 for validate-code with code but no system parameter", "status": "open", "labels": ["reproduced", "round:2026-02-round-2", "status-mismatch", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 10:52", "date_iso": "2026-02-08T10:52:57-06:00", "body_md": "Records-Impacted: 133\nTolerance-ID: validate-code-no-system-422\nRecord-ID: 5ea323a9-073d-4ebf-b1ae-0a374b35c26d\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$validate-code?url=http%3A%2F%2Fterminology.hl7.org%2FValueSet%2FUSPS-State&code=TX&_format=json' \\\n  -H 'Accept: application/fhir+json'\n\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$validate-code?url=http%3A%2F%2Fterminology.hl7.org%2FValueSet%2FUSPS-State&code=TX&_format=json' \\\n  -H 'Accept: application/fhir+json'\n```\n\nProd returns HTTP 422 with OperationOutcome: \"Unable to find code to validate (looked for coding | codeableConcept | code+system | code+inferSystem in parameters ...)\". Dev returns HTTP 200 with Parameters containing `result=true`, `system=https://www.usps.com/`, `code=TX`, `display=Texas`.\n\n\nWhen $validate-code is called with `code` but no `system` parameter (and no `context`), prod returns HTTP 422 with an OperationOutcome error: \"Unable to find code to validate (looked for coding | codeableConcept | code+system | code+inferSystem in parameters ...)\". Dev returns HTTP 200 with a successful Parameters response, inferring the system from the ValueSet.\n\nPer the FHIR spec for ValueSet/$validate-code: \"If a code is provided, a system or a context must be provided.\" Prod correctly rejects these requests; dev incorrectly accepts them by inferring the system.\n\n\n133 records across 14 distinct request URLs, all sharing the same pattern:\n- GET /r4/ValueSet/$validate-code with `url=...&code=...` but no `system` parameter\n- One POST /r4/CodeSystem/$validate-code with only `code` in the Parameters body (no system)\n\nExamples include ValueSets for USPS-State, defined-types, iso3166-1-2, mimetypes, languages, administrative-gender, encounter-status, event-status, patient-contactrelationship, and a CTS ValueSet.\n\nFound via: `grep '\"status-mismatch\"' deltas.ndjson > /tmp/sm.ndjson` then filtering for prod.status=422, dev.status=200, op=validate-code.\n\n\nTolerance ID: `validate-code-no-system-422`. Matches validate-code records where prod returns 422 and dev returns 200, and the request has `code` but no `system` parameter (checked in both URL query params and POST request body). Eliminates 133 records.\n\n\n5ea323a9-073d-4ebf-b1ae-0a374b35c26d — GET /r4/ValueSet/$validate-code?url=http:%2F%2Fterminology.hl7.org%2FValueSet%2FUSPS-State&code=TX&_format=json", "body_html": "<p>Records-Impacted: 133<br>\nTolerance-ID: validate-code-no-system-422<br>\nRecord-ID: 5ea323a9-073d-4ebf-b1ae-0a374b35c26d</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/ValueSet/$validate-code?url=http%3A%2F%2Fterminology.hl7.org%2FValueSet%2FUSPS-State&amp;code=TX&amp;_format=json&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$validate-code?url=http%3A%2F%2Fterminology.hl7.org%2FValueSet%2FUSPS-State&amp;code=TX&amp;_format=json&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;</code></pre>\n<p>Prod returns HTTP 422 with OperationOutcome: &quot;Unable to find code to validate (looked for coding | codeableConcept | code+system | code+inferSystem in parameters ...)&quot;. Dev returns HTTP 200 with Parameters containing <code>result=true</code>, <code>system=https://www.usps.com/</code>, <code>code=TX</code>, <code>display=Texas</code>.</p>\n<p>When $validate-code is called with <code>code</code> but no <code>system</code> parameter (and no <code>context</code>), prod returns HTTP 422 with an OperationOutcome error: &quot;Unable to find code to validate (looked for coding | codeableConcept | code+system | code+inferSystem in parameters ...)&quot;. Dev returns HTTP 200 with a successful Parameters response, inferring the system from the ValueSet.</p>\n<p>Per the FHIR spec for ValueSet/$validate-code: &quot;If a code is provided, a system or a context must be provided.&quot; Prod correctly rejects these requests; dev incorrectly accepts them by inferring the system.</p>\n<p>133 records across 14 distinct request URLs, all sharing the same pattern:</p>\n<ul><li>GET /r4/ValueSet/$validate-code with <code>url=...&amp;code=...</code> but no <code>system</code> parameter</li><li>One POST /r4/CodeSystem/$validate-code with only <code>code</code> in the Parameters body (no system)</li></ul>\n<p>Examples include ValueSets for USPS-State, defined-types, iso3166-1-2, mimetypes, languages, administrative-gender, encounter-status, event-status, patient-contactrelationship, and a CTS ValueSet.</p>\n<p>Found via: <code>grep &#x27;&quot;status-mismatch&quot;&#x27; deltas.ndjson &gt; /tmp/sm.ndjson</code> then filtering for prod.status=422, dev.status=200, op=validate-code.</p>\n<p>Tolerance ID: <code>validate-code-no-system-422</code>. Matches validate-code records where prod returns 422 and dev returns 200, and the request has <code>code</code> but no <code>system</code> parameter (checked in both URL query params and POST request body). Eliminates 133 records.</p>\n<p>5ea323a9-073d-4ebf-b1ae-0a374b35c26d — GET /r4/ValueSet/$validate-code?url=http:%2F%2Fterminology.hl7.org%2FValueSet%2FUSPS-State&amp;code=TX&amp;_format=json</p>", "impact": 133}, {"id": "2938dc7", "title": "POST -code: dev returns result=false due to undefined system in request body extraction", "status": "open", "labels": ["repro-inconclusive", "result-disagrees", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:37", "date_iso": "2026-02-08T13:37:59-06:00", "body_md": "Records-Impacted: 89\nTolerance-ID: validate-code-undefined-system-result-disagrees\nRecord-ID: a27be88a-8e1e-4ce8-8167-af0515f294d3\n\n\n**Attempt 1** — CodeSystem/$validate-code with SNOMED 26643006:\n```bash\ncurl -s 'https://tx.fhir.org/r4/CodeSystem/$validate-code' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"system\",\"valueUri\":\"http://snomed.info/sct\"},{\"name\":\"code\",\"valueCode\":\"26643006\"},{\"name\":\"display\",\"valueString\":\"oral\"},{\"name\":\"displayLanguage\",\"valueCode\":\"en-US\"},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true}]}'\n\ncurl -s 'https://tx-dev.fhir.org/r4/CodeSystem/$validate-code' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"system\",\"valueUri\":\"http://snomed.info/sct\"},{\"name\":\"code\",\"valueCode\":\"26643006\"},{\"name\":\"display\",\"valueString\":\"oral\"},{\"name\":\"displayLanguage\",\"valueCode\":\"en-US\"},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true}]}'\n```\nResult: Both servers now return `result: true`. Bug no longer reproduces on this endpoint.\n\n**Attempt 2** — ValueSet/$validate-code with LOINC 8302-2 against vital signs ValueSet:\n```bash\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$validate-code' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/ValueSet/observation-vitalsignresult\"},{\"name\":\"system\",\"valueUri\":\"http://loinc.org\"},{\"name\":\"code\",\"valueCode\":\"8302-2\"},{\"name\":\"display\",\"valueString\":\"Body height\"},{\"name\":\"displayLanguage\",\"valueCode\":\"en-US\"},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true}]}'\n\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$validate-code' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/ValueSet/observation-vitalsignresult\"},{\"name\":\"system\",\"valueUri\":\"http://loinc.org\"},{\"name\":\"code\",\"valueCode\":\"8302-2\"},{\"name\":\"display\",\"valueString\":\"Body height\"},{\"name\":\"displayLanguage\",\"valueCode\":\"en-US\"},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true}]}'\n```\nResult: Both servers now return `result: true`. Bug no longer reproduces on this endpoint.\n\n**Attempt 3** — ValueSet/$validate-code with SNOMED 116154003 against CTS ValueSet:\n```bash\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$validate-code' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1099.30\"},{\"name\":\"valueSetVersion\",\"valueString\":\"20190418\"},{\"name\":\"codeableConcept\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"http://snomed.info/sct\",\"code\":\"116154003\",\"display\":\"Patient (person)\"}],\"text\":\"Patient\"}},{\"name\":\"displayLanguage\",\"valueCode\":\"en-US\"},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true}]}'\n\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$validate-code' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1099.30\"},{\"name\":\"valueSetVersion\",\"valueString\":\"20190418\"},{\"name\":\"codeableConcept\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"http://snomed.info/sct\",\"code\":\"116154003\",\"display\":\"Patient (person)\"}],\"text\":\"Patient\"}},{\"name\":\"displayLanguage\",\"valueCode\":\"en-US\"},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true}]}'\n```\nResult: Prod returns `result: true`, dev returns `result: false`. Dev's error message ends with \"and undefined\" in the valid SNOMED versions list, confirming the \"undefined\" leak persists in dev's internal data. However, the primary failure is a SNOMED US Edition version mismatch (dev looks for version `20250301` which it doesn't have), so this is not a clean repro of the POST body extraction bug specifically.\n\n**Conclusion**: The original bug (system=undefined in POST body extraction causing result=false) no longer reproduces on simple CodeSystem and ValueSet endpoints. Dev may have partially fixed the POST body parameter extraction. However, \"undefined\" still appears in dev's valid-versions list, suggesting residual issues. The original IPS ValueSets (medication-uv-ips, results-laboratory-pathology-observations-uv-ips) used by the 89 affected records are no longer available on either server.\n\n\nDev returns `result: false` on POST $validate-code requests where prod returns `result: true`. Dev's diagnostics reveal the system URI is \"undefined\" during validation:\n\n- Validate trace shows: `Validate \"[undefined#CODE (...)]\"` instead of `[http://snomed.info/sct#CODE (...)]`\n- ValueSet include filters show as empty `()` instead of actual SNOMED/LOINC filter expressions (e.g. `(http://snomed.info/sct)(concept<763158003)`)\n- CodeSystem/$validate-code returns \"Unknown code 'undefined' in the CodeSystem ...\" for 14 LOINC records\n\nBoth servers use the same SNOMED/LOINC editions (version strings match). Prod correctly validates the codes; dev fails to extract the system parameter from the POST request body and receives it as JavaScript `undefined`.\n\n\n89 result-disagrees records, ALL with prodResult=true and devResult=false:\n\n- 74 POST /r4/ValueSet/$validate-code (42 IPS lab results, 15 @all, 9 VSAC, 7 CTS medication, 6 IPS procedures, 3 IPS medication, 2 CTS medication v2)\n- 15 POST /r4/CodeSystem/$validate-code (14 LOINC property components, 1 SNOMED with display validation)\n\nCode systems affected: LOINC (56), SNOMED (24), RxNorm (9).\n\nSearch used: `grep 'result-disagrees' results/deltas/deltas.ndjson > /tmp/result-disagrees.ndjson` then analyzed by URL, system, and ValueSet.\n\nAll 89 records show \"undefined\" in dev diagnostics trace.\n\nRelated to bug 4cdcd85 which covers the crash (500) variant of the same root cause — dev fails to extract system/code from POST body. These 89 records are the non-crash variant where dev returns 200 but with wrong result.\n\n\nTolerance `validate-code-undefined-system-result-disagrees` matches POST $validate-code records where prod result=true, dev result=false, and dev diagnostics contain the literal string \"undefined\". This covers all 89 records.\n\n\n`a27be88a-8e1e-4ce8-8167-af0515f294d3` — POST /r4/ValueSet/$validate-code, SNOMED 48546005 in IPS medication ValueSet. Prod: result=true, display=\"Product containing diazepam (medicinal product)\". Dev: result=false, \"No valid coding was found for the value set\".", "body_html": "<p>Records-Impacted: 89<br>\nTolerance-ID: validate-code-undefined-system-result-disagrees<br>\nRecord-ID: a27be88a-8e1e-4ce8-8167-af0515f294d3</p>\n<p><strong>Attempt 1</strong> — CodeSystem/$validate-code with SNOMED 26643006:</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/CodeSystem/$validate-code&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;system&quot;,&quot;valueUri&quot;:&quot;http://snomed.info/sct&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;26643006&quot;},{&quot;name&quot;:&quot;display&quot;,&quot;valueString&quot;:&quot;oral&quot;},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueCode&quot;:&quot;en-US&quot;},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true}]}&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/CodeSystem/$validate-code&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;system&quot;,&quot;valueUri&quot;:&quot;http://snomed.info/sct&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;26643006&quot;},{&quot;name&quot;:&quot;display&quot;,&quot;valueString&quot;:&quot;oral&quot;},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueCode&quot;:&quot;en-US&quot;},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true}]}&#x27;</code></pre>\n<p>Result: Both servers now return <code>result: true</code>. Bug no longer reproduces on this endpoint.</p>\n<p><strong>Attempt 2</strong> — ValueSet/$validate-code with LOINC 8302-2 against vital signs ValueSet:</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/ValueSet/$validate-code&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/ValueSet/observation-vitalsignresult&quot;},{&quot;name&quot;:&quot;system&quot;,&quot;valueUri&quot;:&quot;http://loinc.org&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;8302-2&quot;},{&quot;name&quot;:&quot;display&quot;,&quot;valueString&quot;:&quot;Body height&quot;},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueCode&quot;:&quot;en-US&quot;},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true}]}&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$validate-code&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/ValueSet/observation-vitalsignresult&quot;},{&quot;name&quot;:&quot;system&quot;,&quot;valueUri&quot;:&quot;http://loinc.org&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;8302-2&quot;},{&quot;name&quot;:&quot;display&quot;,&quot;valueString&quot;:&quot;Body height&quot;},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueCode&quot;:&quot;en-US&quot;},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true}]}&#x27;</code></pre>\n<p>Result: Both servers now return <code>result: true</code>. Bug no longer reproduces on this endpoint.</p>\n<p><strong>Attempt 3</strong> — ValueSet/$validate-code with SNOMED 116154003 against CTS ValueSet:</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/ValueSet/$validate-code&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1099.30&quot;},{&quot;name&quot;:&quot;valueSetVersion&quot;,&quot;valueString&quot;:&quot;20190418&quot;},{&quot;name&quot;:&quot;codeableConcept&quot;,&quot;valueCodeableConcept&quot;:{&quot;coding&quot;:[{&quot;system&quot;:&quot;http://snomed.info/sct&quot;,&quot;code&quot;:&quot;116154003&quot;,&quot;display&quot;:&quot;Patient (person)&quot;}],&quot;text&quot;:&quot;Patient&quot;}},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueCode&quot;:&quot;en-US&quot;},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true}]}&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$validate-code&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1099.30&quot;},{&quot;name&quot;:&quot;valueSetVersion&quot;,&quot;valueString&quot;:&quot;20190418&quot;},{&quot;name&quot;:&quot;codeableConcept&quot;,&quot;valueCodeableConcept&quot;:{&quot;coding&quot;:[{&quot;system&quot;:&quot;http://snomed.info/sct&quot;,&quot;code&quot;:&quot;116154003&quot;,&quot;display&quot;:&quot;Patient (person)&quot;}],&quot;text&quot;:&quot;Patient&quot;}},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueCode&quot;:&quot;en-US&quot;},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true}]}&#x27;</code></pre>\n<p>Result: Prod returns <code>result: true</code>, dev returns <code>result: false</code>. Dev&#x27;s error message ends with &quot;and undefined&quot; in the valid SNOMED versions list, confirming the &quot;undefined&quot; leak persists in dev&#x27;s internal data. However, the primary failure is a SNOMED US Edition version mismatch (dev looks for version <code>20250301</code> which it doesn&#x27;t have), so this is not a clean repro of the POST body extraction bug specifically.</p>\n<p><strong>Conclusion</strong>: The original bug (system=undefined in POST body extraction causing result=false) no longer reproduces on simple CodeSystem and ValueSet endpoints. Dev may have partially fixed the POST body parameter extraction. However, &quot;undefined&quot; still appears in dev&#x27;s valid-versions list, suggesting residual issues. The original IPS ValueSets (medication-uv-ips, results-laboratory-pathology-observations-uv-ips) used by the 89 affected records are no longer available on either server.</p>\n<p>Dev returns <code>result: false</code> on POST $validate-code requests where prod returns <code>result: true</code>. Dev&#x27;s diagnostics reveal the system URI is &quot;undefined&quot; during validation:</p>\n<ul><li>Validate trace shows: <code>Validate &quot;[undefined#CODE (...)]&quot;</code> instead of <code>[http://snomed.info/sct#CODE (...)]</code></li><li>ValueSet include filters show as empty <code>()</code> instead of actual SNOMED/LOINC filter expressions (e.g. <code>(http://snomed.info/sct)(concept&lt;763158003)</code>)</li><li>CodeSystem/$validate-code returns &quot;Unknown code &#x27;undefined&#x27; in the CodeSystem ...&quot; for 14 LOINC records</li></ul>\n<p>Both servers use the same SNOMED/LOINC editions (version strings match). Prod correctly validates the codes; dev fails to extract the system parameter from the POST request body and receives it as JavaScript <code>undefined</code>.</p>\n<p>89 result-disagrees records, ALL with prodResult=true and devResult=false:</p>\n<ul><li>74 POST /r4/ValueSet/$validate-code (42 IPS lab results, 15 @all, 9 VSAC, 7 CTS medication, 6 IPS procedures, 3 IPS medication, 2 CTS medication v2)</li><li>15 POST /r4/CodeSystem/$validate-code (14 LOINC property components, 1 SNOMED with display validation)</li></ul>\n<p>Code systems affected: LOINC (56), SNOMED (24), RxNorm (9).</p>\n<p>Search used: <code>grep &#x27;result-disagrees&#x27; results/deltas/deltas.ndjson &gt; /tmp/result-disagrees.ndjson</code> then analyzed by URL, system, and ValueSet.</p>\n<p>All 89 records show &quot;undefined&quot; in dev diagnostics trace.</p>\n<p>Related to bug 4cdcd85 which covers the crash (500) variant of the same root cause — dev fails to extract system/code from POST body. These 89 records are the non-crash variant where dev returns 200 but with wrong result.</p>\n<p>Tolerance <code>validate-code-undefined-system-result-disagrees</code> matches POST $validate-code records where prod result=true, dev result=false, and dev diagnostics contain the literal string &quot;undefined&quot;. This covers all 89 records.</p>\n<p><code>a27be88a-8e1e-4ce8-8167-af0515f294d3</code> — POST /r4/ValueSet/$validate-code, SNOMED 48546005 in IPS medication ValueSet. Prod: result=true, display=&quot;Product containing diazepam (medicinal product)&quot;. Dev: result=false, &quot;No valid coding was found for the value set&quot;.</p>", "impact": 89}, {"id": "3103b01", "title": "Dev returns extra informational HGVS syntax issue in $validate-code for varnomen.hgvs.org", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-2", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 10:52", "date_iso": "2026-02-08T10:52:56-06:00", "body_md": "Records-Impacted: 62\nTolerance-ID: hgvs-extra-syntax-issue\nRecord-ID: cdf72565-a646-4daa-86f9-ed5ead0058d6\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/CodeSystem/$validate-code' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"coding\",\"valueCoding\":{\"system\":\"http://varnomen.hgvs.org\",\"code\":\"NC_000003.11\"}},{\"name\":\"displayLanguage\",\"valueString\":\"en-GB\"},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true}]}'\n\ncurl -s 'https://tx-dev.fhir.org/r4/CodeSystem/$validate-code' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"coding\",\"valueCoding\":{\"system\":\"http://varnomen.hgvs.org\",\"code\":\"NC_000003.11\"}},{\"name\":\"displayLanguage\",\"valueString\":\"en-GB\"},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true}]}'\n```\n\nProd returns 1 OperationOutcome issue (error-level only), dev returns 2 issues (error-level plus an additional informational-level issue with text: \"Error while processing 'NC_000003.11': Missing one of 'c', 'g', 'm', 'n', 'p', 'r' followed by '.'.\")\n\n\nFor $validate-code operations against http://varnomen.hgvs.org, both prod and dev correctly return result=false for invalid HGVS codes. Both return the same error-level OperationOutcome issue (\"Unknown code 'X' in the CodeSystem 'http://varnomen.hgvs.org' version '2.0'\").\n\nHowever, dev returns an additional informational-level OperationOutcome issue that prod does not:\n\n- severity: \"information\"\n- code: \"code-invalid\"\n- text: \"Error while processing '<code>': Missing one of 'c', 'g', 'm', 'n', 'p', 'r' followed by '.'.\"\n\nThis appears to be HGVS-specific syntax validation feedback that dev performs but prod does not.\n\n\n62 records in content-differs category show this exact pattern. All involve $validate-code POST to /r4/CodeSystem/$validate-code? with system http://varnomen.hgvs.org. All have the same extra informational issue text pattern (\"Missing one of 'c', 'g', 'm', 'n', 'p', 'r' followed by '.'\").\n\nSearch: grep -c \"Missing one of\" results/deltas/deltas.ndjson => 62\n\n\nTolerance ID: hgvs-extra-syntax-issue. Matches $validate-code records for http://varnomen.hgvs.org where dev has more OperationOutcome issues than prod, and the extra issues are informational-level. Normalizes by trimming dev's issue list to match prod's length. Eliminates 62 records.\n\n\ncdf72565-a646-4daa-86f9-ed5ead0058d6\n\n## Root Cause\n\n**Classification**: code-level defect\n\n**Dev** adds an extra informational issue from the `locate()` message when a code is not found:\n[`tx/workers/validate.js#L1506-L1508`](https://github.com/HealthIntersections/FHIRsmith/blob/6440990b4d0f5ca87b48093bad6ac2868067a49e/tx/workers/validate.js#L1506-L1508)\n— In `checkConceptSet`, after adding the `Unknown_Code_in_Version` error, dev checks `if (loc.message && op)` and adds an informational issue with the message returned by the HGVS provider's `locate()` method.\n\n**Dev HGVS provider** passes the NLM service error message through as `loc.message`:\n[`tx/cs/cs-hgvs.js#L111-L115`](https://github.com/HealthIntersections/FHIRsmith/blob/6440990b4d0f5ca87b48093bad6ac2868067a49e/tx/cs/cs-hgvs.js#L111-L115)\n— When the NLM `$validate-code` returns `result=false`, the HGVS syntax error message (e.g., \"Missing one of 'c', 'g', 'm', 'n', 'p', 'r' followed by '.'\") is returned as `{ context: null, message: result.message }`.\n\n**Prod** does not add informational issues from the `locate()` message:\n[`library/ftx/fhir_valuesets.pas#L2273-L2281`](https://github.com/HealthIntersections/fhirserver/blob/ec46dff3fe631ddeeaa000a3ca9530e0dd8c9eac/library/ftx/fhir_valuesets.pas#L2273-L2281)\n— In `checkConceptSet`, when `loc = nil`, prod only adds the `Unknown_Code_in_Version` error issue. There is no code to emit the `message` var as an additional informational issue. (Additionally, the prod HGVS `locate` at [`server/tx/tx_hgvs.pas#L252-L253`](https://github.com/HealthIntersections/fhirserver/blob/ec46dff3fe631ddeeaa000a3ca9530e0dd8c9eac/server/tx/tx_hgvs.pas#L252-L253) reads `o.str['message']` instead of `o.str['valueString']`, so the NLM error message is never captured regardless.)\n\n**Fix**: Remove the informational issue emission in `tx/workers/validate.js` lines 1506-1508, or gate it behind a condition that matches prod behavior. The `loc.message` from `locate()` should not be surfaced as a separate OperationOutcome issue since prod does not emit it.", "body_html": "<p>Records-Impacted: 62<br>\nTolerance-ID: hgvs-extra-syntax-issue<br>\nRecord-ID: cdf72565-a646-4daa-86f9-ed5ead0058d6</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/CodeSystem/$validate-code&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;coding&quot;,&quot;valueCoding&quot;:{&quot;system&quot;:&quot;http://varnomen.hgvs.org&quot;,&quot;code&quot;:&quot;NC_000003.11&quot;}},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueString&quot;:&quot;en-GB&quot;},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true}]}&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/CodeSystem/$validate-code&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;coding&quot;,&quot;valueCoding&quot;:{&quot;system&quot;:&quot;http://varnomen.hgvs.org&quot;,&quot;code&quot;:&quot;NC_000003.11&quot;}},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueString&quot;:&quot;en-GB&quot;},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true}]}&#x27;</code></pre>\n<p>Prod returns 1 OperationOutcome issue (error-level only), dev returns 2 issues (error-level plus an additional informational-level issue with text: &quot;Error while processing &#x27;NC_000003.11&#x27;: Missing one of &#x27;c&#x27;, &#x27;g&#x27;, &#x27;m&#x27;, &#x27;n&#x27;, &#x27;p&#x27;, &#x27;r&#x27; followed by &#x27;.&#x27;.&quot;)</p>\n<p>For $validate-code operations against <a href=\"http://varnomen.hgvs.org,\" target=\"_blank\">http://varnomen.hgvs.org,</a> both prod and dev correctly return result=false for invalid HGVS codes. Both return the same error-level OperationOutcome issue (&quot;Unknown code &#x27;X&#x27; in the CodeSystem &#x27;<a href=\"http://varnomen.hgvs.org&#x27;\" target=\"_blank\">http://varnomen.hgvs.org&#x27;</a> version &#x27;2.0&#x27;&quot;).</p>\n<p>However, dev returns an additional informational-level OperationOutcome issue that prod does not:</p>\n<ul><li>severity: &quot;information&quot;</li><li>code: &quot;code-invalid&quot;</li><li>text: &quot;Error while processing &#x27;&lt;code&gt;&#x27;: Missing one of &#x27;c&#x27;, &#x27;g&#x27;, &#x27;m&#x27;, &#x27;n&#x27;, &#x27;p&#x27;, &#x27;r&#x27; followed by &#x27;.&#x27;.&quot;</li></ul>\n<p>This appears to be HGVS-specific syntax validation feedback that dev performs but prod does not.</p>\n<p>62 records in content-differs category show this exact pattern. All involve $validate-code POST to /r4/CodeSystem/$validate-code? with system <a href=\"http://varnomen.hgvs.org.\" target=\"_blank\">http://varnomen.hgvs.org.</a> All have the same extra informational issue text pattern (&quot;Missing one of &#x27;c&#x27;, &#x27;g&#x27;, &#x27;m&#x27;, &#x27;n&#x27;, &#x27;p&#x27;, &#x27;r&#x27; followed by &#x27;.&#x27;&quot;).</p>\n<p>Search: grep -c &quot;Missing one of&quot; results/deltas/deltas.ndjson =&gt; 62</p>\n<p>Tolerance ID: hgvs-extra-syntax-issue. Matches $validate-code records for <a href=\"http://varnomen.hgvs.org\" target=\"_blank\">http://varnomen.hgvs.org</a> where dev has more OperationOutcome issues than prod, and the extra issues are informational-level. Normalizes by trimming dev&#x27;s issue list to match prod&#x27;s length. Eliminates 62 records.</p>\n<p>cdf72565-a646-4daa-86f9-ed5ead0058d6</p>\n<h2>Root Cause</h2>\n<p><strong>Classification</strong>: code-level defect</p>\n<p><strong>Dev</strong> adds an extra informational issue from the <code>locate()</code> message when a code is not found:<br>\n<a href=\"https://github.com/HealthIntersections/FHIRsmith/blob/6440990b4d0f5ca87b48093bad6ac2868067a49e/tx/workers/validate.js#L1506-L1508\" target=\"_blank\"><code>tx/workers/validate.js#L1506-L1508</code></a><br>\n— In <code>checkConceptSet</code>, after adding the <code>Unknown_Code_in_Version</code> error, dev checks <code>if (loc.message &amp;&amp; op)</code> and adds an informational issue with the message returned by the HGVS provider&#x27;s <code>locate()</code> method.</p>\n<p><strong>Dev HGVS provider</strong> passes the NLM service error message through as <code>loc.message</code>:<br>\n<a href=\"https://github.com/HealthIntersections/FHIRsmith/blob/6440990b4d0f5ca87b48093bad6ac2868067a49e/tx/cs/cs-hgvs.js#L111-L115\" target=\"_blank\"><code>tx/cs/cs-hgvs.js#L111-L115</code></a><br>\n— When the NLM <code>$validate-code</code> returns <code>result=false</code>, the HGVS syntax error message (e.g., &quot;Missing one of &#x27;c&#x27;, &#x27;g&#x27;, &#x27;m&#x27;, &#x27;n&#x27;, &#x27;p&#x27;, &#x27;r&#x27; followed by &#x27;.&#x27;&quot;) is returned as <code>{ context: null, message: result.message }</code>.</p>\n<p><strong>Prod</strong> does not add informational issues from the <code>locate()</code> message:<br>\n<a href=\"https://github.com/HealthIntersections/fhirserver/blob/ec46dff3fe631ddeeaa000a3ca9530e0dd8c9eac/library/ftx/fhir_valuesets.pas#L2273-L2281\" target=\"_blank\"><code>library/ftx/fhir_valuesets.pas#L2273-L2281</code></a><br>\n— In <code>checkConceptSet</code>, when <code>loc = nil</code>, prod only adds the <code>Unknown_Code_in_Version</code> error issue. There is no code to emit the <code>message</code> var as an additional informational issue. (Additionally, the prod HGVS <code>locate</code> at <a href=\"https://github.com/HealthIntersections/fhirserver/blob/ec46dff3fe631ddeeaa000a3ca9530e0dd8c9eac/server/tx/tx_hgvs.pas#L252-L253\" target=\"_blank\"><code>server/tx/tx_hgvs.pas#L252-L253</code></a> reads <code>o.str[&#x27;message&#x27;]</code> instead of <code>o.str[&#x27;valueString&#x27;]</code>, so the NLM error message is never captured regardless.)</p>\n<p><strong>Fix</strong>: Remove the informational issue emission in <code>tx/workers/validate.js</code> lines 1506-1508, or gate it behind a condition that matches prod behavior. The <code>loc.message</code> from <code>locate()</code> should not be surfaced as a separate OperationOutcome issue since prod does not emit it.</p>", "impact": 62}, {"id": "e02b03e", "title": "Prod HGVS timeout: 62 records have prod=500 due to external service timeout, comparison invalid", "status": "open", "labels": ["config-issue", "reproduced", "round:2026-02-round-2", "status-mismatch", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 10:52", "date_iso": "2026-02-08T10:52:57-06:00", "body_md": "Records-Impacted: 62\nTolerance-ID: skip-prod-hgvs-timeout\nRecord-ID: 286d30a9-e2b8-4967-8c56-265b3f6160a6\n\n\n```bash\ncurl -s https://tx.fhir.org/r4/CodeSystem/'$validate-code' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"coding\",\"valueCoding\":{\"system\":\"http://varnomen.hgvs.org\",\"code\":\"BRCA1:c.3143delG p.(Gly1048ValfsTer14)\"}},{\"name\":\"displayLanguage\",\"valueString\":\"en-GB\"},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true},{\"name\":\"cache-id\",\"valueId\":\"7743c2e6-5b90-4b62-bcd2-6695b993e76b\"},{\"name\":\"system-version\",\"valueUri\":\"http://snomed.info/sct|http://snomed.info/sct/83821000000107\"},{\"name\":\"diagnostics\",\"valueBoolean\":true}]}'\n\ncurl -s https://tx-dev.fhir.org/r4/CodeSystem/'$validate-code' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"coding\",\"valueCoding\":{\"system\":\"http://varnomen.hgvs.org\",\"code\":\"BRCA1:c.3143delG p.(Gly1048ValfsTer14)\"}},{\"name\":\"displayLanguage\",\"valueString\":\"en-GB\"},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true},{\"name\":\"cache-id\",\"valueId\":\"7743c2e6-5b90-4b62-bcd2-6695b993e76b\"},{\"name\":\"system-version\",\"valueUri\":\"http://snomed.info/sct|http://snomed.info/sct/83821000000107\"},{\"name\":\"diagnostics\",\"valueBoolean\":true}]}'\n```\n\nProd returns HTTP 500 with OperationOutcome: \"Error parsing HGVS response: Read timed out.\" Dev returns HTTP 200 with Parameters: result=false, indicating the HGVS code is unknown.\n\n\nProd returns HTTP 500 with an OperationOutcome error: \"Error parsing HGVS response: Read timed out.\" Dev returns HTTP 200 with a proper Parameters response (result=false, code not found in http://varnomen.hgvs.org version 2.0).\n\nProd's 500 is a transient failure — the prod server timed out calling an external HGVS validation service during data collection. Dev processes the same code locally and returns a valid terminology response.\n\n\n62 records in the comparison dataset. All share:\n- System: http://varnomen.hgvs.org\n- Operation: $validate-code (POST /r4/CodeSystem/$validate-code?)\n- Status: prod=500, dev=200\n- Category: status-mismatch\n- Prod body contains \"Error parsing HGVS response: Read timed out.\"\n\nSearch: `grep -c 'Read timed out' results/deltas/deltas.ndjson` → 62\n\nThere are 124 total HGVS records in the dataset; the other 62 did not timeout and have prod=200, dev=200.\n\n\nTolerance `skip-prod-hgvs-timeout` skips any record where prod returned 500 and the prod body contains \"Read timed out\". These records have unreliable comparison data since prod failed to complete the operation. Eliminates 62 records.\n\n\n286d30a9-e2b8-4967-8c56-265b3f6160a6\n\nThis is a data collection artifact — the comparison data is tainted because prod experienced transient external service timeouts during the collection run. These records should be recollected in a future run.", "body_html": "<p>Records-Impacted: 62<br>\nTolerance-ID: skip-prod-hgvs-timeout<br>\nRecord-ID: 286d30a9-e2b8-4967-8c56-265b3f6160a6</p>\n<pre><code class=\"lang-bash\">curl -s https://tx.fhir.org/r4/CodeSystem/&#x27;$validate-code&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;coding&quot;,&quot;valueCoding&quot;:{&quot;system&quot;:&quot;http://varnomen.hgvs.org&quot;,&quot;code&quot;:&quot;BRCA1:c.3143delG p.(Gly1048ValfsTer14)&quot;}},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueString&quot;:&quot;en-GB&quot;},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true},{&quot;name&quot;:&quot;cache-id&quot;,&quot;valueId&quot;:&quot;7743c2e6-5b90-4b62-bcd2-6695b993e76b&quot;},{&quot;name&quot;:&quot;system-version&quot;,&quot;valueUri&quot;:&quot;http://snomed.info/sct|http://snomed.info/sct/83821000000107&quot;},{&quot;name&quot;:&quot;diagnostics&quot;,&quot;valueBoolean&quot;:true}]}&#x27;\n\ncurl -s https://tx-dev.fhir.org/r4/CodeSystem/&#x27;$validate-code&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;coding&quot;,&quot;valueCoding&quot;:{&quot;system&quot;:&quot;http://varnomen.hgvs.org&quot;,&quot;code&quot;:&quot;BRCA1:c.3143delG p.(Gly1048ValfsTer14)&quot;}},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueString&quot;:&quot;en-GB&quot;},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true},{&quot;name&quot;:&quot;cache-id&quot;,&quot;valueId&quot;:&quot;7743c2e6-5b90-4b62-bcd2-6695b993e76b&quot;},{&quot;name&quot;:&quot;system-version&quot;,&quot;valueUri&quot;:&quot;http://snomed.info/sct|http://snomed.info/sct/83821000000107&quot;},{&quot;name&quot;:&quot;diagnostics&quot;,&quot;valueBoolean&quot;:true}]}&#x27;</code></pre>\n<p>Prod returns HTTP 500 with OperationOutcome: &quot;Error parsing HGVS response: Read timed out.&quot; Dev returns HTTP 200 with Parameters: result=false, indicating the HGVS code is unknown.</p>\n<p>Prod returns HTTP 500 with an OperationOutcome error: &quot;Error parsing HGVS response: Read timed out.&quot; Dev returns HTTP 200 with a proper Parameters response (result=false, code not found in <a href=\"http://varnomen.hgvs.org\" target=\"_blank\">http://varnomen.hgvs.org</a> version 2.0).</p>\n<p>Prod&#x27;s 500 is a transient failure — the prod server timed out calling an external HGVS validation service during data collection. Dev processes the same code locally and returns a valid terminology response.</p>\n<p>62 records in the comparison dataset. All share:</p>\n<ul><li>System: <a href=\"http://varnomen.hgvs.org\" target=\"_blank\">http://varnomen.hgvs.org</a></li><li>Operation: $validate-code (POST /r4/CodeSystem/$validate-code?)</li><li>Status: prod=500, dev=200</li><li>Category: status-mismatch</li><li>Prod body contains &quot;Error parsing HGVS response: Read timed out.&quot;</li></ul>\n<p>Search: <code>grep -c &#x27;Read timed out&#x27; results/deltas/deltas.ndjson</code> → 62</p>\n<p>There are 124 total HGVS records in the dataset; the other 62 did not timeout and have prod=200, dev=200.</p>\n<p>Tolerance <code>skip-prod-hgvs-timeout</code> skips any record where prod returned 500 and the prod body contains &quot;Read timed out&quot;. These records have unreliable comparison data since prod failed to complete the operation. Eliminates 62 records.</p>\n<p>286d30a9-e2b8-4967-8c56-265b3f6160a6</p>\n<p>This is a data collection artifact — the comparison data is tainted because prod experienced transient external service timeouts during the collection run. These records should be recollected in a future run.</p>", "impact": 62}, {"id": "6b31694", "title": "Dev crashes (500) on GET  with filter parameter: searchText.toLowerCase is not a function", "status": "open", "labels": ["dev-crash-on-valid", "reproduced", "round:2026-02-round-2", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 10:52", "date_iso": "2026-02-08T10:52:56-06:00", "body_md": "Records-Impacted: 58\nTolerance-ID: expand-filter-crash\nRecord-ID: dabcdc4f-feed-4ac8-adea-8999b06187a5\n\n## Repro\n\n```bash\n# Prod (returns 200 with ValueSet expansion)\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$expand?url=http://hl7.org/fhir/ValueSet/participant-role&filter=referr&count=50' \\\n  -H 'Accept: application/fhir+json'\n\n# Dev (returns 500 with error)\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$expand?url=http://hl7.org/fhir/ValueSet/participant-role&filter=referr&count=50' \\\n  -H 'Accept: application/fhir+json'\n```\n\nProd returns HTTP 200 with a valid ValueSet expansion. Dev returns HTTP 500 with OperationOutcome: `searchText.toLowerCase is not a function`. Reproduced with multiple filter values (`referr`, `family`, `referring`) across different ValueSets.\n\n## What differs\n\nDev returns HTTP 500 with OperationOutcome error `searchText.toLowerCase is not a function` on all GET `$expand` requests (R4 and R5) that include a `filter` parameter. Prod returns 200 with a valid ValueSet expansion.\n\nThe error is a JavaScript TypeError indicating that `searchText` is null/undefined when `.toLowerCase()` is called during filter processing.\n\n## How widespread\n\nAll 58 records matching this error in the comparison dataset. Every one is a GET `/r4/ValueSet/$expand` or `/r5/ValueSet/$expand` request with a `filter=` query parameter. They span 3 distinct ValueSets:\n- `http://hl7.org/fhir/ValueSet/participant-role` (R4 and R5)\n- `http://hl7.org/fhir/ValueSet/condition-code` (R4)\n- `http://hl7.org/fhir/ValueSet/medication-codes` (R4)\n\nSearch: `grep -c 'searchText.toLowerCase is not a function' jobs/2026-02-round-2/results/deltas/deltas.ndjson` → 58\n\n## What the tolerance covers\n\nTolerance ID: `expand-filter-crash`\nMatches: GET requests to `/r[345]/ValueSet/$expand` where `filter=` is in the URL, `prod.status=200`, `dev.status=500`, and the dev response contains `searchText.toLowerCase is not a function`.\nEliminates: 58 records.\n\n## Representative records\n\n- `dabcdc4f-feed-4ac8-adea-8999b06187a5` — `GET /r4/ValueSet/$expand?url=http://hl7.org/fhir/ValueSet/participant-role&filter=referr&count=50`", "body_html": "<p>Records-Impacted: 58<br>\nTolerance-ID: expand-filter-crash<br>\nRecord-ID: dabcdc4f-feed-4ac8-adea-8999b06187a5</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod (returns 200 with ValueSet expansion)\ncurl -s &#x27;https://tx.fhir.org/r4/ValueSet/$expand?url=http://hl7.org/fhir/ValueSet/participant-role&amp;filter=referr&amp;count=50&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;\n\n# Dev (returns 500 with error)\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand?url=http://hl7.org/fhir/ValueSet/participant-role&amp;filter=referr&amp;count=50&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;</code></pre>\n<p>Prod returns HTTP 200 with a valid ValueSet expansion. Dev returns HTTP 500 with OperationOutcome: <code>searchText.toLowerCase is not a function</code>. Reproduced with multiple filter values (<code>referr</code>, <code>family</code>, <code>referring</code>) across different ValueSets.</p>\n<h2>What differs</h2>\n<p>Dev returns HTTP 500 with OperationOutcome error <code>searchText.toLowerCase is not a function</code> on all GET <code>$expand</code> requests (R4 and R5) that include a <code>filter</code> parameter. Prod returns 200 with a valid ValueSet expansion.</p>\n<p>The error is a JavaScript TypeError indicating that <code>searchText</code> is null/undefined when <code>.toLowerCase()</code> is called during filter processing.</p>\n<h2>How widespread</h2>\n<p>All 58 records matching this error in the comparison dataset. Every one is a GET <code>/r4/ValueSet/$expand</code> or <code>/r5/ValueSet/$expand</code> request with a <code>filter=</code> query parameter. They span 3 distinct ValueSets:</p>\n<ul><li><code>http://hl7.org/fhir/ValueSet/participant-role</code> (R4 and R5)</li><li><code>http://hl7.org/fhir/ValueSet/condition-code</code> (R4)</li><li><code>http://hl7.org/fhir/ValueSet/medication-codes</code> (R4)</li></ul>\n<p>Search: <code>grep -c &#x27;searchText.toLowerCase is not a function&#x27; jobs/2026-02-round-2/results/deltas/deltas.ndjson</code> → 58</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance ID: <code>expand-filter-crash</code><br>\nMatches: GET requests to <code>/r[345]/ValueSet/$expand</code> where <code>filter=</code> is in the URL, <code>prod.status=200</code>, <code>dev.status=500</code>, and the dev response contains <code>searchText.toLowerCase is not a function</code>.<br>\nEliminates: 58 records.</p>\n<h2>Representative records</h2>\n<ul><li><code>dabcdc4f-feed-4ac8-adea-8999b06187a5</code> — <code>GET /r4/ValueSet/$expand?url=http://hl7.org/fhir/ValueSet/participant-role&amp;filter=referr&amp;count=50</code></li></ul>", "impact": 58}, {"id": "2ed80bd", "title": "Dev  omits expansion.total when prod includes it", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-2", "round:2026-02-round-3", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-11 19:26", "date_iso": "2026-02-11T19:26:14-06:00", "body_md": "Records-Impacted: 51\nTolerance-ID: expand-dev-missing-total\nRecord-ID: a1f653a2-a199-4228-a7f7-2522abde6953\n\n## Repro\n\n```bash\n# Prod\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$expand' -H 'Accept: application/fhir+json' -H 'Content-Type: application/fhir+json' -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"system-version\",\"valueUri\":\"http://snomed.info/sct|http://snomed.info/sct/11000315107\"},{\"name\":\"displayLanguage\",\"valueCode\":\"fr\"},{\"name\":\"includeDefinition\",\"valueBoolean\":false},{\"name\":\"excludeNested\",\"valueBoolean\":true},{\"name\":\"cache-id\",\"valueId\":\"4d94febc-fb6a-407d-a69c-29b8de3c56c3\"},{\"name\":\"count\",\"valueInteger\":1000},{\"name\":\"offset\",\"valueInteger\":0},{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"status\":\"active\",\"compose\":{\"inactive\":true,\"include\":[{\"system\":\"urn:iso:std:iso:3166:-2\"}]}}}]}' | jq '.expansion | {total, contains_count: (.contains | length)}'\n\n# Dev\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$expand' -H 'Accept: application/fhir+json' -H 'Content-Type: application/fhir+json' -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"system-version\",\"valueUri\":\"http://snomed.info/sct|http://snomed.info/sct/11000315107\"},{\"name\":\"displayLanguage\",\"valueCode\":\"fr\"},{\"name\":\"includeDefinition\",\"valueBoolean\":false},{\"name\":\"excludeNested\",\"valueBoolean\":true},{\"name\":\"cache-id\",\"valueId\":\"4d94febc-fb6a-407d-a69c-29b8de3c56c3\"},{\"name\":\"count\",\"valueInteger\":1000},{\"name\":\"offset\",\"valueInteger\":0},{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"status\":\"active\",\"compose\":{\"inactive\":true,\"include\":[{\"system\":\"urn:iso:std:iso:3166:-2\"}]}}}]}' | jq '.expansion | {total, contains_count: (.contains | length)}'\n```\n\nProd returns `\"total\": 5099` with 1000 contains entries. Dev returns `\"total\": null` (field missing) with 1000 contains entries.\n\n## What differs\n\nIn $expand responses, prod returns `expansion.total` (the total count of matching concepts) while dev omits it entirely. The `total` field is a 0..1 optional integer in FHIR R4's ValueSet.expansion, documented as \"Total concept count; permits server pagination.\" Without it, clients cannot determine how many pages exist in a paged expansion.\n\nExamples:\n- Prod: `\"total\": 5099` with 1000 contains (paged)\n- Dev: no `total` field, same 1000 contains\n\nBoth servers return identical `contains` arrays and `offset` values in all sampled records.\n\n## How widespread\n\n51 total records across round-2 (47 records) and round-3 (7 records, of which 4 eliminated as sole remaining diff after other tolerances). Affects both R4 and R5 endpoints. Systems affected:\n- `urn:iso:std:iso:3166:-2` (ISO 3166-2 country subdivision codes, total=5099)\n- `http://unitsofmeasure.org` (UCUM, total=1364)\n- `urn:ietf:bcp:47` (BCP-47 language tags, total=0)\n\n## What the tolerance covers\n\nTolerance ID: `expand-dev-missing-total`\nMatches: Any $expand response (ValueSet resourceType) where prod has `expansion.total` and dev does not.\nNormalizes by removing `expansion.total` from prod to prevent re-triaging.\n\nRepresentative Record IDs:\n- Round 2: `a1f653a2-a199-4228-a7f7-2522abde6953`\n- Round 3: `cd702b5d-dd1e-407b-9d13-21b62460773b`", "body_html": "<p>Records-Impacted: 51<br>\nTolerance-ID: expand-dev-missing-total<br>\nRecord-ID: a1f653a2-a199-4228-a7f7-2522abde6953</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod\ncurl -s &#x27;https://tx.fhir.org/r4/ValueSet/$expand&#x27; -H &#x27;Accept: application/fhir+json&#x27; -H &#x27;Content-Type: application/fhir+json&#x27; -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;system-version&quot;,&quot;valueUri&quot;:&quot;http://snomed.info/sct|http://snomed.info/sct/11000315107&quot;},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueCode&quot;:&quot;fr&quot;},{&quot;name&quot;:&quot;includeDefinition&quot;,&quot;valueBoolean&quot;:false},{&quot;name&quot;:&quot;excludeNested&quot;,&quot;valueBoolean&quot;:true},{&quot;name&quot;:&quot;cache-id&quot;,&quot;valueId&quot;:&quot;4d94febc-fb6a-407d-a69c-29b8de3c56c3&quot;},{&quot;name&quot;:&quot;count&quot;,&quot;valueInteger&quot;:1000},{&quot;name&quot;:&quot;offset&quot;,&quot;valueInteger&quot;:0},{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;status&quot;:&quot;active&quot;,&quot;compose&quot;:{&quot;inactive&quot;:true,&quot;include&quot;:[{&quot;system&quot;:&quot;urn:iso:std:iso:3166:-2&quot;}]}}}]}&#x27; | jq &#x27;.expansion | {total, contains_count: (.contains | length)}&#x27;\n\n# Dev\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand&#x27; -H &#x27;Accept: application/fhir+json&#x27; -H &#x27;Content-Type: application/fhir+json&#x27; -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;system-version&quot;,&quot;valueUri&quot;:&quot;http://snomed.info/sct|http://snomed.info/sct/11000315107&quot;},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueCode&quot;:&quot;fr&quot;},{&quot;name&quot;:&quot;includeDefinition&quot;,&quot;valueBoolean&quot;:false},{&quot;name&quot;:&quot;excludeNested&quot;,&quot;valueBoolean&quot;:true},{&quot;name&quot;:&quot;cache-id&quot;,&quot;valueId&quot;:&quot;4d94febc-fb6a-407d-a69c-29b8de3c56c3&quot;},{&quot;name&quot;:&quot;count&quot;,&quot;valueInteger&quot;:1000},{&quot;name&quot;:&quot;offset&quot;,&quot;valueInteger&quot;:0},{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;status&quot;:&quot;active&quot;,&quot;compose&quot;:{&quot;inactive&quot;:true,&quot;include&quot;:[{&quot;system&quot;:&quot;urn:iso:std:iso:3166:-2&quot;}]}}}]}&#x27; | jq &#x27;.expansion | {total, contains_count: (.contains | length)}&#x27;</code></pre>\n<p>Prod returns <code>&quot;total&quot;: 5099</code> with 1000 contains entries. Dev returns <code>&quot;total&quot;: null</code> (field missing) with 1000 contains entries.</p>\n<h2>What differs</h2>\n<p>In $expand responses, prod returns <code>expansion.total</code> (the total count of matching concepts) while dev omits it entirely. The <code>total</code> field is a 0..1 optional integer in FHIR R4&#x27;s ValueSet.expansion, documented as &quot;Total concept count; permits server pagination.&quot; Without it, clients cannot determine how many pages exist in a paged expansion.</p>\n<p>Examples:</p>\n<ul><li>Prod: <code>&quot;total&quot;: 5099</code> with 1000 contains (paged)</li><li>Dev: no <code>total</code> field, same 1000 contains</li></ul>\n<p>Both servers return identical <code>contains</code> arrays and <code>offset</code> values in all sampled records.</p>\n<h2>How widespread</h2>\n<p>51 total records across round-2 (47 records) and round-3 (7 records, of which 4 eliminated as sole remaining diff after other tolerances). Affects both R4 and R5 endpoints. Systems affected:</p>\n<ul><li><code>urn:iso:std:iso:3166:-2</code> (ISO 3166-2 country subdivision codes, total=5099)</li><li><code>http://unitsofmeasure.org</code> (UCUM, total=1364)</li><li><code>urn:ietf:bcp:47</code> (BCP-47 language tags, total=0)</li></ul>\n<h2>What the tolerance covers</h2>\n<p>Tolerance ID: <code>expand-dev-missing-total</code><br>\nMatches: Any $expand response (ValueSet resourceType) where prod has <code>expansion.total</code> and dev does not.<br>\nNormalizes by removing <code>expansion.total</code> from prod to prevent re-triaging.</p>\n<p>Representative Record IDs:</p>\n<ul><li>Round 2: <code>a1f653a2-a199-4228-a7f7-2522abde6953</code></li><li>Round 3: <code>cd702b5d-dd1e-407b-9d13-21b62460773b</code></li></ul>", "impact": 51}, {"id": "b36a12b", "title": "validate-code: unknown version message says 'no versions known' when valid versions exist", "status": "open", "labels": ["content-differs", "repro-inconclusive", "round:2026-02-round-2", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 10:52", "date_iso": "2026-02-08T10:52:57-06:00", "body_md": "Records-Impacted: 50\nTolerance-ID: unknown-version-no-versions-known\nRecord-ID: f8badb02-7ec3-4624-a906-eec8ec9f5656\n\n\n```bash\ncurl -s https://tx.fhir.org/r4/CodeSystem/\\$validate-code \\\n  -H \"Accept: application/fhir+json\" \\\n  -H \"Content-Type: application/fhir+json\" \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"coding\",\"valueCoding\":{\"system\":\"https://fhir.nhs.uk/CodeSystem/England-GenomicTestDirectory\",\"version\":\"9\",\"code\":\"M119.5\",\"display\":\"Multi Target NGS Panel Small\"}},{\"name\":\"displayLanguage\",\"valueString\":\"en-GB\"},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true}]}'\n\ncurl -s https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code \\\n  -H \"Accept: application/fhir+json\" \\\n  -H \"Content-Type: application/fhir+json\" \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"coding\",\"valueCoding\":{\"system\":\"https://fhir.nhs.uk/CodeSystem/England-GenomicTestDirectory\",\"version\":\"9\",\"code\":\"M119.5\",\"display\":\"Multi Target NGS Panel Small\"}},{\"name\":\"displayLanguage\",\"valueString\":\"en-GB\"},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true}]}'\n```\n\n**Repro inconclusive**: As of 2026-02-07, both servers now return \"No versions of this code system are known\". The England-GenomicTestDirectory CodeSystem appears to no longer be loaded on either server (tested versions 9, 7, and 0.1.0 all fail). The bug was real at the time of comparison (prod listed \"Valid versions: 0.1.0\" while dev said no versions known), but cannot be verified against the current live servers because the test CodeSystem is unavailable.\n\n\nWhen validating a code against a CodeSystem with a version that doesn't exist, but other versions of the CodeSystem are known:\n\n- **Prod** returns: \"A definition for CodeSystem '...' version 'X' could not be found, so the code cannot be validated. Valid versions: 0.1.0\"\n- **Dev** returns: \"A definition for CodeSystem '...' version 'X' could not be found, so the code cannot be validated. No versions of this code system are known\"\n\nAdditionally, the `x-caused-by-unknown-system` parameter differs:\n- **Prod**: includes the version suffix (e.g., `...England-GenomicTestDirectory|9`)\n- **Dev**: omits the version suffix (e.g., `...England-GenomicTestDirectory`)\n\nThe OperationOutcome message-id also differs:\n- **Prod**: `UNKNOWN_CODESYSTEM_VERSION`\n- **Dev**: `UNKNOWN_CODESYSTEM_VERSION_NONE`\n\nDev's message is factually incorrect — it claims \"No versions of this code system are known\" but it does know version 0.1.0 (proven by 40 other records for the same code system that validate successfully against version 0.1.0).\n\n\nAll 50 impacted records are $validate-code operations against `https://fhir.nhs.uk/CodeSystem/England-GenomicTestDirectory` with requested versions 7 (40 records) or 9 (10 records). Neither version exists — only 0.1.0 is valid.\n\nSearch: `grep 'No versions of this code system are known' jobs/2026-02-round-2/results/deltas/deltas.ndjson | wc -l` → 50\nAll 50 are for England-GenomicTestDirectory. All 50 also have \"Valid versions:\" in prod.\n\nThe pattern may apply more broadly to any CodeSystem where a nonexistent version is requested but other versions are loaded.\n\n\nTolerance `unknown-version-no-versions-known` normalizes the message text, OperationOutcome details, x-caused-by-unknown-system, and message-id for records matching this pattern: both result=false, prod message contains \"Valid versions:\", dev message contains \"No versions of this code system are known\". Eliminates 50 records.", "body_html": "<p>Records-Impacted: 50<br>\nTolerance-ID: unknown-version-no-versions-known<br>\nRecord-ID: f8badb02-7ec3-4624-a906-eec8ec9f5656</p>\n<pre><code class=\"lang-bash\">curl -s https://tx.fhir.org/r4/CodeSystem/\\$validate-code \\\n  -H &quot;Accept: application/fhir+json&quot; \\\n  -H &quot;Content-Type: application/fhir+json&quot; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;coding&quot;,&quot;valueCoding&quot;:{&quot;system&quot;:&quot;https://fhir.nhs.uk/CodeSystem/England-GenomicTestDirectory&quot;,&quot;version&quot;:&quot;9&quot;,&quot;code&quot;:&quot;M119.5&quot;,&quot;display&quot;:&quot;Multi Target NGS Panel Small&quot;}},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueString&quot;:&quot;en-GB&quot;},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true}]}&#x27;\n\ncurl -s https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code \\\n  -H &quot;Accept: application/fhir+json&quot; \\\n  -H &quot;Content-Type: application/fhir+json&quot; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;coding&quot;,&quot;valueCoding&quot;:{&quot;system&quot;:&quot;https://fhir.nhs.uk/CodeSystem/England-GenomicTestDirectory&quot;,&quot;version&quot;:&quot;9&quot;,&quot;code&quot;:&quot;M119.5&quot;,&quot;display&quot;:&quot;Multi Target NGS Panel Small&quot;}},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueString&quot;:&quot;en-GB&quot;},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true}]}&#x27;</code></pre>\n<p><strong>Repro inconclusive</strong>: As of 2026-02-07, both servers now return &quot;No versions of this code system are known&quot;. The England-GenomicTestDirectory CodeSystem appears to no longer be loaded on either server (tested versions 9, 7, and 0.1.0 all fail). The bug was real at the time of comparison (prod listed &quot;Valid versions: 0.1.0&quot; while dev said no versions known), but cannot be verified against the current live servers because the test CodeSystem is unavailable.</p>\n<p>When validating a code against a CodeSystem with a version that doesn&#x27;t exist, but other versions of the CodeSystem are known:</p>\n<ul><li><strong>Prod</strong> returns: &quot;A definition for CodeSystem &#x27;...&#x27; version &#x27;X&#x27; could not be found, so the code cannot be validated. Valid versions: 0.1.0&quot;</li><li><strong>Dev</strong> returns: &quot;A definition for CodeSystem &#x27;...&#x27; version &#x27;X&#x27; could not be found, so the code cannot be validated. No versions of this code system are known&quot;</li></ul>\n<p>Additionally, the <code>x-caused-by-unknown-system</code> parameter differs:</p>\n<ul><li><strong>Prod</strong>: includes the version suffix (e.g., <code>...England-GenomicTestDirectory|9</code>)</li><li><strong>Dev</strong>: omits the version suffix (e.g., <code>...England-GenomicTestDirectory</code>)</li></ul>\n<p>The OperationOutcome message-id also differs:</p>\n<ul><li><strong>Prod</strong>: <code>UNKNOWN_CODESYSTEM_VERSION</code></li><li><strong>Dev</strong>: <code>UNKNOWN_CODESYSTEM_VERSION_NONE</code></li></ul>\n<p>Dev&#x27;s message is factually incorrect — it claims &quot;No versions of this code system are known&quot; but it does know version 0.1.0 (proven by 40 other records for the same code system that validate successfully against version 0.1.0).</p>\n<p>All 50 impacted records are $validate-code operations against <code>https://fhir.nhs.uk/CodeSystem/England-GenomicTestDirectory</code> with requested versions 7 (40 records) or 9 (10 records). Neither version exists — only 0.1.0 is valid.</p>\n<p>Search: <code>grep &#x27;No versions of this code system are known&#x27; jobs/2026-02-round-2/results/deltas/deltas.ndjson | wc -l</code> → 50<br>\nAll 50 are for England-GenomicTestDirectory. All 50 also have &quot;Valid versions:&quot; in prod.</p>\n<p>The pattern may apply more broadly to any CodeSystem where a nonexistent version is requested but other versions are loaded.</p>\n<p>Tolerance <code>unknown-version-no-versions-known</code> normalizes the message text, OperationOutcome details, x-caused-by-unknown-system, and message-id for records matching this pattern: both result=false, prod message contains &quot;Valid versions:&quot;, dev message contains &quot;No versions of this code system are known&quot;. Eliminates 50 records.</p>", "impact": 50}, {"id": "44d1916", "title": "Dev returns 200 expansion instead of 422 too-costly for large code systems (LOINC, MIME types)", "status": "open", "labels": ["reproduced", "round:2026-02-round-2", "round:2026-02-round-3", "status-mismatch", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-11 20:12", "date_iso": "2026-02-11T20:12:53-06:00", "body_md": "Records-Impacted: 40\nTolerance-ID: expand-too-costly-succeeds\nRecord-ID: 02653c32-ee08-4d24-b687-36574afddaf3\n\n## Repro\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$expand' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"count\",\"valueInteger\":1000},{\"name\":\"offset\",\"valueInteger\":0},{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"status\":\"active\",\"compose\":{\"inactive\":true,\"include\":[{\"system\":\"http://loinc.org\"}]}}}]}'\n\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$expand' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"count\",\"valueInteger\":1000},{\"name\":\"offset\",\"valueInteger\":0},{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"status\":\"active\",\"compose\":{\"inactive\":true,\"include\":[{\"system\":\"http://loinc.org\"}]}}}]}'\n```\n\nProd returns HTTP 422 with OperationOutcome `{\"issue\":[{\"severity\":\"error\",\"code\":\"too-costly\",\"details\":{\"text\":\"The value set '' expansion has too many codes to display (>10000)\"}}]}`. Dev returns HTTP 200 with a ValueSet containing 1000 LOINC codes.\n\n## What differs\n\nFor $expand of ValueSets including large code systems, prod returns HTTP 422 with an OperationOutcome containing `issue.code: \"too-costly\"`. Dev returns HTTP 200 with a ValueSet expansion. Prod correctly enforces an expansion size guard — refusing to expand code systems with >10000 codes even when pagination parameters (count/offset) are present. Dev does not enforce this guard and instead returns a paginated result or empty expansion.\n\nProd's error messages fall into two patterns:\n- \"The value set '' expansion has too many codes to display (>10000)\" — for LOINC and BCP-13/MIME type expansions\n- \"The code System has a grammar, and cannot be enumerated directly\" — for CPT and some MIME type expansions (covered by bug c31a8fe)\n\n## How widespread\n\n40 records in the round-3 comparison dataset (jobs/2026-02-round-3) match this pattern:\n- 20 records: `http://loinc.org` — dev returns 1000 codes in expansion\n- 20 records: `urn:ietf:bcp:13` (MIME types) — dev returns empty expansion (total=0)\n- Both /r4/ and /r5/ FHIR versions affected (32 /r4/, 8 /r5/)\n\nSearch: `grep '\"too-costly\"' deltas.ndjson` in the pre-tolerance delta file, filtered to status-mismatch with prod=422 dev=200, yields 40 records.\n\n## Tolerance\n\nTolerance `expand-too-costly-succeeds` matches any $expand request where prod returns 422 with OperationOutcome containing `issue.code: \"too-costly\"` and dev returns 200. Skips these records since the responses are fundamentally incomparable (error vs success). Eliminates all 40 records. Validated with 12-record sample — all legitimate.\n\n## Representative records\n\n- `02653c32-ee08-4d24-b687-36574afddaf3` (LOINC, POST /r4/ValueSet/$expand, round-3)\n- `d9734f68-d8b4-475d-9204-632c9b4ccbf0` (LOINC, POST /r5/ValueSet/$expand, round-2)\n- `3a2672db-cb0d-4312-87f1-5d6b685fbfe0` (MIME types, GET /r4/ValueSet/$expand?url=...mimetypes, round-2)", "body_html": "<p>Records-Impacted: 40<br>\nTolerance-ID: expand-too-costly-succeeds<br>\nRecord-ID: 02653c32-ee08-4d24-b687-36574afddaf3</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/ValueSet/$expand&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;count&quot;,&quot;valueInteger&quot;:1000},{&quot;name&quot;:&quot;offset&quot;,&quot;valueInteger&quot;:0},{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;status&quot;:&quot;active&quot;,&quot;compose&quot;:{&quot;inactive&quot;:true,&quot;include&quot;:[{&quot;system&quot;:&quot;http://loinc.org&quot;}]}}}]}&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;count&quot;,&quot;valueInteger&quot;:1000},{&quot;name&quot;:&quot;offset&quot;,&quot;valueInteger&quot;:0},{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;status&quot;:&quot;active&quot;,&quot;compose&quot;:{&quot;inactive&quot;:true,&quot;include&quot;:[{&quot;system&quot;:&quot;http://loinc.org&quot;}]}}}]}&#x27;</code></pre>\n<p>Prod returns HTTP 422 with OperationOutcome <code>{&quot;issue&quot;:[{&quot;severity&quot;:&quot;error&quot;,&quot;code&quot;:&quot;too-costly&quot;,&quot;details&quot;:{&quot;text&quot;:&quot;The value set &#x27;&#x27; expansion has too many codes to display (&gt;10000)&quot;}}]}</code>. Dev returns HTTP 200 with a ValueSet containing 1000 LOINC codes.</p>\n<h2>What differs</h2>\n<p>For $expand of ValueSets including large code systems, prod returns HTTP 422 with an OperationOutcome containing <code>issue.code: &quot;too-costly&quot;</code>. Dev returns HTTP 200 with a ValueSet expansion. Prod correctly enforces an expansion size guard — refusing to expand code systems with &gt;10000 codes even when pagination parameters (count/offset) are present. Dev does not enforce this guard and instead returns a paginated result or empty expansion.</p>\n<p>Prod&#x27;s error messages fall into two patterns:</p>\n<ul><li>&quot;The value set &#x27;&#x27; expansion has too many codes to display (&gt;10000)&quot; — for LOINC and BCP-13/MIME type expansions</li><li>&quot;The code System has a grammar, and cannot be enumerated directly&quot; — for CPT and some MIME type expansions (covered by bug c31a8fe)</li></ul>\n<h2>How widespread</h2>\n<p>40 records in the round-3 comparison dataset (jobs/2026-02-round-3) match this pattern:</p>\n<ul><li>20 records: <code>http://loinc.org</code> — dev returns 1000 codes in expansion</li><li>20 records: <code>urn:ietf:bcp:13</code> (MIME types) — dev returns empty expansion (total=0)</li><li>Both /r4/ and /r5/ FHIR versions affected (32 /r4/, 8 /r5/)</li></ul>\n<p>Search: <code>grep &#x27;&quot;too-costly&quot;&#x27; deltas.ndjson</code> in the pre-tolerance delta file, filtered to status-mismatch with prod=422 dev=200, yields 40 records.</p>\n<h2>Tolerance</h2>\n<p>Tolerance <code>expand-too-costly-succeeds</code> matches any $expand request where prod returns 422 with OperationOutcome containing <code>issue.code: &quot;too-costly&quot;</code> and dev returns 200. Skips these records since the responses are fundamentally incomparable (error vs success). Eliminates all 40 records. Validated with 12-record sample — all legitimate.</p>\n<h2>Representative records</h2>\n<ul><li><code>02653c32-ee08-4d24-b687-36574afddaf3</code> (LOINC, POST /r4/ValueSet/$expand, round-3)</li><li><code>d9734f68-d8b4-475d-9204-632c9b4ccbf0</code> (LOINC, POST /r5/ValueSet/$expand, round-2)</li><li><code>3a2672db-cb0d-4312-87f1-5d6b685fbfe0</code> (MIME types, GET /r4/ValueSet/$expand?url=...mimetypes, round-2)</li></ul>", "impact": 40}, {"id": "36da928", "title": "Dev returns 404 for SNOMED CT implicit ValueSet  (fhir_vs URLs)", "status": "open", "labels": ["missing-resource", "reproduced", "round:2026-02-round-2", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 10:52", "date_iso": "2026-02-08T10:52:56-06:00", "body_md": "Records-Impacted: 36\nTolerance-ID: snomed-implicit-valueset-expand-404\nRecord-ID: 871b3f66-9e31-4b6c-9774-adb378e935df\n\n## Repro\n\n```bash\n# Prod\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$expand?url=http%3A%2F%2Fsnomed.info%2Fsct%3Ffhir_vs&filter=diabetes&count=5' \\\n  -H 'Accept: application/fhir+json'\n\n# Dev\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$expand?url=http%3A%2F%2Fsnomed.info%2Fsct%3Ffhir_vs&filter=diabetes&count=5' \\\n  -H 'Accept: application/fhir+json'\n```\n\nProd returns HTTP 200 with a valid ValueSet expansion containing 5 SNOMED CT concepts matching \"diabetes\". Dev returns HTTP 404 with OperationOutcome: `\"ValueSet not found: http://snomed.info/sct?fhir_vs\"`.\n\n## What differs\n\nWhen expanding SNOMED CT implicit ValueSets using the standard `fhir_vs` URL pattern, prod returns 200 with a valid ValueSet expansion, while dev returns 404 with OperationOutcome \"ValueSet not found: http://snomed.info/sct?fhir_vs\".\n\nThis affects all SNOMED CT implicit ValueSet URLs:\n- `http://snomed.info/sct?fhir_vs` (all of SNOMED CT)\n- `http://snomed.info/sct?fhir_vs=isa/<sctid>` (descendants of a concept)\n\nThese are FHIR-standard implicit ValueSet URLs defined in the SNOMED CT FHIR usage guide. A terminology server must recognize these URL patterns and synthesize the corresponding ValueSet rather than looking for a stored resource.\n\n## How widespread\n\n36 records in the delta file show this pattern. All are `missing-resource` category, `expand` operation. All have prod=200, dev=404.\n\n```\ngrep -c 'fhir_vs' jobs/2026-02-round-2/results/deltas/deltas.ndjson\n# → 36\n```\n\nThe pattern is predicted by the URL containing `fhir_vs` combined with the $expand operation. Both /r4/ and /r5/ FHIR version prefixes are affected. Various filter and count parameters are used across the records but all fail the same way.\n\n176 total records in comparison.ndjson contain `fhir_vs`; the other 140 are already handled (matched OK or skipped by existing tolerances).\n\n## What the tolerance covers\n\nTolerance `snomed-implicit-valueset-expand-404` matches records where:\n- The URL contains `fhir_vs`\n- Dev returns status 404\n- Prod returns status 200\n\nIt skips these records entirely since no meaningful comparison is possible (dev doesn't return FHIR content). Eliminates 36 delta records.\n\n## Representative record\n\n`871b3f66-9e31-4b6c-9774-adb378e935df` — GET /r4/ValueSet/$expand?url=http%3A%2F%2Fsnomed.info%2Fsct%3Ffhir_vs&filter=diabetes&count=5", "body_html": "<p>Records-Impacted: 36<br>\nTolerance-ID: snomed-implicit-valueset-expand-404<br>\nRecord-ID: 871b3f66-9e31-4b6c-9774-adb378e935df</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod\ncurl -s &#x27;https://tx.fhir.org/r4/ValueSet/$expand?url=http%3A%2F%2Fsnomed.info%2Fsct%3Ffhir_vs&amp;filter=diabetes&amp;count=5&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;\n\n# Dev\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand?url=http%3A%2F%2Fsnomed.info%2Fsct%3Ffhir_vs&amp;filter=diabetes&amp;count=5&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;</code></pre>\n<p>Prod returns HTTP 200 with a valid ValueSet expansion containing 5 SNOMED CT concepts matching &quot;diabetes&quot;. Dev returns HTTP 404 with OperationOutcome: <code>&quot;ValueSet not found: http://snomed.info/sct?fhir_vs&quot;</code>.</p>\n<h2>What differs</h2>\n<p>When expanding SNOMED CT implicit ValueSets using the standard <code>fhir_vs</code> URL pattern, prod returns 200 with a valid ValueSet expansion, while dev returns 404 with OperationOutcome &quot;ValueSet not found: <a href=\"http://snomed.info/sct?fhir_vs&quot;.\" target=\"_blank\">http://snomed.info/sct?fhir_vs&quot;.</a></p>\n<p>This affects all SNOMED CT implicit ValueSet URLs:</p>\n<ul><li><code>http://snomed.info/sct?fhir_vs</code> (all of SNOMED CT)</li><li><code>http://snomed.info/sct?fhir_vs=isa/&lt;sctid&gt;</code> (descendants of a concept)</li></ul>\n<p>These are FHIR-standard implicit ValueSet URLs defined in the SNOMED CT FHIR usage guide. A terminology server must recognize these URL patterns and synthesize the corresponding ValueSet rather than looking for a stored resource.</p>\n<h2>How widespread</h2>\n<p>36 records in the delta file show this pattern. All are <code>missing-resource</code> category, <code>expand</code> operation. All have prod=200, dev=404.</p>\n<pre><code>grep -c &#x27;fhir_vs&#x27; jobs/2026-02-round-2/results/deltas/deltas.ndjson\n# → 36</code></pre>\n<p>The pattern is predicted by the URL containing <code>fhir_vs</code> combined with the $expand operation. Both /r4/ and /r5/ FHIR version prefixes are affected. Various filter and count parameters are used across the records but all fail the same way.</p>\n<p>176 total records in comparison.ndjson contain <code>fhir_vs</code>; the other 140 are already handled (matched OK or skipped by existing tolerances).</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance <code>snomed-implicit-valueset-expand-404</code> matches records where:</p>\n<ul><li>The URL contains <code>fhir_vs</code></li><li>Dev returns status 404</li><li>Prod returns status 200</li></ul>\n<p>It skips these records entirely since no meaningful comparison is possible (dev doesn&#x27;t return FHIR content). Eliminates 36 delta records.</p>\n<h2>Representative record</h2>\n<p><code>871b3f66-9e31-4b6c-9774-adb378e935df</code> — GET /r4/ValueSet/$expand?url=http%3A%2F%2Fsnomed.info%2Fsct%3Ffhir_vs&amp;filter=diabetes&amp;count=5</p>", "impact": 36}, {"id": "7716e08", "title": "Dev uses R5-style property instead of R4 extension for deprecated status in expand contains", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-2", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 10:52", "date_iso": "2026-02-08T10:52:56-06:00", "body_md": "Records-Impacted: 26\nTolerance-ID: expand-r4-deprecated-status-representation\nRecord-ID: 307d55c7-f148-4ddc-a360-3962e4e2fe7c, 131242e8-b7fb-4c3a-a45b-680355b8a70f\n\nIn R4 $expand responses, prod and dev represent deprecated code status differently in two ways:\n\n**1. Per-code deprecated annotations on expansion.contains entries**\n\n- **security-labels (18 records)**: Prod uses R4-compatible extension `http://hl7.org/fhir/5.0/StructureDefinition/extension-ValueSet.expansion.contains.property` to convey `status: deprecated`. Dev uses R5-native `property` elements directly (e.g., `\"property\": [{\"code\": \"status\", \"valueCode\": \"deprecated\"}]`). The R4 spec does not define `property` on `expansion.contains` — that was introduced in R5.\n\n- **patient-contactrelationship (5 records) + v3-TribalEntityUS (3 records)**: Prod annotates deprecated codes with the same R5 backport extension. Dev omits the deprecated status annotation entirely — no extension and no property.\n\n**2. Expansion-level property declaration extension**\n\nProd includes an expansion-level extension `http://hl7.org/fhir/5.0/StructureDefinition/extension-ValueSet.expansion.property` that declares the \"status\" property used in per-code annotations. Dev either omits this entirely (patient-contactrelationship) or includes it with different key ordering (TribalEntityUS). This is the R5 backport mechanism for declaring expansion properties in R4.\n\n**How widespread**\n\n26 expand records across 3 ValueSets. All are R4 $expand operations containing codes from HL7 terminology CodeSystems with deprecated entries.\n\n```bash\ngrep 'extension-ValueSet.expansion.contains.property' jobs/2026-02-round-2/results/deltas/deltas.ndjson | wc -l\ngrep 'extension-ValueSet.expansion.property' jobs/2026-02-round-2/results/deltas/deltas.ndjson | wc -l\n```\n\n**Tolerance**\n\nTolerance `expand-r4-deprecated-status-representation` normalizes by stripping both per-code annotations (R5 backport extension and R5-native property) and the expansion-level property declaration extension from both sides. This eliminates the structural difference so other content differences can still surface.", "body_html": "<p>Records-Impacted: 26<br>\nTolerance-ID: expand-r4-deprecated-status-representation<br>\nRecord-ID: 307d55c7-f148-4ddc-a360-3962e4e2fe7c, 131242e8-b7fb-4c3a-a45b-680355b8a70f</p>\n<p>In R4 $expand responses, prod and dev represent deprecated code status differently in two ways:</p>\n<p><strong>1. Per-code deprecated annotations on expansion.contains entries</strong></p>\n<ul><li><strong>security-labels (18 records)</strong>: Prod uses R4-compatible extension <code>http://hl7.org/fhir/5.0/StructureDefinition/extension-ValueSet.expansion.contains.property</code> to convey <code>status: deprecated</code>. Dev uses R5-native <code>property</code> elements directly (e.g., <code>&quot;property&quot;: [{&quot;code&quot;: &quot;status&quot;, &quot;valueCode&quot;: &quot;deprecated&quot;}]</code>). The R4 spec does not define <code>property</code> on <code>expansion.contains</code> — that was introduced in R5.</li></ul>\n<ul><li><strong>patient-contactrelationship (5 records) + v3-TribalEntityUS (3 records)</strong>: Prod annotates deprecated codes with the same R5 backport extension. Dev omits the deprecated status annotation entirely — no extension and no property.</li></ul>\n<p><strong>2. Expansion-level property declaration extension</strong></p>\n<p>Prod includes an expansion-level extension <code>http://hl7.org/fhir/5.0/StructureDefinition/extension-ValueSet.expansion.property</code> that declares the &quot;status&quot; property used in per-code annotations. Dev either omits this entirely (patient-contactrelationship) or includes it with different key ordering (TribalEntityUS). This is the R5 backport mechanism for declaring expansion properties in R4.</p>\n<p><strong>How widespread</strong></p>\n<p>26 expand records across 3 ValueSets. All are R4 $expand operations containing codes from HL7 terminology CodeSystems with deprecated entries.</p>\n<pre><code class=\"lang-bash\">grep &#x27;extension-ValueSet.expansion.contains.property&#x27; jobs/2026-02-round-2/results/deltas/deltas.ndjson | wc -l\ngrep &#x27;extension-ValueSet.expansion.property&#x27; jobs/2026-02-round-2/results/deltas/deltas.ndjson | wc -l</code></pre>\n<p><strong>Tolerance</strong></p>\n<p>Tolerance <code>expand-r4-deprecated-status-representation</code> normalizes by stripping both per-code annotations (R5 backport extension and R5-native property) and the expansion-level property declaration extension from both sides. This eliminates the structural difference so other content differences can still surface.</p>", "impact": 26}, {"id": "af1ce69", "title": "validate-code: dev renders null status as literal 'null' in inactive concept message", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-2", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 10:52", "date_iso": "2026-02-08T10:52:57-06:00", "body_md": "Records-Impacted: 24\nTolerance-ID: validate-code-null-status-in-message\nRecord-ID: 20db1af0-c1c6-4f83-9019-2aaeff9ef549\n\n## Repro\n\n```bash\n# Prod\ncurl -s 'https://tx.fhir.org/r4/CodeSystem/$validate-code?url=http:%2F%2Fwww.nlm.nih.gov%2Fresearch%2Fumls%2Frxnorm&code=70618&_format=json' \\\n  -H 'Accept: application/fhir+json' | jq -r '.parameter[] | select(.name == \"message\") | .valueString'\n\n# Dev\ncurl -s 'https://tx-dev.fhir.org/r4/CodeSystem/$validate-code?url=http:%2F%2Fwww.nlm.nih.gov%2Fresearch%2Fumls%2Frxnorm&code=70618&_format=json' \\\n  -H 'Accept: application/fhir+json' | jq -r '.parameter[] | select(.name == \"message\") | .valueString'\n```\n\nProd returns `\"The concept '70618' has a status of  and its use should be reviewed\"` (empty string for status), dev returns `\"The concept '70618' has a status of null and its use should be reviewed\"` (literal word \"null\").\n\n## What differs\n\nIn $validate-code responses for inactive concepts, the message and issues text differ in how a missing status value is rendered:\n\n- Prod: `\"The concept '70618' has a status of  and its use should be reviewed\"` (empty string for status)\n- Dev: `\"The concept '70618' has a status of null and its use should be reviewed\"` (literal word \"null\")\n\nBoth servers agree on result=true, inactive=true, display, system, and version. The only difference is this string interpolation of a null/missing status value in the INACTIVE_CONCEPT_FOUND message.\n\n## How widespread\n\n24 records in the current delta file, all identical: GET /r4/CodeSystem/$validate-code for RxNorm code 70618. The same underlying pattern (empty vs \"null\" in status message) also affects 20 NDC records already covered by a separate tolerance (ndc-validate-code-extra-inactive-params, bug 7258b41).\n\nSearch: `grep 'has a status of  and' results/deltas/deltas.ndjson | wc -l` → 24\nAll 24 are validate-code operations on http://www.nlm.nih.gov/research/umls/rxnorm, code 70618.\n\n## What the tolerance covers\n\nTolerance ID: validate-code-null-status-in-message\nMatches: validate-code Parameters responses where prod message contains \"status of \" (empty) and dev message contains \"status of null\" at the same position. Normalizes both message and issues text by replacing \"status of null\" with \"status of \" (prod's rendering) in dev. Eliminates 24 delta records.", "body_html": "<p>Records-Impacted: 24<br>\nTolerance-ID: validate-code-null-status-in-message<br>\nRecord-ID: 20db1af0-c1c6-4f83-9019-2aaeff9ef549</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod\ncurl -s &#x27;https://tx.fhir.org/r4/CodeSystem/$validate-code?url=http:%2F%2Fwww.nlm.nih.gov%2Fresearch%2Fumls%2Frxnorm&amp;code=70618&amp;_format=json&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; | jq -r &#x27;.parameter[] | select(.name == &quot;message&quot;) | .valueString&#x27;\n\n# Dev\ncurl -s &#x27;https://tx-dev.fhir.org/r4/CodeSystem/$validate-code?url=http:%2F%2Fwww.nlm.nih.gov%2Fresearch%2Fumls%2Frxnorm&amp;code=70618&amp;_format=json&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; | jq -r &#x27;.parameter[] | select(.name == &quot;message&quot;) | .valueString&#x27;</code></pre>\n<p>Prod returns <code>&quot;The concept &#x27;70618&#x27; has a status of  and its use should be reviewed&quot;</code> (empty string for status), dev returns <code>&quot;The concept &#x27;70618&#x27; has a status of null and its use should be reviewed&quot;</code> (literal word &quot;null&quot;).</p>\n<h2>What differs</h2>\n<p>In $validate-code responses for inactive concepts, the message and issues text differ in how a missing status value is rendered:</p>\n<ul><li>Prod: <code>&quot;The concept &#x27;70618&#x27; has a status of  and its use should be reviewed&quot;</code> (empty string for status)</li><li>Dev: <code>&quot;The concept &#x27;70618&#x27; has a status of null and its use should be reviewed&quot;</code> (literal word &quot;null&quot;)</li></ul>\n<p>Both servers agree on result=true, inactive=true, display, system, and version. The only difference is this string interpolation of a null/missing status value in the INACTIVE_CONCEPT_FOUND message.</p>\n<h2>How widespread</h2>\n<p>24 records in the current delta file, all identical: GET /r4/CodeSystem/$validate-code for RxNorm code 70618. The same underlying pattern (empty vs &quot;null&quot; in status message) also affects 20 NDC records already covered by a separate tolerance (ndc-validate-code-extra-inactive-params, bug 7258b41).</p>\n<p>Search: <code>grep &#x27;has a status of  and&#x27; results/deltas/deltas.ndjson | wc -l</code> → 24<br>\nAll 24 are validate-code operations on <a href=\"http://www.nlm.nih.gov/research/umls/rxnorm,\" target=\"_blank\">http://www.nlm.nih.gov/research/umls/rxnorm,</a> code 70618.</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance ID: validate-code-null-status-in-message<br>\nMatches: validate-code Parameters responses where prod message contains &quot;status of &quot; (empty) and dev message contains &quot;status of null&quot; at the same position. Normalizes both message and issues text by replacing &quot;status of null&quot; with &quot;status of &quot; (prod&#x27;s rendering) in dev. Eliminates 24 delta records.</p>", "impact": 24}, {"id": "3071698", "title": "Dev  omits limitedExpansion parameter when expansion is truncated", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-3", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-11 20:26", "date_iso": "2026-02-11T20:26:45-06:00", "body_md": "Records-Impacted: 24\nTolerance-ID: expand-missing-limited-expansion\nRecord-ID: 5b67c797-72f0-45ff-b8ca-a9b57e6fddb1\n\n## Repro\n\n```bash\n# Prod\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$expand' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"_incomplete\",\"valueBoolean\":true},{\"name\":\"count\",\"valueInteger\":1000},{\"name\":\"offset\",\"valueInteger\":0},{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/ValueSet/observation-codes\"}]}'\n\n# Dev\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$expand' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"_incomplete\",\"valueBoolean\":true},{\"name\":\"count\",\"valueInteger\":1000},{\"name\":\"offset\",\"valueInteger\":0},{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/ValueSet/observation-codes\"}]}'\n```\n\n**Prod** returns (in `expansion.parameter`):\n> `{\"name\": \"limitedExpansion\", \"valueBoolean\": true}`, `{\"name\": \"offset\", \"valueInteger\": 0}`, `{\"name\": \"count\", \"valueInteger\": 1000}`, `{\"name\": \"used-codesystem\", \"valueUri\": \"http://loinc.org|2.81\"}`\n\n**Dev** returns (in `expansion.parameter`):\n> `{\"name\": \"offset\", \"valueInteger\": 0}`, `{\"name\": \"count\", \"valueInteger\": 1000}`, `{\"name\": \"used-codesystem\", \"valueUri\": \"http://loinc.org|2.81\"}`\n\nBoth return 1000 codes in `expansion.contains`. Prod includes `limitedExpansion: true` to signal the expansion is truncated; dev omits it entirely.\n\n## What differs\n\nFor $expand operations where the request includes `_incomplete: true` (which maps to the `limitedExpansion` expansion parameter), prod includes `limitedExpansion: true` in `expansion.parameter` to signal that the expansion was truncated. Dev omits this parameter entirely.\n\nThis affects large expansions (e.g., all LOINC codes via `observation-codes` ValueSet, all SNOMED codes) where the returned count is capped (e.g., count=1000) and the actual code system has far more codes. The `limitedExpansion` parameter tells clients that the expansion is incomplete — without it, a client cannot distinguish between \"these are all the codes\" and \"there are more codes not shown.\"\n\nIn all 24 affected records:\n- Both servers return 200 with the same number of codes (e.g., 1000)\n- Both use the same code system versions (e.g., LOINC 2.81)\n- Prod includes `{name: \"limitedExpansion\", valueBoolean: true}` in expansion.parameter\n- Dev omits it\n\n## How widespread\n\n24 records across both /r4/ and /r5/ $expand operations. All are POST ValueSet/$expand requests with `_incomplete: true` in the request parameters. The affected expansions span multiple code systems including LOINC, SNOMED, and others where the total code count exceeds the requested count limit.\n\nSearch: `grep 'limitedExpansion' results/deltas/deltas.ndjson | wc -l` → 24\n\nOf these 24 records:\n- 10 have limitedExpansion as the only remaining difference\n- 14 have limitedExpansion plus other differences (e.g., missing used-codesystem, warning-experimental params)\n\n## What the tolerance covers\n\nTolerance `expand-missing-limited-expansion` matches $expand responses where prod has `limitedExpansion: true` in expansion.parameter and dev doesn't. Normalizes by stripping the parameter from prod.\n\n## Representative record IDs\n\n- `5b67c797-72f0-45ff-b8ca-a9b57e6fddb1`: POST /r4/ValueSet/$expand — LOINC observation-codes, count=1000, _incomplete=true", "body_html": "<p>Records-Impacted: 24<br>\nTolerance-ID: expand-missing-limited-expansion<br>\nRecord-ID: 5b67c797-72f0-45ff-b8ca-a9b57e6fddb1</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod\ncurl -s &#x27;https://tx.fhir.org/r4/ValueSet/$expand&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;_incomplete&quot;,&quot;valueBoolean&quot;:true},{&quot;name&quot;:&quot;count&quot;,&quot;valueInteger&quot;:1000},{&quot;name&quot;:&quot;offset&quot;,&quot;valueInteger&quot;:0},{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/ValueSet/observation-codes&quot;}]}&#x27;\n\n# Dev\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;_incomplete&quot;,&quot;valueBoolean&quot;:true},{&quot;name&quot;:&quot;count&quot;,&quot;valueInteger&quot;:1000},{&quot;name&quot;:&quot;offset&quot;,&quot;valueInteger&quot;:0},{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/ValueSet/observation-codes&quot;}]}&#x27;</code></pre>\n<p><strong>Prod</strong> returns (in <code>expansion.parameter</code>):<br>\n&gt; <code>{&quot;name&quot;: &quot;limitedExpansion&quot;, &quot;valueBoolean&quot;: true}</code>, <code>{&quot;name&quot;: &quot;offset&quot;, &quot;valueInteger&quot;: 0}</code>, <code>{&quot;name&quot;: &quot;count&quot;, &quot;valueInteger&quot;: 1000}</code>, <code>{&quot;name&quot;: &quot;used-codesystem&quot;, &quot;valueUri&quot;: &quot;http://loinc.org|2.81&quot;}</code></p>\n<p><strong>Dev</strong> returns (in <code>expansion.parameter</code>):<br>\n&gt; <code>{&quot;name&quot;: &quot;offset&quot;, &quot;valueInteger&quot;: 0}</code>, <code>{&quot;name&quot;: &quot;count&quot;, &quot;valueInteger&quot;: 1000}</code>, <code>{&quot;name&quot;: &quot;used-codesystem&quot;, &quot;valueUri&quot;: &quot;http://loinc.org|2.81&quot;}</code></p>\n<p>Both return 1000 codes in <code>expansion.contains</code>. Prod includes <code>limitedExpansion: true</code> to signal the expansion is truncated; dev omits it entirely.</p>\n<h2>What differs</h2>\n<p>For $expand operations where the request includes <code>_incomplete: true</code> (which maps to the <code>limitedExpansion</code> expansion parameter), prod includes <code>limitedExpansion: true</code> in <code>expansion.parameter</code> to signal that the expansion was truncated. Dev omits this parameter entirely.</p>\n<p>This affects large expansions (e.g., all LOINC codes via <code>observation-codes</code> ValueSet, all SNOMED codes) where the returned count is capped (e.g., count=1000) and the actual code system has far more codes. The <code>limitedExpansion</code> parameter tells clients that the expansion is incomplete — without it, a client cannot distinguish between &quot;these are all the codes&quot; and &quot;there are more codes not shown.&quot;</p>\n<p>In all 24 affected records:</p>\n<ul><li>Both servers return 200 with the same number of codes (e.g., 1000)</li><li>Both use the same code system versions (e.g., LOINC 2.81)</li><li>Prod includes <code>{name: &quot;limitedExpansion&quot;, valueBoolean: true}</code> in expansion.parameter</li><li>Dev omits it</li></ul>\n<h2>How widespread</h2>\n<p>24 records across both /r4/ and /r5/ $expand operations. All are POST ValueSet/$expand requests with <code>_incomplete: true</code> in the request parameters. The affected expansions span multiple code systems including LOINC, SNOMED, and others where the total code count exceeds the requested count limit.</p>\n<p>Search: <code>grep &#x27;limitedExpansion&#x27; results/deltas/deltas.ndjson | wc -l</code> → 24</p>\n<p>Of these 24 records:</p>\n<ul><li>10 have limitedExpansion as the only remaining difference</li><li>14 have limitedExpansion plus other differences (e.g., missing used-codesystem, warning-experimental params)</li></ul>\n<h2>What the tolerance covers</h2>\n<p>Tolerance <code>expand-missing-limited-expansion</code> matches $expand responses where prod has <code>limitedExpansion: true</code> in expansion.parameter and dev doesn&#x27;t. Normalizes by stripping the parameter from prod.</p>\n<h2>Representative record IDs</h2>\n<ul><li><code>5b67c797-72f0-45ff-b8ca-a9b57e6fddb1</code>: POST /r4/ValueSet/$expand — LOINC observation-codes, count=1000, _incomplete=true</li></ul>", "impact": 24}, {"id": "c7004d3", "title": "Dev omits valueset-toocostly extension and adds spurious used-codesystem on  for grammar-based code systems", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-2", "round:2026-02-round-3", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-11 20:22", "date_iso": "2026-02-11T20:22:46-06:00", "body_md": "Records-Impacted: 22\nTolerance-ID: expand-toocostly-extension-and-used-codesystem\nRecord-ID: a272aa8c-96d7-4905-a75a-ea21d67b83fc\n\n## Repro\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$expand' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"_incomplete\",\"valueBoolean\":true},{\"name\":\"count\",\"valueInteger\":1000},{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"url\":\"http://hl7.org/fhir/ValueSet/mimetypes\",\"compose\":{\"include\":[{\"system\":\"urn:ietf:bcp:13\"}]}}}]}' \\\n  | jq '.expansion.extension, [.expansion.parameter[] | select(.name == \"used-codesystem\")]'\n```\n\n```bash\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$expand' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"_incomplete\",\"valueBoolean\":true},{\"name\":\"count\",\"valueInteger\":1000},{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"url\":\"http://hl7.org/fhir/ValueSet/mimetypes\",\"compose\":{\"include\":[{\"system\":\"urn:ietf:bcp:13\"}]}}}]}' \\\n  | jq '.expansion.extension, [.expansion.parameter[] | select(.name == \"used-codesystem\")]'\n```\n\nProd returns `expansion.extension` with `valueset-toocostly: true`, dev returns `null`. Dev includes `used-codesystem: urn:ietf:bcp:13` in parameters, prod does not.\n\n## What differs\n\nFor $expand on grammar-based code systems (primarily BCP-13 MIME types via `urn:ietf:bcp:13`, plus all-languages), both prod and dev return 200 with an empty expansion (total=0, no `contains`). However:\n\n1. **Prod includes `expansion.extension` with `valueset-toocostly: true`; dev omits it.** This extension signals that the expansion could not be performed because the code system is grammar-based or too costly to enumerate. Prod correctly marks these expansions; dev does not.\n\n2. **Dev includes `expansion.parameter` with `used-codesystem` (e.g., `urn:ietf:bcp:13`); prod omits it.** Dev reports which code system it consulted, even though the expansion returned no results. Prod does not report a used-codesystem on these too-costly expansions.\n\nBoth differences always co-occur in the same records.\n\n## How widespread\n\n- **Round 2**: 13 records (12 mimetypes, 1 Brazilian ValueSet)\n- **Round 3**: 9 records (all mimetypes via `urn:ietf:bcp:13`)\n- Total: ~22 records across both rounds\n- All are $expand operations with both sides returning 200 and expansion total=0\n- Both /r4/ and /r5/ FHIR versions affected\n\n## Tolerances\n\n- `expand-toocostly-extension-and-used-codesystem` — matches $expand where both return 200, prod has `valueset-toocostly` extension but dev doesn't. Normalizes by stripping the toocostly extension from prod and any dev-only `used-codesystem` parameters.\n\n## Representative records\n\n- `a272aa8c-96d7-4905-a75a-ea21d67b83fc` — POST /r4/ValueSet/$expand, mimetypes (round-2)\n- `b3b6b035-dd81-463b-a210-d9cdd67e0250` — POST /r4/ValueSet/$expand, mimetypes (round-3)", "body_html": "<p>Records-Impacted: 22<br>\nTolerance-ID: expand-toocostly-extension-and-used-codesystem<br>\nRecord-ID: a272aa8c-96d7-4905-a75a-ea21d67b83fc</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/ValueSet/$expand&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;_incomplete&quot;,&quot;valueBoolean&quot;:true},{&quot;name&quot;:&quot;count&quot;,&quot;valueInteger&quot;:1000},{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;url&quot;:&quot;http://hl7.org/fhir/ValueSet/mimetypes&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;urn:ietf:bcp:13&quot;}]}}}]}&#x27; \\\n  | jq &#x27;.expansion.extension, [.expansion.parameter[] | select(.name == &quot;used-codesystem&quot;)]&#x27;</code></pre>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;_incomplete&quot;,&quot;valueBoolean&quot;:true},{&quot;name&quot;:&quot;count&quot;,&quot;valueInteger&quot;:1000},{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;url&quot;:&quot;http://hl7.org/fhir/ValueSet/mimetypes&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;urn:ietf:bcp:13&quot;}]}}}]}&#x27; \\\n  | jq &#x27;.expansion.extension, [.expansion.parameter[] | select(.name == &quot;used-codesystem&quot;)]&#x27;</code></pre>\n<p>Prod returns <code>expansion.extension</code> with <code>valueset-toocostly: true</code>, dev returns <code>null</code>. Dev includes <code>used-codesystem: urn:ietf:bcp:13</code> in parameters, prod does not.</p>\n<h2>What differs</h2>\n<p>For $expand on grammar-based code systems (primarily BCP-13 MIME types via <code>urn:ietf:bcp:13</code>, plus all-languages), both prod and dev return 200 with an empty expansion (total=0, no <code>contains</code>). However:</p>\n<ol><li>**Prod includes <code>expansion.extension</code> with <code>valueset-toocostly: true</code>; dev omits it.** This extension signals that the expansion could not be performed because the code system is grammar-based or too costly to enumerate. Prod correctly marks these expansions; dev does not.</li></ol>\n<ol><li>**Dev includes <code>expansion.parameter</code> with <code>used-codesystem</code> (e.g., <code>urn:ietf:bcp:13</code>); prod omits it.** Dev reports which code system it consulted, even though the expansion returned no results. Prod does not report a used-codesystem on these too-costly expansions.</li></ol>\n<p>Both differences always co-occur in the same records.</p>\n<h2>How widespread</h2>\n<ul><li><strong>Round 2</strong>: 13 records (12 mimetypes, 1 Brazilian ValueSet)</li><li><strong>Round 3</strong>: 9 records (all mimetypes via <code>urn:ietf:bcp:13</code>)</li><li>Total: ~22 records across both rounds</li><li>All are $expand operations with both sides returning 200 and expansion total=0</li><li>Both /r4/ and /r5/ FHIR versions affected</li></ul>\n<h2>Tolerances</h2>\n<ul><li><code>expand-toocostly-extension-and-used-codesystem</code> — matches $expand where both return 200, prod has <code>valueset-toocostly</code> extension but dev doesn&#x27;t. Normalizes by stripping the toocostly extension from prod and any dev-only <code>used-codesystem</code> parameters.</li></ul>\n<h2>Representative records</h2>\n<ul><li><code>a272aa8c-96d7-4905-a75a-ea21d67b83fc</code> — POST /r4/ValueSet/$expand, mimetypes (round-2)</li><li><code>b3b6b035-dd81-463b-a210-d9cdd67e0250</code> — POST /r4/ValueSet/$expand, mimetypes (round-3)</li></ul>", "impact": 22}, {"id": "f9e35f6", "title": "validate-code: version-not-found issue text and count differ due to code system version skew", "status": "open", "labels": ["content-differs", "no-repro-needed", "round:2026-02-round-3", "tx-compare", "version-skew", "wont-fix"], "author": "Claude (AI Assistant)", "date": "2026-02-11 20:10", "date_iso": "2026-02-11T20:10:00-06:00", "body_md": "Records-Impacted: 19\nTolerance-ID: version-not-found-skew\nRecord-ID: 91de2c9c-52d4-4038-b525-d2ace69ec62e\n\n## What differs\n\nWhen `$validate-code` returns `result: false` and includes issues about unknown code system versions (\"A definition for CodeSystem '...' version '...' could not be found, so the code cannot be validated. Valid versions: ...\"), prod and dev differ in two ways:\n\n1. **Valid versions lists differ**: The \"Valid versions: ...\" text lists different available editions. For example, for SNOMED CT, prod lists editions like `449081005/version/20250510` and `900000000000207008/version/20240801` that dev doesn't have, while dev lists `731000124108/version/20230301` that prod doesn't.\n\n2. **Extra not-found issues on dev**: Dev sometimes reports additional not-found errors for code system versions that prod considers valid. For example, dev reports LOINC version 2.77 as \"could not be found\" (only knows 2.81), while prod has both 2.77 and 2.81 loaded.\n\nBoth servers agree `result=false`. The differences are only in the explanatory details about which versions are available, caused by different code system editions loaded on each server.\n\nAffected code systems include: SNOMED CT, LOINC, ICD-11, observation-category, PHIN VS, and various other code systems where available versions differ between prod and dev.\n\n## How widespread\n\n19 records eliminated by this tolerance. All are content-differs validate-code (both CodeSystem and ValueSet endpoints), all with both prod and dev returning result=false. Found via: `content-differs validate-code with both result=false and \"could not be found, so the code cannot be validated\" in issues, where stripping those issues and the message param makes prod and dev identical`.\n\n## What the tolerance covers\n\nTolerance `version-not-found-skew` matches validate-code records where both result=false and at least one issue contains \"could not be found, so the code cannot be validated\". Normalizes by stripping all such issues and the message parameter from both sides. After stripping, the remaining issues are identical between prod and dev, confirming these are pure version-skew differences.\n\nRepresentative record IDs:\n- 91de2c9c-52d4-4038-b525-d2ace69ec62e (LOINC 2.77 + SNOMED version skew)\n- 49648ad8-3e20-4181-82d8-... (SNOMED-only version skew)\n- 05fc8815-b9cc-4fdd-b0ed-... (scc_primary code system)", "body_html": "<p>Records-Impacted: 19<br>\nTolerance-ID: version-not-found-skew<br>\nRecord-ID: 91de2c9c-52d4-4038-b525-d2ace69ec62e</p>\n<h2>What differs</h2>\n<p>When <code>$validate-code</code> returns <code>result: false</code> and includes issues about unknown code system versions (&quot;A definition for CodeSystem &#x27;...&#x27; version &#x27;...&#x27; could not be found, so the code cannot be validated. Valid versions: ...&quot;), prod and dev differ in two ways:</p>\n<ol><li><strong>Valid versions lists differ</strong>: The &quot;Valid versions: ...&quot; text lists different available editions. For example, for SNOMED CT, prod lists editions like <code>449081005/version/20250510</code> and <code>900000000000207008/version/20240801</code> that dev doesn&#x27;t have, while dev lists <code>731000124108/version/20230301</code> that prod doesn&#x27;t.</li></ol>\n<ol><li><strong>Extra not-found issues on dev</strong>: Dev sometimes reports additional not-found errors for code system versions that prod considers valid. For example, dev reports LOINC version 2.77 as &quot;could not be found&quot; (only knows 2.81), while prod has both 2.77 and 2.81 loaded.</li></ol>\n<p>Both servers agree <code>result=false</code>. The differences are only in the explanatory details about which versions are available, caused by different code system editions loaded on each server.</p>\n<p>Affected code systems include: SNOMED CT, LOINC, ICD-11, observation-category, PHIN VS, and various other code systems where available versions differ between prod and dev.</p>\n<h2>How widespread</h2>\n<p>19 records eliminated by this tolerance. All are content-differs validate-code (both CodeSystem and ValueSet endpoints), all with both prod and dev returning result=false. Found via: <code>content-differs validate-code with both result=false and &quot;could not be found, so the code cannot be validated&quot; in issues, where stripping those issues and the message param makes prod and dev identical</code>.</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance <code>version-not-found-skew</code> matches validate-code records where both result=false and at least one issue contains &quot;could not be found, so the code cannot be validated&quot;. Normalizes by stripping all such issues and the message parameter from both sides. After stripping, the remaining issues are identical between prod and dev, confirming these are pure version-skew differences.</p>\n<p>Representative record IDs:</p>\n<ul><li>91de2c9c-52d4-4038-b525-d2ace69ec62e (LOINC 2.77 + SNOMED version skew)</li><li>49648ad8-3e20-4181-82d8-... (SNOMED-only version skew)</li><li>05fc8815-b9cc-4fdd-b0ed-... (scc_primary code system)</li></ul>", "impact": 19}, {"id": "1932f81", "title": "Dev returns SQLITE_MISUSE error on RxNorm-related $expand requests", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-2", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 10:52", "date_iso": "2026-02-08T10:52:55-06:00", "body_md": "Records-Impacted: 16\nTolerance-ID: dev-sqlite-misuse-expand-rxnorm\nRecord-ID: e108a92a-a962-45b4-ad35-e0aa4fe4cf32\n\n## Repro\n\n```bash\n# Prod\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$expand?_limit=1000&_incomplete=true' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\n  \"resourceType\": \"Parameters\",\n  \"parameter\": [\n    {\n      \"name\": \"x-system-cache-id\",\n      \"valueString\": \"dc8fd4bc-091a-424a-8a3b-6198ef146891\"\n    },\n    {\n      \"name\": \"includeDefinition\",\n      \"valueBoolean\": false\n    },\n    {\n      \"name\": \"excludeNested\",\n      \"valueBoolean\": false\n    },\n    {\n      \"name\": \"valueSet\",\n      \"resource\": {\n        \"resourceType\": \"ValueSet\",\n        \"status\": \"active\",\n        \"compose\": {\n          \"inactive\": true,\n          \"include\": [\n            {\n              \"system\": \"http://www.nlm.nih.gov/research/umls/rxnorm\"\n            }\n          ]\n        }\n      }\n    },\n    {\n      \"name\": \"_limit\",\n      \"valueString\": \"1000\"\n    },\n    {\n      \"name\": \"_incomplete\",\n      \"valueString\": \"true\"\n    }\n  ]\n}'\n\n# Dev\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$expand?_limit=1000&_incomplete=true' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\n  \"resourceType\": \"Parameters\",\n  \"parameter\": [\n    {\n      \"name\": \"x-system-cache-id\",\n      \"valueString\": \"dc8fd4bc-091a-424a-8a3b-6198ef146891\"\n    },\n    {\n      \"name\": \"includeDefinition\",\n      \"valueBoolean\": false\n    },\n    {\n      \"name\": \"excludeNested\",\n      \"valueBoolean\": false\n    },\n    {\n      \"name\": \"valueSet\",\n      \"resource\": {\n        \"resourceType\": \"ValueSet\",\n        \"status\": \"active\",\n        \"compose\": {\n          \"inactive\": true,\n          \"include\": [\n            {\n              \"system\": \"http://www.nlm.nih.gov/research/umls/rxnorm\"\n            }\n          ]\n        }\n      }\n    },\n    {\n      \"name\": \"_limit\",\n      \"valueString\": \"1000\"\n    },\n    {\n      \"name\": \"_incomplete\",\n      \"valueString\": \"true\"\n    }\n  ]\n}'\n```\n\nProd returns 500 with `\"fdb_sqlite3_objects error: no such column: cui1\"` (specific database schema error). Dev returns 500 with `\"SQLITE_MISUSE: not an error\"` (generic SQLite misuse error).\n\n## What differs\n\nDev returns 500 with error message \"SQLITE_MISUSE: not an error\" on POST /r4/ValueSet/$expand requests involving RxNorm-related code systems. This affects two sub-patterns:\n\n1. **8 records (both 500)**: Prod also returns 500 but with a different, more descriptive SQLite error: \"fdb_sqlite3_objects error: no such column: cui1\". Both servers crash, but dev's error is generic/unhelpful while prod's points to a specific database schema issue.\n\n2. **8 records (prod 422, dev 500)**: Prod returns 422 with a proper error message like \"A definition for CodeSystem 'https://hl7.org/fhir/sid/ndc' could not be found, so the value set cannot be expanded\". Dev crashes with 500 SQLITE_MISUSE instead of returning a proper error response.\n\nAll 16 records are POST requests to /r4/ValueSet/$expand?_limit=1000&_incomplete=true with request bodies that include RxNorm (http://www.nlm.nih.gov/research/umls/rxnorm) in the ValueSet compose.\n\n## How widespread\n\n16 records total in the dataset. All are expand operations on the same URL pattern. Searched with:\n  grep -c 'SQLITE_MISUSE' results/deltas/deltas.ndjson  → 16\n\nAll have the same dev error text \"SQLITE_MISUSE: not an error\". The prod responses vary between internal SQLite errors (500) and proper FHIR error responses (422).\n\n## What the tolerance covers\n\nTolerance ID: dev-sqlite-misuse-expand-rxnorm\nMatches records where the dev response is an OperationOutcome containing \"SQLITE_MISUSE\" in the error details, on $expand operations. Skips the entire record since dev's crash prevents meaningful content comparison.\nEliminates 16 records.", "body_html": "<p>Records-Impacted: 16<br>\nTolerance-ID: dev-sqlite-misuse-expand-rxnorm<br>\nRecord-ID: e108a92a-a962-45b4-ad35-e0aa4fe4cf32</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod\ncurl -s &#x27;https://tx.fhir.org/r4/ValueSet/$expand?_limit=1000&amp;_incomplete=true&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{\n  &quot;resourceType&quot;: &quot;Parameters&quot;,\n  &quot;parameter&quot;: [\n    {\n      &quot;name&quot;: &quot;x-system-cache-id&quot;,\n      &quot;valueString&quot;: &quot;dc8fd4bc-091a-424a-8a3b-6198ef146891&quot;\n    },\n    {\n      &quot;name&quot;: &quot;includeDefinition&quot;,\n      &quot;valueBoolean&quot;: false\n    },\n    {\n      &quot;name&quot;: &quot;excludeNested&quot;,\n      &quot;valueBoolean&quot;: false\n    },\n    {\n      &quot;name&quot;: &quot;valueSet&quot;,\n      &quot;resource&quot;: {\n        &quot;resourceType&quot;: &quot;ValueSet&quot;,\n        &quot;status&quot;: &quot;active&quot;,\n        &quot;compose&quot;: {\n          &quot;inactive&quot;: true,\n          &quot;include&quot;: [\n            {\n              &quot;system&quot;: &quot;http://www.nlm.nih.gov/research/umls/rxnorm&quot;\n            }\n          ]\n        }\n      }\n    },\n    {\n      &quot;name&quot;: &quot;_limit&quot;,\n      &quot;valueString&quot;: &quot;1000&quot;\n    },\n    {\n      &quot;name&quot;: &quot;_incomplete&quot;,\n      &quot;valueString&quot;: &quot;true&quot;\n    }\n  ]\n}&#x27;\n\n# Dev\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand?_limit=1000&amp;_incomplete=true&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{\n  &quot;resourceType&quot;: &quot;Parameters&quot;,\n  &quot;parameter&quot;: [\n    {\n      &quot;name&quot;: &quot;x-system-cache-id&quot;,\n      &quot;valueString&quot;: &quot;dc8fd4bc-091a-424a-8a3b-6198ef146891&quot;\n    },\n    {\n      &quot;name&quot;: &quot;includeDefinition&quot;,\n      &quot;valueBoolean&quot;: false\n    },\n    {\n      &quot;name&quot;: &quot;excludeNested&quot;,\n      &quot;valueBoolean&quot;: false\n    },\n    {\n      &quot;name&quot;: &quot;valueSet&quot;,\n      &quot;resource&quot;: {\n        &quot;resourceType&quot;: &quot;ValueSet&quot;,\n        &quot;status&quot;: &quot;active&quot;,\n        &quot;compose&quot;: {\n          &quot;inactive&quot;: true,\n          &quot;include&quot;: [\n            {\n              &quot;system&quot;: &quot;http://www.nlm.nih.gov/research/umls/rxnorm&quot;\n            }\n          ]\n        }\n      }\n    },\n    {\n      &quot;name&quot;: &quot;_limit&quot;,\n      &quot;valueString&quot;: &quot;1000&quot;\n    },\n    {\n      &quot;name&quot;: &quot;_incomplete&quot;,\n      &quot;valueString&quot;: &quot;true&quot;\n    }\n  ]\n}&#x27;</code></pre>\n<p>Prod returns 500 with <code>&quot;fdb_sqlite3_objects error: no such column: cui1&quot;</code> (specific database schema error). Dev returns 500 with <code>&quot;SQLITE_MISUSE: not an error&quot;</code> (generic SQLite misuse error).</p>\n<h2>What differs</h2>\n<p>Dev returns 500 with error message &quot;SQLITE_MISUSE: not an error&quot; on POST /r4/ValueSet/$expand requests involving RxNorm-related code systems. This affects two sub-patterns:</p>\n<ol><li><strong>8 records (both 500)</strong>: Prod also returns 500 but with a different, more descriptive SQLite error: &quot;fdb_sqlite3_objects error: no such column: cui1&quot;. Both servers crash, but dev&#x27;s error is generic/unhelpful while prod&#x27;s points to a specific database schema issue.</li></ol>\n<ol><li><strong>8 records (prod 422, dev 500)</strong>: Prod returns 422 with a proper error message like &quot;A definition for CodeSystem &#x27;<a href=\"https://hl7.org/fhir/sid/ndc&#x27;\" target=\"_blank\">https://hl7.org/fhir/sid/ndc&#x27;</a> could not be found, so the value set cannot be expanded&quot;. Dev crashes with 500 SQLITE_MISUSE instead of returning a proper error response.</li></ol>\n<p>All 16 records are POST requests to /r4/ValueSet/$expand?_limit=1000&amp;_incomplete=true with request bodies that include RxNorm (<a href=\"http://www.nlm.nih.gov/research/umls/rxnorm\" target=\"_blank\">http://www.nlm.nih.gov/research/umls/rxnorm</a>) in the ValueSet compose.</p>\n<h2>How widespread</h2>\n<p>16 records total in the dataset. All are expand operations on the same URL pattern. Searched with:<br>\ngrep -c &#x27;SQLITE_MISUSE&#x27; results/deltas/deltas.ndjson  → 16</p>\n<p>All have the same dev error text &quot;SQLITE_MISUSE: not an error&quot;. The prod responses vary between internal SQLite errors (500) and proper FHIR error responses (422).</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance ID: dev-sqlite-misuse-expand-rxnorm<br>\nMatches records where the dev response is an OperationOutcome containing &quot;SQLITE_MISUSE&quot; in the error details, on $expand operations. Skips the entire record since dev&#x27;s crash prevents meaningful content comparison.<br>\nEliminates 16 records.</p>", "impact": 16}, {"id": "ccb86ff", "title": "Dev crashes (500) on valid $expand requests with JavaScript TypeErrors", "status": "open", "labels": ["dev-crash-on-valid", "repro-inconclusive", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:37", "date_iso": "2026-02-08T13:37:59-06:00", "body_md": "Records-Impacted: 15\nTolerance-ID: expand-dev-crash-on-valid\nRecord-ID: 7598431b-1c90-409c-b8f2-2be8358e8be3\n\n\nProd returns 200 with valid ValueSet expansion; dev returns 500 with OperationOutcome containing JavaScript TypeErrors. Two distinct error messages observed:\n\n1. `vs.expansion.parameter is not iterable` (1 record) — triggered when expanding `http://hl7.org/fhir/us/core/ValueSet/us-core-pregnancy-status`\n2. `exp.addParamUri is not a function` (14 records) — triggered when expanding Verily phenotype ValueSets (e.g., `http://fhir.verily.com/ValueSet/verily-phenotype-*`)\n\nBoth are unhandled JS TypeErrors during the expand code path, causing 500 instead of a valid expansion.\n\n\n15 records in deltas, all `POST /r4/ValueSet/$expand` with prod=200, dev=500:\n\n```\ngrep '\"dev-crash-on-valid\"' results/deltas/deltas.ndjson | grep expand | wc -l\n```\n\nThe `addParamUri` errors are all Verily phenotype ValueSets (14 records). The `parameter is not iterable` error affects 1 US Core ValueSet.\n\n\nTolerance `expand-dev-crash-on-valid` matches POST /r4/ValueSet/$expand where prod=200 and dev=500. Eliminates all 15 records.\n\n\n- `7598431b-1c90-409c-b8f2-2be8358e8be3` (parameter is not iterable)\n- `9ec233b5-f523-4ec4-b4f9-fcdf8b63d17f` (addParamUri)", "body_html": "<p>Records-Impacted: 15<br>\nTolerance-ID: expand-dev-crash-on-valid<br>\nRecord-ID: 7598431b-1c90-409c-b8f2-2be8358e8be3</p>\n<p>Prod returns 200 with valid ValueSet expansion; dev returns 500 with OperationOutcome containing JavaScript TypeErrors. Two distinct error messages observed:</p>\n<ol><li><code>vs.expansion.parameter is not iterable</code> (1 record) — triggered when expanding <code>http://hl7.org/fhir/us/core/ValueSet/us-core-pregnancy-status</code></li><li><code>exp.addParamUri is not a function</code> (14 records) — triggered when expanding Verily phenotype ValueSets (e.g., <code>http://fhir.verily.com/ValueSet/verily-phenotype-*</code>)</li></ol>\n<p>Both are unhandled JS TypeErrors during the expand code path, causing 500 instead of a valid expansion.</p>\n<p>15 records in deltas, all <code>POST /r4/ValueSet/$expand</code> with prod=200, dev=500:</p>\n<pre><code>grep &#x27;&quot;dev-crash-on-valid&quot;&#x27; results/deltas/deltas.ndjson | grep expand | wc -l</code></pre>\n<p>The <code>addParamUri</code> errors are all Verily phenotype ValueSets (14 records). The <code>parameter is not iterable</code> error affects 1 US Core ValueSet.</p>\n<p>Tolerance <code>expand-dev-crash-on-valid</code> matches POST /r4/ValueSet/$expand where prod=200 and dev=500. Eliminates all 15 records.</p>\n<ul><li><code>7598431b-1c90-409c-b8f2-2be8358e8be3</code> (parameter is not iterable)</li><li><code>9ec233b5-f523-4ec4-b4f9-fcdf8b63d17f</code> (addParamUri)</li></ul>", "impact": 15}, {"id": "d05a4a6", "title": "Dev omits retired status-check informational issues in validate-code OperationOutcome", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-2", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 10:52", "date_iso": "2026-02-08T10:52:57-06:00", "body_md": "Records-Impacted: 13\nTolerance-ID: missing-retired-status-check-issue\nRecord-ID: dc21c18a-fd57-429c-a51b-54bbfd23753f\n\n## Repro\n\n```bash\n# Prod\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$validate-code?url=http:%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fsecurity-labels%7C4.0.1&code=code8&_format=json&system=urn:ihe:xds:scheme8' \\\n  -H 'Accept: application/fhir+json'\n\n# Dev\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$validate-code?url=http:%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fsecurity-labels%7C4.0.1&code=code8&_format=json&system=urn:ihe:xds:scheme8' \\\n  -H 'Accept: application/fhir+json'\n```\n\nProd returns 3 OperationOutcome issues: an informational `status-check` issue (\"Reference to retired ValueSet http://terminology.hl7.org/ValueSet/v3-ActUSPrivacyLaw|3.0.0\") plus two error-level issues (UNKNOWN_CODESYSTEM and not-in-vs). Dev returns only the 2 error-level issues, omitting the retired status-check informational issue entirely.\n\n## What differs\n\nWhen validating a code against a ValueSet that includes a retired sub-ValueSet, prod returns an informational status-check issue in the OperationOutcome reporting the retired reference. Dev omits this issue entirely.\n\nSpecifically, for validate-code on `http://hl7.org/fhir/ValueSet/security-labels|4.0.1` (which composes `http://terminology.hl7.org/ValueSet/v3-ActUSPrivacyLaw|3.0.0`, a retired ValueSet), prod includes:\n\n```json\n{\n  \"severity\": \"information\",\n  \"code\": \"business-rule\",\n  \"details\": {\n    \"coding\": [{\"system\": \"http://hl7.org/fhir/tools/CodeSystem/tx-issue-type\", \"code\": \"status-check\"}],\n    \"text\": \"Reference to retired ValueSet http://terminology.hl7.org/ValueSet/v3-ActUSPrivacyLaw|3.0.0\"\n  }\n}\n```\n\nDev's OperationOutcome has no such issue. All other parameters (result, system, code, message, and the two error-level issues) match between prod and dev.\n\n## How widespread\n\n13 records in deltas.ndjson. All are GET validate-code requests on `http://hl7.org/fhir/ValueSet/security-labels|4.0.1` with system `urn:ihe:xds:scheme8`. Found via:\n```\ngrep 'status-check' results/deltas/deltas.ndjson | wc -l\n```\n\nNote: the existing `hl7-terminology-cs-version-skew` tolerance already strips *draft* status-check issues for `terminology.hl7.org/CodeSystem/*` systems (bug 6edc96c). This is a separate pattern — *retired* status-check issues for ValueSet composition references.\n\n## What the tolerance covers\n\nTolerance `missing-retired-status-check-issue` strips informational status-check issues containing \"retired\" from prod's OperationOutcome, matching any validate-code operation where prod has a retired status-check issue and dev does not. Eliminates 13 records.", "body_html": "<p>Records-Impacted: 13<br>\nTolerance-ID: missing-retired-status-check-issue<br>\nRecord-ID: dc21c18a-fd57-429c-a51b-54bbfd23753f</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod\ncurl -s &#x27;https://tx.fhir.org/r4/ValueSet/$validate-code?url=http:%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fsecurity-labels%7C4.0.1&amp;code=code8&amp;_format=json&amp;system=urn:ihe:xds:scheme8&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;\n\n# Dev\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$validate-code?url=http:%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fsecurity-labels%7C4.0.1&amp;code=code8&amp;_format=json&amp;system=urn:ihe:xds:scheme8&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;</code></pre>\n<p>Prod returns 3 OperationOutcome issues: an informational <code>status-check</code> issue (&quot;Reference to retired ValueSet <a href=\"http://terminology.hl7.org/ValueSet/v3-ActUSPrivacyLaw|3.0.0&quot;\" target=\"_blank\">http://terminology.hl7.org/ValueSet/v3-ActUSPrivacyLaw|3.0.0&quot;</a>) plus two error-level issues (UNKNOWN_CODESYSTEM and not-in-vs). Dev returns only the 2 error-level issues, omitting the retired status-check informational issue entirely.</p>\n<h2>What differs</h2>\n<p>When validating a code against a ValueSet that includes a retired sub-ValueSet, prod returns an informational status-check issue in the OperationOutcome reporting the retired reference. Dev omits this issue entirely.</p>\n<p>Specifically, for validate-code on <code>http://hl7.org/fhir/ValueSet/security-labels|4.0.1</code> (which composes <code>http://terminology.hl7.org/ValueSet/v3-ActUSPrivacyLaw|3.0.0</code>, a retired ValueSet), prod includes:</p>\n<pre><code class=\"lang-json\">{\n  &quot;severity&quot;: &quot;information&quot;,\n  &quot;code&quot;: &quot;business-rule&quot;,\n  &quot;details&quot;: {\n    &quot;coding&quot;: [{&quot;system&quot;: &quot;http://hl7.org/fhir/tools/CodeSystem/tx-issue-type&quot;, &quot;code&quot;: &quot;status-check&quot;}],\n    &quot;text&quot;: &quot;Reference to retired ValueSet http://terminology.hl7.org/ValueSet/v3-ActUSPrivacyLaw|3.0.0&quot;\n  }\n}</code></pre>\n<p>Dev&#x27;s OperationOutcome has no such issue. All other parameters (result, system, code, message, and the two error-level issues) match between prod and dev.</p>\n<h2>How widespread</h2>\n<p>13 records in deltas.ndjson. All are GET validate-code requests on <code>http://hl7.org/fhir/ValueSet/security-labels|4.0.1</code> with system <code>urn:ihe:xds:scheme8</code>. Found via:</p>\n<pre><code>grep &#x27;status-check&#x27; results/deltas/deltas.ndjson | wc -l</code></pre>\n<p>Note: the existing <code>hl7-terminology-cs-version-skew</code> tolerance already strips <em>draft</em> status-check issues for <code>terminology.hl7.org/CodeSystem/*</code> systems (bug 6edc96c). This is a separate pattern — <em>retired</em> status-check issues for ValueSet composition references.</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance <code>missing-retired-status-check-issue</code> strips informational status-check issues containing &quot;retired&quot; from prod&#x27;s OperationOutcome, matching any validate-code operation where prod has a retired status-check issue and dev does not. Eliminates 13 records.</p>", "impact": 13}, {"id": "f33161f", "title": "Dev returns 400 error instead of 200 toocostly expansion for grammar-based code systems", "status": "open", "labels": ["reproduced", "round:2026-02-round-2", "status-mismatch", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 10:52", "date_iso": "2026-02-08T10:52:57-06:00", "body_md": "Records-Impacted: 12\nTolerance-ID: expand-toocostly-grammar-400\nRecord-ID: 4a993d89-3f8b-444d-9a63-e95c6944c4a7\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$expand' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"x-system-cache-id\",\"valueString\":\"dc8fd4bc-091a-424a-8a3b-6198ef146891\"},{\"name\":\"defaultDisplayLanguage\",\"valueCode\":\"en-US\"},{\"name\":\"_limit\",\"valueInteger\":10000},{\"name\":\"_incomplete\",\"valueBoolean\":true},{\"name\":\"displayLanguage\",\"valueCode\":\"en\"},{\"name\":\"count\",\"valueInteger\":1000},{\"name\":\"offset\",\"valueInteger\":0},{\"name\":\"excludeNested\",\"valueBoolean\":false},{\"name\":\"cache-id\",\"valueId\":\"26888bd4-58f1-4cae-b379-f6f52937a918\"},{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"id\":\"all-languages\",\"status\":\"active\",\"compose\":{\"include\":[{\"system\":\"urn:ietf:bcp:47\"}]}}}]}'\n\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$expand' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"x-system-cache-id\",\"valueString\":\"dc8fd4bc-091a-424a-8a3b-6198ef146891\"},{\"name\":\"defaultDisplayLanguage\",\"valueCode\":\"en-US\"},{\"name\":\"_limit\",\"valueInteger\":10000},{\"name\":\"_incomplete\",\"valueBoolean\":true},{\"name\":\"displayLanguage\",\"valueCode\":\"en\"},{\"name\":\"count\",\"valueInteger\":1000},{\"name\":\"offset\",\"valueInteger\":0},{\"name\":\"excludeNested\",\"valueBoolean\":false},{\"name\":\"cache-id\",\"valueId\":\"26888bd4-58f1-4cae-b379-f6f52937a918\"},{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"id\":\"all-languages\",\"status\":\"active\",\"compose\":{\"include\":[{\"system\":\"urn:ietf:bcp:47\"}]}}}]}'\n```\n\nProd returns HTTP 200 with a ValueSet containing the `valueset-toocostly` extension (`valueBoolean: true`) and `limitedExpansion` parameter. Dev returns HTTP 400 with an OperationOutcome: `code: \"too-costly\"`, message: `\"The code System \\\"urn:ietf:bcp:47\\\" has a grammar, and cannot be enumerated directly\"`.\n\n\nWhen expanding a ValueSet that includes a grammar-based code system (BCP-47 `urn:ietf:bcp:47` or SNOMED CT `http://snomed.info/sct`) without any filter constraints, prod returns HTTP 200 with a ValueSet containing the `valueset-toocostly` extension and `limitedExpansion` parameter (indicating the expansion is too large to enumerate). Dev instead returns HTTP 400 with an OperationOutcome error (`code: \"too-costly\"`, message: \"The code System ... has a grammar, and cannot be enumerated directly\").\n\nProd's approach (returning a ValueSet with the toocostly extension) is the expected FHIR behavior for expansions that are too costly to compute — it signals the condition without failing the request.\n\n\n12 records in the comparison dataset show this pattern:\n- 8 records involve BCP-47 (`urn:ietf:bcp:47`), including the `all-languages` ValueSet\n- 4 records involve SNOMED CT (`http://snomed.info/sct`)\n- Affects both /r4/ and /r5/ endpoints\n- All are POST /r{4,5}/ValueSet/$expand requests\n\nSearch: `grep 'has a grammar' deltas.ndjson` finds 223 matches across all records (most already handled by existing tolerances), but filtering to status-mismatch expand records with prod=200/dev=400 and dev issue code \"too-costly\" yields exactly 12.\n\n\nTolerance ID: `expand-toocostly-grammar-400`. Matches $expand requests where prod returns 200 with the `valueset-toocostly` extension and dev returns 400 with an OperationOutcome containing issue code \"too-costly\". Skips these records entirely since the status codes and response formats are incomparable.\n\n\n- `4a993d89-3f8b-444d-9a63-e95c6944c4a7` (BCP-47, /r4/)\n- `b96706f9-c555-40e7-bdd2-f682fe2d5d88` (SNOMED, /r4/)\n- `d61127b2-3ed1-4deb-b11b-b8ccc77185ed` (BCP-47, /r5/)", "body_html": "<p>Records-Impacted: 12<br>\nTolerance-ID: expand-toocostly-grammar-400<br>\nRecord-ID: 4a993d89-3f8b-444d-9a63-e95c6944c4a7</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/ValueSet/$expand&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;x-system-cache-id&quot;,&quot;valueString&quot;:&quot;dc8fd4bc-091a-424a-8a3b-6198ef146891&quot;},{&quot;name&quot;:&quot;defaultDisplayLanguage&quot;,&quot;valueCode&quot;:&quot;en-US&quot;},{&quot;name&quot;:&quot;_limit&quot;,&quot;valueInteger&quot;:10000},{&quot;name&quot;:&quot;_incomplete&quot;,&quot;valueBoolean&quot;:true},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueCode&quot;:&quot;en&quot;},{&quot;name&quot;:&quot;count&quot;,&quot;valueInteger&quot;:1000},{&quot;name&quot;:&quot;offset&quot;,&quot;valueInteger&quot;:0},{&quot;name&quot;:&quot;excludeNested&quot;,&quot;valueBoolean&quot;:false},{&quot;name&quot;:&quot;cache-id&quot;,&quot;valueId&quot;:&quot;26888bd4-58f1-4cae-b379-f6f52937a918&quot;},{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;id&quot;:&quot;all-languages&quot;,&quot;status&quot;:&quot;active&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;urn:ietf:bcp:47&quot;}]}}}]}&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;x-system-cache-id&quot;,&quot;valueString&quot;:&quot;dc8fd4bc-091a-424a-8a3b-6198ef146891&quot;},{&quot;name&quot;:&quot;defaultDisplayLanguage&quot;,&quot;valueCode&quot;:&quot;en-US&quot;},{&quot;name&quot;:&quot;_limit&quot;,&quot;valueInteger&quot;:10000},{&quot;name&quot;:&quot;_incomplete&quot;,&quot;valueBoolean&quot;:true},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueCode&quot;:&quot;en&quot;},{&quot;name&quot;:&quot;count&quot;,&quot;valueInteger&quot;:1000},{&quot;name&quot;:&quot;offset&quot;,&quot;valueInteger&quot;:0},{&quot;name&quot;:&quot;excludeNested&quot;,&quot;valueBoolean&quot;:false},{&quot;name&quot;:&quot;cache-id&quot;,&quot;valueId&quot;:&quot;26888bd4-58f1-4cae-b379-f6f52937a918&quot;},{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;id&quot;:&quot;all-languages&quot;,&quot;status&quot;:&quot;active&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;urn:ietf:bcp:47&quot;}]}}}]}&#x27;</code></pre>\n<p>Prod returns HTTP 200 with a ValueSet containing the <code>valueset-toocostly</code> extension (<code>valueBoolean: true</code>) and <code>limitedExpansion</code> parameter. Dev returns HTTP 400 with an OperationOutcome: <code>code: &quot;too-costly&quot;</code>, message: <code>&quot;The code System \\&quot;urn:ietf:bcp:47\\&quot; has a grammar, and cannot be enumerated directly&quot;</code>.</p>\n<p>When expanding a ValueSet that includes a grammar-based code system (BCP-47 <code>urn:ietf:bcp:47</code> or SNOMED CT <code>http://snomed.info/sct</code>) without any filter constraints, prod returns HTTP 200 with a ValueSet containing the <code>valueset-toocostly</code> extension and <code>limitedExpansion</code> parameter (indicating the expansion is too large to enumerate). Dev instead returns HTTP 400 with an OperationOutcome error (<code>code: &quot;too-costly&quot;</code>, message: &quot;The code System ... has a grammar, and cannot be enumerated directly&quot;).</p>\n<p>Prod&#x27;s approach (returning a ValueSet with the toocostly extension) is the expected FHIR behavior for expansions that are too costly to compute — it signals the condition without failing the request.</p>\n<p>12 records in the comparison dataset show this pattern:</p>\n<ul><li>8 records involve BCP-47 (<code>urn:ietf:bcp:47</code>), including the <code>all-languages</code> ValueSet</li><li>4 records involve SNOMED CT (<code>http://snomed.info/sct</code>)</li><li>Affects both /r4/ and /r5/ endpoints</li><li>All are POST /r{4,5}/ValueSet/$expand requests</li></ul>\n<p>Search: <code>grep &#x27;has a grammar&#x27; deltas.ndjson</code> finds 223 matches across all records (most already handled by existing tolerances), but filtering to status-mismatch expand records with prod=200/dev=400 and dev issue code &quot;too-costly&quot; yields exactly 12.</p>\n<p>Tolerance ID: <code>expand-toocostly-grammar-400</code>. Matches $expand requests where prod returns 200 with the <code>valueset-toocostly</code> extension and dev returns 400 with an OperationOutcome containing issue code &quot;too-costly&quot;. Skips these records entirely since the status codes and response formats are incomparable.</p>\n<ul><li><code>4a993d89-3f8b-444d-9a63-e95c6944c4a7</code> (BCP-47, /r4/)</li><li><code>b96706f9-c555-40e7-bdd2-f682fe2d5d88</code> (SNOMED, /r4/)</li><li><code>d61127b2-3ed1-4deb-b11b-b8ccc77185ed</code> (BCP-47, /r5/)</li></ul>", "impact": 12}, {"id": "16f1bf2", "title": "Dev $expand includes extra ValueSet metadata (contact) that prod omits", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:37", "date_iso": "2026-02-08T13:37:59-06:00", "body_md": "Records-Impacted: 12\nTolerance-ID: expand-dev-extra-contact-metadata\nRecord-ID: 80d06a63-cebf-4a33-af1b-583b4f6a1c10\n\n\nDev includes the `contact` field in `$expand` responses; prod omits it. Reproduce with any of these ValueSets:\n\n**medicationrequest-category** (contact has URL only):\n```bash\ncurl -s -H 'Accept: application/fhir+json' \\\n'https://tx.fhir.org/r4/ValueSet/$expand?url=http://hl7.org/fhir/ValueSet/medicationrequest-category&count=0' \\\n| python3 -c \"import sys,json; d=json.load(sys.stdin); print('contact' in d)\"\n\ncurl -s -H 'Accept: application/fhir+json' \\\n'https://tx-dev.fhir.org/r4/ValueSet/$expand?url=http://hl7.org/fhir/ValueSet/medicationrequest-category&count=0' \\\n| python3 -c \"import sys,json; d=json.load(sys.stdin); print('contact' in d, d.get('contact'))\"\n```\n\n**administrative-gender** (contact has URL + email):\n```bash\ncurl -s -H 'Accept: application/fhir+json' \\\n'https://tx-dev.fhir.org/r4/ValueSet/$expand?url=http://hl7.org/fhir/ValueSet/administrative-gender&count=0' \\\n| python3 -c \"import sys,json; d=json.load(sys.stdin); print('contact' in d, d.get('contact'))\"\n```\n\nOther affected ValueSets include: `address-type`, `address-use`, `identifier-use`, `gender-identity`, `iso3166-1-2`, `languages`, `mimetypes`, `name-use`.\n\n\nDev $expand responses include the ValueSet `contact` field (publisher contact information) that prod omits from expansion results. The contact data comes from the source ValueSet definition and contains HL7 FHIR contact info such as:\n\n- `{\"telecom\": [{\"system\": \"url\", \"value\": \"http://hl7.org/fhir\"}]}`\n- `{\"telecom\": [{\"system\": \"url\", \"value\": \"http://hl7.org/fhir\"}, {\"system\": \"email\", \"value\": \"fhir@lists.hl7.org\"}]}`\n\nProd strips this metadata from the expansion response; dev passes it through.\n\n\n12 records in deltas, 59 in the full comparison dataset (others already eliminated by existing tolerances). All are $expand operations on /r4/ValueSet/$expand. Matched with:\n\n```\ngrep '\"contact\":[' deltas.ndjson  # in devBody\n```\n\nFiltered to cases where dev has contact but prod does not.\n\n\nTolerance `expand-dev-extra-contact-metadata` matches ValueSet $expand responses where dev has a `contact` field and prod does not. It strips the `contact` field from dev to normalize both sides. Eliminates 12 delta records (9 where contact was the sole remaining difference, 3 where other differences also exist — those 3 will remain in deltas due to the other differences).\n\n\n`80d06a63-cebf-4a33-af1b-583b4f6a1c10` — POST /r4/ValueSet/$expand for medicationrequest-category ValueSet. Dev includes `contact: [{telecom: [{system: \"url\", value: \"http://hl7.org/fhir\"}]}]`, prod omits it.", "body_html": "<p>Records-Impacted: 12<br>\nTolerance-ID: expand-dev-extra-contact-metadata<br>\nRecord-ID: 80d06a63-cebf-4a33-af1b-583b4f6a1c10</p>\n<p>Dev includes the <code>contact</code> field in <code>$expand</code> responses; prod omits it. Reproduce with any of these ValueSets:</p>\n<p><strong>medicationrequest-category</strong> (contact has URL only):</p>\n<pre><code class=\"lang-bash\">curl -s -H &#x27;Accept: application/fhir+json&#x27; \\\n&#x27;https://tx.fhir.org/r4/ValueSet/$expand?url=http://hl7.org/fhir/ValueSet/medicationrequest-category&amp;count=0&#x27; \\\n| python3 -c &quot;import sys,json; d=json.load(sys.stdin); print(&#x27;contact&#x27; in d)&quot;\n\ncurl -s -H &#x27;Accept: application/fhir+json&#x27; \\\n&#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand?url=http://hl7.org/fhir/ValueSet/medicationrequest-category&amp;count=0&#x27; \\\n| python3 -c &quot;import sys,json; d=json.load(sys.stdin); print(&#x27;contact&#x27; in d, d.get(&#x27;contact&#x27;))&quot;</code></pre>\n<p><strong>administrative-gender</strong> (contact has URL + email):</p>\n<pre><code class=\"lang-bash\">curl -s -H &#x27;Accept: application/fhir+json&#x27; \\\n&#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand?url=http://hl7.org/fhir/ValueSet/administrative-gender&amp;count=0&#x27; \\\n| python3 -c &quot;import sys,json; d=json.load(sys.stdin); print(&#x27;contact&#x27; in d, d.get(&#x27;contact&#x27;))&quot;</code></pre>\n<p>Other affected ValueSets include: <code>address-type</code>, <code>address-use</code>, <code>identifier-use</code>, <code>gender-identity</code>, <code>iso3166-1-2</code>, <code>languages</code>, <code>mimetypes</code>, <code>name-use</code>.</p>\n<p>Dev $expand responses include the ValueSet <code>contact</code> field (publisher contact information) that prod omits from expansion results. The contact data comes from the source ValueSet definition and contains HL7 FHIR contact info such as:</p>\n<ul><li><code>{&quot;telecom&quot;: [{&quot;system&quot;: &quot;url&quot;, &quot;value&quot;: &quot;http://hl7.org/fhir&quot;}]}</code></li><li><code>{&quot;telecom&quot;: [{&quot;system&quot;: &quot;url&quot;, &quot;value&quot;: &quot;http://hl7.org/fhir&quot;}, {&quot;system&quot;: &quot;email&quot;, &quot;value&quot;: &quot;fhir@lists.hl7.org&quot;}]}</code></li></ul>\n<p>Prod strips this metadata from the expansion response; dev passes it through.</p>\n<p>12 records in deltas, 59 in the full comparison dataset (others already eliminated by existing tolerances). All are $expand operations on /r4/ValueSet/$expand. Matched with:</p>\n<pre><code>grep &#x27;&quot;contact&quot;:[&#x27; deltas.ndjson  # in devBody</code></pre>\n<p>Filtered to cases where dev has contact but prod does not.</p>\n<p>Tolerance <code>expand-dev-extra-contact-metadata</code> matches ValueSet $expand responses where dev has a <code>contact</code> field and prod does not. It strips the <code>contact</code> field from dev to normalize both sides. Eliminates 12 delta records (9 where contact was the sole remaining difference, 3 where other differences also exist — those 3 will remain in deltas due to the other differences).</p>\n<p><code>80d06a63-cebf-4a33-af1b-583b4f6a1c10</code> — POST /r4/ValueSet/$expand for medicationrequest-category ValueSet. Dev includes <code>contact: [{telecom: [{system: &quot;url&quot;, value: &quot;http://hl7.org/fhir&quot;}]}]</code>, prod omits it.</p>", "impact": 12}, {"id": "c31a8fe", "title": "Dev  succeeds (200) where prod refuses with too-costly (422) for grammar/large code systems", "status": "open", "labels": ["reproduced", "round:2026-02-round-1", "status-mismatch", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:37", "date_iso": "2026-02-08T13:37:59-06:00", "body_md": "Records-Impacted: 12\nTolerance-ID: expand-too-costly-succeeds\nRecord-ID: 4fe6282f-ccf2-4340-9758-cbc70b7d2b79\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$expand' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"compose\":{\"include\":[{\"system\":\"http://www.ama-assn.org/go/cpt\"}]}}}]}'\n\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$expand' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"compose\":{\"include\":[{\"system\":\"http://www.ama-assn.org/go/cpt\"}]}}}]}'\n```\n\nProd returns HTTP 422 with OperationOutcome code `too-costly`: \"The code System has a grammar, and cannot be enumerated directly\". Dev returns HTTP 200 with a ValueSet expansion containing 7 CPT codes (99202, 99203, 0001A, 25, P1, 1P, F1).\n\n\nProd returns HTTP 422 with an OperationOutcome containing issue code `too-costly` for certain $expand requests. Dev returns HTTP 200 with a successful ValueSet expansion containing codes.\n\nProd's error messages fall into two patterns:\n- \"The code System \\\"X\\\" has a grammar, and cannot be enumerated directly\" (10 records: 8 CPT, 2 BCP-13/MIME types)\n- \"The value set '' expansion has too many codes to display (>10000)\" (2 records: NDC)\n\nDev expands these successfully, returning actual codes. For example, for CPT, dev returns 7 codes with full display text; for NDC, dev returns total=0 (empty expansion).\n\n\n12 records, all POST /r4/ValueSet/$expand, all with prodStatus=422 and devStatus=200.\n\nBreakdown by code system:\n- 8 records: http://www.ama-assn.org/go/cpt (CPT)\n- 2 records: urn:ietf:bcp:13 (MIME types)\n- 2 records: http://hl7.org/fhir/sid/ndc (NDC — \"too many codes\" variant)\n\nSearch: `grep '\"prodStatus\":422,\"devStatus\":200' results/deltas/deltas.ndjson | wc -l` → 12\n\n\nTolerance ID: `expand-too-costly-succeeds`. Matches POST /r4/ValueSet/$expand where prod.status=422 and dev.status=200, and prod body contains issue code `too-costly`. Skips the record. Eliminates all 12 records.\n\n\n- 4fe6282f-ccf2-4340-9758-cbc70b7d2b79 (CPT grammar)\n- d1360bdd-814e-4da9-af67-e4c9e145f3f1 (BCP-13 grammar)\n- 3a9f2a04-94d7-431a-95dd-af16ff2ee3f7 (NDC too many codes)", "body_html": "<p>Records-Impacted: 12<br>\nTolerance-ID: expand-too-costly-succeeds<br>\nRecord-ID: 4fe6282f-ccf2-4340-9758-cbc70b7d2b79</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/ValueSet/$expand&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;http://www.ama-assn.org/go/cpt&quot;}]}}}]}&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;http://www.ama-assn.org/go/cpt&quot;}]}}}]}&#x27;</code></pre>\n<p>Prod returns HTTP 422 with OperationOutcome code <code>too-costly</code>: &quot;The code System has a grammar, and cannot be enumerated directly&quot;. Dev returns HTTP 200 with a ValueSet expansion containing 7 CPT codes (99202, 99203, 0001A, 25, P1, 1P, F1).</p>\n<p>Prod returns HTTP 422 with an OperationOutcome containing issue code <code>too-costly</code> for certain $expand requests. Dev returns HTTP 200 with a successful ValueSet expansion containing codes.</p>\n<p>Prod&#x27;s error messages fall into two patterns:</p>\n<ul><li>&quot;The code System \\&quot;X\\&quot; has a grammar, and cannot be enumerated directly&quot; (10 records: 8 CPT, 2 BCP-13/MIME types)</li><li>&quot;The value set &#x27;&#x27; expansion has too many codes to display (&gt;10000)&quot; (2 records: NDC)</li></ul>\n<p>Dev expands these successfully, returning actual codes. For example, for CPT, dev returns 7 codes with full display text; for NDC, dev returns total=0 (empty expansion).</p>\n<p>12 records, all POST /r4/ValueSet/$expand, all with prodStatus=422 and devStatus=200.</p>\n<p>Breakdown by code system:</p>\n<ul><li>8 records: <a href=\"http://www.ama-assn.org/go/cpt\" target=\"_blank\">http://www.ama-assn.org/go/cpt</a> (CPT)</li><li>2 records: urn:ietf:bcp:13 (MIME types)</li><li>2 records: <a href=\"http://hl7.org/fhir/sid/ndc\" target=\"_blank\">http://hl7.org/fhir/sid/ndc</a> (NDC — &quot;too many codes&quot; variant)</li></ul>\n<p>Search: <code>grep &#x27;&quot;prodStatus&quot;:422,&quot;devStatus&quot;:200&#x27; results/deltas/deltas.ndjson | wc -l</code> → 12</p>\n<p>Tolerance ID: <code>expand-too-costly-succeeds</code>. Matches POST /r4/ValueSet/$expand where prod.status=422 and dev.status=200, and prod body contains issue code <code>too-costly</code>. Skips the record. Eliminates all 12 records.</p>\n<ul><li>4fe6282f-ccf2-4340-9758-cbc70b7d2b79 (CPT grammar)</li><li>d1360bdd-814e-4da9-af67-e4c9e145f3f1 (BCP-13 grammar)</li><li>3a9f2a04-94d7-431a-95dd-af16ff2ee3f7 (NDC too many codes)</li></ul>", "impact": 12}, {"id": "674611c", "title": "Dev returns extra 'message' parameter with filter-miss warnings on successful validate-code", "status": "open", "labels": ["content-differs", "repro-inconclusive", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:37", "date_iso": "2026-02-08T13:37:59-06:00", "body_md": "Records-Impacted: 12\nTolerance-ID: validate-code-extra-filter-miss-message\nRecord-ID: 7c3bf322-7db7-42f5-82d6-dd1ef9bd9588\n\n\n**Status: Inconclusive** -- the IPS ValueSets (e.g. `allergies-intolerances-uv-ips|2.0.0`) used in all 12 affected records are not loaded on the public tx.fhir.org / tx-dev.fhir.org servers, so the original requests cannot be replayed. The request bodies were not stored in the comparison records.\n\nAttempted:\n1. Reconstructed POST to `/r4/ValueSet/$validate-code` for SNOMED 716186003 against `http://hl7.org/fhir/uv/ips/ValueSet/allergies-intolerances-uv-ips` (with and without version) -- both servers return \"value Set could not be found\"\n2. Checked 33 related delta records -- only IPS ValueSet records (not publicly available) match the exact bug pattern (result=true on both, dev extra message, prod no message)\n3. Non-IPS records (medication-form-codes, us-core-encounter-type) show a different pattern (result=false on both sides, different message content)\n\n\nOn $validate-code requests against ValueSets with multiple include filters (e.g. IPS allergies-intolerances, medical-devices), when the code is valid (result=true, found in at least one filter), dev returns an extra `message` parameter containing \"Code X is not in the specified filter\" for each filter the code did NOT match. Prod omits the `message` parameter entirely when the overall result is true.\n\nExample (record 7c3bf322):\n- Prod: result=true, no message parameter\n- Dev: result=true, message=\"Code 716186003 is not in the specified filter; Code 716186003 is not in the specified filter; Code 716186003 is not in the specified filter\"\n\nThe code 716186003 (No known allergy) is valid in the IPS allergies ValueSet but only matches the 4th include filter (concept<<716186003). Dev reports failure messages for the 3 filters it didn't match.\n\n\n12 records in deltas.ndjson, all POST /r4/ValueSet/$validate-code with result=true. All involve SNOMED codes against IPS ValueSets with multiple include filters. Found via:\n```\ngrep 'extra-in-dev' results/deltas/deltas.ndjson | grep '\"message\"' → 23 hits\n```\nOf those, 12 have this pattern (single diff: extra-in-dev:message, result=true on both sides, dev message contains \"is not in the specified filter\", prod has no message param).\n\nThe remaining 11 are different patterns (multiple diffs, result=false, or different message content).\n\n\nTolerance ID: validate-code-extra-filter-miss-message\nMatches: validate-code where result=true on both sides, dev has a `message` parameter that prod lacks, and the dev message matches the pattern \"is not in the specified filter\".\nNormalizes: strips the extra `message` parameter from dev.", "body_html": "<p>Records-Impacted: 12<br>\nTolerance-ID: validate-code-extra-filter-miss-message<br>\nRecord-ID: 7c3bf322-7db7-42f5-82d6-dd1ef9bd9588</p>\n<p><strong>Status: Inconclusive</strong> -- the IPS ValueSets (e.g. <code>allergies-intolerances-uv-ips|2.0.0</code>) used in all 12 affected records are not loaded on the public tx.fhir.org / tx-dev.fhir.org servers, so the original requests cannot be replayed. The request bodies were not stored in the comparison records.</p>\n<p>Attempted:</p>\n<ol><li>Reconstructed POST to <code>/r4/ValueSet/$validate-code</code> for SNOMED 716186003 against <code>http://hl7.org/fhir/uv/ips/ValueSet/allergies-intolerances-uv-ips</code> (with and without version) -- both servers return &quot;value Set could not be found&quot;</li><li>Checked 33 related delta records -- only IPS ValueSet records (not publicly available) match the exact bug pattern (result=true on both, dev extra message, prod no message)</li><li>Non-IPS records (medication-form-codes, us-core-encounter-type) show a different pattern (result=false on both sides, different message content)</li></ol>\n<p>On $validate-code requests against ValueSets with multiple include filters (e.g. IPS allergies-intolerances, medical-devices), when the code is valid (result=true, found in at least one filter), dev returns an extra <code>message</code> parameter containing &quot;Code X is not in the specified filter&quot; for each filter the code did NOT match. Prod omits the <code>message</code> parameter entirely when the overall result is true.</p>\n<p>Example (record 7c3bf322):</p>\n<ul><li>Prod: result=true, no message parameter</li><li>Dev: result=true, message=&quot;Code 716186003 is not in the specified filter; Code 716186003 is not in the specified filter; Code 716186003 is not in the specified filter&quot;</li></ul>\n<p>The code 716186003 (No known allergy) is valid in the IPS allergies ValueSet but only matches the 4th include filter (concept&lt;&lt;716186003). Dev reports failure messages for the 3 filters it didn&#x27;t match.</p>\n<p>12 records in deltas.ndjson, all POST /r4/ValueSet/$validate-code with result=true. All involve SNOMED codes against IPS ValueSets with multiple include filters. Found via:</p>\n<pre><code>grep &#x27;extra-in-dev&#x27; results/deltas/deltas.ndjson | grep &#x27;&quot;message&quot;&#x27; → 23 hits</code></pre>\n<p>Of those, 12 have this pattern (single diff: extra-in-dev:message, result=true on both sides, dev message contains &quot;is not in the specified filter&quot;, prod has no message param).</p>\n<p>The remaining 11 are different patterns (multiple diffs, result=false, or different message content).</p>\n<p>Tolerance ID: validate-code-extra-filter-miss-message<br>\nMatches: validate-code where result=true on both sides, dev has a <code>message</code> parameter that prod lacks, and the dev message matches the pattern &quot;is not in the specified filter&quot;.<br>\nNormalizes: strips the extra <code>message</code> parameter from dev.</p>", "impact": 12}, {"id": "1433eb6", "title": "Dev returns 400 ValueSet-not-found for validate-code requests that prod handles successfully (10 records)", "status": "open", "labels": ["reproduced", "round:2026-02-round-2", "status-mismatch", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 10:52", "date_iso": "2026-02-08T10:52:55-06:00", "body_md": "Records-Impacted: 10\nTolerance-ID: validate-code-valueset-not-found-dev-400\nRecord-ID: 064711fa-e287-430e-a6f4-7ff723952ff1\n\n## Repro\n\n```bash\n# Prod\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$validate-code' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/ValueSet/@all\"},{\"name\":\"codeableConcept\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"http://snomed.info/sct\",\"code\":\"48546005\",\"display\":\"Diazepam-containing product\"}]}},{\"name\":\"displayLanguage\",\"valueCode\":\"en-US\"},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true}]}'\n\n# Dev\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$validate-code' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/ValueSet/@all\"},{\"name\":\"codeableConcept\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"http://snomed.info/sct\",\"code\":\"48546005\",\"display\":\"Diazepam-containing product\"}]}},{\"name\":\"displayLanguage\",\"valueCode\":\"en-US\"},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true}]}'\n```\n\nProd returns HTTP 200 with `{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"result\",\"valueBoolean\":true},...]}` indicating successful validation. Dev returns HTTP 400 with `{\"resourceType\":\"OperationOutcome\",\"issue\":[{\"severity\":\"error\",\"code\":\"not-found\",\"details\":{\"text\":\"A definition for the value Set 'http://hl7.org/fhir/ValueSet/@all' could not be found\"}}]}`.\n\nFor $validate-code requests against certain ValueSets, prod returns HTTP 200 with a valid Parameters response (result=true or result=false), while dev returns HTTP 400 with an OperationOutcome saying \"A definition for the value Set '...' could not be found.\"\n\nProd successfully resolves these ValueSets and performs code validation. Dev fails at the ValueSet resolution step and returns an error instead of a validation result.\n\n\n10 records show this pattern (prod=200, dev=400 with \"could not be found\"):\n\n- 3 records: `nrces.in/ndhm/fhir/r4/ValueSet/ndhm-diagnosis-use*` (Indian NDHM ValueSets)\n- 5 records: `ontariohealth.ca/fhir/ValueSet/*` (Ontario Health ValueSets)\n- 2 records: `hl7.org/fhir/ValueSet/@all` (special @all ValueSet)\n\nSearch: `grep 'could not be found' results/deltas/deltas.ndjson` filtered to prod=200 dev=400\n\nAll are POST /r4/ValueSet/$validate-code requests. The ValueSets come from different IG packages (NDHM India, Ontario Health, and core FHIR @all), so the root cause may be that dev is missing certain IG-provided ValueSet definitions or doesn't support the @all pseudo-ValueSet.\n\n\nTolerance `validate-code-valueset-not-found-dev-400` matches: POST validate-code, prod=200, dev=400, where dev body contains OperationOutcome with \"could not be found\" text. Eliminates all 10 records.\n\n\n- 064711fa-e287-430e-a6f4-7ff723952ff1 (nrces.in ndhm-diagnosis-use--0)\n- 5beceead-a754-4f88-8dec-1a7a931166b9 (ontariohealth.ca symptoms-of-clinical-concern)\n- 38f6e665-4c34-4589-8d29-77c522b97845 (hl7.org/fhir/ValueSet/@all)", "body_html": "<p>Records-Impacted: 10<br>\nTolerance-ID: validate-code-valueset-not-found-dev-400<br>\nRecord-ID: 064711fa-e287-430e-a6f4-7ff723952ff1</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod\ncurl -s &#x27;https://tx.fhir.org/r4/ValueSet/$validate-code&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/ValueSet/@all&quot;},{&quot;name&quot;:&quot;codeableConcept&quot;,&quot;valueCodeableConcept&quot;:{&quot;coding&quot;:[{&quot;system&quot;:&quot;http://snomed.info/sct&quot;,&quot;code&quot;:&quot;48546005&quot;,&quot;display&quot;:&quot;Diazepam-containing product&quot;}]}},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueCode&quot;:&quot;en-US&quot;},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true}]}&#x27;\n\n# Dev\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$validate-code&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/ValueSet/@all&quot;},{&quot;name&quot;:&quot;codeableConcept&quot;,&quot;valueCodeableConcept&quot;:{&quot;coding&quot;:[{&quot;system&quot;:&quot;http://snomed.info/sct&quot;,&quot;code&quot;:&quot;48546005&quot;,&quot;display&quot;:&quot;Diazepam-containing product&quot;}]}},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueCode&quot;:&quot;en-US&quot;},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true}]}&#x27;</code></pre>\n<p>Prod returns HTTP 200 with <code>{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;result&quot;,&quot;valueBoolean&quot;:true},...]}</code> indicating successful validation. Dev returns HTTP 400 with <code>{&quot;resourceType&quot;:&quot;OperationOutcome&quot;,&quot;issue&quot;:[{&quot;severity&quot;:&quot;error&quot;,&quot;code&quot;:&quot;not-found&quot;,&quot;details&quot;:{&quot;text&quot;:&quot;A definition for the value Set &#x27;http://hl7.org/fhir/ValueSet/@all&#x27; could not be found&quot;}}]}</code>.</p>\n<p>For $validate-code requests against certain ValueSets, prod returns HTTP 200 with a valid Parameters response (result=true or result=false), while dev returns HTTP 400 with an OperationOutcome saying &quot;A definition for the value Set &#x27;...&#x27; could not be found.&quot;</p>\n<p>Prod successfully resolves these ValueSets and performs code validation. Dev fails at the ValueSet resolution step and returns an error instead of a validation result.</p>\n<p>10 records show this pattern (prod=200, dev=400 with &quot;could not be found&quot;):</p>\n<ul><li>3 records: <code>nrces.in/ndhm/fhir/r4/ValueSet/ndhm-diagnosis-use*</code> (Indian NDHM ValueSets)</li><li>5 records: <code>ontariohealth.ca/fhir/ValueSet/*</code> (Ontario Health ValueSets)</li><li>2 records: <code>hl7.org/fhir/ValueSet/@all</code> (special @all ValueSet)</li></ul>\n<p>Search: <code>grep &#x27;could not be found&#x27; results/deltas/deltas.ndjson</code> filtered to prod=200 dev=400</p>\n<p>All are POST /r4/ValueSet/$validate-code requests. The ValueSets come from different IG packages (NDHM India, Ontario Health, and core FHIR @all), so the root cause may be that dev is missing certain IG-provided ValueSet definitions or doesn&#x27;t support the @all pseudo-ValueSet.</p>\n<p>Tolerance <code>validate-code-valueset-not-found-dev-400</code> matches: POST validate-code, prod=200, dev=400, where dev body contains OperationOutcome with &quot;could not be found&quot; text. Eliminates all 10 records.</p>\n<ul><li>064711fa-e287-430e-a6f4-7ff723952ff1 (nrces.in ndhm-diagnosis-use--0)</li><li>5beceead-a754-4f88-8dec-1a7a931166b9 (ontariohealth.ca symptoms-of-clinical-concern)</li><li>38f6e665-4c34-4589-8d29-77c522b97845 (hl7.org/fhir/ValueSet/@all)</li></ul>", "impact": 10}, {"id": "80ce6b2", "title": "Dev message parameter omits issue texts when validating CodeableConcept with multiple coding errors", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-2", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 10:52", "date_iso": "2026-02-08T10:52:56-06:00", "body_md": "Records-Impacted: 10\nTolerance-ID: message-concat-selective-issues\nRecord-ID: c350392e-d535-45e3-83cf-924b05e26a14\n\n## Repro\n\n```bash\n# Prod\ncat > /tmp/repro-request.json << 'EOF'\n{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"codeableConcept\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"https://fhir.nwgenomics.nhs.uk/CodeSystem/GenomicClinicalIndication\",\"code\":\"R210\",\"display\":\"Inherited MMR deficiency (Lynch syndrome)\"},{\"system\":\"http://snomed.info/sct\",\"code\":\"1365861003\",\"display\":\"Lynch syndrome gene mutation detected\"}],\"text\":\"Inherited MMR deficiency (Lynch syndrome)\"}},{\"name\":\"displayLanguage\",\"valueString\":\"en-GB\"},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true},{\"name\":\"tx-resource\",\"resource\":{\"resourceType\":\"CodeSystem\",\"id\":\"GenomicClinicalIndication\",\"url\":\"https://fhir.nwgenomics.nhs.uk/CodeSystem/GenomicClinicalIndication\",\"version\":\"0.1.0\",\"name\":\"GenomicClinicalIndication\",\"title\":\"NHS England Genomic Clinical Indication Code\",\"status\":\"draft\",\"experimental\":false,\"date\":\"2025-05-08\",\"publisher\":\"NHS North West Genomics\",\"contact\":[{\"telecom\":[{\"system\":\"url\",\"value\":\"https://www.nwgenomics.nhs.uk/contact-us\"}]}],\"description\":\"1st level Genomic Test Directory Codes\",\"jurisdiction\":[{\"coding\":[{\"system\":\"urn:iso:std:iso:3166\",\"code\":\"GB\",\"display\":\"United Kingdom of Great Britain and Northern Ireland\"}]}],\"caseSensitive\":true,\"content\":\"fragment\",\"concept\":[{\"code\":\"R240\",\"display\":\"Diagnostic testing for known mutation(s)\"},{\"code\":\"R361\",\"display\":\"Childhood onset hereditary spastic paraplegia\"},{\"code\":\"R362\",\"display\":\"Not present in 8.0\"},{\"code\":\"R372\",\"display\":\"Newborn screening for sickle cell disease in a transfused baby\"},{\"code\":\"R93\",\"display\":\"Sickle cell, thalassaemia and other haemoglobinopathies\"},{\"code\":\"R94\",\"display\":\"Not present in 8.0\"},{\"code\":\"R413\",\"display\":\"Autoinflammatory Disorders\"},{\"code\":\"R67\",\"display\":\"Monogenic hearing loss\"},{\"code\":\"R141\",\"display\":\"Monogenic diabetes\"},{\"code\":\"R142\",\"display\":\"Glucokinase-related fasting hyperglycaemia\"},{\"code\":\"R201\",\"display\":\"Atypical haemolytic uraemic syndrome\"},{\"code\":\"M9\",\"display\":\"Thyroid Papillary Carcinoma - Adult\"},{\"code\":\"M215\",\"display\":\"Endometrial Cancer\"}]}},{\"name\":\"cache-id\",\"valueId\":\"7743c2e6-5b90-4b62-bcd2-6695b993e76b\"},{\"name\":\"system-version\",\"valueUri\":\"http://snomed.info/sct|http://snomed.info/sct/83821000000107\"},{\"name\":\"diagnostics\",\"valueBoolean\":true}]}\nEOF\n\ncat /tmp/repro-request.json | curl -s https://tx.fhir.org/r4/CodeSystem/\\$validate-code \\\n  -X POST --header 'Content-Type: application/json' --header 'Accept: application/json' \\\n  --data-binary @- | jq -r '.parameter[] | select(.name == \"message\") | .valueString'\n\n# Dev\ncat /tmp/repro-request.json | curl -s https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code \\\n  -X POST --header 'Content-Type: application/json' --header 'Accept: application/json' \\\n  --data-binary @- | jq -r '.parameter[] | select(.name == \"message\") | .valueString'\n```\n\nProd returns: `Unknown code '1365861003' in the CodeSystem 'http://snomed.info/sct' version 'http://snomed.info/sct/83821000000107/version/20230412' (UK Edition); Unknown Code 'R210' in the CodeSystem 'https://fhir.nwgenomics.nhs.uk/CodeSystem/GenomicClinicalIndication' version '0.1.0' - note that the code system is labeled as a fragment, so the code may be valid in some other fragment`\n\nDev returns: `Unknown code '1365861003' in the CodeSystem 'http://snomed.info/sct' version 'http://snomed.info/sct/83821000000107/version/20230412' (UK Edition)`\n\nDev omits the second error message about the GenomicClinicalIndication code R210.\n\n## What differs\n\nWhen $validate-code is called on a CodeableConcept containing multiple codings that each fail validation, the `message` output parameter should concatenate all error/warning issue texts with \"; \". Prod does this correctly. Dev only includes one of the error texts in the message, omitting the others.\n\nFor example, with a CodeableConcept containing two codings (GenomicClinicalIndication#R210 and SNOMED#1365861003), both invalid:\n- **Prod message**: \"Unknown code '1365861003' in the CodeSystem 'http://snomed.info/sct'...; Unknown Code 'R210' in the CodeSystem 'https://fhir.nwgenomics.nhs.uk/CodeSystem/GenomicClinicalIndication'...\"\n- **Dev message**: \"Unknown code '1365861003' in the CodeSystem 'http://snomed.info/sct'...\"\n\nDev omits the second error about the GenomicClinicalIndication code. The structured OperationOutcome `issues` resource is identical between prod and dev (both have all 3 issues). Only the `message` parameter text is incomplete.\n\n## How widespread\n\n10 delta records, all POST /r4/CodeSystem/$validate-code, all validating the same GenomicClinicalIndication CodeableConcept with SNOMED coding. Identified by searching for records where the only diff is `message` value-differs and prod's message contains more semicolon-separated segments than dev's.\n\nThis is a variant of the same underlying bug as tolerance `message-concat-missing-issues` (which handles a different set of 8 records where prod message = all issue texts joined, dev message = first issue text only). The root cause is the same: dev doesn't properly concatenate all relevant issue texts into the message parameter.\n\n## What the tolerance covers\n\nTolerance `message-concat-selective-issues` matches validate-code records where:\n- Both sides have identical OperationOutcome issues\n- Messages differ\n- Dev's message is a proper substring of prod's message (prod includes more issue texts)\n\nCanonicalizes dev's message to prod's value. Eliminates 10 records.", "body_html": "<p>Records-Impacted: 10<br>\nTolerance-ID: message-concat-selective-issues<br>\nRecord-ID: c350392e-d535-45e3-83cf-924b05e26a14</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod\ncat &gt; /tmp/repro-request.json &lt;&lt; &#x27;EOF&#x27;\n{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;codeableConcept&quot;,&quot;valueCodeableConcept&quot;:{&quot;coding&quot;:[{&quot;system&quot;:&quot;https://fhir.nwgenomics.nhs.uk/CodeSystem/GenomicClinicalIndication&quot;,&quot;code&quot;:&quot;R210&quot;,&quot;display&quot;:&quot;Inherited MMR deficiency (Lynch syndrome)&quot;},{&quot;system&quot;:&quot;http://snomed.info/sct&quot;,&quot;code&quot;:&quot;1365861003&quot;,&quot;display&quot;:&quot;Lynch syndrome gene mutation detected&quot;}],&quot;text&quot;:&quot;Inherited MMR deficiency (Lynch syndrome)&quot;}},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueString&quot;:&quot;en-GB&quot;},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true},{&quot;name&quot;:&quot;tx-resource&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;CodeSystem&quot;,&quot;id&quot;:&quot;GenomicClinicalIndication&quot;,&quot;url&quot;:&quot;https://fhir.nwgenomics.nhs.uk/CodeSystem/GenomicClinicalIndication&quot;,&quot;version&quot;:&quot;0.1.0&quot;,&quot;name&quot;:&quot;GenomicClinicalIndication&quot;,&quot;title&quot;:&quot;NHS England Genomic Clinical Indication Code&quot;,&quot;status&quot;:&quot;draft&quot;,&quot;experimental&quot;:false,&quot;date&quot;:&quot;2025-05-08&quot;,&quot;publisher&quot;:&quot;NHS North West Genomics&quot;,&quot;contact&quot;:[{&quot;telecom&quot;:[{&quot;system&quot;:&quot;url&quot;,&quot;value&quot;:&quot;https://www.nwgenomics.nhs.uk/contact-us&quot;}]}],&quot;description&quot;:&quot;1st level Genomic Test Directory Codes&quot;,&quot;jurisdiction&quot;:[{&quot;coding&quot;:[{&quot;system&quot;:&quot;urn:iso:std:iso:3166&quot;,&quot;code&quot;:&quot;GB&quot;,&quot;display&quot;:&quot;United Kingdom of Great Britain and Northern Ireland&quot;}]}],&quot;caseSensitive&quot;:true,&quot;content&quot;:&quot;fragment&quot;,&quot;concept&quot;:[{&quot;code&quot;:&quot;R240&quot;,&quot;display&quot;:&quot;Diagnostic testing for known mutation(s)&quot;},{&quot;code&quot;:&quot;R361&quot;,&quot;display&quot;:&quot;Childhood onset hereditary spastic paraplegia&quot;},{&quot;code&quot;:&quot;R362&quot;,&quot;display&quot;:&quot;Not present in 8.0&quot;},{&quot;code&quot;:&quot;R372&quot;,&quot;display&quot;:&quot;Newborn screening for sickle cell disease in a transfused baby&quot;},{&quot;code&quot;:&quot;R93&quot;,&quot;display&quot;:&quot;Sickle cell, thalassaemia and other haemoglobinopathies&quot;},{&quot;code&quot;:&quot;R94&quot;,&quot;display&quot;:&quot;Not present in 8.0&quot;},{&quot;code&quot;:&quot;R413&quot;,&quot;display&quot;:&quot;Autoinflammatory Disorders&quot;},{&quot;code&quot;:&quot;R67&quot;,&quot;display&quot;:&quot;Monogenic hearing loss&quot;},{&quot;code&quot;:&quot;R141&quot;,&quot;display&quot;:&quot;Monogenic diabetes&quot;},{&quot;code&quot;:&quot;R142&quot;,&quot;display&quot;:&quot;Glucokinase-related fasting hyperglycaemia&quot;},{&quot;code&quot;:&quot;R201&quot;,&quot;display&quot;:&quot;Atypical haemolytic uraemic syndrome&quot;},{&quot;code&quot;:&quot;M9&quot;,&quot;display&quot;:&quot;Thyroid Papillary Carcinoma - Adult&quot;},{&quot;code&quot;:&quot;M215&quot;,&quot;display&quot;:&quot;Endometrial Cancer&quot;}]}},{&quot;name&quot;:&quot;cache-id&quot;,&quot;valueId&quot;:&quot;7743c2e6-5b90-4b62-bcd2-6695b993e76b&quot;},{&quot;name&quot;:&quot;system-version&quot;,&quot;valueUri&quot;:&quot;http://snomed.info/sct|http://snomed.info/sct/83821000000107&quot;},{&quot;name&quot;:&quot;diagnostics&quot;,&quot;valueBoolean&quot;:true}]}\nEOF\n\ncat /tmp/repro-request.json | curl -s https://tx.fhir.org/r4/CodeSystem/\\$validate-code \\\n  -X POST --header &#x27;Content-Type: application/json&#x27; --header &#x27;Accept: application/json&#x27; \\\n  --data-binary @- | jq -r &#x27;.parameter[] | select(.name == &quot;message&quot;) | .valueString&#x27;\n\n# Dev\ncat /tmp/repro-request.json | curl -s https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code \\\n  -X POST --header &#x27;Content-Type: application/json&#x27; --header &#x27;Accept: application/json&#x27; \\\n  --data-binary @- | jq -r &#x27;.parameter[] | select(.name == &quot;message&quot;) | .valueString&#x27;</code></pre>\n<p>Prod returns: <code>Unknown code &#x27;1365861003&#x27; in the CodeSystem &#x27;http://snomed.info/sct&#x27; version &#x27;http://snomed.info/sct/83821000000107/version/20230412&#x27; (UK Edition); Unknown Code &#x27;R210&#x27; in the CodeSystem &#x27;https://fhir.nwgenomics.nhs.uk/CodeSystem/GenomicClinicalIndication&#x27; version &#x27;0.1.0&#x27; - note that the code system is labeled as a fragment, so the code may be valid in some other fragment</code></p>\n<p>Dev returns: <code>Unknown code &#x27;1365861003&#x27; in the CodeSystem &#x27;http://snomed.info/sct&#x27; version &#x27;http://snomed.info/sct/83821000000107/version/20230412&#x27; (UK Edition)</code></p>\n<p>Dev omits the second error message about the GenomicClinicalIndication code R210.</p>\n<h2>What differs</h2>\n<p>When $validate-code is called on a CodeableConcept containing multiple codings that each fail validation, the <code>message</code> output parameter should concatenate all error/warning issue texts with &quot;; &quot;. Prod does this correctly. Dev only includes one of the error texts in the message, omitting the others.</p>\n<p>For example, with a CodeableConcept containing two codings (GenomicClinicalIndication#R210 and SNOMED#1365861003), both invalid:</p>\n<ul><li><strong>Prod message</strong>: &quot;Unknown code &#x27;1365861003&#x27; in the CodeSystem &#x27;<a href=\"http://snomed.info/sct&#x27;...;\" target=\"_blank\">http://snomed.info/sct&#x27;...;</a> Unknown Code &#x27;R210&#x27; in the CodeSystem &#x27;<a href=\"https://fhir.nwgenomics.nhs.uk/CodeSystem/GenomicClinicalIndication&#x27;...&quot;\" target=\"_blank\">https://fhir.nwgenomics.nhs.uk/CodeSystem/GenomicClinicalIndication&#x27;...&quot;</a></li><li><strong>Dev message</strong>: &quot;Unknown code &#x27;1365861003&#x27; in the CodeSystem &#x27;<a href=\"http://snomed.info/sct&#x27;...&quot;\" target=\"_blank\">http://snomed.info/sct&#x27;...&quot;</a></li></ul>\n<p>Dev omits the second error about the GenomicClinicalIndication code. The structured OperationOutcome <code>issues</code> resource is identical between prod and dev (both have all 3 issues). Only the <code>message</code> parameter text is incomplete.</p>\n<h2>How widespread</h2>\n<p>10 delta records, all POST /r4/CodeSystem/$validate-code, all validating the same GenomicClinicalIndication CodeableConcept with SNOMED coding. Identified by searching for records where the only diff is <code>message</code> value-differs and prod&#x27;s message contains more semicolon-separated segments than dev&#x27;s.</p>\n<p>This is a variant of the same underlying bug as tolerance <code>message-concat-missing-issues</code> (which handles a different set of 8 records where prod message = all issue texts joined, dev message = first issue text only). The root cause is the same: dev doesn&#x27;t properly concatenate all relevant issue texts into the message parameter.</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance <code>message-concat-selective-issues</code> matches validate-code records where:</p>\n<ul><li>Both sides have identical OperationOutcome issues</li><li>Messages differ</li><li>Dev&#x27;s message is a proper substring of prod&#x27;s message (prod includes more issue texts)</li></ul>\n<p>Canonicalizes dev&#x27;s message to prod&#x27;s value. Eliminates 10 records.</p>", "impact": 10}, {"id": "2905420", "title": "DICOM CID 29 AcquisitionModality ValueSet missing from dev", "status": "open", "labels": ["P3", "reproduced", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:37", "date_iso": "2026-02-08T13:37:58-06:00", "body_md": "Records-Impacted: 10\nTolerance-ID: dicom-cid29-missing\nRecord-ID: 3e3359d1-7391-4620-8b72-552f197f21cf\n\n\n**Test 1: Direct read by ID** (prod=200, dev=404)\n\n```bash\ncurl -s -H \"Accept: application/fhir+json\" \\\n\"https://tx.fhir.org/r4/ValueSet/dicom-cid-29-AcquisitionModality\" \\\n| python3 -c \"import sys,json; d=json.load(sys.stdin); print(f'Status: 200, resourceType: {d[\\\"resourceType\\\"]}, id: {d[\\\"id\\\"]}')\"\n\ncurl -s -o /dev/null -w \"%{http_code}\" -H \"Accept: application/fhir+json\" \\\n\"https://tx-dev.fhir.org/r4/ValueSet/dicom-cid-29-AcquisitionModality\"\n```\n\n**Test 2: URL search** (prod total=1, dev total=0)\n\n```bash\ncurl -s -H \"Accept: application/fhir+json\" \\\n\"https://tx.fhir.org/r4/ValueSet?url=http%3A%2F%2Fdicom.nema.org%2Fmedical%2Fdicom%2Fcurrent%2Foutput%2Fchtml%2Fpart16%2Fsect_CID_29.html\" \\\n| python3 -c \"import sys,json; d=json.load(sys.stdin); print(f'total: {d[\\\"total\\\"]}, entries: {len(d.get(\\\"entry\\\",[]))}')\"\n\ncurl -s -H \"Accept: application/fhir+json\" \\\n\"https://tx-dev.fhir.org/r4/ValueSet?url=http%3A%2F%2Fdicom.nema.org%2Fmedical%2Fdicom%2Fcurrent%2Foutput%2Fchtml%2Fpart16%2Fsect_CID_29.html\" \\\n| python3 -c \"import sys,json; d=json.load(sys.stdin); print(f'total: {d[\\\"total\\\"]}, entries: {len(d.get(\\\"entry\\\",[]))}')\"\n```\n\nVerified 2026-02-07: both tests confirm the DICOM CID 29 AcquisitionModality ValueSet exists on prod but is entirely missing from dev.\n\n\nWhen searching for the DICOM CID 29 AcquisitionModality ValueSet by URL (`/r4/ValueSet?url=http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_29.html`), prod returns a Bundle with `total: 1` containing the full ValueSet resource (id: `dicom-cid-29-AcquisitionModality`, 51 DICOM modality codes). Dev returns an empty Bundle with `total: 0`.\n\nDirect reads by ID (`/r4/ValueSet/dicom-cid-29-AcquisitionModality`) return 200 on prod with the full ValueSet, and 404 on dev with \"ValueSet/dicom-cid-29-AcquisitionModality not found\".\n\nThe ValueSet has URL `http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_29.html`, version `2025.3.20250714`, and uses system `http://dicom.nema.org/resources/ontology/DCM`.\n\n\n10 records in the delta file:\n- 5x P3 (prod=200, dev=404): direct read `/r4/ValueSet/dicom-cid-29-AcquisitionModality`\n- 5x P6 (both 200, content differs): URL search returning empty Bundle vs populated Bundle\n\nSearch: `grep 'dicom-cid-29\\|sect_CID_29' deltas.ndjson` finds all 10.\n\n\n- `3e3359d1-7391-4620-8b72-552f197f21cf` (P6 URL search)\n- `ab5f8ed0-5149-4967-af3a-3c649cbb10c5` (P3 direct read)\n\n---", "body_html": "<p>Records-Impacted: 10<br>\nTolerance-ID: dicom-cid29-missing<br>\nRecord-ID: 3e3359d1-7391-4620-8b72-552f197f21cf</p>\n<p><strong>Test 1: Direct read by ID</strong> (prod=200, dev=404)</p>\n<pre><code class=\"lang-bash\">curl -s -H &quot;Accept: application/fhir+json&quot; \\\n&quot;https://tx.fhir.org/r4/ValueSet/dicom-cid-29-AcquisitionModality&quot; \\\n| python3 -c &quot;import sys,json; d=json.load(sys.stdin); print(f&#x27;Status: 200, resourceType: {d[\\&quot;resourceType\\&quot;]}, id: {d[\\&quot;id\\&quot;]}&#x27;)&quot;\n\ncurl -s -o /dev/null -w &quot;%{http_code}&quot; -H &quot;Accept: application/fhir+json&quot; \\\n&quot;https://tx-dev.fhir.org/r4/ValueSet/dicom-cid-29-AcquisitionModality&quot;</code></pre>\n<p><strong>Test 2: URL search</strong> (prod total=1, dev total=0)</p>\n<pre><code class=\"lang-bash\">curl -s -H &quot;Accept: application/fhir+json&quot; \\\n&quot;https://tx.fhir.org/r4/ValueSet?url=http%3A%2F%2Fdicom.nema.org%2Fmedical%2Fdicom%2Fcurrent%2Foutput%2Fchtml%2Fpart16%2Fsect_CID_29.html&quot; \\\n| python3 -c &quot;import sys,json; d=json.load(sys.stdin); print(f&#x27;total: {d[\\&quot;total\\&quot;]}, entries: {len(d.get(\\&quot;entry\\&quot;,[]))}&#x27;)&quot;\n\ncurl -s -H &quot;Accept: application/fhir+json&quot; \\\n&quot;https://tx-dev.fhir.org/r4/ValueSet?url=http%3A%2F%2Fdicom.nema.org%2Fmedical%2Fdicom%2Fcurrent%2Foutput%2Fchtml%2Fpart16%2Fsect_CID_29.html&quot; \\\n| python3 -c &quot;import sys,json; d=json.load(sys.stdin); print(f&#x27;total: {d[\\&quot;total\\&quot;]}, entries: {len(d.get(\\&quot;entry\\&quot;,[]))}&#x27;)&quot;</code></pre>\n<p>Verified 2026-02-07: both tests confirm the DICOM CID 29 AcquisitionModality ValueSet exists on prod but is entirely missing from dev.</p>\n<p>When searching for the DICOM CID 29 AcquisitionModality ValueSet by URL (<code>/r4/ValueSet?url=http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_29.html</code>), prod returns a Bundle with <code>total: 1</code> containing the full ValueSet resource (id: <code>dicom-cid-29-AcquisitionModality</code>, 51 DICOM modality codes). Dev returns an empty Bundle with <code>total: 0</code>.</p>\n<p>Direct reads by ID (<code>/r4/ValueSet/dicom-cid-29-AcquisitionModality</code>) return 200 on prod with the full ValueSet, and 404 on dev with &quot;ValueSet/dicom-cid-29-AcquisitionModality not found&quot;.</p>\n<p>The ValueSet has URL <code>http://dicom.nema.org/medical/dicom/current/output/chtml/part16/sect_CID_29.html</code>, version <code>2025.3.20250714</code>, and uses system <code>http://dicom.nema.org/resources/ontology/DCM</code>.</p>\n<p>10 records in the delta file:</p>\n<ul><li>5x P3 (prod=200, dev=404): direct read <code>/r4/ValueSet/dicom-cid-29-AcquisitionModality</code></li><li>5x P6 (both 200, content differs): URL search returning empty Bundle vs populated Bundle</li></ul>\n<p>Search: <code>grep &#x27;dicom-cid-29\\|sect_CID_29&#x27; deltas.ndjson</code> finds all 10.</p>\n<ul><li><code>3e3359d1-7391-4620-8b72-552f197f21cf</code> (P6 URL search)</li><li><code>ab5f8ed0-5149-4967-af3a-3c649cbb10c5</code> (P3 direct read)</li></ul>\n<hr>", "impact": 10}, {"id": "1d45060", "title": "CPT validate-code: dev omits informational 'Code X not found in CPT' issue", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:37", "date_iso": "2026-02-08T13:37:59-06:00", "body_md": "Records-Impacted: 10\nTolerance-ID: cpt-validate-code-missing-info-issue\nRecord-ID: e8127050-3f19-4115-bf45-a50dfea09d40\n\n\n```bash\ncurl -s \"https://tx.fhir.org/r4/CodeSystem/\\$validate-code\" \\\n-H \"Accept: application/fhir+json\" \\\n-H \"Content-Type: application/fhir+json\" \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://www.ama-assn.org/go/cpt\"},{\"name\":\"code\",\"valueCode\":\"19304\"}]}'\n\ncurl -s \"https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code\" \\\n-H \"Accept: application/fhir+json\" \\\n-H \"Content-Type: application/fhir+json\" \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://www.ama-assn.org/go/cpt\"},{\"name\":\"code\",\"valueCode\":\"19304\"}]}'\n```\n\nProd returns 2 OperationOutcome issues: `severity=error` (\"Unknown code '19304' in the CodeSystem 'http://www.ama-assn.org/go/cpt' version '2023'\") and `severity=information` (\"Code '19304' not found in CPT\"). Dev returns only the error issue and omits the informational one.\n\n\nWhen validating an unknown CPT code (result=false), prod returns two OperationOutcome issues:\n1. severity=error: \"Unknown code 'X' in the CodeSystem 'http://www.ama-assn.org/go/cpt' version '2023'\"\n2. severity=information: \"Code 'X' not found in CPT\"\n\nDev returns only the first (error) issue and omits the second (informational) issue.\n\nFor ValueSet/$validate-code (2 of the 10 records), this also affects the message parameter: prod prefixes the message with \"Code 'X' not found in CPT; \" while dev omits this prefix.\n\nBoth sides agree on result=false, system, code, and the primary error issue text.\n\n\n10 records total: 8 POST /r4/CodeSystem/$validate-code and 2 POST /r4/ValueSet/$validate-code. All involve system http://www.ama-assn.org/go/cpt, result=false, where the code is unknown in CPT version 2023.\n\nSearch: checked all 57 delta records for cases where prod has more OperationOutcome issues than dev — found exactly 10 CPT records matching this pattern.\n\nCodes affected: 19304 (2 records), 98000 (2 records), 99201 (6 records).\n\n\nTolerance ID: cpt-validate-code-missing-info-issue. Matches CPT validate-code records where result=false and prod has an extra informational \"not found in CPT\" issue. Normalizes by stripping the extra informational issue from prod and removing the corresponding message prefix. Eliminates 10 records.", "body_html": "<p>Records-Impacted: 10<br>\nTolerance-ID: cpt-validate-code-missing-info-issue<br>\nRecord-ID: e8127050-3f19-4115-bf45-a50dfea09d40</p>\n<pre><code class=\"lang-bash\">curl -s &quot;https://tx.fhir.org/r4/CodeSystem/\\$validate-code&quot; \\\n-H &quot;Accept: application/fhir+json&quot; \\\n-H &quot;Content-Type: application/fhir+json&quot; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://www.ama-assn.org/go/cpt&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;19304&quot;}]}&#x27;\n\ncurl -s &quot;https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code&quot; \\\n-H &quot;Accept: application/fhir+json&quot; \\\n-H &quot;Content-Type: application/fhir+json&quot; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://www.ama-assn.org/go/cpt&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;19304&quot;}]}&#x27;</code></pre>\n<p>Prod returns 2 OperationOutcome issues: <code>severity=error</code> (&quot;Unknown code &#x27;19304&#x27; in the CodeSystem &#x27;<a href=\"http://www.ama-assn.org/go/cpt&#x27;\" target=\"_blank\">http://www.ama-assn.org/go/cpt&#x27;</a> version &#x27;2023&#x27;&quot;) and <code>severity=information</code> (&quot;Code &#x27;19304&#x27; not found in CPT&quot;). Dev returns only the error issue and omits the informational one.</p>\n<p>When validating an unknown CPT code (result=false), prod returns two OperationOutcome issues:</p>\n<ol><li>severity=error: &quot;Unknown code &#x27;X&#x27; in the CodeSystem &#x27;<a href=\"http://www.ama-assn.org/go/cpt&#x27;\" target=\"_blank\">http://www.ama-assn.org/go/cpt&#x27;</a> version &#x27;2023&#x27;&quot;</li><li>severity=information: &quot;Code &#x27;X&#x27; not found in CPT&quot;</li></ol>\n<p>Dev returns only the first (error) issue and omits the second (informational) issue.</p>\n<p>For ValueSet/$validate-code (2 of the 10 records), this also affects the message parameter: prod prefixes the message with &quot;Code &#x27;X&#x27; not found in CPT; &quot; while dev omits this prefix.</p>\n<p>Both sides agree on result=false, system, code, and the primary error issue text.</p>\n<p>10 records total: 8 POST /r4/CodeSystem/$validate-code and 2 POST /r4/ValueSet/$validate-code. All involve system <a href=\"http://www.ama-assn.org/go/cpt,\" target=\"_blank\">http://www.ama-assn.org/go/cpt,</a> result=false, where the code is unknown in CPT version 2023.</p>\n<p>Search: checked all 57 delta records for cases where prod has more OperationOutcome issues than dev — found exactly 10 CPT records matching this pattern.</p>\n<p>Codes affected: 19304 (2 records), 98000 (2 records), 99201 (6 records).</p>\n<p>Tolerance ID: cpt-validate-code-missing-info-issue. Matches CPT validate-code records where result=false and prod has an extra informational &quot;not found in CPT&quot; issue. Normalizes by stripping the extra informational issue from prod and removing the corresponding message prefix. Eliminates 10 records.</p>", "impact": 10}, {"id": "d45bc62", "title": "Dev returns 400 'No ValueSet specified' for validate-code with codeableConcept-only (prod returns 200)", "status": "open", "labels": ["reproduced", "round:2026-02-round-3", "status-mismatch", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-11 20:27", "date_iso": "2026-02-11T20:27:40-06:00", "body_md": "Records-Impacted: 9\nTolerance-ID: validate-code-no-valueset-codeableconcept\nRecord-ID: abd1a7d8-3110-4b8a-a14b-267543425ffd\n\n## Repro\n\n```bash\n# Prod\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$validate-code' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"codeableConcept\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"http://loinc.org\",\"version\":\"2.77\",\"code\":\"8867-4\",\"display\":\"Heart rate\"},{\"system\":\"http://loinc.org\",\"version\":\"2.77\",\"code\":\"8480-6\",\"display\":\"Systolic blood pressure\"}]}}]}'\n\n# Dev\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$validate-code' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"codeableConcept\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"http://loinc.org\",\"version\":\"2.77\",\"code\":\"8867-4\",\"display\":\"Heart rate\"},{\"system\":\"http://loinc.org\",\"version\":\"2.77\",\"code\":\"8480-6\",\"display\":\"Systolic blood pressure\"}]}}]}'\n```\n\n**Prod** (HTTP 200) returns:\n> `\"result\": true`, `\"system\": \"http://loinc.org\"`, `\"code\": \"8480-6\"`, `\"display\": \"Systolic blood pressure\"`, plus echoed codeableConcept with both codings\n\n**Dev** (HTTP 400) returns:\n> `\"severity\": \"error\"`, `\"code\": \"invalid\"`, `\"details\": {\"text\": \"No ValueSet specified - provide url parameter or valueSet resource\"}`\n\n## What differs\n\nPOST /r4/ValueSet/$validate-code with only a `codeableConcept` parameter (no `url`, `context`, or `valueSet`):\n- **Prod** (HTTP 200): Validates the codeableConcept against each coding's CodeSystem and returns a Parameters response with result=true/false, system, code, version, display, and the echoed codeableConcept.\n- **Dev** (HTTP 400): Returns an OperationOutcome error: \"No ValueSet specified - provide url parameter or valueSet resource\"\n\nThe FHIR spec says \"If the operation is not called at the instance level, one of url, context, or valueSet must be provided.\" So dev is arguably more strictly spec-compliant, but prod handles this gracefully by validating each coding in the codeableConcept against its code system directly.\n\n## How widespread\n\n9 records match this pattern. All are:\n- POST /r4/ValueSet/$validate-code\n- Request body has only a `codeableConcept` parameter (no url, context, or valueSet)\n- All use http://loinc.org codings\n- Prod returns 200 with Parameters, dev returns 400 with OperationOutcome\n\nSearch: `grep 'No ValueSet specified' results/deltas/deltas.ndjson | wc -l` → 9\n\n## What the tolerance covers\n\nTolerance `validate-code-no-valueset-codeableconcept` matches POST validate-code requests where prod=200, dev=400, and dev body contains \"No ValueSet specified\". Skips all 9 records.\n\n## Representative records\n\n- abd1a7d8-3110-4b8a-a14b-267543425ffd (LOINC codeableConcept with 8867-4 + 8480-6, prod result=true)\n- 47660ea6 (LOINC codeableConcept, prod result=false)", "body_html": "<p>Records-Impacted: 9<br>\nTolerance-ID: validate-code-no-valueset-codeableconcept<br>\nRecord-ID: abd1a7d8-3110-4b8a-a14b-267543425ffd</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod\ncurl -s &#x27;https://tx.fhir.org/r4/ValueSet/$validate-code&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;codeableConcept&quot;,&quot;valueCodeableConcept&quot;:{&quot;coding&quot;:[{&quot;system&quot;:&quot;http://loinc.org&quot;,&quot;version&quot;:&quot;2.77&quot;,&quot;code&quot;:&quot;8867-4&quot;,&quot;display&quot;:&quot;Heart rate&quot;},{&quot;system&quot;:&quot;http://loinc.org&quot;,&quot;version&quot;:&quot;2.77&quot;,&quot;code&quot;:&quot;8480-6&quot;,&quot;display&quot;:&quot;Systolic blood pressure&quot;}]}}]}&#x27;\n\n# Dev\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$validate-code&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;codeableConcept&quot;,&quot;valueCodeableConcept&quot;:{&quot;coding&quot;:[{&quot;system&quot;:&quot;http://loinc.org&quot;,&quot;version&quot;:&quot;2.77&quot;,&quot;code&quot;:&quot;8867-4&quot;,&quot;display&quot;:&quot;Heart rate&quot;},{&quot;system&quot;:&quot;http://loinc.org&quot;,&quot;version&quot;:&quot;2.77&quot;,&quot;code&quot;:&quot;8480-6&quot;,&quot;display&quot;:&quot;Systolic blood pressure&quot;}]}}]}&#x27;</code></pre>\n<p><strong>Prod</strong> (HTTP 200) returns:<br>\n&gt; <code>&quot;result&quot;: true</code>, <code>&quot;system&quot;: &quot;http://loinc.org&quot;</code>, <code>&quot;code&quot;: &quot;8480-6&quot;</code>, <code>&quot;display&quot;: &quot;Systolic blood pressure&quot;</code>, plus echoed codeableConcept with both codings</p>\n<p><strong>Dev</strong> (HTTP 400) returns:<br>\n&gt; <code>&quot;severity&quot;: &quot;error&quot;</code>, <code>&quot;code&quot;: &quot;invalid&quot;</code>, <code>&quot;details&quot;: {&quot;text&quot;: &quot;No ValueSet specified - provide url parameter or valueSet resource&quot;}</code></p>\n<h2>What differs</h2>\n<p>POST /r4/ValueSet/$validate-code with only a <code>codeableConcept</code> parameter (no <code>url</code>, <code>context</code>, or <code>valueSet</code>):</p>\n<ul><li><strong>Prod</strong> (HTTP 200): Validates the codeableConcept against each coding&#x27;s CodeSystem and returns a Parameters response with result=true/false, system, code, version, display, and the echoed codeableConcept.</li><li><strong>Dev</strong> (HTTP 400): Returns an OperationOutcome error: &quot;No ValueSet specified - provide url parameter or valueSet resource&quot;</li></ul>\n<p>The FHIR spec says &quot;If the operation is not called at the instance level, one of url, context, or valueSet must be provided.&quot; So dev is arguably more strictly spec-compliant, but prod handles this gracefully by validating each coding in the codeableConcept against its code system directly.</p>\n<h2>How widespread</h2>\n<p>9 records match this pattern. All are:</p>\n<ul><li>POST /r4/ValueSet/$validate-code</li><li>Request body has only a <code>codeableConcept</code> parameter (no url, context, or valueSet)</li><li>All use <a href=\"http://loinc.org\" target=\"_blank\">http://loinc.org</a> codings</li><li>Prod returns 200 with Parameters, dev returns 400 with OperationOutcome</li></ul>\n<p>Search: <code>grep &#x27;No ValueSet specified&#x27; results/deltas/deltas.ndjson | wc -l</code> → 9</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance <code>validate-code-no-valueset-codeableconcept</code> matches POST validate-code requests where prod=200, dev=400, and dev body contains &quot;No ValueSet specified&quot;. Skips all 9 records.</p>\n<h2>Representative records</h2>\n<ul><li>abd1a7d8-3110-4b8a-a14b-267543425ffd (LOINC codeableConcept with 8867-4 + 8480-6, prod result=true)</li><li>47660ea6 (LOINC codeableConcept, prod result=false)</li></ul>", "impact": 9}, {"id": "23b3e84", "title": "validate-code message parameter only includes first issue text instead of all", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:38", "date_iso": "2026-02-08T13:38:00-06:00", "body_md": "Records-Impacted: 8\nTolerance-ID: message-concat-missing-issues\nRecord-ID: 69462376-1a61-4aa3-a8ea-3a140347fb3a\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/CodeSystem/$validate-code' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"coding\",\"valueCoding\":{\"system\":\"SI\"}},{\"name\":\"abstract\",\"valueBoolean\":false}]}'\n\ncurl -s 'https://tx-dev.fhir.org/r4/CodeSystem/$validate-code' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"coding\",\"valueCoding\":{\"system\":\"SI\"}},{\"name\":\"abstract\",\"valueBoolean\":false}]}'\n```\n\nProd message: `\"A definition for CodeSystem 'SI' could not be found, so the code cannot be validated; Coding.system must be an absolute reference, not a local reference\"` (both issue texts joined with `; `).\nDev message: `\"A definition for CodeSystem 'SI' could not be found, so the code cannot be validated\"` (only first issue text). Both servers return identical OperationOutcome `issues` with both errors.\n\n\nWhen a $validate-code response has multiple OperationOutcome issues, the `message` parameter should concatenate all issue texts (joined with `; `). Prod does this correctly. Dev only includes the text from the first issue in the `message` parameter, omitting subsequent issue texts.\n\nExample: for a relative system URI like \"SI\", both servers return two issues:\n1. \"A definition for CodeSystem 'SI' could not be found, so the code cannot be validated\"\n2. \"Coding.system must be an absolute reference, not a local reference\"\n\nProd message: \"A definition for CodeSystem 'SI' could not be found, so the code cannot be validated; Coding.system must be an absolute reference, not a local reference\"\nDev message: \"A definition for CodeSystem 'SI' could not be found, so the code cannot be validated\"\n\nThe OperationOutcome `issues` resource itself is identical between both servers — same issue codes, same details text, same severity. Only the top-level `message` summary parameter differs.\n\n\n8 records in comparison.ndjson match this pattern. 5 are CodeSystem/$validate-code with relative system URIs (like \"SI\", \"prov\"), 3 are ValueSet/$validate-code. All are validate-code operations where multiple issues exist.\n\nSearch: Records where prod message equals '; '.join(all issue texts) and dev message equals only the first issue text, with 2+ issues.\n\n\nTolerance `message-concat-missing-issues` normalizes the `message` parameter to prod's concatenated value when the pattern matches (dev message equals first issue text, prod message equals all issues joined with '; '). This eliminates the 5 delta records matching this pattern.", "body_html": "<p>Records-Impacted: 8<br>\nTolerance-ID: message-concat-missing-issues<br>\nRecord-ID: 69462376-1a61-4aa3-a8ea-3a140347fb3a</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/CodeSystem/$validate-code&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;coding&quot;,&quot;valueCoding&quot;:{&quot;system&quot;:&quot;SI&quot;}},{&quot;name&quot;:&quot;abstract&quot;,&quot;valueBoolean&quot;:false}]}&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/CodeSystem/$validate-code&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;coding&quot;,&quot;valueCoding&quot;:{&quot;system&quot;:&quot;SI&quot;}},{&quot;name&quot;:&quot;abstract&quot;,&quot;valueBoolean&quot;:false}]}&#x27;</code></pre>\n<p>Prod message: <code>&quot;A definition for CodeSystem &#x27;SI&#x27; could not be found, so the code cannot be validated; Coding.system must be an absolute reference, not a local reference&quot;</code> (both issue texts joined with <code>; </code>).<br>\nDev message: <code>&quot;A definition for CodeSystem &#x27;SI&#x27; could not be found, so the code cannot be validated&quot;</code> (only first issue text). Both servers return identical OperationOutcome <code>issues</code> with both errors.</p>\n<p>When a $validate-code response has multiple OperationOutcome issues, the <code>message</code> parameter should concatenate all issue texts (joined with <code>; </code>). Prod does this correctly. Dev only includes the text from the first issue in the <code>message</code> parameter, omitting subsequent issue texts.</p>\n<p>Example: for a relative system URI like &quot;SI&quot;, both servers return two issues:</p>\n<ol><li>&quot;A definition for CodeSystem &#x27;SI&#x27; could not be found, so the code cannot be validated&quot;</li><li>&quot;Coding.system must be an absolute reference, not a local reference&quot;</li></ol>\n<p>Prod message: &quot;A definition for CodeSystem &#x27;SI&#x27; could not be found, so the code cannot be validated; Coding.system must be an absolute reference, not a local reference&quot;<br>\nDev message: &quot;A definition for CodeSystem &#x27;SI&#x27; could not be found, so the code cannot be validated&quot;</p>\n<p>The OperationOutcome <code>issues</code> resource itself is identical between both servers — same issue codes, same details text, same severity. Only the top-level <code>message</code> summary parameter differs.</p>\n<p>8 records in comparison.ndjson match this pattern. 5 are CodeSystem/$validate-code with relative system URIs (like &quot;SI&quot;, &quot;prov&quot;), 3 are ValueSet/$validate-code. All are validate-code operations where multiple issues exist.</p>\n<p>Search: Records where prod message equals &#x27;; &#x27;.join(all issue texts) and dev message equals only the first issue text, with 2+ issues.</p>\n<p>Tolerance <code>message-concat-missing-issues</code> normalizes the <code>message</code> parameter to prod&#x27;s concatenated value when the pattern matches (dev message equals first issue text, prod message equals all issues joined with &#x27;; &#x27;). This eliminates the 5 delta records matching this pattern.</p>", "impact": 8}, {"id": "4bd6271", "title": "ISO 3166 : prod includes 42 reserved/user-assigned codes that dev omits", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:37", "date_iso": "2026-02-08T13:37:59-06:00", "body_md": "Records-Impacted: 7\nTolerance-ID: expand-iso3166-extra-reserved-codes\nRecord-ID: 70faaf64-3ca5-4ee1-94f1-7f89ad1cf7ed\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/CodeSystem/$validate-code?url=urn:iso:std:iso:3166&code=AA' \\\n-H 'Accept: application/fhir+json'\n\ncurl -s 'https://tx-dev.fhir.org/r4/CodeSystem/$validate-code?url=urn:iso:std:iso:3166&code=AA' \\\n-H 'Accept: application/fhir+json'\n```\n\nProd validates code `AA` (a reserved/user-assigned code) as valid in `urn:iso:std:iso:3166`, dev rejects it as unknown. This confirms prod's code system includes 42 reserved/user-assigned ISO 3166-1 codes that dev omits. The original bug was observed via `$expand` (291 vs 249 codes); the expand for the canonical `iso3166-1-2` ValueSet now returns 249 on both servers (the ValueSet compose filters to assigned codes only), but the underlying code system data still differs as shown by `$validate-code`.\n\n\nPOST /r4/ValueSet/$expand for ValueSets containing urn:iso:std:iso:3166: prod returns 291 codes (total=291), dev returns 249 codes (total=249). The 42 extra codes in prod are all ISO 3166-1 reserved/user-assigned codes:\n\n- AA (User-assigned)\n- QM through QZ (15 User-assigned codes)\n- XA through XJ, XL through XZ (24 codes: mostly User-assigned, plus XK=Kosovo, XX=Unknown, XZ=International Waters)\n- ZZ (Unknown or Invalid Territory)\n\nDev returns only the 249 standard assigned country codes.\n\n\n7 $expand records in deltas show this exact pattern (prod_total=291, dev_total=249):\n- `grep 'iso:3166' jobs/2026-02-round-1/results/deltas/deltas.ndjson` finds 14 records total (including reads and a dev-crash)\n- All 7 content-differs expand records share the same 291 vs 249 pattern\n\nSearch used:\n```\npython3 -c \"\nimport json\nwith open('jobs/2026-02-round-1/results/deltas/deltas.ndjson') as f:\n  for line in f:\n      r = json.loads(line)\n      if 'iso:3166' in r.get('prodBody',''):\n          prod = json.loads(r['prodBody'])\n          dev = json.loads(r['devBody'])\n          if prod.get('expansion',{}).get('total') == 291:\n              print(r['id'][:12])\n\"\n```\n\n\nTolerance `expand-iso3166-extra-reserved-codes` matches expand records where both prod and dev use urn:iso:std:iso:3166 and prod.expansion.total > dev.expansion.total. It normalizes by filtering prod's contains array to only include codes present in dev, and sets both totals to dev's count. This eliminates 7 records while preserving any other differences (display text, etc.) for detection.", "body_html": "<p>Records-Impacted: 7<br>\nTolerance-ID: expand-iso3166-extra-reserved-codes<br>\nRecord-ID: 70faaf64-3ca5-4ee1-94f1-7f89ad1cf7ed</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/CodeSystem/$validate-code?url=urn:iso:std:iso:3166&amp;code=AA&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/CodeSystem/$validate-code?url=urn:iso:std:iso:3166&amp;code=AA&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27;</code></pre>\n<p>Prod validates code <code>AA</code> (a reserved/user-assigned code) as valid in <code>urn:iso:std:iso:3166</code>, dev rejects it as unknown. This confirms prod&#x27;s code system includes 42 reserved/user-assigned ISO 3166-1 codes that dev omits. The original bug was observed via <code>$expand</code> (291 vs 249 codes); the expand for the canonical <code>iso3166-1-2</code> ValueSet now returns 249 on both servers (the ValueSet compose filters to assigned codes only), but the underlying code system data still differs as shown by <code>$validate-code</code>.</p>\n<p>POST /r4/ValueSet/$expand for ValueSets containing urn:iso:std:iso:3166: prod returns 291 codes (total=291), dev returns 249 codes (total=249). The 42 extra codes in prod are all ISO 3166-1 reserved/user-assigned codes:</p>\n<ul><li>AA (User-assigned)</li><li>QM through QZ (15 User-assigned codes)</li><li>XA through XJ, XL through XZ (24 codes: mostly User-assigned, plus XK=Kosovo, XX=Unknown, XZ=International Waters)</li><li>ZZ (Unknown or Invalid Territory)</li></ul>\n<p>Dev returns only the 249 standard assigned country codes.</p>\n<p>7 $expand records in deltas show this exact pattern (prod_total=291, dev_total=249):</p>\n<ul><li><code>grep &#x27;iso:3166&#x27; jobs/2026-02-round-1/results/deltas/deltas.ndjson</code> finds 14 records total (including reads and a dev-crash)</li><li>All 7 content-differs expand records share the same 291 vs 249 pattern</li></ul>\n<p>Search used:</p>\n<pre><code>python3 -c &quot;\nimport json\nwith open(&#x27;jobs/2026-02-round-1/results/deltas/deltas.ndjson&#x27;) as f:\n  for line in f:\n      r = json.loads(line)\n      if &#x27;iso:3166&#x27; in r.get(&#x27;prodBody&#x27;,&#x27;&#x27;):\n          prod = json.loads(r[&#x27;prodBody&#x27;])\n          dev = json.loads(r[&#x27;devBody&#x27;])\n          if prod.get(&#x27;expansion&#x27;,{}).get(&#x27;total&#x27;) == 291:\n              print(r[&#x27;id&#x27;][:12])\n&quot;</code></pre>\n<p>Tolerance <code>expand-iso3166-extra-reserved-codes</code> matches expand records where both prod and dev use urn:iso:std:iso:3166 and prod.expansion.total &gt; dev.expansion.total. It normalizes by filtering prod&#x27;s contains array to only include codes present in dev, and sets both totals to dev&#x27;s count. This eliminates 7 records while preserving any other differences (display text, etc.) for detection.</p>", "impact": 7}, {"id": "801aef1", "title": "Dev adds expression field on informational OperationOutcome issues where prod omits it", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-2", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 10:52", "date_iso": "2026-02-08T10:52:56-06:00", "body_md": "Records-Impacted: 6\nTolerance-ID: oo-extra-expression-on-info-issues\nRecord-ID: 9160e659-1af6-4bc6-9c89-e0a8b4df55cf\n\n## Repro\n\n```bash\n# Prod\ncurl -s 'https://tx.fhir.org/r4/CodeSystem/$validate-code?system=http%3A%2F%2Funitsofmeasure.org&code=TEST' \\\n  -H 'Accept: application/fhir+json' | \\\n  jq '.parameter[] | select(.name == \"issues\") | .resource.issue[] | select(.severity == \"information\") | {severity, code, expression}'\n\n# Dev\ncurl -s 'https://tx-dev.fhir.org/r4/CodeSystem/$validate-code?system=http%3A%2F%2Funitsofmeasure.org&code=TEST' \\\n  -H 'Accept: application/fhir+json' | \\\n  jq '.parameter[] | select(.name == \"issues\") | .resource.issue[] | select(.severity == \"information\") | {severity, code, expression}'\n```\n\nProd returns `\"expression\": null` (field absent) on the informational issue, dev returns `\"expression\": [\"code\"]`.\n\n## What differs\n\nIn $validate-code responses, both prod and dev return OperationOutcome issues. On error-severity issues, both include `expression: [\"code\"]`. On information-severity issues, prod omits the `expression` field entirely while dev includes `expression: [\"code\"]`.\n\nFor example, on `GET /r4/CodeSystem/$validate-code?system=http%3A%2F%2Funitsofmeasure.org&code=TEST`:\n- Prod: informational issue has no `expression` field\n- Dev: informational issue has `\"expression\": [\"code\"]`\n\nThe `expression` value is semantically correct (the issue relates to the `code` parameter), so dev is providing more complete information, but the difference in field presence is a real behavioral divergence.\n\n## How widespread\n\n6 records across the dataset exhibit this pattern:\n- 4 SNOMED CT records (all `code=K29` variants on different FHIR version paths)\n- 1 UCUM record (`code=TEST`)\n- 1 SNOMED CT POST record (`code=freetext`)\n\nAll are `$validate-code` or `$batch-validate-code` operations where the code is invalid and the informational issue provides supplementary error context (e.g., UCUM parse error, SNOMED expression parse error).\n\nSearch: node script checking all 3948 delta records for issues where dev has `expression` and prod lacks it on the same positional issue.\n\n## What the tolerance covers\n\nTolerance `oo-extra-expression-on-info-issues` matches validate-code Parameters responses where any OperationOutcome information-severity issue in dev has `expression` that prod lacks. Normalizes by removing the extra `expression` from dev to match prod. Eliminates 6 records.", "body_html": "<p>Records-Impacted: 6<br>\nTolerance-ID: oo-extra-expression-on-info-issues<br>\nRecord-ID: 9160e659-1af6-4bc6-9c89-e0a8b4df55cf</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod\ncurl -s &#x27;https://tx.fhir.org/r4/CodeSystem/$validate-code?system=http%3A%2F%2Funitsofmeasure.org&amp;code=TEST&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; | \\\n  jq &#x27;.parameter[] | select(.name == &quot;issues&quot;) | .resource.issue[] | select(.severity == &quot;information&quot;) | {severity, code, expression}&#x27;\n\n# Dev\ncurl -s &#x27;https://tx-dev.fhir.org/r4/CodeSystem/$validate-code?system=http%3A%2F%2Funitsofmeasure.org&amp;code=TEST&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; | \\\n  jq &#x27;.parameter[] | select(.name == &quot;issues&quot;) | .resource.issue[] | select(.severity == &quot;information&quot;) | {severity, code, expression}&#x27;</code></pre>\n<p>Prod returns <code>&quot;expression&quot;: null</code> (field absent) on the informational issue, dev returns <code>&quot;expression&quot;: [&quot;code&quot;]</code>.</p>\n<h2>What differs</h2>\n<p>In $validate-code responses, both prod and dev return OperationOutcome issues. On error-severity issues, both include <code>expression: [&quot;code&quot;]</code>. On information-severity issues, prod omits the <code>expression</code> field entirely while dev includes <code>expression: [&quot;code&quot;]</code>.</p>\n<p>For example, on <code>GET /r4/CodeSystem/$validate-code?system=http%3A%2F%2Funitsofmeasure.org&amp;code=TEST</code>:</p>\n<ul><li>Prod: informational issue has no <code>expression</code> field</li><li>Dev: informational issue has <code>&quot;expression&quot;: [&quot;code&quot;]</code></li></ul>\n<p>The <code>expression</code> value is semantically correct (the issue relates to the <code>code</code> parameter), so dev is providing more complete information, but the difference in field presence is a real behavioral divergence.</p>\n<h2>How widespread</h2>\n<p>6 records across the dataset exhibit this pattern:</p>\n<ul><li>4 SNOMED CT records (all <code>code=K29</code> variants on different FHIR version paths)</li><li>1 UCUM record (<code>code=TEST</code>)</li><li>1 SNOMED CT POST record (<code>code=freetext</code>)</li></ul>\n<p>All are <code>$validate-code</code> or <code>$batch-validate-code</code> operations where the code is invalid and the informational issue provides supplementary error context (e.g., UCUM parse error, SNOMED expression parse error).</p>\n<p>Search: node script checking all 3948 delta records for issues where dev has <code>expression</code> and prod lacks it on the same positional issue.</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance <code>oo-extra-expression-on-info-issues</code> matches validate-code Parameters responses where any OperationOutcome information-severity issue in dev has <code>expression</code> that prod lacks. Normalizes by removing the extra <code>expression</code> from dev to match prod. Eliminates 6 records.</p>", "impact": 6}, {"id": "7b445b0", "title": "SNOMED $lookup: dev returns Synonym designation use type where prod returns Inactive", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-2", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 10:52", "date_iso": "2026-02-08T10:52:56-06:00", "body_md": "Records-Impacted: 4\nTolerance-ID: snomed-lookup-inactive-designation-use\nRecord-ID: eebd3d87-2015-48c3-84ac-c46d76ac23e1\n\n## Repro\n\n```bash\n# Prod\ncurl -s 'https://tx.fhir.org/r4/CodeSystem/$lookup?system=http://snomed.info/sct&code=303071001' \\\n  -H 'Accept: application/fhir+json'\n\n# Dev\ncurl -s 'https://tx-dev.fhir.org/r4/CodeSystem/$lookup?system=http://snomed.info/sct&code=303071001' \\\n  -H 'Accept: application/fhir+json'\n```\n\nProd returns designation \"People in the family\" with `use.code: \"73425007\"` (display: \"Inactive\"), dev returns the same designation with `use.code: \"900000000000013009\"` (display: \"Synonym (core metadata concept)\"). Also reproducible with code 116101001 where prod marks 7 of 9 designations as Inactive while dev marks none.\n\n## What differs\n\nFor SNOMED CT CodeSystem/$lookup responses containing inactive descriptions, prod marks those designations with `use.code: \"73425007\"` (display: \"Inactive\") while dev marks the same designations with `use.code: \"900000000000013009\"` (display: \"Synonym (core metadata concept)\").\n\nIn SNOMED CT, concept 73425007 identifies a description that is inactive (no longer preferred). Using Synonym (900000000000013009) instead loses the information that the description is inactive.\n\nExample for code 303071001 (Family member):\n- Prod: designation \"People in the family\" has `use.code: \"73425007\"` (Inactive)\n- Dev: same designation has `use.code: \"900000000000013009\"` (Synonym)\n\nFor code 116101001, prod marks 7 of 9 designations with Inactive use type; dev marks none as Inactive, using Synonym or FSN instead.\n\n## How widespread\n\n4 records in the delta set match this pattern. All are SNOMED $lookup operations on R4:\n- 1 record for code 303071001 (Family member)\n- 3 records for code 116101001 (Gonadotropin releasing hormone) — same code, different comparison record IDs\n\nSearch: `python3` script checking for `73425007` in prodBody across all SNOMED lookup deltas found exactly 4 matches. Broader search across all 2187 SNOMED lookups in comparison.ndjson also found only 4 records.\n\n## What the tolerance covers\n\nTolerance `snomed-lookup-inactive-designation-use` normalizes the designation use type difference by:\n- Matching SNOMED $lookup records where prod has designation use code 73425007 and dev has 900000000000013009 for the same designation value\n- Normalizing dev designations to match prod's use type when the designation text matches\n\nEliminates 4 records.\n\n## Representative records\n\n- eebd3d87-2015-48c3-84ac-c46d76ac23e1 — GET /r4/CodeSystem/$lookup?system=http://snomed.info/sct&code=303071001\n- fcb6b89e-a38f-444f-8bcb-41eefd5509b0 — GET /r4/CodeSystem/$lookup?system=http://snomed.info/sct&code=116101001", "body_html": "<p>Records-Impacted: 4<br>\nTolerance-ID: snomed-lookup-inactive-designation-use<br>\nRecord-ID: eebd3d87-2015-48c3-84ac-c46d76ac23e1</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod\ncurl -s &#x27;https://tx.fhir.org/r4/CodeSystem/$lookup?system=http://snomed.info/sct&amp;code=303071001&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;\n\n# Dev\ncurl -s &#x27;https://tx-dev.fhir.org/r4/CodeSystem/$lookup?system=http://snomed.info/sct&amp;code=303071001&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;</code></pre>\n<p>Prod returns designation &quot;People in the family&quot; with <code>use.code: &quot;73425007&quot;</code> (display: &quot;Inactive&quot;), dev returns the same designation with <code>use.code: &quot;900000000000013009&quot;</code> (display: &quot;Synonym (core metadata concept)&quot;). Also reproducible with code 116101001 where prod marks 7 of 9 designations as Inactive while dev marks none.</p>\n<h2>What differs</h2>\n<p>For SNOMED CT CodeSystem/$lookup responses containing inactive descriptions, prod marks those designations with <code>use.code: &quot;73425007&quot;</code> (display: &quot;Inactive&quot;) while dev marks the same designations with <code>use.code: &quot;900000000000013009&quot;</code> (display: &quot;Synonym (core metadata concept)&quot;).</p>\n<p>In SNOMED CT, concept 73425007 identifies a description that is inactive (no longer preferred). Using Synonym (900000000000013009) instead loses the information that the description is inactive.</p>\n<p>Example for code 303071001 (Family member):</p>\n<ul><li>Prod: designation &quot;People in the family&quot; has <code>use.code: &quot;73425007&quot;</code> (Inactive)</li><li>Dev: same designation has <code>use.code: &quot;900000000000013009&quot;</code> (Synonym)</li></ul>\n<p>For code 116101001, prod marks 7 of 9 designations with Inactive use type; dev marks none as Inactive, using Synonym or FSN instead.</p>\n<h2>How widespread</h2>\n<p>4 records in the delta set match this pattern. All are SNOMED $lookup operations on R4:</p>\n<ul><li>1 record for code 303071001 (Family member)</li><li>3 records for code 116101001 (Gonadotropin releasing hormone) — same code, different comparison record IDs</li></ul>\n<p>Search: <code>python3</code> script checking for <code>73425007</code> in prodBody across all SNOMED lookup deltas found exactly 4 matches. Broader search across all 2187 SNOMED lookups in comparison.ndjson also found only 4 records.</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance <code>snomed-lookup-inactive-designation-use</code> normalizes the designation use type difference by:</p>\n<ul><li>Matching SNOMED $lookup records where prod has designation use code 73425007 and dev has 900000000000013009 for the same designation value</li><li>Normalizing dev designations to match prod&#x27;s use type when the designation text matches</li></ul>\n<p>Eliminates 4 records.</p>\n<h2>Representative records</h2>\n<ul><li>eebd3d87-2015-48c3-84ac-c46d76ac23e1 — GET /r4/CodeSystem/$lookup?system=<a href=\"http://snomed.info/sct&amp;code=303071001\" target=\"_blank\">http://snomed.info/sct&amp;code=303071001</a></li><li>fcb6b89e-a38f-444f-8bcb-41eefd5509b0 — GET /r4/CodeSystem/$lookup?system=<a href=\"http://snomed.info/sct&amp;code=116101001\" target=\"_blank\">http://snomed.info/sct&amp;code=116101001</a></li></ul>", "impact": 4}, {"id": "d5bac5b", "title": "Draft CodeSystem message missing provenance suffix in dev", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:37", "date_iso": "2026-02-08T13:37:59-06:00", "body_md": "Records-Impacted: 4\nTolerance-ID: draft-codesystem-message-provenance-suffix\nRecord-ID: dcdd2b94-db92-4e95-973c-5ced19783bef\n\n\nValidate a code against a draft CodeSystem (e.g. `event-status`) on both servers and compare the `details.text` in the OperationOutcome issue:\n\n```bash\ncurl -s \"https://tx.fhir.org/r4/CodeSystem/\\$validate-code\" \\\n-H \"Content-Type: application/fhir+json\" \\\n-H \"Accept: application/fhir+json\" \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/event-status\"},{\"name\":\"code\",\"valueCode\":\"completed\"}]}'\n\ncurl -s \"https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code\" \\\n-H \"Content-Type: application/fhir+json\" \\\n-H \"Accept: application/fhir+json\" \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/event-status\"},{\"name\":\"code\",\"valueCode\":\"completed\"}]}'\n```\n\n**Expected** (prod): `details.text` = `Reference to draft CodeSystem http://hl7.org/fhir/event-status|4.0.1 from hl7.fhir.r4.core#4.0.1`\n**Actual** (dev): `details.text` = `Reference to draft CodeSystem http://hl7.org/fhir/event-status|4.0.1`\n\nAlso reproduces with other draft CodeSystems: `narrative-status`, `medicationrequest-status`, `medicationrequest-intent`.\n\n\nWhen validating codes against draft CodeSystems, both prod and dev return an informational OperationOutcome issue with code \"status-check\" and message ID \"MSG_DRAFT\". The details.text differs:\n\n- **Prod**: `Reference to draft CodeSystem http://hl7.org/fhir/event-status|4.0.1 from hl7.fhir.r4.core#4.0.1`\n- **Dev**: `Reference to draft CodeSystem http://hl7.org/fhir/event-status|4.0.1`\n\nDev omits the ` from <package>#<version>` provenance suffix that identifies which FHIR package the CodeSystem was loaded from.\n\n\n4 records in the comparison dataset, all POST /r4/CodeSystem/$validate-code against draft CodeSystems from hl7.fhir.r4.core#4.0.1:\n- http://hl7.org/fhir/event-status\n- http://hl7.org/fhir/narrative-status\n- http://hl7.org/fhir/CodeSystem/medicationrequest-status\n- http://hl7.org/fhir/CodeSystem/medicationrequest-intent\n\nFound via: `grep -c 'from hl7.fhir' results/deltas/deltas.ndjson` (4 matches out of 910 deltas).\n\nAll 4 records agree on result (true), system, code, version, and display. The only remaining difference after normalization is the details.text provenance suffix.\n\n\nTolerance ID: `draft-codesystem-message-provenance-suffix`. Matches validate-code Parameters responses where OperationOutcome issue text in prod ends with ` from <package>#<version>` and dev has the same text without that suffix. Normalizes both sides to the prod text (which includes provenance). Eliminates 4 records.", "body_html": "<p>Records-Impacted: 4<br>\nTolerance-ID: draft-codesystem-message-provenance-suffix<br>\nRecord-ID: dcdd2b94-db92-4e95-973c-5ced19783bef</p>\n<p>Validate a code against a draft CodeSystem (e.g. <code>event-status</code>) on both servers and compare the <code>details.text</code> in the OperationOutcome issue:</p>\n<pre><code class=\"lang-bash\">curl -s &quot;https://tx.fhir.org/r4/CodeSystem/\\$validate-code&quot; \\\n-H &quot;Content-Type: application/fhir+json&quot; \\\n-H &quot;Accept: application/fhir+json&quot; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/event-status&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;completed&quot;}]}&#x27;\n\ncurl -s &quot;https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code&quot; \\\n-H &quot;Content-Type: application/fhir+json&quot; \\\n-H &quot;Accept: application/fhir+json&quot; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/event-status&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;completed&quot;}]}&#x27;</code></pre>\n<p><strong>Expected</strong> (prod): <code>details.text</code> = <code>Reference to draft CodeSystem http://hl7.org/fhir/event-status|4.0.1 from hl7.fhir.r4.core#4.0.1</code><br>\n<strong>Actual</strong> (dev): <code>details.text</code> = <code>Reference to draft CodeSystem http://hl7.org/fhir/event-status|4.0.1</code></p>\n<p>Also reproduces with other draft CodeSystems: <code>narrative-status</code>, <code>medicationrequest-status</code>, <code>medicationrequest-intent</code>.</p>\n<p>When validating codes against draft CodeSystems, both prod and dev return an informational OperationOutcome issue with code &quot;status-check&quot; and message ID &quot;MSG_DRAFT&quot;. The details.text differs:</p>\n<ul><li><strong>Prod</strong>: <code>Reference to draft CodeSystem http://hl7.org/fhir/event-status|4.0.1 from hl7.fhir.r4.core#4.0.1</code></li><li><strong>Dev</strong>: <code>Reference to draft CodeSystem http://hl7.org/fhir/event-status|4.0.1</code></li></ul>\n<p>Dev omits the <code> from &lt;package&gt;#&lt;version&gt;</code> provenance suffix that identifies which FHIR package the CodeSystem was loaded from.</p>\n<p>4 records in the comparison dataset, all POST /r4/CodeSystem/$validate-code against draft CodeSystems from hl7.fhir.r4.core#4.0.1:</p>\n<ul><li><a href=\"http://hl7.org/fhir/event-status\" target=\"_blank\">http://hl7.org/fhir/event-status</a></li><li><a href=\"http://hl7.org/fhir/narrative-status\" target=\"_blank\">http://hl7.org/fhir/narrative-status</a></li><li><a href=\"http://hl7.org/fhir/CodeSystem/medicationrequest-status\" target=\"_blank\">http://hl7.org/fhir/CodeSystem/medicationrequest-status</a></li><li><a href=\"http://hl7.org/fhir/CodeSystem/medicationrequest-intent\" target=\"_blank\">http://hl7.org/fhir/CodeSystem/medicationrequest-intent</a></li></ul>\n<p>Found via: <code>grep -c &#x27;from hl7.fhir&#x27; results/deltas/deltas.ndjson</code> (4 matches out of 910 deltas).</p>\n<p>All 4 records agree on result (true), system, code, version, and display. The only remaining difference after normalization is the details.text provenance suffix.</p>\n<p>Tolerance ID: <code>draft-codesystem-message-provenance-suffix</code>. Matches validate-code Parameters responses where OperationOutcome issue text in prod ends with <code> from &lt;package&gt;#&lt;version&gt;</code> and dev has the same text without that suffix. Normalizes both sides to the prod text (which includes provenance). Eliminates 4 records.</p>", "impact": 4}, {"id": "0b7549d", "title": "Resource read: prod omits text.div when text.status=generated, dev includes it", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:37", "date_iso": "2026-02-08T13:37:59-06:00", "body_md": "Records-Impacted: 4\nTolerance-ID: read-resource-text-div-diff\nRecord-ID: 31a631b5-8579-48d8-a95c-e40eadfd4714\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/ValueSet/us-core-laboratory-test-codes' \\\n-H 'Accept: application/fhir+json'\n\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/us-core-laboratory-test-codes' \\\n-H 'Accept: application/fhir+json'\n```\n\nProd returns `\"text\": {\"status\": \"generated\"}` with no `div` element. Dev returns `\"text\": {\"status\": \"generated\", \"div\": \"<div>...Generated Narrative...</div>\"}` with a full generated narrative. Same behavior on both the direct read (`/r4/ValueSet/us-core-laboratory-test-codes`) and search (`/r4/ValueSet?url=...`) paths.\n\n\nWhen reading ValueSet resources (both direct reads like `/r4/ValueSet/us-core-laboratory-test-codes` and search reads like `/r4/ValueSet?url=...`), prod returns `text: {\"status\": \"generated\"}` without the `div` element, while dev returns `text: {\"status\": \"generated\", \"div\": \"<div>...</div>\"}` with a full generated narrative.\n\nIn FHIR R4, when `text.status` is present, the `div` element is required. Prod's omission of `div` with `status=generated` is technically non-conformant. Dev includes the correct generated narrative HTML.\n\nThe narrative content itself is auto-generated from the resource structure (e.g., listing included code systems and filters) and has no direct terminology significance.\n\n\n4 delta records are affected, all for the same ValueSet (`us-core-laboratory-test-codes`) accessed via 2 URL patterns (direct read and search), each appearing twice in the test data:\n\n- 31a631b5: GET /r4/ValueSet?url=...us-core-laboratory-test-codes (search)\n- 296cf150: GET /r4/ValueSet/us-core-laboratory-test-codes (direct)\n- 9a2a81a0: GET /r4/ValueSet?url=...us-core-laboratory-test-codes (search)\n- 6e354570: GET /r4/ValueSet/us-core-laboratory-test-codes (direct)\n\nSearch used: `grep '\"op\":\"read\"' deltas.ndjson` then checked all 8 results for text.div presence. Only these 4 had the pattern (the other 4 had different issues: entry count mismatch or other diffs).\n\n\nTolerance ID: `read-resource-text-div-diff`. Matches read operations (resource reads returning ValueSet, CodeSystem, or Bundle with entries) where both sides have `text.status=generated` but differ on `div` presence. Normalizes by stripping `text.div` from both sides and comparing the rest. Eliminates 4 records.\n\n\n`grep -n '31a631b5-8579-48d8-a95c-e40eadfd4714' comparison.ndjson`", "body_html": "<p>Records-Impacted: 4<br>\nTolerance-ID: read-resource-text-div-diff<br>\nRecord-ID: 31a631b5-8579-48d8-a95c-e40eadfd4714</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/ValueSet/us-core-laboratory-test-codes&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/us-core-laboratory-test-codes&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27;</code></pre>\n<p>Prod returns <code>&quot;text&quot;: {&quot;status&quot;: &quot;generated&quot;}</code> with no <code>div</code> element. Dev returns <code>&quot;text&quot;: {&quot;status&quot;: &quot;generated&quot;, &quot;div&quot;: &quot;&lt;div&gt;...Generated Narrative...&lt;/div&gt;&quot;}</code> with a full generated narrative. Same behavior on both the direct read (<code>/r4/ValueSet/us-core-laboratory-test-codes</code>) and search (<code>/r4/ValueSet?url=...</code>) paths.</p>\n<p>When reading ValueSet resources (both direct reads like <code>/r4/ValueSet/us-core-laboratory-test-codes</code> and search reads like <code>/r4/ValueSet?url=...</code>), prod returns <code>text: {&quot;status&quot;: &quot;generated&quot;}</code> without the <code>div</code> element, while dev returns <code>text: {&quot;status&quot;: &quot;generated&quot;, &quot;div&quot;: &quot;&lt;div&gt;...&lt;/div&gt;&quot;}</code> with a full generated narrative.</p>\n<p>In FHIR R4, when <code>text.status</code> is present, the <code>div</code> element is required. Prod&#x27;s omission of <code>div</code> with <code>status=generated</code> is technically non-conformant. Dev includes the correct generated narrative HTML.</p>\n<p>The narrative content itself is auto-generated from the resource structure (e.g., listing included code systems and filters) and has no direct terminology significance.</p>\n<p>4 delta records are affected, all for the same ValueSet (<code>us-core-laboratory-test-codes</code>) accessed via 2 URL patterns (direct read and search), each appearing twice in the test data:</p>\n<ul><li>31a631b5: GET /r4/ValueSet?url=...us-core-laboratory-test-codes (search)</li><li>296cf150: GET /r4/ValueSet/us-core-laboratory-test-codes (direct)</li><li>9a2a81a0: GET /r4/ValueSet?url=...us-core-laboratory-test-codes (search)</li><li>6e354570: GET /r4/ValueSet/us-core-laboratory-test-codes (direct)</li></ul>\n<p>Search used: <code>grep &#x27;&quot;op&quot;:&quot;read&quot;&#x27; deltas.ndjson</code> then checked all 8 results for text.div presence. Only these 4 had the pattern (the other 4 had different issues: entry count mismatch or other diffs).</p>\n<p>Tolerance ID: <code>read-resource-text-div-diff</code>. Matches read operations (resource reads returning ValueSet, CodeSystem, or Bundle with entries) where both sides have <code>text.status=generated</code> but differ on <code>div</code> presence. Normalizes by stripping <code>text.div</code> from both sides and comparing the rest. Eliminates 4 records.</p>\n<p><code>grep -n &#x27;31a631b5-8579-48d8-a95c-e40eadfd4714&#x27; comparison.ndjson</code></p>", "impact": 4}, {"id": "61d43e0", "title": "Case-insensitive validate-code: dev returns extra normalized-code param, different severity and issue text", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:37", "date_iso": "2026-02-08T13:37:59-06:00", "body_md": "Records-Impacted: 4\nTolerance-ID: case-insensitive-code-validation-diffs\nRecord-ID: b6d0a8c8-a6e9-4acb-8228-f08aad1b1c49\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/CodeSystem/\\$validate-code' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/sid/icd-10-cm\"},{\"name\":\"code\",\"valueCode\":\"M80.00xA\"}]}'\n\ncurl -s 'https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/sid/icd-10-cm\"},{\"name\":\"code\",\"valueCode\":\"M80.00xA\"}]}'\n```\n\nProd returns severity `\"warning\"`, no `normalized-code` param, and bare system URI in issue text. Dev returns severity `\"information\"`, extra `normalized-code: \"M80.00XA\"` param, and versioned system URI (`http://hl7.org/fhir/sid/icd-10-cm|2024`) in issue text.\n\nWhen validating codes in case-insensitive code systems (ICD-10, ICD-10-CM) where the submitted code has incorrect casing (e.g., \"M80.00xA\" instead of \"M80.00XA\", or \"i50\" instead of \"I50\"):\n\n1. Dev returns an extra `normalized-code` output parameter containing the correctly-cased code. Prod omits this parameter entirely. The `normalized-code` parameter is a valid $validate-code output per the FHIR spec, so dev is arguably more informative, but the difference needs tracking.\n\n2. The OperationOutcome issue severity differs: prod returns `\"warning\"`, dev returns `\"information\"` for the CODE_CASE_DIFFERENCE issue. Both convey the same message about case differences.\n\n3. The issue details text includes the system URI version in dev but not in prod. Prod: \"the code system 'http://hl7.org/fhir/sid/icd-10-cm' is case insensitive\". Dev: \"the code system 'http://hl7.org/fhir/sid/icd-10-cm|2024' is case insensitive\".\n\nAll 4 records are POST /r4/CodeSystem/$validate-code with case-insensitive code systems (2 ICD-10-CM with code M80.00xA, 2 ICD-10 with code i50). Both sides agree result=true.\n\nSearch: `grep 'normalized-code' jobs/2026-02-round-1/results/deltas/deltas.ndjson | wc -l` → 4\nCross-check: `grep 'CODE_CASE_DIFFERENCE' jobs/2026-02-round-1/results/deltas/deltas.ndjson | wc -l` → 4 (same records)", "body_html": "<p>Records-Impacted: 4<br>\nTolerance-ID: case-insensitive-code-validation-diffs<br>\nRecord-ID: b6d0a8c8-a6e9-4acb-8228-f08aad1b1c49</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/CodeSystem/\\$validate-code&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/sid/icd-10-cm&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;M80.00xA&quot;}]}&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/sid/icd-10-cm&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;M80.00xA&quot;}]}&#x27;</code></pre>\n<p>Prod returns severity <code>&quot;warning&quot;</code>, no <code>normalized-code</code> param, and bare system URI in issue text. Dev returns severity <code>&quot;information&quot;</code>, extra <code>normalized-code: &quot;M80.00XA&quot;</code> param, and versioned system URI (<code>http://hl7.org/fhir/sid/icd-10-cm|2024</code>) in issue text.</p>\n<p>When validating codes in case-insensitive code systems (ICD-10, ICD-10-CM) where the submitted code has incorrect casing (e.g., &quot;M80.00xA&quot; instead of &quot;M80.00XA&quot;, or &quot;i50&quot; instead of &quot;I50&quot;):</p>\n<ol><li>Dev returns an extra <code>normalized-code</code> output parameter containing the correctly-cased code. Prod omits this parameter entirely. The <code>normalized-code</code> parameter is a valid $validate-code output per the FHIR spec, so dev is arguably more informative, but the difference needs tracking.</li></ol>\n<ol><li>The OperationOutcome issue severity differs: prod returns <code>&quot;warning&quot;</code>, dev returns <code>&quot;information&quot;</code> for the CODE_CASE_DIFFERENCE issue. Both convey the same message about case differences.</li></ol>\n<ol><li>The issue details text includes the system URI version in dev but not in prod. Prod: &quot;the code system &#x27;<a href=\"http://hl7.org/fhir/sid/icd-10-cm&#x27;\" target=\"_blank\">http://hl7.org/fhir/sid/icd-10-cm&#x27;</a> is case insensitive&quot;. Dev: &quot;the code system &#x27;<a href=\"http://hl7.org/fhir/sid/icd-10-cm|2024&#x27;\" target=\"_blank\">http://hl7.org/fhir/sid/icd-10-cm|2024&#x27;</a> is case insensitive&quot;.</li></ol>\n<p>All 4 records are POST /r4/CodeSystem/$validate-code with case-insensitive code systems (2 ICD-10-CM with code M80.00xA, 2 ICD-10 with code i50). Both sides agree result=true.</p>\n<p>Search: <code>grep &#x27;normalized-code&#x27; jobs/2026-02-round-1/results/deltas/deltas.ndjson | wc -l</code> → 4<br>\nCross-check: <code>grep &#x27;CODE_CASE_DIFFERENCE&#x27; jobs/2026-02-round-1/results/deltas/deltas.ndjson | wc -l</code> → 4 (same records)</p>", "impact": 4}, {"id": "c59229b", "title": "CPT validate-code: dev says 'Unknown code' while prod says 'Wrong Display Name' for same CPT codes", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:38", "date_iso": "2026-02-08T13:38:00-06:00", "body_md": "Records-Impacted: 4\nTolerance-ID: cpt-validate-code-unknown-vs-invalid-display\nRecord-ID: d6a5e829-c5cc-44f3-b708-9615095c396b\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/CodeSystem/$validate-code' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-H 'Accept-Language: en-US' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"system\",\"valueUri\":\"http://www.ama-assn.org/go/cpt\"},{\"name\":\"code\",\"valueCode\":\"99235\"},{\"name\":\"display\",\"valueString\":\"Observation or inpatient hospital care for problems of moderate severity\"}]}'\n\ncurl -s 'https://tx-dev.fhir.org/r4/CodeSystem/$validate-code' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-H 'Accept-Language: en-US' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"system\",\"valueUri\":\"http://www.ama-assn.org/go/cpt\"},{\"name\":\"code\",\"valueCode\":\"99235\"},{\"name\":\"display\",\"valueString\":\"Observation or inpatient hospital care for problems of moderate severity\"}]}'\n```\n\nProd returns `result=false` with issue `invalid-display` (\"Wrong Display Name\") — it finds CPT 99235 but rejects the display. Dev returns `result=false` with issue `invalid-code` (\"Unknown code '99235'\") — it cannot find the code at all. Confirmed 2026-02-07.\n\n\nOn POST /r4/CodeSystem/$validate-code for CPT code 99235, both servers return result=false, but for entirely different reasons:\n\n- **Prod**: Finds the code in CPT 2023, returns version=\"2023\", display (the correct display text), and error \"Wrong Display Name\" with issue code `invalid-display`. The code exists but the submitted display text is wrong.\n- **Dev**: Cannot find the code at all, returns \"Unknown code '99235' in the CodeSystem 'http://www.ama-assn.org/go/cpt' version '2023'\" with issue code `invalid-code`. No version or display parameters returned.\n\nAdditional parameter differences: prod returns `display` and `version` parameters that dev omits entirely.\n\n\n4 delta records match this pattern. All are POST /r4/CodeSystem/$validate-code for CPT code 99235 with system http://www.ama-assn.org/go/cpt.\n\nSearch: all records where system=CPT, both result=false, prod has invalid-display issue, dev has invalid-code issue.\n\nRecord IDs: d6a5e829-c5cc, cce32e6a-60b5, b305620e-f843, f6ec96ae-ab93.\n\n\nSame root cause as bug f559b53 (dev fails to recognize valid CPT codes). The existing tolerance cpt-validate-code-result-disagrees only covers the case where prodResult=true and devResult=false. This bug covers a different manifestation where both return result=false but for different reasons — prod recognizes the code and rejects the display, dev doesn't find the code at all.\n\n\nTolerance ID: cpt-validate-code-unknown-vs-invalid-display\nMatches: CPT validate-code where both result=false, prod has invalid-display issue, dev has invalid-code issue.\nEliminates: 4 records.", "body_html": "<p>Records-Impacted: 4<br>\nTolerance-ID: cpt-validate-code-unknown-vs-invalid-display<br>\nRecord-ID: d6a5e829-c5cc-44f3-b708-9615095c396b</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/CodeSystem/$validate-code&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-H &#x27;Accept-Language: en-US&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;system&quot;,&quot;valueUri&quot;:&quot;http://www.ama-assn.org/go/cpt&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;99235&quot;},{&quot;name&quot;:&quot;display&quot;,&quot;valueString&quot;:&quot;Observation or inpatient hospital care for problems of moderate severity&quot;}]}&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/CodeSystem/$validate-code&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-H &#x27;Accept-Language: en-US&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;system&quot;,&quot;valueUri&quot;:&quot;http://www.ama-assn.org/go/cpt&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;99235&quot;},{&quot;name&quot;:&quot;display&quot;,&quot;valueString&quot;:&quot;Observation or inpatient hospital care for problems of moderate severity&quot;}]}&#x27;</code></pre>\n<p>Prod returns <code>result=false</code> with issue <code>invalid-display</code> (&quot;Wrong Display Name&quot;) — it finds CPT 99235 but rejects the display. Dev returns <code>result=false</code> with issue <code>invalid-code</code> (&quot;Unknown code &#x27;99235&#x27;&quot;) — it cannot find the code at all. Confirmed 2026-02-07.</p>\n<p>On POST /r4/CodeSystem/$validate-code for CPT code 99235, both servers return result=false, but for entirely different reasons:</p>\n<ul><li><strong>Prod</strong>: Finds the code in CPT 2023, returns version=&quot;2023&quot;, display (the correct display text), and error &quot;Wrong Display Name&quot; with issue code <code>invalid-display</code>. The code exists but the submitted display text is wrong.</li><li><strong>Dev</strong>: Cannot find the code at all, returns &quot;Unknown code &#x27;99235&#x27; in the CodeSystem &#x27;<a href=\"http://www.ama-assn.org/go/cpt&#x27;\" target=\"_blank\">http://www.ama-assn.org/go/cpt&#x27;</a> version &#x27;2023&#x27;&quot; with issue code <code>invalid-code</code>. No version or display parameters returned.</li></ul>\n<p>Additional parameter differences: prod returns <code>display</code> and <code>version</code> parameters that dev omits entirely.</p>\n<p>4 delta records match this pattern. All are POST /r4/CodeSystem/$validate-code for CPT code 99235 with system <a href=\"http://www.ama-assn.org/go/cpt.\" target=\"_blank\">http://www.ama-assn.org/go/cpt.</a></p>\n<p>Search: all records where system=CPT, both result=false, prod has invalid-display issue, dev has invalid-code issue.</p>\n<p>Record IDs: d6a5e829-c5cc, cce32e6a-60b5, b305620e-f843, f6ec96ae-ab93.</p>\n<p>Same root cause as bug f559b53 (dev fails to recognize valid CPT codes). The existing tolerance cpt-validate-code-result-disagrees only covers the case where prodResult=true and devResult=false. This bug covers a different manifestation where both return result=false but for different reasons — prod recognizes the code and rejects the display, dev doesn&#x27;t find the code at all.</p>\n<p>Tolerance ID: cpt-validate-code-unknown-vs-invalid-display<br>\nMatches: CPT validate-code where both result=false, prod has invalid-display issue, dev has invalid-code issue.<br>\nEliminates: 4 records.</p>", "impact": 4}, {"id": "8ef44d0", "title": "500 OperationOutcome structural differences: missing issue.code on prod, extra diagnostics/text", "status": "open", "labels": ["content-differs", "repro-inconclusive", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:38", "date_iso": "2026-02-08T13:38:00-06:00", "body_md": "Records-Impacted: 4\nTolerance-ID: error-operationoutcome-structure-diff\nRecord-ID: 1bb4cd9f-c99d-4431-b974-f6b5423eb529\n\n\nRequest bodies were not stored for these POST records. Attempted to reproduce\nby constructing similar validate-code requests against unknown CodeSystem\n`http://hl7.org/fhir/v3/AdministrativeGender`:\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$validate-code' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"coding\",\"valueCoding\":{\"system\":\"http://hl7.org/fhir/v3/AdministrativeGender\",\"code\":\"M\"}},{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"compose\":{\"include\":[{\"system\":\"http://hl7.org/fhir/v3/AdministrativeGender\"}]}}}]}'\n\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$validate-code' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"coding\",\"valueCoding\":{\"system\":\"http://hl7.org/fhir/v3/AdministrativeGender\",\"code\":\"M\"}},{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"compose\":{\"include\":[{\"system\":\"http://hl7.org/fhir/v3/AdministrativeGender\"}]}}}]}'\n```\n\n**Result**: Both servers return HTTP 200 with `result: false` (not the original 500\nOperationOutcome). Server behavior has changed since the comparison was captured\n(2026-02-06). Three different request body variations were tried; none reproduced\nthe 500/500 pattern.\n\nWhen both prod and dev return HTTP 500 with OperationOutcome, the response structures\ndiffer in three ways:\n\n1. **issue.code field**: Dev includes `code: \"exception\"` on each issue, prod omits it\n entirely. Per FHIR R4, `OperationOutcome.issue.code` is required (1..1), so prod is\n technically non-conformant.\n\n2. **issue.diagnostics field**: Dev includes a `diagnostics` string (duplicating the\n `details.text` content), prod omits it. The `diagnostics` field is optional (0..1)\n per spec.\n\n3. **text narrative element**: Prod includes `text: {status: \"generated\", div: \"...\"}`,\n dev omits the `text` element entirely. (The div is already stripped by the\n `read-resource-text-div-diff` tolerance, leaving just `text.status` on prod.)\n\nAll 4 affected records are POST /r4/ValueSet/$validate-code requests that result in\n500 errors due to unknown CodeSystems. The error messages are identical between prod\nand dev — both correctly identify the same failure. Only the OperationOutcome structure\ndiffers.\n\nFound with:\ngrep through deltas.ndjson for records where both prod.status=500 and dev.status=500,\nthen checked OperationOutcome issue field structure differences. All 4 records show\nthe same pattern.", "body_html": "<p>Records-Impacted: 4<br>\nTolerance-ID: error-operationoutcome-structure-diff<br>\nRecord-ID: 1bb4cd9f-c99d-4431-b974-f6b5423eb529</p>\n<p>Request bodies were not stored for these POST records. Attempted to reproduce<br>\nby constructing similar validate-code requests against unknown CodeSystem<br>\n<code>http://hl7.org/fhir/v3/AdministrativeGender</code>:</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/ValueSet/$validate-code&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;coding&quot;,&quot;valueCoding&quot;:{&quot;system&quot;:&quot;http://hl7.org/fhir/v3/AdministrativeGender&quot;,&quot;code&quot;:&quot;M&quot;}},{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;http://hl7.org/fhir/v3/AdministrativeGender&quot;}]}}}]}&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$validate-code&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;coding&quot;,&quot;valueCoding&quot;:{&quot;system&quot;:&quot;http://hl7.org/fhir/v3/AdministrativeGender&quot;,&quot;code&quot;:&quot;M&quot;}},{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;http://hl7.org/fhir/v3/AdministrativeGender&quot;}]}}}]}&#x27;</code></pre>\n<p><strong>Result</strong>: Both servers return HTTP 200 with <code>result: false</code> (not the original 500<br>\nOperationOutcome). Server behavior has changed since the comparison was captured<br>\n(2026-02-06). Three different request body variations were tried; none reproduced<br>\nthe 500/500 pattern.</p>\n<p>When both prod and dev return HTTP 500 with OperationOutcome, the response structures<br>\ndiffer in three ways:</p>\n<ol><li><strong>issue.code field</strong>: Dev includes <code>code: &quot;exception&quot;</code> on each issue, prod omits it</li></ol>\n<p>entirely. Per FHIR R4, <code>OperationOutcome.issue.code</code> is required (1..1), so prod is<br>\ntechnically non-conformant.</p>\n<ol><li><strong>issue.diagnostics field</strong>: Dev includes a <code>diagnostics</code> string (duplicating the</li></ol>\n<p><code>details.text</code> content), prod omits it. The <code>diagnostics</code> field is optional (0..1)<br>\nper spec.</p>\n<ol><li><strong>text narrative element</strong>: Prod includes <code>text: {status: &quot;generated&quot;, div: &quot;...&quot;}</code>,</li></ol>\n<p>dev omits the <code>text</code> element entirely. (The div is already stripped by the<br>\n<code>read-resource-text-div-diff</code> tolerance, leaving just <code>text.status</code> on prod.)</p>\n<p>All 4 affected records are POST /r4/ValueSet/$validate-code requests that result in<br>\n500 errors due to unknown CodeSystems. The error messages are identical between prod<br>\nand dev — both correctly identify the same failure. Only the OperationOutcome structure<br>\ndiffers.</p>\n<p>Found with:<br>\ngrep through deltas.ndjson for records where both prod.status=500 and dev.status=500,<br>\nthen checked OperationOutcome issue field structure differences. All 4 records show<br>\nthe same pattern.</p>", "impact": 4}, {"id": "3b864c6", "title": "SNOMED inactive display message lists extra synonyms vs prod", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:37", "date_iso": "2026-02-08T13:37:59-06:00", "body_md": "Records-Impacted: 3\nTolerance-ID: inactive-display-message-extra-synonyms\nRecord-ID: 292172fe-c9f1-4ca4-b1a7-1f353187c9ba\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$validate-code' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/ValueSet/condition-severity\"},{\"name\":\"coding\",\"valueCoding\":{\"system\":\"http://snomed.info/sct\",\"code\":\"6736007\",\"display\":\"Moderate\"}}]}'\n\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$validate-code' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/ValueSet/condition-severity\"},{\"name\":\"coding\",\"valueCoding\":{\"system\":\"http://snomed.info/sct\",\"code\":\"6736007\",\"display\":\"Moderate\"}}]}'\n```\n\nProd returns `\"The correct display is one of Midgrade\"`, dev returns `\"The correct display is one of Midgrade,Moderate (severity modifier) (qualifier value),Moderate (severity modifier),Moderate severity\"`.\n\n\nWhen validating a code with an inactive display (INACTIVE_DISPLAY_FOUND), the OperationOutcome issue details.text \"correct display\" list differs between prod and dev:\n\n- Prod: \"'Moderate' is no longer considered a correct display for code '6736007' (status = inactive). The correct display is one of Midgrade\"\n- Dev: \"'Moderate' is no longer considered a correct display for code '6736007' (status = inactive). The correct display is one of Midgrade,Moderate (severity modifier) (qualifier value),Moderate (severity modifier),Moderate severity\"\n\nProd lists only the preferred display term. Dev lists multiple synonyms/designations in addition to the preferred term.\n\nSame pattern for code 78421000 (Intramuscular): prod lists only \"Intramuscular route\" (quoted), dev lists \"Intramuscular route,Intramuscular route (qualifier value),Intramuscular use,IM route,IM use\".\n\n\n3 records in the comparison dataset, all in deltas:\n- 292172fe: POST /r4/ValueSet/$validate-code (SNOMED 6736007)\n- 01902b33: POST /r4/CodeSystem/$validate-code (SNOMED 78421000)\n- a0e9c508: POST /r4/CodeSystem/$validate-code (SNOMED 78421000)\n\nAll are SNOMED validate-code with display-comment issue type and INACTIVE_DISPLAY_FOUND message ID.\n\nSearch: grep 'INACTIVE_DISPLAY_FOUND' deltas.ndjson | wc -l → 3\n\n\nTolerance ID: inactive-display-message-extra-synonyms\nMatches validate-code records where OperationOutcome has display-comment issues with differing details.text that share the same prefix up to \"The correct display is one of\". Normalizes both sides to prod's text. Eliminates 3 records.", "body_html": "<p>Records-Impacted: 3<br>\nTolerance-ID: inactive-display-message-extra-synonyms<br>\nRecord-ID: 292172fe-c9f1-4ca4-b1a7-1f353187c9ba</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/ValueSet/$validate-code&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/ValueSet/condition-severity&quot;},{&quot;name&quot;:&quot;coding&quot;,&quot;valueCoding&quot;:{&quot;system&quot;:&quot;http://snomed.info/sct&quot;,&quot;code&quot;:&quot;6736007&quot;,&quot;display&quot;:&quot;Moderate&quot;}}]}&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$validate-code&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/ValueSet/condition-severity&quot;},{&quot;name&quot;:&quot;coding&quot;,&quot;valueCoding&quot;:{&quot;system&quot;:&quot;http://snomed.info/sct&quot;,&quot;code&quot;:&quot;6736007&quot;,&quot;display&quot;:&quot;Moderate&quot;}}]}&#x27;</code></pre>\n<p>Prod returns <code>&quot;The correct display is one of Midgrade&quot;</code>, dev returns <code>&quot;The correct display is one of Midgrade,Moderate (severity modifier) (qualifier value),Moderate (severity modifier),Moderate severity&quot;</code>.</p>\n<p>When validating a code with an inactive display (INACTIVE_DISPLAY_FOUND), the OperationOutcome issue details.text &quot;correct display&quot; list differs between prod and dev:</p>\n<ul><li>Prod: &quot;&#x27;Moderate&#x27; is no longer considered a correct display for code &#x27;6736007&#x27; (status = inactive). The correct display is one of Midgrade&quot;</li><li>Dev: &quot;&#x27;Moderate&#x27; is no longer considered a correct display for code &#x27;6736007&#x27; (status = inactive). The correct display is one of Midgrade,Moderate (severity modifier) (qualifier value),Moderate (severity modifier),Moderate severity&quot;</li></ul>\n<p>Prod lists only the preferred display term. Dev lists multiple synonyms/designations in addition to the preferred term.</p>\n<p>Same pattern for code 78421000 (Intramuscular): prod lists only &quot;Intramuscular route&quot; (quoted), dev lists &quot;Intramuscular route,Intramuscular route (qualifier value),Intramuscular use,IM route,IM use&quot;.</p>\n<p>3 records in the comparison dataset, all in deltas:</p>\n<ul><li>292172fe: POST /r4/ValueSet/$validate-code (SNOMED 6736007)</li><li>01902b33: POST /r4/CodeSystem/$validate-code (SNOMED 78421000)</li><li>a0e9c508: POST /r4/CodeSystem/$validate-code (SNOMED 78421000)</li></ul>\n<p>All are SNOMED validate-code with display-comment issue type and INACTIVE_DISPLAY_FOUND message ID.</p>\n<p>Search: grep &#x27;INACTIVE_DISPLAY_FOUND&#x27; deltas.ndjson | wc -l → 3</p>\n<p>Tolerance ID: inactive-display-message-extra-synonyms<br>\nMatches validate-code records where OperationOutcome has display-comment issues with differing details.text that share the same prefix up to &quot;The correct display is one of&quot;. Normalizes both sides to prod&#x27;s text. Eliminates 3 records.</p>", "impact": 3}, {"id": "0abae17", "title": "POST -code: dev missing code/system/display params and extra issues due to undefined system extraction", "status": "open", "labels": ["content-differs", "repro-inconclusive", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:37", "date_iso": "2026-02-08T13:37:59-06:00", "body_md": "Records-Impacted: 3\nTolerance-ID: validate-code-undefined-system-missing-params\nRecord-ID: 243e44e8-cafb-44ba-a521-de4aab9d6985\n\n\nCould not reproduce live. The original request was a POST to `/r4/ValueSet/$validate-code` with a `codeableConcept` parameter (SNOMED code 785126002) validated against the IPS medication ValueSet (`http://hl7.org/fhir/uv/ips/ValueSet/medication-uv-ips|2.0.0`). The ValueSet is not natively available on either server — it was provided inline via the test framework (likely as a `tx-resource` parameter). The request body was not stored in the comparison data, and the inline ValueSet definition is not available, so the exact request cannot be reconstructed.\n\nAttempted with a server-resident ValueSet (`http://hl7.org/fhir/ValueSet/medication-codes`), but both servers correctly return `system`, `code`, and `display` for that case — the undefined system extraction bug only manifests when the ValueSet is provided inline via the test framework's request format.\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$validate-code' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/ValueSet/medication-codes\"},{\"name\":\"codeableConcept\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"http://snomed.info/sct\",\"code\":\"785126002\",\"display\":\"Product containing precisely methylphenidate hydrochloride 5 milligram/1 each conventional release chewable tablet\"}]}}]}'\n\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$validate-code' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/ValueSet/medication-codes\"},{\"name\":\"codeableConcept\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"http://snomed.info/sct\",\"code\":\"785126002\",\"display\":\"Product containing precisely methylphenidate hydrochloride 5 milligram/1 each conventional release chewable tablet\"}]}}]}'\n```\n\nBoth servers return matching `system`, `code`, and `display` parameters with server-resident ValueSets. The bug requires the inline ValueSet provision path used by the Java validator test framework.\n\n\nOn POST /r4/ValueSet/$validate-code with codeableConcept input, dev fails to return `code`, `system`, and `display` output parameters that prod returns. Dev also returns extra OperationOutcome issues (`this-code-not-in-vs`, `not-in-vs`) that prod does not include. Both servers agree result=false (because the submitted display text is wrong).\n\nSpecific differences in the normalized output:\n- **Prod returns**: code=785126002, system=http://snomed.info/sct, display=\"Methylphenidate hydrochloride 5 mg chewable tablet\"\n- **Dev returns**: none of these three parameters\n- **Prod issues**: 1 issue (invalid-display error)\n- **Dev issues**: 3 issues (this-code-not-in-vs information, invalid-display error, not-in-vs error)\n- **Message**: Dev prepends \"No valid coding was found for the value set...\" to the message; prod has only the invalid-display message (already handled by invalid-display-message-format tolerance)\n\nDev diagnostics show `Validate \"[undefined#785126002 ...]\"` — the system is JavaScript \"undefined\", confirming the same POST body extraction failure as bugs 19283df and 4cdcd85.\n\n\n3 records, all POST /r4/ValueSet/$validate-code with the same SNOMED code 785126002 validating against medication-uv-ips ValueSet:\n- 243e44e8-cafb-44ba-a521-de4aab9d6985\n- 683c85d6-b337-4460-a005-df239084339a\n- 1e7a78b8-c2ec-4819-b871-31cd30f5af28\n\nAll 3 have result=false on both sides (display text is wrong), same SNOMED version. Pattern identified by searching for validate-code records where dev is missing both code and system parameters.\n\n\nTolerance `validate-code-undefined-system-missing-params` matches POST $validate-code with result=false where prod has code/system params but dev lacks them, and dev diagnostics contain \"undefined\". Eliminates all 3 records.\n\n\nSame root cause as bug 19283df (result-disagrees variant, 89 records) and bug 4cdcd85 (crash variant, 1 record). All three stem from dev failing to extract system/code from POST request body.", "body_html": "<p>Records-Impacted: 3<br>\nTolerance-ID: validate-code-undefined-system-missing-params<br>\nRecord-ID: 243e44e8-cafb-44ba-a521-de4aab9d6985</p>\n<p>Could not reproduce live. The original request was a POST to <code>/r4/ValueSet/$validate-code</code> with a <code>codeableConcept</code> parameter (SNOMED code 785126002) validated against the IPS medication ValueSet (<code>http://hl7.org/fhir/uv/ips/ValueSet/medication-uv-ips|2.0.0</code>). The ValueSet is not natively available on either server — it was provided inline via the test framework (likely as a <code>tx-resource</code> parameter). The request body was not stored in the comparison data, and the inline ValueSet definition is not available, so the exact request cannot be reconstructed.</p>\n<p>Attempted with a server-resident ValueSet (<code>http://hl7.org/fhir/ValueSet/medication-codes</code>), but both servers correctly return <code>system</code>, <code>code</code>, and <code>display</code> for that case — the undefined system extraction bug only manifests when the ValueSet is provided inline via the test framework&#x27;s request format.</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/ValueSet/$validate-code&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/ValueSet/medication-codes&quot;},{&quot;name&quot;:&quot;codeableConcept&quot;,&quot;valueCodeableConcept&quot;:{&quot;coding&quot;:[{&quot;system&quot;:&quot;http://snomed.info/sct&quot;,&quot;code&quot;:&quot;785126002&quot;,&quot;display&quot;:&quot;Product containing precisely methylphenidate hydrochloride 5 milligram/1 each conventional release chewable tablet&quot;}]}}]}&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$validate-code&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/ValueSet/medication-codes&quot;},{&quot;name&quot;:&quot;codeableConcept&quot;,&quot;valueCodeableConcept&quot;:{&quot;coding&quot;:[{&quot;system&quot;:&quot;http://snomed.info/sct&quot;,&quot;code&quot;:&quot;785126002&quot;,&quot;display&quot;:&quot;Product containing precisely methylphenidate hydrochloride 5 milligram/1 each conventional release chewable tablet&quot;}]}}]}&#x27;</code></pre>\n<p>Both servers return matching <code>system</code>, <code>code</code>, and <code>display</code> parameters with server-resident ValueSets. The bug requires the inline ValueSet provision path used by the Java validator test framework.</p>\n<p>On POST /r4/ValueSet/$validate-code with codeableConcept input, dev fails to return <code>code</code>, <code>system</code>, and <code>display</code> output parameters that prod returns. Dev also returns extra OperationOutcome issues (<code>this-code-not-in-vs</code>, <code>not-in-vs</code>) that prod does not include. Both servers agree result=false (because the submitted display text is wrong).</p>\n<p>Specific differences in the normalized output:</p>\n<ul><li><strong>Prod returns</strong>: code=785126002, system=<a href=\"http://snomed.info/sct,\" target=\"_blank\">http://snomed.info/sct,</a> display=&quot;Methylphenidate hydrochloride 5 mg chewable tablet&quot;</li><li><strong>Dev returns</strong>: none of these three parameters</li><li><strong>Prod issues</strong>: 1 issue (invalid-display error)</li><li><strong>Dev issues</strong>: 3 issues (this-code-not-in-vs information, invalid-display error, not-in-vs error)</li><li><strong>Message</strong>: Dev prepends &quot;No valid coding was found for the value set...&quot; to the message; prod has only the invalid-display message (already handled by invalid-display-message-format tolerance)</li></ul>\n<p>Dev diagnostics show <code>Validate &quot;[undefined#785126002 ...]&quot;</code> — the system is JavaScript &quot;undefined&quot;, confirming the same POST body extraction failure as bugs 19283df and 4cdcd85.</p>\n<p>3 records, all POST /r4/ValueSet/$validate-code with the same SNOMED code 785126002 validating against medication-uv-ips ValueSet:</p>\n<ul><li>243e44e8-cafb-44ba-a521-de4aab9d6985</li><li>683c85d6-b337-4460-a005-df239084339a</li><li>1e7a78b8-c2ec-4819-b871-31cd30f5af28</li></ul>\n<p>All 3 have result=false on both sides (display text is wrong), same SNOMED version. Pattern identified by searching for validate-code records where dev is missing both code and system parameters.</p>\n<p>Tolerance <code>validate-code-undefined-system-missing-params</code> matches POST $validate-code with result=false where prod has code/system params but dev lacks them, and dev diagnostics contain &quot;undefined&quot;. Eliminates all 3 records.</p>\n<p>Same root cause as bug 19283df (result-disagrees variant, 89 records) and bug 4cdcd85 (crash variant, 1 record). All three stem from dev failing to extract system/code from POST request body.</p>", "impact": 3}, {"id": "d70be11", "title": "CodeSystem/-code with multi-coding CodeableConcept: prod and dev report different coding in system/code/version output params", "status": "open", "labels": ["content-differs", "repro-inconclusive", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:37", "date_iso": "2026-02-08T13:37:59-06:00", "body_md": "Records-Impacted: 3\nTolerance-ID: multi-coding-cc-system-code-version-disagree\nRecord-ID: 65fabdc4-930b-49e8-9ff1-60c176cbbfee\n\n\nThe custom CodeSystem `http://fhir.essilorluxottica.com/fhir/CodeSystem/el-observation-code-cs` is no longer loaded on either server, so the original request conditions cannot be recreated. Both servers now return `result=false` with \"A definition for CodeSystem could not be found\".\n\n```bash\ncurl -s \"https://tx.fhir.org/r4/CodeSystem/$validate-code\" \\\n-H \"Accept: application/fhir+json\" \\\n-H \"Content-Type: application/fhir+json\" \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"codeableConcept\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"http://fhir.essilorluxottica.com/fhir/CodeSystem/el-observation-code-cs\",\"code\":\"physical.evaluation.alertnessAndOrientation.disorientatedtime\",\"display\":\"Patient is not alert & oriented to time\"},{\"system\":\"http://snomed.info/sct\",\"code\":\"19657006\",\"display\":\"Disorientated in time (finding)\"}]}}]}'\n\ncurl -s \"https://tx-dev.fhir.org/r4/CodeSystem/$validate-code\" \\\n-H \"Accept: application/fhir+json\" \\\n-H \"Content-Type: application/fhir+json\" \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"codeableConcept\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"http://fhir.essilorluxottica.com/fhir/CodeSystem/el-observation-code-cs\",\"code\":\"physical.evaluation.alertnessAndOrientation.disorientatedtime\",\"display\":\"Patient is not alert & oriented to time\"},{\"system\":\"http://snomed.info/sct\",\"code\":\"19657006\",\"display\":\"Disorientated in time (finding)\"}]}}]}'\n```\n\nBoth servers now return `result=false` with unknown CodeSystem error. The bug cannot be reproduced live because the custom CodeSystem package is no longer loaded.\n\n\nWhen POST /r4/CodeSystem/$validate-code is called with a CodeableConcept containing two codings (one from a custom CodeSystem `http://fhir.essilorluxottica.com/fhir/CodeSystem/el-observation-code-cs` and one from SNOMED CT), both servers return result=true and return identical codeableConcept parameters. However, the scalar output parameters (system, code, version) disagree on which coding to report:\n\n- **Prod** reports the SNOMED coding: system=http://snomed.info/sct, code=19657006, version=http://snomed.info/sct/900000000000207008/version/20250201\n- **Dev** reports the custom CodeSystem coding: system=http://fhir.essilorluxottica.com/fhir/CodeSystem/el-observation-code-cs, code=physical.evaluation.alertnessAndOrientation.disorientatedtime, version=1.0.0\n\n\n3 records, all POST /r4/CodeSystem/$validate-code? with CodeableConcept containing one el-observation-code-cs coding and one SNOMED coding. Found by searching for validate-code records where prod and dev return different system parameter values:\n\n```\ngrep 'el-observation-code-cs' comparison.ndjson | wc -l  # 3\n```\n\nAll 3 are currently in deltas. All involve the same custom CodeSystem paired with SNOMED.\n\n\nTolerance ID: multi-coding-cc-system-code-version-disagree\nMatches: POST $validate-code where result=true, both sides have codeableConcept with >1 coding, and system param differs between prod and dev.\nNormalizes system, code, and version params to prod values on both sides.\nEliminates 3 records.\n\n\n- 65fabdc4-930b-49e8-9ff1-60c176cbbfee (SNOMED 19657006 / el-observation-code-cs disorientatedtime)\n- db568fd1-e0b1-4188-b29f-4fe9f7b2529b (SNOMED 85828009 / el-observation-code-cs autoimmune)\n- 2e0dea57-4d5f-4442-99b8-881d1177f561 (SNOMED 26329005 / el-observation-code-cs cognitiveStatusNotNormal)", "body_html": "<p>Records-Impacted: 3<br>\nTolerance-ID: multi-coding-cc-system-code-version-disagree<br>\nRecord-ID: 65fabdc4-930b-49e8-9ff1-60c176cbbfee</p>\n<p>The custom CodeSystem <code>http://fhir.essilorluxottica.com/fhir/CodeSystem/el-observation-code-cs</code> is no longer loaded on either server, so the original request conditions cannot be recreated. Both servers now return <code>result=false</code> with &quot;A definition for CodeSystem could not be found&quot;.</p>\n<pre><code class=\"lang-bash\">curl -s &quot;https://tx.fhir.org/r4/CodeSystem/$validate-code&quot; \\\n-H &quot;Accept: application/fhir+json&quot; \\\n-H &quot;Content-Type: application/fhir+json&quot; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;codeableConcept&quot;,&quot;valueCodeableConcept&quot;:{&quot;coding&quot;:[{&quot;system&quot;:&quot;http://fhir.essilorluxottica.com/fhir/CodeSystem/el-observation-code-cs&quot;,&quot;code&quot;:&quot;physical.evaluation.alertnessAndOrientation.disorientatedtime&quot;,&quot;display&quot;:&quot;Patient is not alert &amp; oriented to time&quot;},{&quot;system&quot;:&quot;http://snomed.info/sct&quot;,&quot;code&quot;:&quot;19657006&quot;,&quot;display&quot;:&quot;Disorientated in time (finding)&quot;}]}}]}&#x27;\n\ncurl -s &quot;https://tx-dev.fhir.org/r4/CodeSystem/$validate-code&quot; \\\n-H &quot;Accept: application/fhir+json&quot; \\\n-H &quot;Content-Type: application/fhir+json&quot; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;codeableConcept&quot;,&quot;valueCodeableConcept&quot;:{&quot;coding&quot;:[{&quot;system&quot;:&quot;http://fhir.essilorluxottica.com/fhir/CodeSystem/el-observation-code-cs&quot;,&quot;code&quot;:&quot;physical.evaluation.alertnessAndOrientation.disorientatedtime&quot;,&quot;display&quot;:&quot;Patient is not alert &amp; oriented to time&quot;},{&quot;system&quot;:&quot;http://snomed.info/sct&quot;,&quot;code&quot;:&quot;19657006&quot;,&quot;display&quot;:&quot;Disorientated in time (finding)&quot;}]}}]}&#x27;</code></pre>\n<p>Both servers now return <code>result=false</code> with unknown CodeSystem error. The bug cannot be reproduced live because the custom CodeSystem package is no longer loaded.</p>\n<p>When POST /r4/CodeSystem/$validate-code is called with a CodeableConcept containing two codings (one from a custom CodeSystem <code>http://fhir.essilorluxottica.com/fhir/CodeSystem/el-observation-code-cs</code> and one from SNOMED CT), both servers return result=true and return identical codeableConcept parameters. However, the scalar output parameters (system, code, version) disagree on which coding to report:</p>\n<ul><li><strong>Prod</strong> reports the SNOMED coding: system=<a href=\"http://snomed.info/sct,\" target=\"_blank\">http://snomed.info/sct,</a> code=19657006, version=<a href=\"http://snomed.info/sct/900000000000207008/version/20250201\" target=\"_blank\">http://snomed.info/sct/900000000000207008/version/20250201</a></li><li><strong>Dev</strong> reports the custom CodeSystem coding: system=<a href=\"http://fhir.essilorluxottica.com/fhir/CodeSystem/el-observation-code-cs,\" target=\"_blank\">http://fhir.essilorluxottica.com/fhir/CodeSystem/el-observation-code-cs,</a> code=physical.evaluation.alertnessAndOrientation.disorientatedtime, version=1.0.0</li></ul>\n<p>3 records, all POST /r4/CodeSystem/$validate-code? with CodeableConcept containing one el-observation-code-cs coding and one SNOMED coding. Found by searching for validate-code records where prod and dev return different system parameter values:</p>\n<pre><code>grep &#x27;el-observation-code-cs&#x27; comparison.ndjson | wc -l  # 3</code></pre>\n<p>All 3 are currently in deltas. All involve the same custom CodeSystem paired with SNOMED.</p>\n<p>Tolerance ID: multi-coding-cc-system-code-version-disagree<br>\nMatches: POST $validate-code where result=true, both sides have codeableConcept with &gt;1 coding, and system param differs between prod and dev.<br>\nNormalizes system, code, and version params to prod values on both sides.<br>\nEliminates 3 records.</p>\n<ul><li>65fabdc4-930b-49e8-9ff1-60c176cbbfee (SNOMED 19657006 / el-observation-code-cs disorientatedtime)</li><li>db568fd1-e0b1-4188-b29f-4fe9f7b2529b (SNOMED 85828009 / el-observation-code-cs autoimmune)</li><li>2e0dea57-4d5f-4442-99b8-881d1177f561 (SNOMED 26329005 / el-observation-code-cs cognitiveStatusNotNormal)</li></ul>", "impact": 3}, {"id": "3b1d8dc", "title": "Prod returns duplicate entries in searchset Bundle for same resource URL", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:38", "date_iso": "2026-02-08T13:38:00-06:00", "body_md": "Records-Impacted: 3\nTolerance-ID: searchset-duplicate-entries\nRecord-ID: 71e7b8c5-f8da-4323-b233-575727a2f583\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/ValueSet?_format=json&url=http%3A%2F%2Fcts.nlm.nih.gov%2Ffhir%2FValueSet%2F2.16.840.1.113762.1.4.1021.103' \\\n-H 'Accept: application/fhir+json'\n\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet?_format=json&url=http%3A%2F%2Fcts.nlm.nih.gov%2Ffhir%2FValueSet%2F2.16.840.1.113762.1.4.1021.103' \\\n-H 'Accept: application/fhir+json'\n\ncurl -s 'https://tx.fhir.org/r4/CodeSystem?_format=json&url=https%3A%2F%2Fnahdo.org%2Fsopt&version=9.2' \\\n-H 'Accept: application/fhir+json'\n\ncurl -s 'https://tx-dev.fhir.org/r4/CodeSystem?_format=json&url=https%3A%2F%2Fnahdo.org%2Fsopt&version=9.2' \\\n-H 'Accept: application/fhir+json'\n```\n\nProd returns `total: 2` with duplicate entries for both the ValueSet and CodeSystem searches. Dev returns `total: 1` with a single entry in each case. For the ValueSet, the two prod entries have different `meta.lastUpdated` timestamps (2024-04-29 vs 2025-10-22). For the CodeSystem, the two prod entries are identical copies. Tested 2026-02-07.\n\n\nWhen searching for ValueSet or CodeSystem resources by URL (e.g., `GET /r4/ValueSet?url=...`), prod returns Bundle with `total: 2` and two entries, while dev returns `total: 1` with one entry.\n\nIn record 71e7b8c5, prod returns two versions of ValueSet 2.16.840.1.113762.1.4.1021.103 with different `meta.lastUpdated` (2024-04-29 vs 2025-10-22), different `purpose` text, different `resource-lastReviewDate` extension values, and different expansion timestamps/identifiers. Dev returns only the first version.\n\nIn record c8adc8ae, prod returns two identical copies of CodeSystem `https://nahdo.org/sopt` version 9.2 (searched via `GET /r4/CodeSystem?url=https://nahdo.org/sopt&version=9.2`).\n\n\n3 records in comparison.ndjson show `prod total > 1` in search Bundle responses out of 503 total resource search operations:\n- 71e7b8c5: `/r4/ValueSet?url=http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1021.103`\n- c8adc8ae: `/r4/CodeSystem?url=https://nahdo.org/sopt&version=9.2`\n- b9db7af5: `/r4/ValueSet?url=http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1021.103` (same URL, different request)\n\nThe pattern is: `GET /r4/{ValueSet|CodeSystem}?url=...` where prod has loaded multiple copies/versions of the same resource.\n\n\nTolerance `searchset-duplicate-entries` matches searchset Bundles where prod returns more entries than dev. It normalizes by keeping only the first entry from prod (matching dev's single entry) and setting both totals to the minimum. Affects 3 records.", "body_html": "<p>Records-Impacted: 3<br>\nTolerance-ID: searchset-duplicate-entries<br>\nRecord-ID: 71e7b8c5-f8da-4323-b233-575727a2f583</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/ValueSet?_format=json&amp;url=http%3A%2F%2Fcts.nlm.nih.gov%2Ffhir%2FValueSet%2F2.16.840.1.113762.1.4.1021.103&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet?_format=json&amp;url=http%3A%2F%2Fcts.nlm.nih.gov%2Ffhir%2FValueSet%2F2.16.840.1.113762.1.4.1021.103&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27;\n\ncurl -s &#x27;https://tx.fhir.org/r4/CodeSystem?_format=json&amp;url=https%3A%2F%2Fnahdo.org%2Fsopt&amp;version=9.2&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/CodeSystem?_format=json&amp;url=https%3A%2F%2Fnahdo.org%2Fsopt&amp;version=9.2&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27;</code></pre>\n<p>Prod returns <code>total: 2</code> with duplicate entries for both the ValueSet and CodeSystem searches. Dev returns <code>total: 1</code> with a single entry in each case. For the ValueSet, the two prod entries have different <code>meta.lastUpdated</code> timestamps (2024-04-29 vs 2025-10-22). For the CodeSystem, the two prod entries are identical copies. Tested 2026-02-07.</p>\n<p>When searching for ValueSet or CodeSystem resources by URL (e.g., <code>GET /r4/ValueSet?url=...</code>), prod returns Bundle with <code>total: 2</code> and two entries, while dev returns <code>total: 1</code> with one entry.</p>\n<p>In record 71e7b8c5, prod returns two versions of ValueSet 2.16.840.1.113762.1.4.1021.103 with different <code>meta.lastUpdated</code> (2024-04-29 vs 2025-10-22), different <code>purpose</code> text, different <code>resource-lastReviewDate</code> extension values, and different expansion timestamps/identifiers. Dev returns only the first version.</p>\n<p>In record c8adc8ae, prod returns two identical copies of CodeSystem <code>https://nahdo.org/sopt</code> version 9.2 (searched via <code>GET /r4/CodeSystem?url=https://nahdo.org/sopt&amp;version=9.2</code>).</p>\n<p>3 records in comparison.ndjson show <code>prod total &gt; 1</code> in search Bundle responses out of 503 total resource search operations:</p>\n<ul><li>71e7b8c5: <code>/r4/ValueSet?url=http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1021.103</code></li><li>c8adc8ae: <code>/r4/CodeSystem?url=https://nahdo.org/sopt&amp;version=9.2</code></li><li>b9db7af5: <code>/r4/ValueSet?url=http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1021.103</code> (same URL, different request)</li></ul>\n<p>The pattern is: <code>GET /r4/{ValueSet|CodeSystem}?url=...</code> where prod has loaded multiple copies/versions of the same resource.</p>\n<p>Tolerance <code>searchset-duplicate-entries</code> matches searchset Bundles where prod returns more entries than dev. It normalizes by keeping only the first entry from prod (matching dev&#x27;s single entry) and setting both totals to the minimum. Affects 3 records.</p>", "impact": 3}, {"id": "fdc587a", "title": "validate-code: dev returns result=false for ISO 3166 user-assigned code AA that prod considers valid", "status": "open", "labels": ["not-reproduced", "result-disagrees", "round:2026-02-round-2", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 18:47", "date_iso": "2026-02-08T18:47:30-06:00", "body_md": "Records-Impacted: 3\nTolerance-ID: validate-code-iso3166-AA-result-disagrees\nRecord-ID: 5a8b1eb2-7256-40a1-b0d4-9ba62b35f8e2\n\n## Repro\n\n```bash\n# Prod: returns result=true, display=\"User-assigned\"\ncurl -s -H \"Accept: application/fhir+json\" \\\n  \"https://tx.fhir.org/r4/CodeSystem/\\$validate-code?url=urn:iso:std:iso:3166&code=AA\"\n\n# Dev: returns result=false, \"Unknown code 'AA'\"\ncurl -s -H \"Accept: application/fhir+json\" \\\n  \"https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code?url=urn:iso:std:iso:3166&code=AA\"\n```\n\n**Prod response** (result=true):\n```json\n{\n  \"resourceType\": \"Parameters\",\n  \"parameter\": [\n    {\"name\": \"result\", \"valueBoolean\": true},\n    {\"name\": \"system\", \"valueUri\": \"urn:iso:std:iso:3166\"},\n    {\"name\": \"code\", \"valueCode\": \"AA\"},\n    {\"name\": \"version\", \"valueString\": \"2018\"},\n    {\"name\": \"display\", \"valueString\": \"User-assigned\"}\n  ]\n}\n```\n\n**Dev response** (result=false):\n```json\n{\n  \"resourceType\": \"Parameters\",\n  \"parameter\": [\n    {\"name\": \"result\", \"valueBoolean\": false},\n    {\"name\": \"system\", \"valueUri\": \"urn:iso:std:iso:3166\"},\n    {\"name\": \"code\", \"valueCode\": \"AA\"},\n    {\"name\": \"message\", \"valueString\": \"Unknown code 'AA' in the CodeSystem 'urn:iso:std:iso:3166' version '2018'\"}\n  ]\n}\n```\n\nReproduced 2026-02-07. Prod considers ISO 3166 user-assigned code \"AA\" valid; dev does not recognize it.\n\n## What differs\n\nWhen CodeSystem/$validate-code is called with `url=urn:iso:std:iso:3166&code=AA`:\n\n- **Prod (200, result=true)**: Validates successfully. Returns `result: true`, `version: 2018`, `display: \"User-assigned\"`. Code \"AA\" is recognized as a valid user-assignable code in ISO 3166.\n- **Dev (200, result=false)**: Returns `result: false` with error message \"Unknown code 'AA' in the CodeSystem 'urn:iso:std:iso:3166' version '2018'\". Dev does not recognize \"AA\" as a valid code.\n\nThis is a `result-disagrees` — the core validation result differs. Prod says the code is valid; dev says it's unknown.\n\n\"AA\" is a user-assigned code in ISO 3166. The ISO 3166 standard reserves certain codes (AA, QM-QZ, XA-XZ, ZZ) for user-defined purposes. Prod includes these in its code system data; dev does not.\n\n## How widespread\n\n3 records in the deltas show this exact pattern — all are CodeSystem/$validate-code for `urn:iso:std:iso:3166` with code \"AA\", all with prod=true/dev=false.\n\nSearch: `grep 'result-disagrees' deltas.ndjson | grep 'urn:iso:std:iso:3166' | wc -l` → 3\n\n## What the tolerance covers\n\nTolerance `validate-code-iso3166-AA-result-disagrees` matches validate-code requests on `urn:iso:std:iso:3166` where the result disagrees. Skips these records. Eliminates 3 records.\n\n## Repro\n\n```\nGET /r4/CodeSystem/$validate-code?url=urn:iso:std:iso:3166&code=AA\n```", "body_html": "<p>Records-Impacted: 3<br>\nTolerance-ID: validate-code-iso3166-AA-result-disagrees<br>\nRecord-ID: 5a8b1eb2-7256-40a1-b0d4-9ba62b35f8e2</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod: returns result=true, display=&quot;User-assigned&quot;\ncurl -s -H &quot;Accept: application/fhir+json&quot; \\\n  &quot;https://tx.fhir.org/r4/CodeSystem/\\$validate-code?url=urn:iso:std:iso:3166&amp;code=AA&quot;\n\n# Dev: returns result=false, &quot;Unknown code &#x27;AA&#x27;&quot;\ncurl -s -H &quot;Accept: application/fhir+json&quot; \\\n  &quot;https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code?url=urn:iso:std:iso:3166&amp;code=AA&quot;</code></pre>\n<p><strong>Prod response</strong> (result=true):</p>\n<pre><code class=\"lang-json\">{\n  &quot;resourceType&quot;: &quot;Parameters&quot;,\n  &quot;parameter&quot;: [\n    {&quot;name&quot;: &quot;result&quot;, &quot;valueBoolean&quot;: true},\n    {&quot;name&quot;: &quot;system&quot;, &quot;valueUri&quot;: &quot;urn:iso:std:iso:3166&quot;},\n    {&quot;name&quot;: &quot;code&quot;, &quot;valueCode&quot;: &quot;AA&quot;},\n    {&quot;name&quot;: &quot;version&quot;, &quot;valueString&quot;: &quot;2018&quot;},\n    {&quot;name&quot;: &quot;display&quot;, &quot;valueString&quot;: &quot;User-assigned&quot;}\n  ]\n}</code></pre>\n<p><strong>Dev response</strong> (result=false):</p>\n<pre><code class=\"lang-json\">{\n  &quot;resourceType&quot;: &quot;Parameters&quot;,\n  &quot;parameter&quot;: [\n    {&quot;name&quot;: &quot;result&quot;, &quot;valueBoolean&quot;: false},\n    {&quot;name&quot;: &quot;system&quot;, &quot;valueUri&quot;: &quot;urn:iso:std:iso:3166&quot;},\n    {&quot;name&quot;: &quot;code&quot;, &quot;valueCode&quot;: &quot;AA&quot;},\n    {&quot;name&quot;: &quot;message&quot;, &quot;valueString&quot;: &quot;Unknown code &#x27;AA&#x27; in the CodeSystem &#x27;urn:iso:std:iso:3166&#x27; version &#x27;2018&#x27;&quot;}\n  ]\n}</code></pre>\n<p>Reproduced 2026-02-07. Prod considers ISO 3166 user-assigned code &quot;AA&quot; valid; dev does not recognize it.</p>\n<h2>What differs</h2>\n<p>When CodeSystem/$validate-code is called with <code>url=urn:iso:std:iso:3166&amp;code=AA</code>:</p>\n<ul><li><strong>Prod (200, result=true)</strong>: Validates successfully. Returns <code>result: true</code>, <code>version: 2018</code>, <code>display: &quot;User-assigned&quot;</code>. Code &quot;AA&quot; is recognized as a valid user-assignable code in ISO 3166.</li><li><strong>Dev (200, result=false)</strong>: Returns <code>result: false</code> with error message &quot;Unknown code &#x27;AA&#x27; in the CodeSystem &#x27;urn:iso:std:iso:3166&#x27; version &#x27;2018&#x27;&quot;. Dev does not recognize &quot;AA&quot; as a valid code.</li></ul>\n<p>This is a <code>result-disagrees</code> — the core validation result differs. Prod says the code is valid; dev says it&#x27;s unknown.</p>\n<p>&quot;AA&quot; is a user-assigned code in ISO 3166. The ISO 3166 standard reserves certain codes (AA, QM-QZ, XA-XZ, ZZ) for user-defined purposes. Prod includes these in its code system data; dev does not.</p>\n<h2>How widespread</h2>\n<p>3 records in the deltas show this exact pattern — all are CodeSystem/$validate-code for <code>urn:iso:std:iso:3166</code> with code &quot;AA&quot;, all with prod=true/dev=false.</p>\n<p>Search: <code>grep &#x27;result-disagrees&#x27; deltas.ndjson | grep &#x27;urn:iso:std:iso:3166&#x27; | wc -l</code> → 3</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance <code>validate-code-iso3166-AA-result-disagrees</code> matches validate-code requests on <code>urn:iso:std:iso:3166</code> where the result disagrees. Skips these records. Eliminates 3 records.</p>\n<h2>Repro</h2>\n<pre><code>GET /r4/CodeSystem/$validate-code?url=urn:iso:std:iso:3166&amp;code=AA</code></pre>", "impact": 3}, {"id": "15f5ce0", "title": "GET /r5/CodeSystem/$subsumes returns 400 despite valid system parameter", "status": "open", "labels": ["reproduced", "round:2026-02-round-2", "status-mismatch", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 10:52", "date_iso": "2026-02-08T10:52:55-06:00", "body_md": "Records-Impacted: 2\nTolerance-ID: r5-get-subsumes-status-mismatch\nRecord-ID: 065c2fa7-d80e-416a-b50d-ed4f78a48fd7\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r5/CodeSystem/$subsumes?system=http://snomed.info/sct&codeA=40127002&codeB=159033005' \\\n  -H 'Accept: application/fhir+json'\n\ncurl -s 'https://tx-dev.fhir.org/r5/CodeSystem/$subsumes?system=http://snomed.info/sct&codeA=40127002&codeB=159033005' \\\n  -H 'Accept: application/fhir+json'\n```\n\nProd returns HTTP 400 with OperationOutcome: \"No CodeSystem Identified (need a system parameter, or execute the operation on a CodeSystem resource)\". Dev returns HTTP 200 with Parameters containing `{\"name\":\"outcome\",\"valueCode\":\"subsumed-by\"}`.\n\n\nGET requests to `/r5/CodeSystem/$subsumes` with `system`, `codeA`, and `codeB` query parameters return HTTP 400 from prod with an OperationOutcome error: \"No CodeSystem Identified (need a system parameter, or execute the operation on a CodeSystem resource)\". Dev returns HTTP 200 with a valid Parameters response containing the subsumption outcome.\n\nThe `system` parameter is clearly present in the URL (e.g., `system=http://snomed.info/sct`), so prod appears to fail to recognize it. POST requests to the same R5 $subsumes endpoint succeed on both prod and dev.\n\n\n2 records in the current comparison dataset, both GET requests to `/r5/CodeSystem/$subsumes` with SNOMED system:\n\n- `065c2fa7-d80e-416a-b50d-ed4f78a48fd7`: codeA=40127002, codeB=159033005 (dev: subsumed-by)\n- `d48aa838-d4f2-492a-aedb-5562103b1ae3`: codeA=159033005, codeB=309414002\n\nFound via: `grep '/r5/CodeSystem/\\$subsumes' comparison.ndjson` — 3 total records, of which 2 are GET (both failing) and 1 is POST (succeeding).\n\nNo R4 $subsumes records exist in the dataset for comparison.\n\n\nTolerance ID `r5-get-subsumes-status-mismatch` skips GET requests to `/r5/CodeSystem/$subsumes` where prod=400 and dev=200. Eliminates 2 records.", "body_html": "<p>Records-Impacted: 2<br>\nTolerance-ID: r5-get-subsumes-status-mismatch<br>\nRecord-ID: 065c2fa7-d80e-416a-b50d-ed4f78a48fd7</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r5/CodeSystem/$subsumes?system=http://snomed.info/sct&amp;codeA=40127002&amp;codeB=159033005&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r5/CodeSystem/$subsumes?system=http://snomed.info/sct&amp;codeA=40127002&amp;codeB=159033005&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;</code></pre>\n<p>Prod returns HTTP 400 with OperationOutcome: &quot;No CodeSystem Identified (need a system parameter, or execute the operation on a CodeSystem resource)&quot;. Dev returns HTTP 200 with Parameters containing <code>{&quot;name&quot;:&quot;outcome&quot;,&quot;valueCode&quot;:&quot;subsumed-by&quot;}</code>.</p>\n<p>GET requests to <code>/r5/CodeSystem/$subsumes</code> with <code>system</code>, <code>codeA</code>, and <code>codeB</code> query parameters return HTTP 400 from prod with an OperationOutcome error: &quot;No CodeSystem Identified (need a system parameter, or execute the operation on a CodeSystem resource)&quot;. Dev returns HTTP 200 with a valid Parameters response containing the subsumption outcome.</p>\n<p>The <code>system</code> parameter is clearly present in the URL (e.g., <code>system=http://snomed.info/sct</code>), so prod appears to fail to recognize it. POST requests to the same R5 $subsumes endpoint succeed on both prod and dev.</p>\n<p>2 records in the current comparison dataset, both GET requests to <code>/r5/CodeSystem/$subsumes</code> with SNOMED system:</p>\n<ul><li><code>065c2fa7-d80e-416a-b50d-ed4f78a48fd7</code>: codeA=40127002, codeB=159033005 (dev: subsumed-by)</li><li><code>d48aa838-d4f2-492a-aedb-5562103b1ae3</code>: codeA=159033005, codeB=309414002</li></ul>\n<p>Found via: <code>grep &#x27;/r5/CodeSystem/\\$subsumes&#x27; comparison.ndjson</code> — 3 total records, of which 2 are GET (both failing) and 1 is POST (succeeding).</p>\n<p>No R4 $subsumes records exist in the dataset for comparison.</p>\n<p>Tolerance ID <code>r5-get-subsumes-status-mismatch</code> skips GET requests to <code>/r5/CodeSystem/$subsumes</code> where prod=400 and dev=200. Eliminates 2 records.</p>", "impact": 2}, {"id": "7069f54", "title": "BCP-47 case-sensitive validation: dev accepts 'en-us' (lowercase), prod correctly rejects it", "status": "open", "labels": ["reproduced", "result-disagrees", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:37", "date_iso": "2026-02-08T13:37:59-06:00", "body_md": "Records-Impacted: 2\nTolerance-ID: bcp47-case-sensitive-validation\nRecord-ID: ba44d44e-929e-4b34-8d18-39ead53a68b6\n\n\n```bash\ncurl -s \"https://tx.fhir.org/r4/CodeSystem/\\$validate-code\" \\\n-H \"Accept: application/fhir+json\" \\\n-H \"Content-Type: application/fhir+json\" \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"urn:ietf:bcp:47\"},{\"name\":\"code\",\"valueCode\":\"en-us\"},{\"name\":\"display\",\"valueString\":\"English (Region=United States)\"}]}'\n\ncurl -s \"https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code\" \\\n-H \"Accept: application/fhir+json\" \\\n-H \"Content-Type: application/fhir+json\" \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"urn:ietf:bcp:47\"},{\"name\":\"code\",\"valueCode\":\"en-us\"},{\"name\":\"display\",\"valueString\":\"English (Region=United States)\"}]}'\n```\n\nProd returns `result: false` with error \"Unknown code 'en-us' in the CodeSystem 'urn:ietf:bcp:47'\", dev returns `result: true` with display \"English (Region=United States)\".\n\n\nDev returns result=true for BCP-47 code \"en-us\" with display \"English (Region=United States)\". Prod returns result=false with error \"Unknown code 'en-us' in the CodeSystem 'urn:ietf:bcp:47'\" and informational issue \"Unable to recognise part 2 (\\\"us\\\") as a valid language part\".\n\nThe correct BCP-47 regional variant format is \"en-US\" (uppercase region code). BCP-47 is case-sensitive in FHIR (the code system has caseSensitive=true by default per the 2022 FHIR update). Prod correctly rejects the lowercase variant; dev incorrectly accepts it.\n\n\n2 records in deltas, both for code \"en-us\" in system urn:ietf:bcp:47:\n- ba44d44e-929e-4b34-8d18-39ead53a68b6: POST /r4/CodeSystem/$validate-code\n- 175c5449-c70c-4c69-9e2e-4f728d035c1f: POST /r4/ValueSet/$validate-code\n\nSearch: grep 'en-us' jobs/2026-02-round-1/results/deltas/deltas.ndjson (2 matches, both result-disagrees with prodResult=false, devResult=true)\n\nBoth records show the same root cause: dev's BCP-47 code lookup is case-insensitive when it should be case-sensitive.\n\n\nTolerance ID: bcp47-case-sensitive-validation\nMatches: result-disagrees records where system is urn:ietf:bcp:47 and prodResult=false, devResult=true.\nEliminates 2 records.", "body_html": "<p>Records-Impacted: 2<br>\nTolerance-ID: bcp47-case-sensitive-validation<br>\nRecord-ID: ba44d44e-929e-4b34-8d18-39ead53a68b6</p>\n<pre><code class=\"lang-bash\">curl -s &quot;https://tx.fhir.org/r4/CodeSystem/\\$validate-code&quot; \\\n-H &quot;Accept: application/fhir+json&quot; \\\n-H &quot;Content-Type: application/fhir+json&quot; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;urn:ietf:bcp:47&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;en-us&quot;},{&quot;name&quot;:&quot;display&quot;,&quot;valueString&quot;:&quot;English (Region=United States)&quot;}]}&#x27;\n\ncurl -s &quot;https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code&quot; \\\n-H &quot;Accept: application/fhir+json&quot; \\\n-H &quot;Content-Type: application/fhir+json&quot; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;urn:ietf:bcp:47&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;en-us&quot;},{&quot;name&quot;:&quot;display&quot;,&quot;valueString&quot;:&quot;English (Region=United States)&quot;}]}&#x27;</code></pre>\n<p>Prod returns <code>result: false</code> with error &quot;Unknown code &#x27;en-us&#x27; in the CodeSystem &#x27;urn:ietf:bcp:47&#x27;&quot;, dev returns <code>result: true</code> with display &quot;English (Region=United States)&quot;.</p>\n<p>Dev returns result=true for BCP-47 code &quot;en-us&quot; with display &quot;English (Region=United States)&quot;. Prod returns result=false with error &quot;Unknown code &#x27;en-us&#x27; in the CodeSystem &#x27;urn:ietf:bcp:47&#x27;&quot; and informational issue &quot;Unable to recognise part 2 (\\&quot;us\\&quot;) as a valid language part&quot;.</p>\n<p>The correct BCP-47 regional variant format is &quot;en-US&quot; (uppercase region code). BCP-47 is case-sensitive in FHIR (the code system has caseSensitive=true by default per the 2022 FHIR update). Prod correctly rejects the lowercase variant; dev incorrectly accepts it.</p>\n<p>2 records in deltas, both for code &quot;en-us&quot; in system urn:ietf:bcp:47:</p>\n<ul><li>ba44d44e-929e-4b34-8d18-39ead53a68b6: POST /r4/CodeSystem/$validate-code</li><li>175c5449-c70c-4c69-9e2e-4f728d035c1f: POST /r4/ValueSet/$validate-code</li></ul>\n<p>Search: grep &#x27;en-us&#x27; jobs/2026-02-round-1/results/deltas/deltas.ndjson (2 matches, both result-disagrees with prodResult=false, devResult=true)</p>\n<p>Both records show the same root cause: dev&#x27;s BCP-47 code lookup is case-insensitive when it should be case-sensitive.</p>\n<p>Tolerance ID: bcp47-case-sensitive-validation<br>\nMatches: result-disagrees records where system is urn:ietf:bcp:47 and prodResult=false, devResult=true.<br>\nEliminates 2 records.</p>", "impact": 2}, {"id": "399b413", "title": "SNOMED expression parse error message differs: wording and character offset", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:37", "date_iso": "2026-02-08T13:37:59-06:00", "body_md": "Records-Impacted: 2\nTolerance-ID: snomed-expression-parse-message-diff\nRecord-ID: 2a323fee-2b5e-4c5f-ad4d-d623797b7f6f\n\n\n```bash\ncurl -s \"https://tx.fhir.org/r4/CodeSystem/\\$validate-code\" \\\n-H \"Accept: application/fhir+json\" \\\n-H \"Content-Type: application/fhir+json\" \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://snomed.info/sct\"},{\"name\":\"code\",\"valueCode\":\"freetext\"}]}'\n\ncurl -s \"https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code\" \\\n-H \"Accept: application/fhir+json\" \\\n-H \"Content-Type: application/fhir+json\" \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://snomed.info/sct\"},{\"name\":\"code\",\"valueCode\":\"freetext\"}]}'\n```\n\nProd returns `\"...and neither could it be parsed as an expression (Concept not found (next char = \"f\", in \"freetext\") at character 1)\"`, dev returns `\"...and could not be parsed as an expression (Concept not found (next char = \"f\", in \"freetext\") at character 0)\"`.\n\n\nWhen validating an invalid SNOMED CT code (e.g. \"freetext\"), both prod and dev return an informational issue with a SNOMED expression parse error. The message text differs in two ways:\n\n- **Wording**: prod says \"and neither could it be parsed as an expression\", dev says \"and could not be parsed as an expression\"\n- **Character offset**: prod reports \"at character 1\", dev reports \"at character 0\"\n\nProd: `Code freetext is not a valid SNOMED CT Term, and neither could it be parsed as an expression (Concept not found (next char = \"f\", in \"freetext\") at character 1)`\nDev:  `Code freetext is not a valid SNOMED CT Term, and could not be parsed as an expression (Concept not found (next char = \"f\", in \"freetext\") at character 0)`\n\nAll other aspects of the response match (result=false, system, code, error issues, etc.).\n\n\n2 records in the delta file, both for SNOMED code \"freetext\":\n- 2a323fee: POST /r4/ValueSet/$batch-validate-code (batch-validate-code op)\n- 1160ac1d: POST /r4/CodeSystem/$validate-code (validate-code op)\n\nSearch: `grep -c 'neither could it be parsed' deltas.ndjson` → 2\n\nThe pattern is specific to invalid SNOMED codes that trigger the expression parser fallback. Only \"freetext\" triggers it in this dataset.\n\n\nTolerance ID: snomed-expression-parse-message-diff\nMatches: OperationOutcome issues where prod text contains \"neither could it be parsed as an expression\" and dev text contains \"could not be parsed as an expression\" for the same issue. Normalizes dev text to prod text.\nEliminates: 2 records.", "body_html": "<p>Records-Impacted: 2<br>\nTolerance-ID: snomed-expression-parse-message-diff<br>\nRecord-ID: 2a323fee-2b5e-4c5f-ad4d-d623797b7f6f</p>\n<pre><code class=\"lang-bash\">curl -s &quot;https://tx.fhir.org/r4/CodeSystem/\\$validate-code&quot; \\\n-H &quot;Accept: application/fhir+json&quot; \\\n-H &quot;Content-Type: application/fhir+json&quot; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://snomed.info/sct&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;freetext&quot;}]}&#x27;\n\ncurl -s &quot;https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code&quot; \\\n-H &quot;Accept: application/fhir+json&quot; \\\n-H &quot;Content-Type: application/fhir+json&quot; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://snomed.info/sct&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;freetext&quot;}]}&#x27;</code></pre>\n<p>Prod returns <code>&quot;...and neither could it be parsed as an expression (Concept not found (next char = &quot;f&quot;, in &quot;freetext&quot;) at character 1)&quot;</code>, dev returns <code>&quot;...and could not be parsed as an expression (Concept not found (next char = &quot;f&quot;, in &quot;freetext&quot;) at character 0)&quot;</code>.</p>\n<p>When validating an invalid SNOMED CT code (e.g. &quot;freetext&quot;), both prod and dev return an informational issue with a SNOMED expression parse error. The message text differs in two ways:</p>\n<ul><li><strong>Wording</strong>: prod says &quot;and neither could it be parsed as an expression&quot;, dev says &quot;and could not be parsed as an expression&quot;</li><li><strong>Character offset</strong>: prod reports &quot;at character 1&quot;, dev reports &quot;at character 0&quot;</li></ul>\n<p>Prod: <code>Code freetext is not a valid SNOMED CT Term, and neither could it be parsed as an expression (Concept not found (next char = &quot;f&quot;, in &quot;freetext&quot;) at character 1)</code><br>\nDev:  <code>Code freetext is not a valid SNOMED CT Term, and could not be parsed as an expression (Concept not found (next char = &quot;f&quot;, in &quot;freetext&quot;) at character 0)</code></p>\n<p>All other aspects of the response match (result=false, system, code, error issues, etc.).</p>\n<p>2 records in the delta file, both for SNOMED code &quot;freetext&quot;:</p>\n<ul><li>2a323fee: POST /r4/ValueSet/$batch-validate-code (batch-validate-code op)</li><li>1160ac1d: POST /r4/CodeSystem/$validate-code (validate-code op)</li></ul>\n<p>Search: <code>grep -c &#x27;neither could it be parsed&#x27; deltas.ndjson</code> → 2</p>\n<p>The pattern is specific to invalid SNOMED codes that trigger the expression parser fallback. Only &quot;freetext&quot; triggers it in this dataset.</p>\n<p>Tolerance ID: snomed-expression-parse-message-diff<br>\nMatches: OperationOutcome issues where prod text contains &quot;neither could it be parsed as an expression&quot; and dev text contains &quot;could not be parsed as an expression&quot; for the same issue. Normalizes dev text to prod text.<br>\nEliminates: 2 records.</p>", "impact": 2}, {"id": "0a23e86", "title": "Dev stringifies undefined code as literal 'undefined' in validate-code error messages", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:38", "date_iso": "2026-02-08T13:38:00-06:00", "body_md": "Records-Impacted: 2\nTolerance-ID: validate-code-undefined-code-message-diff\nRecord-ID: 712fb856-cb1d-47ca-87a5-3b9d82bfc8cd\n\n\n```bash\ncurl -s \"https://tx.fhir.org/r4/ValueSet/\\$validate-code\" \\\n-H \"Accept: application/fhir+json\" \\\n-H \"Content-Type: application/fhir+json\" \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/ValueSet/observation-vitalsignresult\"},{\"name\":\"coding\",\"valueCoding\":{\"system\":\"http://loinc.org\"}}]}'\n\ncurl -s \"https://tx-dev.fhir.org/r4/ValueSet/\\$validate-code\" \\\n-H \"Accept: application/fhir+json\" \\\n-H \"Content-Type: application/fhir+json\" \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/ValueSet/observation-vitalsignresult\"},{\"name\":\"coding\",\"valueCoding\":{\"system\":\"http://loinc.org\"}}]}'\n```\n\nProd returns message with `'http://loinc.org#'` (empty code, correct), plus `version: \"2.81\"`. Dev returns message with `'http://loinc.org#undefined'` (JS undefined coercion), an extra `invalid-code` OperationOutcome issue for \"Unknown code 'undefined'\", and omits the `version` parameter.\n\n\nPOST /r4/ValueSet/$validate-code: when the request contains a coding with no code value, dev treats the absent code as the literal string \"undefined\" (JavaScript undefined-to-string coercion). Both sides agree result=false, but:\n\n- Prod message: \"The provided code 'http://loinc.org#' was not found in the value set...\"\n- Dev message: \"The provided code 'http://loinc.org#undefined' was not found in the value set...\"\n\nDev also returns an extra OperationOutcome issue (invalid-code: \"Unknown code 'undefined' in the CodeSystem 'http://loinc.org' version '2.81'\") that prod does not include, and uses issue type code \"invalid-code\" instead of \"not-in-vs\".\n\nThe version parameter is also absent from dev's response (prod returns version: \"2.81\").\n\n\n2 records in deltas show this pattern (both POST /r4/ValueSet/$validate-code). 16 total records in comparison.ndjson have #undefined in devBody, but 14 are CodeSystem/$validate-code where result disagrees (prod=true, dev=false) — those are already handled by tolerance validate-code-undefined-system-result-disagrees (bug 19283df). The remaining 2 are ValueSet/$validate-code where both agree result=false but the error messages differ.\n\nSearch: `grep '#undefined' results/deltas/deltas.ndjson` → 2 matches\n\n\nTolerance ID: validate-code-undefined-code-message-diff\nMatches POST $validate-code records where both result=false and dev's message contains '#undefined' while prod's message contains '#' (empty code). Skips these records. Eliminates 2 delta records.\n\n\n- 712fb856-cb1d-47ca-87a5-3b9d82bfc8cd\n- ab72ac62-6f86-41fe-89b8-fae8b0701db4\n\nSame root cause as bugs 19283df and 4cdcd85 — dev fails to extract values from POST request bodies, receiving JavaScript undefined.", "body_html": "<p>Records-Impacted: 2<br>\nTolerance-ID: validate-code-undefined-code-message-diff<br>\nRecord-ID: 712fb856-cb1d-47ca-87a5-3b9d82bfc8cd</p>\n<pre><code class=\"lang-bash\">curl -s &quot;https://tx.fhir.org/r4/ValueSet/\\$validate-code&quot; \\\n-H &quot;Accept: application/fhir+json&quot; \\\n-H &quot;Content-Type: application/fhir+json&quot; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/ValueSet/observation-vitalsignresult&quot;},{&quot;name&quot;:&quot;coding&quot;,&quot;valueCoding&quot;:{&quot;system&quot;:&quot;http://loinc.org&quot;}}]}&#x27;\n\ncurl -s &quot;https://tx-dev.fhir.org/r4/ValueSet/\\$validate-code&quot; \\\n-H &quot;Accept: application/fhir+json&quot; \\\n-H &quot;Content-Type: application/fhir+json&quot; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/ValueSet/observation-vitalsignresult&quot;},{&quot;name&quot;:&quot;coding&quot;,&quot;valueCoding&quot;:{&quot;system&quot;:&quot;http://loinc.org&quot;}}]}&#x27;</code></pre>\n<p>Prod returns message with <code>&#x27;http://loinc.org#&#x27;</code> (empty code, correct), plus <code>version: &quot;2.81&quot;</code>. Dev returns message with <code>&#x27;http://loinc.org#undefined&#x27;</code> (JS undefined coercion), an extra <code>invalid-code</code> OperationOutcome issue for &quot;Unknown code &#x27;undefined&#x27;&quot;, and omits the <code>version</code> parameter.</p>\n<p>POST /r4/ValueSet/$validate-code: when the request contains a coding with no code value, dev treats the absent code as the literal string &quot;undefined&quot; (JavaScript undefined-to-string coercion). Both sides agree result=false, but:</p>\n<ul><li>Prod message: &quot;The provided code &#x27;<a href=\"http://loinc.org#&#x27;\" target=\"_blank\">http://loinc.org#&#x27;</a> was not found in the value set...&quot;</li><li>Dev message: &quot;The provided code &#x27;<a href=\"http://loinc.org#undefined&#x27;\" target=\"_blank\">http://loinc.org#undefined&#x27;</a> was not found in the value set...&quot;</li></ul>\n<p>Dev also returns an extra OperationOutcome issue (invalid-code: &quot;Unknown code &#x27;undefined&#x27; in the CodeSystem &#x27;<a href=\"http://loinc.org&#x27;\" target=\"_blank\">http://loinc.org&#x27;</a> version &#x27;2.81&#x27;&quot;) that prod does not include, and uses issue type code &quot;invalid-code&quot; instead of &quot;not-in-vs&quot;.</p>\n<p>The version parameter is also absent from dev&#x27;s response (prod returns version: &quot;2.81&quot;).</p>\n<p>2 records in deltas show this pattern (both POST /r4/ValueSet/$validate-code). 16 total records in comparison.ndjson have #undefined in devBody, but 14 are CodeSystem/$validate-code where result disagrees (prod=true, dev=false) — those are already handled by tolerance validate-code-undefined-system-result-disagrees (bug 19283df). The remaining 2 are ValueSet/$validate-code where both agree result=false but the error messages differ.</p>\n<p>Search: <code>grep &#x27;#undefined&#x27; results/deltas/deltas.ndjson</code> → 2 matches</p>\n<p>Tolerance ID: validate-code-undefined-code-message-diff<br>\nMatches POST $validate-code records where both result=false and dev&#x27;s message contains &#x27;#undefined&#x27; while prod&#x27;s message contains &#x27;#&#x27; (empty code). Skips these records. Eliminates 2 delta records.</p>\n<ul><li>712fb856-cb1d-47ca-87a5-3b9d82bfc8cd</li><li>ab72ac62-6f86-41fe-89b8-fae8b0701db4</li></ul>\n<p>Same root cause as bugs 19283df and 4cdcd85 — dev fails to extract values from POST request bodies, receiving JavaScript undefined.</p>", "impact": 2}, {"id": "1e5268a", "title": "validate-code: dev renders empty status in INACTIVE_DISPLAY_FOUND message where prod shows 'inactive'", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-2", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 10:52", "date_iso": "2026-02-08T10:52:55-06:00", "body_md": "Records-Impacted: 1\nTolerance-ID: inactive-display-empty-status-in-message\nRecord-ID: f5fcec17-986f-4f27-994d-d49aeca30d13\n\n## Repro\n\n**Reproduced 2026-02-07** against live servers.\n\n```bash\n# POST to both servers:\ncurl -s -X POST \"https://tx.fhir.org/r4/CodeSystem/\\$validate-code\" \\\n  -H \"Accept: application/fhir+json\" \\\n  -H \"Content-Type: application/fhir+json\" \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"system\",\"valueUri\":\"http://snomed.info/sct\"},{\"name\":\"code\",\"valueCode\":\"26643006\"},{\"name\":\"display\",\"valueString\":\"oral\"},{\"name\":\"displayLanguage\",\"valueCode\":\"en-US\"},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true}]}'\n\ncurl -s -X POST \"https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code\" \\\n  -H \"Accept: application/fhir+json\" \\\n  -H \"Content-Type: application/fhir+json\" \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"system\",\"valueUri\":\"http://snomed.info/sct\"},{\"name\":\"code\",\"valueCode\":\"26643006\"},{\"name\":\"display\",\"valueString\":\"oral\"},{\"name\":\"displayLanguage\",\"valueCode\":\"en-US\"},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true}]}'\n```\n\n**Prod** returns message text:\n> 'oral' is no longer considered a correct display for code '26643006' (status = inactive). The correct display is one of \"Oral route\"\n\n**Dev** returns message text:\n> 'oral' is no longer considered a correct display for code '26643006' (status = ). The correct display is one of Oral route,Per os,Oral route (qualifier value),Oral use,Per oral route,PO - Per os,By mouth\n\nThe empty `(status = )` on dev vs `(status = inactive)` on prod confirms the bug. The concept is inactive, so prod is correct.\n\n## What differs\n\nIn $validate-code responses for SNOMED codes with an inactive display, the INACTIVE_DISPLAY_FOUND `display-comment` issue text differs in the status rendering:\n\n- Prod: `'oral' is no longer considered a correct display for code '26643006' (status = inactive). The correct display is one of \"Oral route\"`\n- Dev: `'oral' is no longer considered a correct display for code '26643006' (status = ). The correct display is one of Oral route,Per os,...`\n\nDev renders the status as empty `(status = )` where prod renders `(status = inactive)`. The concept (SNOMED 26643006 \"Oral route\") is indeed inactive, so prod's rendering is correct.\n\nA secondary difference (dev listing all designations vs prod listing only the preferred term) is already adjudicated as equiv-autofix (GG adjudicated, tolerance `inactive-display-message-extra-synonyms`), but that tolerance cannot fire here because the prefix text differs due to the empty status.\n\n## How widespread\n\n1 record in the current delta file: POST /r4/CodeSystem/$validate-code for SNOMED code 26643006 with display \"oral\".\n\nSearch: `grep '(status = )' comparison.ndjson | wc -l` → 1\n\nThis is related to but distinct from bug af1ce69 (dev renders \"null\" in INACTIVE_CONCEPT_FOUND messages). Both are about dev mishandling status values in message templates, but the message IDs and rendering failures differ: af1ce69 has \"null\" appearing, this has an empty string where \"inactive\" should be.\n\n## What the tolerance covers\n\nTolerance ID: inactive-display-empty-status-in-message\nMatches: validate-code Parameters responses with display-comment issues where the INACTIVE_DISPLAY_FOUND message text differs only in the `(status = ...)` portion between prod and dev. Normalizes dev's empty status to match prod's status value. Combined with the existing `inactive-display-message-extra-synonyms` tolerance, this eliminates the record. Eliminates 1 delta record.", "body_html": "<p>Records-Impacted: 1<br>\nTolerance-ID: inactive-display-empty-status-in-message<br>\nRecord-ID: f5fcec17-986f-4f27-994d-d49aeca30d13</p>\n<h2>Repro</h2>\n<p><strong>Reproduced 2026-02-07</strong> against live servers.</p>\n<pre><code class=\"lang-bash\"># POST to both servers:\ncurl -s -X POST &quot;https://tx.fhir.org/r4/CodeSystem/\\$validate-code&quot; \\\n  -H &quot;Accept: application/fhir+json&quot; \\\n  -H &quot;Content-Type: application/fhir+json&quot; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;system&quot;,&quot;valueUri&quot;:&quot;http://snomed.info/sct&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;26643006&quot;},{&quot;name&quot;:&quot;display&quot;,&quot;valueString&quot;:&quot;oral&quot;},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueCode&quot;:&quot;en-US&quot;},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true}]}&#x27;\n\ncurl -s -X POST &quot;https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code&quot; \\\n  -H &quot;Accept: application/fhir+json&quot; \\\n  -H &quot;Content-Type: application/fhir+json&quot; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;system&quot;,&quot;valueUri&quot;:&quot;http://snomed.info/sct&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;26643006&quot;},{&quot;name&quot;:&quot;display&quot;,&quot;valueString&quot;:&quot;oral&quot;},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueCode&quot;:&quot;en-US&quot;},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true}]}&#x27;</code></pre>\n<p><strong>Prod</strong> returns message text:<br>\n&gt; &#x27;oral&#x27; is no longer considered a correct display for code &#x27;26643006&#x27; (status = inactive). The correct display is one of &quot;Oral route&quot;</p>\n<p><strong>Dev</strong> returns message text:<br>\n&gt; &#x27;oral&#x27; is no longer considered a correct display for code &#x27;26643006&#x27; (status = ). The correct display is one of Oral route,Per os,Oral route (qualifier value),Oral use,Per oral route,PO - Per os,By mouth</p>\n<p>The empty <code>(status = )</code> on dev vs <code>(status = inactive)</code> on prod confirms the bug. The concept is inactive, so prod is correct.</p>\n<h2>What differs</h2>\n<p>In $validate-code responses for SNOMED codes with an inactive display, the INACTIVE_DISPLAY_FOUND <code>display-comment</code> issue text differs in the status rendering:</p>\n<ul><li>Prod: <code>&#x27;oral&#x27; is no longer considered a correct display for code &#x27;26643006&#x27; (status = inactive). The correct display is one of &quot;Oral route&quot;</code></li><li>Dev: <code>&#x27;oral&#x27; is no longer considered a correct display for code &#x27;26643006&#x27; (status = ). The correct display is one of Oral route,Per os,...</code></li></ul>\n<p>Dev renders the status as empty <code>(status = )</code> where prod renders <code>(status = inactive)</code>. The concept (SNOMED 26643006 &quot;Oral route&quot;) is indeed inactive, so prod&#x27;s rendering is correct.</p>\n<p>A secondary difference (dev listing all designations vs prod listing only the preferred term) is already adjudicated as equiv-autofix (GG adjudicated, tolerance <code>inactive-display-message-extra-synonyms</code>), but that tolerance cannot fire here because the prefix text differs due to the empty status.</p>\n<h2>How widespread</h2>\n<p>1 record in the current delta file: POST /r4/CodeSystem/$validate-code for SNOMED code 26643006 with display &quot;oral&quot;.</p>\n<p>Search: <code>grep &#x27;(status = )&#x27; comparison.ndjson | wc -l</code> → 1</p>\n<p>This is related to but distinct from bug af1ce69 (dev renders &quot;null&quot; in INACTIVE_CONCEPT_FOUND messages). Both are about dev mishandling status values in message templates, but the message IDs and rendering failures differ: af1ce69 has &quot;null&quot; appearing, this has an empty string where &quot;inactive&quot; should be.</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance ID: inactive-display-empty-status-in-message<br>\nMatches: validate-code Parameters responses with display-comment issues where the INACTIVE_DISPLAY_FOUND message text differs only in the <code>(status = ...)</code> portion between prod and dev. Normalizes dev&#x27;s empty status to match prod&#x27;s status value. Combined with the existing <code>inactive-display-message-extra-synonyms</code> tolerance, this eliminates the record. Eliminates 1 delta record.</p>", "impact": 1}, {"id": "44136eb", "title": "Dev returns expansion codes when prod marks expansion as too-costly (both HTTP 200)", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-2", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 10:52", "date_iso": "2026-02-08T10:52:56-06:00", "body_md": "Records-Impacted: 1\nTolerance-ID: expand-toocostly-dev-returns-codes\nRecord-ID: 227d1960-bfbd-4ca4-9c10-c5614d0e62d5\n\n## Repro\n\n```bash\n# Save the request body from the record (1.2MB, includes inline CodeSystem resources)\n# Extract from: jobs/2026-02-round-2/issues/227d1960-bfbd-4ca4-9c10-c5614d0e62d5/record.json\n# python3 -c \"import json; r=json.load(open('record.json')); open('/tmp/body.json','w').write(r['requestBody'])\"\n\n# Prod\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$expand' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d @/tmp/body.json | python3 -c \"import sys,json; d=json.load(sys.stdin); e=d.get('expansion',{}); print('total:', e.get('total'), 'contains:', len(e.get('contains',[])), 'toocostly:', any(x.get('url','').endswith('valueset-toocostly') for x in e.get('extension',[])))\"\n\n# Dev\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$expand' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d @/tmp/body.json | python3 -c \"import sys,json; d=json.load(sys.stdin); e=d.get('expansion',{}); print('total:', e.get('total'), 'contains:', len(e.get('contains',[])), 'toocostly:', any(x.get('url','').endswith('valueset-toocostly') for x in e.get('extension',[])))\"\n```\n\nProd returns `total: 0, contains: 0, toocostly: True`. Dev returns `total: None, contains: 1000, toocostly: False`.\n\n## What differs\n\nFor $expand of ValueSets that include large code systems, prod returns HTTP 200 with an empty expansion (0 codes in `contains`) and marks it with `valueset-toocostly: true` extension and `limitedExpansion: true` parameter. Dev returns HTTP 200 with 1000 codes in `expansion.contains` — it proceeds with the expansion that prod considers too costly.\n\nAfter existing normalizations strip the toocostly extension difference (tolerance `expand-toocostly-extension-and-used-codesystem`), the remaining difference is: prod has no `expansion.contains` array while dev has 1000 codes.\n\nThe observed record involves a Brazilian ValueSet (`cid10-ciap2`, URL `https://fhir.saude.go.gov.br/r4/core/ValueSet/cid10-ciap2`) that includes codes from `BRCID10` and `BRCIAP2` code systems.\n\n## How widespread\n\n1 record in the current delta file shows this exact pattern (both 200, prod empty+toocostly, dev has codes). Related but distinct from bug 44d1916 (where prod returns 422 instead of 200).\n\nSearch: checked all 56 records where prod has 0 codes and dev has >0 codes in comparison.ndjson; 55 of those have prod with no expansion metadata at all (handled by other tolerances), and only this 1 record has prod explicitly marking the expansion as too-costly with the toocostly extension.\n\n## Tolerance\n\nTolerance `expand-toocostly-dev-returns-codes` matches $expand records where both return 200, prod has the `valueset-toocostly` extension, and dev has codes in `expansion.contains` while prod does not. Skips these records since the responses are fundamentally different in content (empty vs populated expansion) and this is a known behavioral difference in expansion size enforcement.", "body_html": "<p>Records-Impacted: 1<br>\nTolerance-ID: expand-toocostly-dev-returns-codes<br>\nRecord-ID: 227d1960-bfbd-4ca4-9c10-c5614d0e62d5</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Save the request body from the record (1.2MB, includes inline CodeSystem resources)\n# Extract from: jobs/2026-02-round-2/issues/227d1960-bfbd-4ca4-9c10-c5614d0e62d5/record.json\n# python3 -c &quot;import json; r=json.load(open(&#x27;record.json&#x27;)); open(&#x27;/tmp/body.json&#x27;,&#x27;w&#x27;).write(r[&#x27;requestBody&#x27;])&quot;\n\n# Prod\ncurl -s &#x27;https://tx.fhir.org/r4/ValueSet/$expand&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d @/tmp/body.json | python3 -c &quot;import sys,json; d=json.load(sys.stdin); e=d.get(&#x27;expansion&#x27;,{}); print(&#x27;total:&#x27;, e.get(&#x27;total&#x27;), &#x27;contains:&#x27;, len(e.get(&#x27;contains&#x27;,[])), &#x27;toocostly:&#x27;, any(x.get(&#x27;url&#x27;,&#x27;&#x27;).endswith(&#x27;valueset-toocostly&#x27;) for x in e.get(&#x27;extension&#x27;,[])))&quot;\n\n# Dev\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d @/tmp/body.json | python3 -c &quot;import sys,json; d=json.load(sys.stdin); e=d.get(&#x27;expansion&#x27;,{}); print(&#x27;total:&#x27;, e.get(&#x27;total&#x27;), &#x27;contains:&#x27;, len(e.get(&#x27;contains&#x27;,[])), &#x27;toocostly:&#x27;, any(x.get(&#x27;url&#x27;,&#x27;&#x27;).endswith(&#x27;valueset-toocostly&#x27;) for x in e.get(&#x27;extension&#x27;,[])))&quot;</code></pre>\n<p>Prod returns <code>total: 0, contains: 0, toocostly: True</code>. Dev returns <code>total: None, contains: 1000, toocostly: False</code>.</p>\n<h2>What differs</h2>\n<p>For $expand of ValueSets that include large code systems, prod returns HTTP 200 with an empty expansion (0 codes in <code>contains</code>) and marks it with <code>valueset-toocostly: true</code> extension and <code>limitedExpansion: true</code> parameter. Dev returns HTTP 200 with 1000 codes in <code>expansion.contains</code> — it proceeds with the expansion that prod considers too costly.</p>\n<p>After existing normalizations strip the toocostly extension difference (tolerance <code>expand-toocostly-extension-and-used-codesystem</code>), the remaining difference is: prod has no <code>expansion.contains</code> array while dev has 1000 codes.</p>\n<p>The observed record involves a Brazilian ValueSet (<code>cid10-ciap2</code>, URL <code>https://fhir.saude.go.gov.br/r4/core/ValueSet/cid10-ciap2</code>) that includes codes from <code>BRCID10</code> and <code>BRCIAP2</code> code systems.</p>\n<h2>How widespread</h2>\n<p>1 record in the current delta file shows this exact pattern (both 200, prod empty+toocostly, dev has codes). Related but distinct from bug 44d1916 (where prod returns 422 instead of 200).</p>\n<p>Search: checked all 56 records where prod has 0 codes and dev has &gt;0 codes in comparison.ndjson; 55 of those have prod with no expansion metadata at all (handled by other tolerances), and only this 1 record has prod explicitly marking the expansion as too-costly with the toocostly extension.</p>\n<h2>Tolerance</h2>\n<p>Tolerance <code>expand-toocostly-dev-returns-codes</code> matches $expand records where both return 200, prod has the <code>valueset-toocostly</code> extension, and dev has codes in <code>expansion.contains</code> while prod does not. Skips these records since the responses are fundamentally different in content (empty vs populated expansion) and this is a known behavioral difference in expansion size enforcement.</p>", "impact": 1}, {"id": "5f3b796", "title": "LOINC $lookup: dev returns extra designations, RELATEDNAMES2 properties, and different CLASSTYPE format", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-2", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 10:52", "date_iso": "2026-02-08T10:52:56-06:00", "body_md": "Records-Impacted: 1\nTolerance-ID: loinc-lookup-extra-designations-properties\nRecord-ID: e5ceaa8d-ae90-42ed-a02d-1dc612d44d30\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/CodeSystem/$lookup' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"system\",\"valueUri\":\"http://loinc.org\"},{\"name\":\"code\",\"valueCode\":\"4548-4\"}]}'\n\ncurl -s 'https://tx-dev.fhir.org/r4/CodeSystem/$lookup' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"system\",\"valueUri\":\"http://loinc.org\"},{\"name\":\"code\",\"valueCode\":\"4548-4\"}]}'\n```\n\nProd returns CLASSTYPE with `value: \"Laboratory class\"` and 0 RELATEDNAMES2 properties. Dev returns CLASSTYPE with `value: \"1\"` plus `description: \"Laboratory class\"`, an extra `preferredForLanguage` designation, and 14 RELATEDNAMES2 properties with language-specific related names.\n\n\nOn POST /r4/CodeSystem/$lookup for LOINC code 4548-4, dev returns three categories of differences compared to prod:\n\n1. **Extra `preferredForLanguage` designation**: Dev includes a designation with `use.system: \"http://terminology.hl7.org/CodeSystem/hl7TermMaintInfra\"` and `use.code: \"preferredForLanguage\"` that prod omits entirely. (Prod instead has a duplicate LONG_COMMON_NAME designation with identical content.)\n\n2. **Different CLASSTYPE property format**: Prod returns `CLASSTYPE` with `value: \"Laboratory class\"` (a single valueString). Dev returns `CLASSTYPE` with `value: \"1\"` (the numeric code) plus a separate `description: \"Laboratory class\"` part. These represent different data modeling choices for the same property.\n\n3. **Extra RELATEDNAMES2 properties**: Dev returns 14 `RELATEDNAMES2` property parameters with language-specific related names (en-US, ar-JO, de-AT, de-DE, el-GR, es-ES, et-EE, fr-BE, it-IT, pl-PL, pt-BR, ru-RU, uk-UA, zh-CN). Prod returns none of these RELATEDNAMES2 properties.\n\n\nOnly 1 LOINC $lookup record exists in this comparison dataset. All LOINC $lookup requests would likely be affected since these differences stem from how LOINC properties and designations are served.\n\ngrep 'lookup' deltas.ndjson | grep 'loinc' → 1 record\n\n\nTolerance `loinc-lookup-extra-designations-properties` normalizes all three differences:\n- Strips the `preferredForLanguage` designation from dev\n- Strips duplicate LONG_COMMON_NAME designations from prod\n- Normalizes CLASSTYPE to use prod's format (value only, no description)\n- Strips all RELATEDNAMES2 properties from dev\n\nThis eliminates 1 record from deltas.", "body_html": "<p>Records-Impacted: 1<br>\nTolerance-ID: loinc-lookup-extra-designations-properties<br>\nRecord-ID: e5ceaa8d-ae90-42ed-a02d-1dc612d44d30</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/CodeSystem/$lookup&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;system&quot;,&quot;valueUri&quot;:&quot;http://loinc.org&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;4548-4&quot;}]}&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/CodeSystem/$lookup&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;system&quot;,&quot;valueUri&quot;:&quot;http://loinc.org&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;4548-4&quot;}]}&#x27;</code></pre>\n<p>Prod returns CLASSTYPE with <code>value: &quot;Laboratory class&quot;</code> and 0 RELATEDNAMES2 properties. Dev returns CLASSTYPE with <code>value: &quot;1&quot;</code> plus <code>description: &quot;Laboratory class&quot;</code>, an extra <code>preferredForLanguage</code> designation, and 14 RELATEDNAMES2 properties with language-specific related names.</p>\n<p>On POST /r4/CodeSystem/$lookup for LOINC code 4548-4, dev returns three categories of differences compared to prod:</p>\n<ol><li>**Extra <code>preferredForLanguage</code> designation**: Dev includes a designation with <code>use.system: &quot;http://terminology.hl7.org/CodeSystem/hl7TermMaintInfra&quot;</code> and <code>use.code: &quot;preferredForLanguage&quot;</code> that prod omits entirely. (Prod instead has a duplicate LONG_COMMON_NAME designation with identical content.)</li></ol>\n<ol><li><strong>Different CLASSTYPE property format</strong>: Prod returns <code>CLASSTYPE</code> with <code>value: &quot;Laboratory class&quot;</code> (a single valueString). Dev returns <code>CLASSTYPE</code> with <code>value: &quot;1&quot;</code> (the numeric code) plus a separate <code>description: &quot;Laboratory class&quot;</code> part. These represent different data modeling choices for the same property.</li></ol>\n<ol><li><strong>Extra RELATEDNAMES2 properties</strong>: Dev returns 14 <code>RELATEDNAMES2</code> property parameters with language-specific related names (en-US, ar-JO, de-AT, de-DE, el-GR, es-ES, et-EE, fr-BE, it-IT, pl-PL, pt-BR, ru-RU, uk-UA, zh-CN). Prod returns none of these RELATEDNAMES2 properties.</li></ol>\n<p>Only 1 LOINC $lookup record exists in this comparison dataset. All LOINC $lookup requests would likely be affected since these differences stem from how LOINC properties and designations are served.</p>\n<p>grep &#x27;lookup&#x27; deltas.ndjson | grep &#x27;loinc&#x27; → 1 record</p>\n<p>Tolerance <code>loinc-lookup-extra-designations-properties</code> normalizes all three differences:</p>\n<ul><li>Strips the <code>preferredForLanguage</code> designation from dev</li><li>Strips duplicate LONG_COMMON_NAME designations from prod</li><li>Normalizes CLASSTYPE to use prod&#x27;s format (value only, no description)</li><li>Strips all RELATEDNAMES2 properties from dev</li></ul>\n<p>This eliminates 1 record from deltas.</p>", "impact": 1}, {"id": "2f5929e", "title": "expand: dev returns 404 for unknown ISO 3166 version that prod resolves by fallback", "status": "open", "labels": ["missing-resource", "reproduced", "round:2026-02-round-2", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 10:52", "date_iso": "2026-02-08T10:52:56-06:00", "body_md": "Records-Impacted: 1\nTolerance-ID: expand-iso3166-unknown-version-fallback\nRecord-ID: 3d803696-e4e1-40e7-a249-c18cd3ff07aa\n\n## Repro\n\n**Request** (GET, same for both servers):\n```\ncurl -s -H \"Accept: application/fhir+json\" \\\n  'https://tx.fhir.org/r4/ValueSet/$expand?url=http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fiso3166-1-2&system-version=urn:iso:std:iso:3166|2020&count=1000'\n```\n\nReplace `tx.fhir.org` with `tx-dev.fhir.org` for the dev server.\n\n**Prod (tx.fhir.org)** -- HTTP 200:\n- Returns a ValueSet with `expansion.total` = 249 country codes\n- `used-codesystem` parameter: `urn:iso:std:iso:3166|2018` (falls back to known version)\n- `system-version` parameter: `urn:iso:std:iso:3166|2020` (echoes the requested version)\n\n**Dev (tx-dev.fhir.org)** -- HTTP 404:\n```json\n{\n  \"resourceType\": \"OperationOutcome\",\n  \"issue\": [{\n    \"severity\": \"error\",\n    \"code\": \"not-found\",\n    \"details\": {\n      \"text\": \"A definition for CodeSystem 'urn:iso:std:iso:3166' version '2020' could not be found, so the value set cannot be expanded. Valid versions: 2018 or 20210120\"\n    }\n  }]\n}\n```\n\n**Result**: Reproduced. Prod gracefully falls back to version 2018 when version 2020 is requested. Dev rejects the request outright with a 404 OperationOutcome.\n\n## What differs\n\nWhen $expand is called on ValueSet/iso3166-1-2 with `system-version=urn:iso:std:iso:3166|2020`:\n\n- **Prod (200)**: Successfully expands the ValueSet with 249 country codes. Falls back to version 2018 (shown in `used-codesystem` parameter as `urn:iso:std:iso:3166|2018`), while also echoing the requested `system-version` as `urn:iso:std:iso:3166|2020`.\n- **Dev (404)**: Returns an OperationOutcome with error: \"A definition for CodeSystem 'urn:iso:std:iso:3166' version '2020' could not be found, so the value set cannot be expanded. Valid versions: 2018 or 20210120\"\n\nProd gracefully handles the unknown version by falling back to a known edition and succeeding. Dev rejects the request outright with a 404.\n\n## How widespread\n\nOnly 1 record in the deltas matches this exact pattern (prod=200, dev=404 for ISO 3166 $expand with unknown version). This is the only missing-resource record in the entire delta set.\n\nSearch: `grep 'missing-resource' deltas.ndjson | wc -l` → 1\n\nThe pattern is conceptually related to bug 1bc5e64 (dev not resolving code system versions prod resolves), but that bug covers validate-code operations where both return result=false. This is an $expand where the outcome diverges completely (200 with data vs 404 with error).\n\n## What the tolerance covers\n\nTolerance `expand-iso3166-unknown-version-fallback` matches $expand records where prod=200 and dev=404, the URL targets `iso3166-1-2`, and `system-version` contains `iso:3166`. Skips the record. Eliminates 1 record.", "body_html": "<p>Records-Impacted: 1<br>\nTolerance-ID: expand-iso3166-unknown-version-fallback<br>\nRecord-ID: 3d803696-e4e1-40e7-a249-c18cd3ff07aa</p>\n<h2>Repro</h2>\n<p><strong>Request</strong> (GET, same for both servers):</p>\n<pre><code>curl -s -H &quot;Accept: application/fhir+json&quot; \\\n  &#x27;https://tx.fhir.org/r4/ValueSet/$expand?url=http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fiso3166-1-2&amp;system-version=urn:iso:std:iso:3166|2020&amp;count=1000&#x27;</code></pre>\n<p>Replace <code>tx.fhir.org</code> with <code>tx-dev.fhir.org</code> for the dev server.</p>\n<p><strong>Prod (tx.fhir.org)</strong> -- HTTP 200:</p>\n<ul><li>Returns a ValueSet with <code>expansion.total</code> = 249 country codes</li><li><code>used-codesystem</code> parameter: <code>urn:iso:std:iso:3166|2018</code> (falls back to known version)</li><li><code>system-version</code> parameter: <code>urn:iso:std:iso:3166|2020</code> (echoes the requested version)</li></ul>\n<p><strong>Dev (tx-dev.fhir.org)</strong> -- HTTP 404:</p>\n<pre><code class=\"lang-json\">{\n  &quot;resourceType&quot;: &quot;OperationOutcome&quot;,\n  &quot;issue&quot;: [{\n    &quot;severity&quot;: &quot;error&quot;,\n    &quot;code&quot;: &quot;not-found&quot;,\n    &quot;details&quot;: {\n      &quot;text&quot;: &quot;A definition for CodeSystem &#x27;urn:iso:std:iso:3166&#x27; version &#x27;2020&#x27; could not be found, so the value set cannot be expanded. Valid versions: 2018 or 20210120&quot;\n    }\n  }]\n}</code></pre>\n<p><strong>Result</strong>: Reproduced. Prod gracefully falls back to version 2018 when version 2020 is requested. Dev rejects the request outright with a 404 OperationOutcome.</p>\n<h2>What differs</h2>\n<p>When $expand is called on ValueSet/iso3166-1-2 with <code>system-version=urn:iso:std:iso:3166|2020</code>:</p>\n<ul><li><strong>Prod (200)</strong>: Successfully expands the ValueSet with 249 country codes. Falls back to version 2018 (shown in <code>used-codesystem</code> parameter as <code>urn:iso:std:iso:3166|2018</code>), while also echoing the requested <code>system-version</code> as <code>urn:iso:std:iso:3166|2020</code>.</li><li><strong>Dev (404)</strong>: Returns an OperationOutcome with error: &quot;A definition for CodeSystem &#x27;urn:iso:std:iso:3166&#x27; version &#x27;2020&#x27; could not be found, so the value set cannot be expanded. Valid versions: 2018 or 20210120&quot;</li></ul>\n<p>Prod gracefully handles the unknown version by falling back to a known edition and succeeding. Dev rejects the request outright with a 404.</p>\n<h2>How widespread</h2>\n<p>Only 1 record in the deltas matches this exact pattern (prod=200, dev=404 for ISO 3166 $expand with unknown version). This is the only missing-resource record in the entire delta set.</p>\n<p>Search: <code>grep &#x27;missing-resource&#x27; deltas.ndjson | wc -l</code> → 1</p>\n<p>The pattern is conceptually related to bug 1bc5e64 (dev not resolving code system versions prod resolves), but that bug covers validate-code operations where both return result=false. This is an $expand where the outcome diverges completely (200 with data vs 404 with error).</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance <code>expand-iso3166-unknown-version-fallback</code> matches $expand records where prod=200 and dev=404, the URL targets <code>iso3166-1-2</code>, and <code>system-version</code> contains <code>iso:3166</code>. Skips the record. Eliminates 1 record.</p>", "impact": 1}, {"id": "f9f6206", "title": "validate-code: dev renders JavaScript undefined/null as literal strings when code/version absent", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-2", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 10:52", "date_iso": "2026-02-08T10:52:57-06:00", "body_md": "Records-Impacted: 1\nTolerance-ID: validate-code-undefined-null-in-unknown-code-message\nRecord-ID: 7f0c6cf8-a250-4935-8ab6-32f499d65302\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r5/CodeSystem/$validate-code' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"coding\",\"valueCoding\":{\"system\":\"urn:ietf:bcp:47\"}},{\"name\":\"displayLanguage\",\"valueString\":\"en\"},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true}]}'\n\ncurl -s 'https://tx-dev.fhir.org/r5/CodeSystem/$validate-code' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"coding\",\"valueCoding\":{\"system\":\"urn:ietf:bcp:47\"}},{\"name\":\"displayLanguage\",\"valueString\":\"en\"},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true}]}'\n```\n\nProd returns message `\"Unknown code '' in the CodeSystem 'urn:ietf:bcp:47' version ''\"` (empty strings for missing code/version), dev returns `\"Unknown code 'undefined' in the CodeSystem 'urn:ietf:bcp:47' version 'null'\"` (JavaScript undefined/null as literal strings). Dev also includes an extra informational issue `\"Empty code\"` that prod does not return.\n\n\nIn a POST /r5/CodeSystem/$validate-code request for system `urn:ietf:bcp:47` with a coding that has no `code` or `version`, the message and issues text differ:\n\n- Prod: `\"Unknown code '' in the CodeSystem 'urn:ietf:bcp:47' version ''\"`\n- Dev: `\"Unknown code 'undefined' in the CodeSystem 'urn:ietf:bcp:47' version 'null'\"`\n\nDev renders JavaScript's `undefined` and `null` as literal strings instead of empty strings when code and version are absent from the request.\n\nAdditionally, dev includes an extra informational OperationOutcome issue (`\"Empty code\"`, severity=information) that prod does not return.\n\nBoth servers agree on result=false and system=urn:ietf:bcp:47.\n\n\n1 record in the current delta file. Searched for broader patterns:\n- `grep \"'undefined'\" deltas.ndjson` → 37 hits total, but only 2 have 'undefined' in non-diagnostics params (this record and 06cfc4c9 which has \"and undefined\" in a version list — a different pattern)\n- `grep \"version 'null'\" deltas.ndjson` → 1 hit (this record only)\n- `grep \"Empty code\" deltas.ndjson` → 1 hit (this record only)\n\n\nTolerance ID: validate-code-undefined-null-in-unknown-code-message\nMatches: validate-code Parameters responses where dev message contains `'undefined'` or `version 'null'` and prod has the same message but with empty strings. Normalizes the message and issues text to prod's rendering, and removes the extra \"Empty code\" informational issue from dev. Eliminates 1 delta record.\n\n\n`grep -n '7f0c6cf8-a250-4935-8ab6-32f499d65302' comparison.ndjson`", "body_html": "<p>Records-Impacted: 1<br>\nTolerance-ID: validate-code-undefined-null-in-unknown-code-message<br>\nRecord-ID: 7f0c6cf8-a250-4935-8ab6-32f499d65302</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r5/CodeSystem/$validate-code&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;coding&quot;,&quot;valueCoding&quot;:{&quot;system&quot;:&quot;urn:ietf:bcp:47&quot;}},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueString&quot;:&quot;en&quot;},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true}]}&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r5/CodeSystem/$validate-code&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;coding&quot;,&quot;valueCoding&quot;:{&quot;system&quot;:&quot;urn:ietf:bcp:47&quot;}},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueString&quot;:&quot;en&quot;},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true}]}&#x27;</code></pre>\n<p>Prod returns message <code>&quot;Unknown code &#x27;&#x27; in the CodeSystem &#x27;urn:ietf:bcp:47&#x27; version &#x27;&#x27;&quot;</code> (empty strings for missing code/version), dev returns <code>&quot;Unknown code &#x27;undefined&#x27; in the CodeSystem &#x27;urn:ietf:bcp:47&#x27; version &#x27;null&#x27;&quot;</code> (JavaScript undefined/null as literal strings). Dev also includes an extra informational issue <code>&quot;Empty code&quot;</code> that prod does not return.</p>\n<p>In a POST /r5/CodeSystem/$validate-code request for system <code>urn:ietf:bcp:47</code> with a coding that has no <code>code</code> or <code>version</code>, the message and issues text differ:</p>\n<ul><li>Prod: <code>&quot;Unknown code &#x27;&#x27; in the CodeSystem &#x27;urn:ietf:bcp:47&#x27; version &#x27;&#x27;&quot;</code></li><li>Dev: <code>&quot;Unknown code &#x27;undefined&#x27; in the CodeSystem &#x27;urn:ietf:bcp:47&#x27; version &#x27;null&#x27;&quot;</code></li></ul>\n<p>Dev renders JavaScript&#x27;s <code>undefined</code> and <code>null</code> as literal strings instead of empty strings when code and version are absent from the request.</p>\n<p>Additionally, dev includes an extra informational OperationOutcome issue (<code>&quot;Empty code&quot;</code>, severity=information) that prod does not return.</p>\n<p>Both servers agree on result=false and system=urn:ietf:bcp:47.</p>\n<p>1 record in the current delta file. Searched for broader patterns:</p>\n<ul><li><code>grep &quot;&#x27;undefined&#x27;&quot; deltas.ndjson</code> → 37 hits total, but only 2 have &#x27;undefined&#x27; in non-diagnostics params (this record and 06cfc4c9 which has &quot;and undefined&quot; in a version list — a different pattern)</li><li><code>grep &quot;version &#x27;null&#x27;&quot; deltas.ndjson</code> → 1 hit (this record only)</li><li><code>grep &quot;Empty code&quot; deltas.ndjson</code> → 1 hit (this record only)</li></ul>\n<p>Tolerance ID: validate-code-undefined-null-in-unknown-code-message<br>\nMatches: validate-code Parameters responses where dev message contains <code>&#x27;undefined&#x27;</code> or <code>version &#x27;null&#x27;</code> and prod has the same message but with empty strings. Normalizes the message and issues text to prod&#x27;s rendering, and removes the extra &quot;Empty code&quot; informational issue from dev. Eliminates 1 delta record.</p>\n<p><code>grep -n &#x27;7f0c6cf8-a250-4935-8ab6-32f499d65302&#x27; comparison.ndjson</code></p>", "impact": 1}, {"id": "f33ebd3", "title": "validate-code: prod reports UNKNOWN_CODESYSTEM, dev reports UNKNOWN_CODESYSTEM_VERSION when system-version pins unavailable SNOMED edition", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-2", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 10:52", "date_iso": "2026-02-08T10:52:57-06:00", "body_md": "Records-Impacted: 1\nTolerance-ID: unknown-system-vs-unknown-version\nRecord-ID: 06cfc4c9-c3c4-42a6-abb8-3068cd06190f\n\n## Repro\n\n```bash\n# Prod\ncurl -s \"https://tx.fhir.org/r4/CodeSystem/\\$validate-code\" \\\n  -H \"Accept: application/fhir+json\" \\\n  -H \"Content-Type: application/fhir+json\" \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"coding\",\"valueCoding\":{\"system\":\"http://snomed.info/sct\",\"code\":\"29857009\",\"display\":\"Chest pain\"}},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true},{\"name\":\"system-version\",\"valueString\":\"http://snomed.info/sct|http://snomed.info/sct/20611000087101\"}]}'\n\n# Dev\ncurl -s \"https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code\" \\\n  -H \"Accept: application/fhir+json\" \\\n  -H \"Content-Type: application/fhir+json\" \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"coding\",\"valueCoding\":{\"system\":\"http://snomed.info/sct\",\"code\":\"29857009\",\"display\":\"Chest pain\"}},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true},{\"name\":\"system-version\",\"valueString\":\"http://snomed.info/sct|http://snomed.info/sct/20611000087101\"}]}'\n```\n\nProd returns message-id `UNKNOWN_CODESYSTEM` (\"A definition for CodeSystem 'http://snomed.info/sct' could not be found\"), dev returns message-id `UNKNOWN_CODESYSTEM_VERSION` (\"...version 'http://snomed.info/sct/20611000087101' could not be found...Valid versions: ...\"). Dev also includes `display: \"Chest pain\"` and version-qualified `x-caused-by-unknown-system`.\n\n## What differs\n\nWhen `$validate-code` on `CodeSystem` is called with `system-version` pinning an unavailable SNOMED CT edition (Canadian edition `http://snomed.info/sct/20611000087101`), prod and dev disagree on the error classification:\n\n- **Prod**: Treats the entire CodeSystem as unknown — message-id `UNKNOWN_CODESYSTEM`, message \"A definition for CodeSystem 'http://snomed.info/sct' could not be found\", `x-caused-by-unknown-system: http://snomed.info/sct` (no version), no `display` parameter\n- **Dev**: Recognizes SNOMED is loaded but the specific edition is not — message-id `UNKNOWN_CODESYSTEM_VERSION`, message \"A definition for CodeSystem 'http://snomed.info/sct' version 'http://snomed.info/sct/20611000087101' could not be found ... Valid versions: ...\" listing all available editions, `x-caused-by-unknown-system: http://snomed.info/sct|http://snomed.info/sct/20611000087101` (with version), and includes `display: \"Chest pain\"` parameter\n\nBoth return `result: false` but for different reasons: prod says the system is entirely unknown, dev says the specific version is unknown and helpfully lists available versions.\n\nThe request includes `system-version` parameter `http://snomed.info/sct|http://snomed.info/sct/20611000087101` (Canadian SNOMED edition), `default-to-latest-version: true`, and code `29857009` (Chest pain).\n\n## How widespread\n\nOnly 1 record in the deltas matches this exact pattern (prod=UNKNOWN_CODESYSTEM, dev=UNKNOWN_CODESYSTEM_VERSION). In the full comparison data, also only 1 record has this specific disagreement — the remaining SNOMED records with system-version for this edition are handled by existing tolerances.\n\nSearch: `grep 'UNKNOWN_CODESYSTEM' deltas.ndjson` → 2 hits, but only 1 has this prod-vs-dev message-id disagreement (the other is a missing-resource for $expand).\n\n## What the tolerance covers\n\nTolerance `unknown-system-vs-unknown-version` matches validate-code records where prod has message-id `UNKNOWN_CODESYSTEM` and dev has `UNKNOWN_CODESYSTEM_VERSION`. Normalizes dev's messages, issues, x-caused-by-unknown-system, and display to match prod's values. Eliminates 1 record.", "body_html": "<p>Records-Impacted: 1<br>\nTolerance-ID: unknown-system-vs-unknown-version<br>\nRecord-ID: 06cfc4c9-c3c4-42a6-abb8-3068cd06190f</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod\ncurl -s &quot;https://tx.fhir.org/r4/CodeSystem/\\$validate-code&quot; \\\n  -H &quot;Accept: application/fhir+json&quot; \\\n  -H &quot;Content-Type: application/fhir+json&quot; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;coding&quot;,&quot;valueCoding&quot;:{&quot;system&quot;:&quot;http://snomed.info/sct&quot;,&quot;code&quot;:&quot;29857009&quot;,&quot;display&quot;:&quot;Chest pain&quot;}},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true},{&quot;name&quot;:&quot;system-version&quot;,&quot;valueString&quot;:&quot;http://snomed.info/sct|http://snomed.info/sct/20611000087101&quot;}]}&#x27;\n\n# Dev\ncurl -s &quot;https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code&quot; \\\n  -H &quot;Accept: application/fhir+json&quot; \\\n  -H &quot;Content-Type: application/fhir+json&quot; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;coding&quot;,&quot;valueCoding&quot;:{&quot;system&quot;:&quot;http://snomed.info/sct&quot;,&quot;code&quot;:&quot;29857009&quot;,&quot;display&quot;:&quot;Chest pain&quot;}},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true},{&quot;name&quot;:&quot;system-version&quot;,&quot;valueString&quot;:&quot;http://snomed.info/sct|http://snomed.info/sct/20611000087101&quot;}]}&#x27;</code></pre>\n<p>Prod returns message-id <code>UNKNOWN_CODESYSTEM</code> (&quot;A definition for CodeSystem &#x27;<a href=\"http://snomed.info/sct&#x27;\" target=\"_blank\">http://snomed.info/sct&#x27;</a> could not be found&quot;), dev returns message-id <code>UNKNOWN_CODESYSTEM_VERSION</code> (&quot;...version &#x27;<a href=\"http://snomed.info/sct/20611000087101&#x27;\" target=\"_blank\">http://snomed.info/sct/20611000087101&#x27;</a> could not be found...Valid versions: ...&quot;). Dev also includes <code>display: &quot;Chest pain&quot;</code> and version-qualified <code>x-caused-by-unknown-system</code>.</p>\n<h2>What differs</h2>\n<p>When <code>$validate-code</code> on <code>CodeSystem</code> is called with <code>system-version</code> pinning an unavailable SNOMED CT edition (Canadian edition <code>http://snomed.info/sct/20611000087101</code>), prod and dev disagree on the error classification:</p>\n<ul><li><strong>Prod</strong>: Treats the entire CodeSystem as unknown — message-id <code>UNKNOWN_CODESYSTEM</code>, message &quot;A definition for CodeSystem &#x27;<a href=\"http://snomed.info/sct&#x27;\" target=\"_blank\">http://snomed.info/sct&#x27;</a> could not be found&quot;, <code>x-caused-by-unknown-system: http://snomed.info/sct</code> (no version), no <code>display</code> parameter</li><li><strong>Dev</strong>: Recognizes SNOMED is loaded but the specific edition is not — message-id <code>UNKNOWN_CODESYSTEM_VERSION</code>, message &quot;A definition for CodeSystem &#x27;<a href=\"http://snomed.info/sct&#x27;\" target=\"_blank\">http://snomed.info/sct&#x27;</a> version &#x27;<a href=\"http://snomed.info/sct/20611000087101&#x27;\" target=\"_blank\">http://snomed.info/sct/20611000087101&#x27;</a> could not be found ... Valid versions: ...&quot; listing all available editions, <code>x-caused-by-unknown-system: http://snomed.info/sct|http://snomed.info/sct/20611000087101</code> (with version), and includes <code>display: &quot;Chest pain&quot;</code> parameter</li></ul>\n<p>Both return <code>result: false</code> but for different reasons: prod says the system is entirely unknown, dev says the specific version is unknown and helpfully lists available versions.</p>\n<p>The request includes <code>system-version</code> parameter <code>http://snomed.info/sct|http://snomed.info/sct/20611000087101</code> (Canadian SNOMED edition), <code>default-to-latest-version: true</code>, and code <code>29857009</code> (Chest pain).</p>\n<h2>How widespread</h2>\n<p>Only 1 record in the deltas matches this exact pattern (prod=UNKNOWN_CODESYSTEM, dev=UNKNOWN_CODESYSTEM_VERSION). In the full comparison data, also only 1 record has this specific disagreement — the remaining SNOMED records with system-version for this edition are handled by existing tolerances.</p>\n<p>Search: <code>grep &#x27;UNKNOWN_CODESYSTEM&#x27; deltas.ndjson</code> → 2 hits, but only 1 has this prod-vs-dev message-id disagreement (the other is a missing-resource for $expand).</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance <code>unknown-system-vs-unknown-version</code> matches validate-code records where prod has message-id <code>UNKNOWN_CODESYSTEM</code> and dev has <code>UNKNOWN_CODESYSTEM_VERSION</code>. Normalizes dev&#x27;s messages, issues, x-caused-by-unknown-system, and display to match prod&#x27;s values. Eliminates 1 record.</p>", "impact": 1}, {"id": "e107342", "title": "SNOMED $lookup: prod returns 400 where dev returns 404 for unknown code", "status": "open", "labels": ["reproduced", "round:2026-02-round-2", "status-mismatch", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 10:52", "date_iso": "2026-02-08T10:52:57-06:00", "body_md": "Records-Impacted: 1\nTolerance-ID: lookup-unknown-code-status-400-vs-404\nRecord-ID: 442928d4-a15c-4934-b21f-0713857f1c04\n\n## Repro\n\nReproduced on 2026-02-07. Prod returns HTTP 400 with issue code `invalid`; dev returns HTTP 404 with issue code `not-found`.\n\n```bash\n# Prod (returns 400)\ncurl -s -o /dev/null -w \"%{http_code}\" -H \"Accept: application/fhir+json\" \\\n  \"https://tx.fhir.org/r5/CodeSystem/\\$lookup?system=http://snomed.info/sct&code=710136005\"\n# => 400\n\n# Dev (returns 404)\ncurl -s -o /dev/null -w \"%{http_code}\" -H \"Accept: application/fhir+json\" \\\n  \"https://tx-dev.fhir.org/r5/CodeSystem/\\$lookup?system=http://snomed.info/sct&code=710136005\"\n# => 404\n```\n\nProd response (HTTP 400):\n```json\n{\n  \"resourceType\": \"OperationOutcome\",\n  \"issue\": [{\"severity\": \"error\", \"code\": \"invalid\", \"diagnostics\": \"Unable to find code 710136005 in http://snomed.info/sct version http://snomed.info/sct/900000000000207008/version/20250201\"}]\n}\n```\n\nDev response (HTTP 404):\n```json\n{\n  \"resourceType\": \"OperationOutcome\",\n  \"issue\": [{\"severity\": \"error\", \"code\": \"not-found\", \"details\": {\"text\": \"Unable to find code '710136005' in http://snomed.info/sct version http://snomed.info/sct/900000000000207008/version/20250201\"}}]\n}\n```\n\n## What differs\n\nFor a SNOMED CT $lookup on an unknown code (`GET /r5/CodeSystem/$lookup?system=http://snomed.info/sct&code=710136005`):\n\n- **Prod** returns HTTP 400 with OperationOutcome issue code `invalid` and error message in `diagnostics`\n- **Dev** returns HTTP 404 with OperationOutcome issue code `not-found` and error message in `details.text`\n\nBoth servers agree the code doesn't exist in SNOMED CT (same version `http://snomed.info/sct/900000000000207008/version/20250201`), but differ on:\n1. HTTP status code: 400 (Bad Request) vs 404 (Not Found)\n2. OperationOutcome issue code: `invalid` vs `not-found`\n3. Error message field: `diagnostics` vs `details.text`\n\nNote: The FHIR R4 spec example for $lookup error responses uses `not-found` with `details.text` (matching dev's behavior), though the spec doesn't mandate a specific HTTP status code.\n\n## How widespread\n\nOnly 1 record in the current dataset shows this pattern. Out of 2991 total $lookup operations, this is the only one with a status mismatch. The specific SNOMED code 710136005 only appears once.\n\n```bash\ngrep '\"prodStatus\":400.*\"devStatus\":404' jobs/2026-02-round-2/results/deltas/deltas.ndjson | wc -l\n# => 1\n```\n\n## Tolerance\n\nTolerance `lookup-unknown-code-status-400-vs-404` matches $lookup operations where prod returns 400 and dev returns 404, both returning OperationOutcome with \"Unable to find code\" messages. It skips the record since the content difference (status code and issue structure) is entirely covered by the status mismatch pattern.", "body_html": "<p>Records-Impacted: 1<br>\nTolerance-ID: lookup-unknown-code-status-400-vs-404<br>\nRecord-ID: 442928d4-a15c-4934-b21f-0713857f1c04</p>\n<h2>Repro</h2>\n<p>Reproduced on 2026-02-07. Prod returns HTTP 400 with issue code <code>invalid</code>; dev returns HTTP 404 with issue code <code>not-found</code>.</p>\n<pre><code class=\"lang-bash\"># Prod (returns 400)\ncurl -s -o /dev/null -w &quot;%{http_code}&quot; -H &quot;Accept: application/fhir+json&quot; \\\n  &quot;https://tx.fhir.org/r5/CodeSystem/\\$lookup?system=http://snomed.info/sct&amp;code=710136005&quot;\n# =&gt; 400\n\n# Dev (returns 404)\ncurl -s -o /dev/null -w &quot;%{http_code}&quot; -H &quot;Accept: application/fhir+json&quot; \\\n  &quot;https://tx-dev.fhir.org/r5/CodeSystem/\\$lookup?system=http://snomed.info/sct&amp;code=710136005&quot;\n# =&gt; 404</code></pre>\n<p>Prod response (HTTP 400):</p>\n<pre><code class=\"lang-json\">{\n  &quot;resourceType&quot;: &quot;OperationOutcome&quot;,\n  &quot;issue&quot;: [{&quot;severity&quot;: &quot;error&quot;, &quot;code&quot;: &quot;invalid&quot;, &quot;diagnostics&quot;: &quot;Unable to find code 710136005 in http://snomed.info/sct version http://snomed.info/sct/900000000000207008/version/20250201&quot;}]\n}</code></pre>\n<p>Dev response (HTTP 404):</p>\n<pre><code class=\"lang-json\">{\n  &quot;resourceType&quot;: &quot;OperationOutcome&quot;,\n  &quot;issue&quot;: [{&quot;severity&quot;: &quot;error&quot;, &quot;code&quot;: &quot;not-found&quot;, &quot;details&quot;: {&quot;text&quot;: &quot;Unable to find code &#x27;710136005&#x27; in http://snomed.info/sct version http://snomed.info/sct/900000000000207008/version/20250201&quot;}}]\n}</code></pre>\n<h2>What differs</h2>\n<p>For a SNOMED CT $lookup on an unknown code (<code>GET /r5/CodeSystem/$lookup?system=http://snomed.info/sct&amp;code=710136005</code>):</p>\n<ul><li><strong>Prod</strong> returns HTTP 400 with OperationOutcome issue code <code>invalid</code> and error message in <code>diagnostics</code></li><li><strong>Dev</strong> returns HTTP 404 with OperationOutcome issue code <code>not-found</code> and error message in <code>details.text</code></li></ul>\n<p>Both servers agree the code doesn&#x27;t exist in SNOMED CT (same version <code>http://snomed.info/sct/900000000000207008/version/20250201</code>), but differ on:</p>\n<ol><li>HTTP status code: 400 (Bad Request) vs 404 (Not Found)</li><li>OperationOutcome issue code: <code>invalid</code> vs <code>not-found</code></li><li>Error message field: <code>diagnostics</code> vs <code>details.text</code></li></ol>\n<p>Note: The FHIR R4 spec example for $lookup error responses uses <code>not-found</code> with <code>details.text</code> (matching dev&#x27;s behavior), though the spec doesn&#x27;t mandate a specific HTTP status code.</p>\n<h2>How widespread</h2>\n<p>Only 1 record in the current dataset shows this pattern. Out of 2991 total $lookup operations, this is the only one with a status mismatch. The specific SNOMED code 710136005 only appears once.</p>\n<pre><code class=\"lang-bash\">grep &#x27;&quot;prodStatus&quot;:400.*&quot;devStatus&quot;:404&#x27; jobs/2026-02-round-2/results/deltas/deltas.ndjson | wc -l\n# =&gt; 1</code></pre>\n<h2>Tolerance</h2>\n<p>Tolerance <code>lookup-unknown-code-status-400-vs-404</code> matches $lookup operations where prod returns 400 and dev returns 404, both returning OperationOutcome with &quot;Unable to find code&quot; messages. It skips the record since the content difference (status code and issue structure) is entirely covered by the status mismatch pattern.</p>", "impact": 1}, {"id": "dc0b0d1", "title": "CodeSystem/$validate-code without system: different error message and severity", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:37", "date_iso": "2026-02-08T13:37:59-06:00", "body_md": "Records-Impacted: 1\nTolerance-ID: cs-validate-code-no-system-error-format\nRecord-ID: 9afb9fcf-df5f-4766-a56a-33379c66b90a\n\n\n```bash\ncurl -s \"https://tx.fhir.org/r4/CodeSystem/\\$validate-code\" \\\n-H \"Accept: application/fhir+json\" \\\n-H \"Content-Type: application/fhir+json\" \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"coding\",\"valueCoding\":{\"code\":\"OBG\"}}]}'\n\ncurl -s \"https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code\" \\\n-H \"Accept: application/fhir+json\" \\\n-H \"Content-Type: application/fhir+json\" \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"coding\",\"valueCoding\":{\"code\":\"OBG\"}}]}'\n```\n\nProd returns severity=`warning` with message \"Coding has no system. A code with no system has no defined meaning, and it cannot be validated. A system should be provided\" and includes `details.coding` with code `invalid-data` from the `tx-issue-type` system. Dev returns severity=`error` with message \"No CodeSystem specified - provide url parameter or codeSystem resource\" and no `details.coding`.\n\n\nPOST /r4/CodeSystem/$validate-code with code \"OBG\" and no system parameter.\n\nBoth servers return result=false, but they differ in how they report the error:\n\n- **Prod**: severity=warning, message=\"Coding has no system. A code with no system has no defined meaning, and it cannot be validated. A system should be provided\", includes details.coding with code \"invalid-data\" from tx-issue-type system\n- **Dev**: severity=error, message=\"No CodeSystem specified - provide url parameter or codeSystem resource\", no details.coding at all\n\nThree distinct differences:\n1. Severity: warning (prod) vs error (dev)\n2. Message text: completely different wording\n3. Issue detail coding: prod includes structured tx-issue-type coding, dev omits it\n\n\nThis is the only record in the dataset with this specific pattern. Searched for \"No CodeSystem specified\" across both comparison.ndjson and deltas.ndjson — found exactly 1 match. The request shape (POST to /r4/CodeSystem/$validate-code without trailing ?) is also unique.\n\n\nTolerance ID: cs-validate-code-no-system-error-format\nMatches: POST /r4/CodeSystem/$validate-code (without trailing ?), where dev message contains \"No CodeSystem specified\". Normalizes message and issues to prod's values to suppress this single record.\n\n\n9afb9fcf-df5f-4766-a56a-33379c66b90a", "body_html": "<p>Records-Impacted: 1<br>\nTolerance-ID: cs-validate-code-no-system-error-format<br>\nRecord-ID: 9afb9fcf-df5f-4766-a56a-33379c66b90a</p>\n<pre><code class=\"lang-bash\">curl -s &quot;https://tx.fhir.org/r4/CodeSystem/\\$validate-code&quot; \\\n-H &quot;Accept: application/fhir+json&quot; \\\n-H &quot;Content-Type: application/fhir+json&quot; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;coding&quot;,&quot;valueCoding&quot;:{&quot;code&quot;:&quot;OBG&quot;}}]}&#x27;\n\ncurl -s &quot;https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code&quot; \\\n-H &quot;Accept: application/fhir+json&quot; \\\n-H &quot;Content-Type: application/fhir+json&quot; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;coding&quot;,&quot;valueCoding&quot;:{&quot;code&quot;:&quot;OBG&quot;}}]}&#x27;</code></pre>\n<p>Prod returns severity=<code>warning</code> with message &quot;Coding has no system. A code with no system has no defined meaning, and it cannot be validated. A system should be provided&quot; and includes <code>details.coding</code> with code <code>invalid-data</code> from the <code>tx-issue-type</code> system. Dev returns severity=<code>error</code> with message &quot;No CodeSystem specified - provide url parameter or codeSystem resource&quot; and no <code>details.coding</code>.</p>\n<p>POST /r4/CodeSystem/$validate-code with code &quot;OBG&quot; and no system parameter.</p>\n<p>Both servers return result=false, but they differ in how they report the error:</p>\n<ul><li><strong>Prod</strong>: severity=warning, message=&quot;Coding has no system. A code with no system has no defined meaning, and it cannot be validated. A system should be provided&quot;, includes details.coding with code &quot;invalid-data&quot; from tx-issue-type system</li><li><strong>Dev</strong>: severity=error, message=&quot;No CodeSystem specified - provide url parameter or codeSystem resource&quot;, no details.coding at all</li></ul>\n<p>Three distinct differences:</p>\n<ol><li>Severity: warning (prod) vs error (dev)</li><li>Message text: completely different wording</li><li>Issue detail coding: prod includes structured tx-issue-type coding, dev omits it</li></ol>\n<p>This is the only record in the dataset with this specific pattern. Searched for &quot;No CodeSystem specified&quot; across both comparison.ndjson and deltas.ndjson — found exactly 1 match. The request shape (POST to /r4/CodeSystem/$validate-code without trailing ?) is also unique.</p>\n<p>Tolerance ID: cs-validate-code-no-system-error-format<br>\nMatches: POST /r4/CodeSystem/$validate-code (without trailing ?), where dev message contains &quot;No CodeSystem specified&quot;. Normalizes message and issues to prod&#x27;s values to suppress this single record.</p>\n<p>9afb9fcf-df5f-4766-a56a-33379c66b90a</p>", "impact": 1}, {"id": "5f7faaa", "title": "Dev crashes (500) on POST /r4/ValueSet/$validate-code with 'No Match for undefined|undefined'", "status": "open", "labels": ["dev-crash-on-valid", "reproduced", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:37", "date_iso": "2026-02-08T13:37:59-06:00", "body_md": "Records-Impacted: 1\nTolerance-ID: validate-code-crash-undefined-system-code\nRecord-ID: 6b937ddc-13c0-49e1-bd96-24ef10f06543\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$validate-code' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"coding\",\"valueCoding\":{\"system\":\"urn:oid:2.16.840.1.113883.6.238\",\"code\":\"2108-9\",\"display\":\"EUROPEAN\"}},{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"url\":\"http://hl7.org/fhir/us/core/ValueSet/detailed-race\",\"version\":\"6.1.0\",\"status\":\"active\",\"compose\":{\"include\":[{\"valueSet\":[\"http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.1.11.14914\"]},{\"valueSet\":[\"http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1021.103\"]}],\"exclude\":[{\"valueSet\":[\"http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.3.2074.1.1.3\"]}]}}}]}'\n\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$validate-code' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"coding\",\"valueCoding\":{\"system\":\"urn:oid:2.16.840.1.113883.6.238\",\"code\":\"2108-9\",\"display\":\"EUROPEAN\"}},{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"url\":\"http://hl7.org/fhir/us/core/ValueSet/detailed-race\",\"version\":\"6.1.0\",\"status\":\"active\",\"compose\":{\"include\":[{\"valueSet\":[\"http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.1.11.14914\"]},{\"valueSet\":[\"http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1021.103\"]}],\"exclude\":[{\"valueSet\":[\"http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.3.2074.1.1.3\"]}]}}}]}'\n```\n\nProd returns 200 with a Parameters response (result=false, with code system version details). Dev returns 500 with OperationOutcome `\"No Match for undefined|undefined\"`. The bug triggers when a ValueSet has `compose.exclude` entries with only a `valueSet` reference (no `system`); dev's exclude-processing code path reads `cc.system` and `cc.version` as `undefined` from the exclude entry.\n\n\nProd returns 200 with a successful $validate-code Parameters response (result=true, system=urn:oid:2.16.840.1.113883.6.238, code=2108-9, display=\"European\", version=\"1.2\"). Dev returns 500 with an OperationOutcome error: \"No Match for undefined|undefined\".\n\nThe error message \"undefined|undefined\" indicates that dev failed to extract the system and code parameters from the POST request body, receiving them as JavaScript `undefined` values instead.\n\nThe request is POST /r4/ValueSet/$validate-code against the http://hl7.org/fhir/us/core/ValueSet/detailed-race ValueSet (US Core detailed race codes). The request body was not captured in the comparison data, but two other POST $validate-code requests involving the same ValueSet (detailed-race) succeeded on both sides, suggesting this may be related to a specific combination of request parameters rather than the ValueSet itself.\n\n\nOnly 1 record in the comparison dataset exhibits this exact pattern. Searched:\n- `grep -c 'undefined|undefined' comparison.ndjson` → 1\n- All dev=500/prod=200 validate-code records → only this one\n- All detailed-race records → 3 total, 2 succeed on both sides\n\n\nTolerance `validate-code-crash-undefined-system-code` matches POST /r4/ValueSet/$validate-code where prod=200, dev=500, and dev error contains \"undefined|undefined\". Skips the record. Eliminates 1 record.\n\n\n6b937ddc-13c0-49e1-bd96-24ef10f06543", "body_html": "<p>Records-Impacted: 1<br>\nTolerance-ID: validate-code-crash-undefined-system-code<br>\nRecord-ID: 6b937ddc-13c0-49e1-bd96-24ef10f06543</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/ValueSet/$validate-code&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;coding&quot;,&quot;valueCoding&quot;:{&quot;system&quot;:&quot;urn:oid:2.16.840.1.113883.6.238&quot;,&quot;code&quot;:&quot;2108-9&quot;,&quot;display&quot;:&quot;EUROPEAN&quot;}},{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;url&quot;:&quot;http://hl7.org/fhir/us/core/ValueSet/detailed-race&quot;,&quot;version&quot;:&quot;6.1.0&quot;,&quot;status&quot;:&quot;active&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;valueSet&quot;:[&quot;http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.1.11.14914&quot;]},{&quot;valueSet&quot;:[&quot;http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1021.103&quot;]}],&quot;exclude&quot;:[{&quot;valueSet&quot;:[&quot;http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.3.2074.1.1.3&quot;]}]}}}]}&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$validate-code&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;coding&quot;,&quot;valueCoding&quot;:{&quot;system&quot;:&quot;urn:oid:2.16.840.1.113883.6.238&quot;,&quot;code&quot;:&quot;2108-9&quot;,&quot;display&quot;:&quot;EUROPEAN&quot;}},{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;url&quot;:&quot;http://hl7.org/fhir/us/core/ValueSet/detailed-race&quot;,&quot;version&quot;:&quot;6.1.0&quot;,&quot;status&quot;:&quot;active&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;valueSet&quot;:[&quot;http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.1.11.14914&quot;]},{&quot;valueSet&quot;:[&quot;http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1021.103&quot;]}],&quot;exclude&quot;:[{&quot;valueSet&quot;:[&quot;http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.3.2074.1.1.3&quot;]}]}}}]}&#x27;</code></pre>\n<p>Prod returns 200 with a Parameters response (result=false, with code system version details). Dev returns 500 with OperationOutcome <code>&quot;No Match for undefined|undefined&quot;</code>. The bug triggers when a ValueSet has <code>compose.exclude</code> entries with only a <code>valueSet</code> reference (no <code>system</code>); dev&#x27;s exclude-processing code path reads <code>cc.system</code> and <code>cc.version</code> as <code>undefined</code> from the exclude entry.</p>\n<p>Prod returns 200 with a successful $validate-code Parameters response (result=true, system=urn:oid:2.16.840.1.113883.6.238, code=2108-9, display=&quot;European&quot;, version=&quot;1.2&quot;). Dev returns 500 with an OperationOutcome error: &quot;No Match for undefined|undefined&quot;.</p>\n<p>The error message &quot;undefined|undefined&quot; indicates that dev failed to extract the system and code parameters from the POST request body, receiving them as JavaScript <code>undefined</code> values instead.</p>\n<p>The request is POST /r4/ValueSet/$validate-code against the <a href=\"http://hl7.org/fhir/us/core/ValueSet/detailed-race\" target=\"_blank\">http://hl7.org/fhir/us/core/ValueSet/detailed-race</a> ValueSet (US Core detailed race codes). The request body was not captured in the comparison data, but two other POST $validate-code requests involving the same ValueSet (detailed-race) succeeded on both sides, suggesting this may be related to a specific combination of request parameters rather than the ValueSet itself.</p>\n<p>Only 1 record in the comparison dataset exhibits this exact pattern. Searched:</p>\n<ul><li><code>grep -c &#x27;undefined|undefined&#x27; comparison.ndjson</code> → 1</li><li>All dev=500/prod=200 validate-code records → only this one</li><li>All detailed-race records → 3 total, 2 succeed on both sides</li></ul>\n<p>Tolerance <code>validate-code-crash-undefined-system-code</code> matches POST /r4/ValueSet/$validate-code where prod=200, dev=500, and dev error contains &quot;undefined|undefined&quot;. Skips the record. Eliminates 1 record.</p>\n<p>6b937ddc-13c0-49e1-bd96-24ef10f06543</p>", "impact": 1}, {"id": "16cbe05", "title": "Dev  includes warning-experimental expansion parameter that prod omits", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:37", "date_iso": "2026-02-08T13:37:59-06:00", "body_md": "Records-Impacted: 1\nTolerance-ID: expand-dev-warning-experimental-param\nRecord-ID: 5d1cbf41-db75-4663-8f3a-c492eb8a33aa\n\n\n```bash\ncurl -sL 'https://tx.fhir.org/r4/ValueSet/$expand?url=http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Flanguages&count=50' \\\n-H 'Accept: application/fhir+json'\n\ncurl -sL 'https://tx-dev.fhir.org/r4/ValueSet/$expand?url=http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Flanguages&count=50' \\\n-H 'Accept: application/fhir+json'\n```\n\nProd expansion parameters: `[\"count\", \"used-codesystem\"]`. Dev expansion parameters: `[\"warning-experimental\", \"count\", \"used-codesystem\"]`. Dev includes `{\"name\":\"warning-experimental\",\"valueUri\":\"http://hl7.org/fhir/ValueSet/languages|4.0.1\"}` that prod omits entirely.\n\n\nDev $expand for http://hl7.org/fhir/ValueSet/languages includes an extra expansion.parameter `{\"name\":\"warning-experimental\",\"valueUri\":\"http://hl7.org/fhir/ValueSet/languages|4.0.1\"}` that prod omits entirely.\n\nThe ValueSet has `experimental: true` in its metadata (both sides agree). Dev adds a `warning-experimental` parameter to the expansion to flag this fact; prod does not emit this warning parameter.\n\n\nOnly 1 record in the dataset contains this difference. Searched for:\n- `grep -c 'warning-experimental' comparison.ndjson` → 1\n- All expand records checked for dev-only `warning-*` parameters → only this one record\n- Prod never emits any `warning-*` expansion parameters in any record\n\nThe pattern is specific to this ValueSet, though the behavior could in principle affect any experimental ValueSet expansion.\n\n\nTolerance `expand-dev-warning-experimental-param` matches $expand responses (ValueSet resourceType) where dev has `warning-experimental` parameter and prod does not. Strips the extra parameter from dev. Eliminates 1 record.\n\n\n`5d1cbf41-db75-4663-8f3a-c492eb8a33aa` — GET /r4/ValueSet/$expand?url=http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Flanguages&count=50", "body_html": "<p>Records-Impacted: 1<br>\nTolerance-ID: expand-dev-warning-experimental-param<br>\nRecord-ID: 5d1cbf41-db75-4663-8f3a-c492eb8a33aa</p>\n<pre><code class=\"lang-bash\">curl -sL &#x27;https://tx.fhir.org/r4/ValueSet/$expand?url=http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Flanguages&amp;count=50&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27;\n\ncurl -sL &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand?url=http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Flanguages&amp;count=50&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27;</code></pre>\n<p>Prod expansion parameters: <code>[&quot;count&quot;, &quot;used-codesystem&quot;]</code>. Dev expansion parameters: <code>[&quot;warning-experimental&quot;, &quot;count&quot;, &quot;used-codesystem&quot;]</code>. Dev includes <code>{&quot;name&quot;:&quot;warning-experimental&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/ValueSet/languages|4.0.1&quot;}</code> that prod omits entirely.</p>\n<p>Dev $expand for <a href=\"http://hl7.org/fhir/ValueSet/languages\" target=\"_blank\">http://hl7.org/fhir/ValueSet/languages</a> includes an extra expansion.parameter <code>{&quot;name&quot;:&quot;warning-experimental&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/ValueSet/languages|4.0.1&quot;}</code> that prod omits entirely.</p>\n<p>The ValueSet has <code>experimental: true</code> in its metadata (both sides agree). Dev adds a <code>warning-experimental</code> parameter to the expansion to flag this fact; prod does not emit this warning parameter.</p>\n<p>Only 1 record in the dataset contains this difference. Searched for:</p>\n<ul><li><code>grep -c &#x27;warning-experimental&#x27; comparison.ndjson</code> → 1</li><li>All expand records checked for dev-only <code>warning-*</code> parameters → only this one record</li><li>Prod never emits any <code>warning-*</code> expansion parameters in any record</li></ul>\n<p>The pattern is specific to this ValueSet, though the behavior could in principle affect any experimental ValueSet expansion.</p>\n<p>Tolerance <code>expand-dev-warning-experimental-param</code> matches $expand responses (ValueSet resourceType) where dev has <code>warning-experimental</code> parameter and prod does not. Strips the extra parameter from dev. Eliminates 1 record.</p>\n<p><code>5d1cbf41-db75-4663-8f3a-c492eb8a33aa</code> — GET /r4/ValueSet/$expand?url=http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Flanguages&amp;count=50</p>", "impact": 1}, {"id": "516d895", "title": "UCUM error message formatting differs between prod and dev", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:38", "date_iso": "2026-02-08T13:38:00-06:00", "body_md": "Records-Impacted: 1\nTolerance-ID: ucum-error-message-format\nRecord-ID: 392830d5-650f-42a4-9149-a8f7a1246016\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$batch-validate-code' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"validation\",\"resource\":{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"system\",\"valueUri\":\"http://unitsofmeasure.org\"},{\"name\":\"code\",\"valueCode\":\"Torr\"}]}}]}'\n\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$batch-validate-code' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"validation\",\"resource\":{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"system\",\"valueUri\":\"http://unitsofmeasure.org\"},{\"name\":\"code\",\"valueCode\":\"Torr\"}]}}]}'\n```\n\nProd returns `Error processing Unit: 'Torr': The unit \"Torr\" is unknown at character 1`, dev returns `Error processing unit 'Torr': The unit 'Torr' is unknown at character 1`.\n\n\nUCUM $validate-code (via batch-validate-code) for unknown code \"Torr\": the informational OperationOutcome issue text for UCUM parsing errors has different formatting between prod and dev.\n\nProd: `Error processing Unit: 'Torr': The unit \"Torr\" is unknown at character 1`\nDev: `Error processing unit 'Torr': The unit 'Torr' is unknown at character 1`\n\nThree formatting differences:\n1. Capitalization: \"Unit:\" (prod) vs \"unit\" (dev)\n2. Punctuation: extra colon after unit name in prod (\"'Torr':\") vs none in dev (\"'Torr'\")\n3. Quoting style: escaped double quotes in prod (`\"Torr\"`) vs single quotes in dev (`'Torr'`)\n\nBoth agree on result=false, system, code, and the primary error message. The only difference is in this secondary informational issue text about UCUM parsing.\n\n\n1 record in the full comparison dataset. Searched with:\n- `grep -c 'Error processing Unit' comparison.ndjson` → 1\n- `grep -c 'Error processing unit' comparison.ndjson` → 1\n\nThis is a batch-validate-code request: POST /r4/ValueSet/$batch-validate-code\n\n\nTolerance ID: `ucum-error-message-format`. Matches batch-validate-code records for unitsofmeasure.org where nested validation issue text differs due to UCUM error message formatting. Normalizes dev issue text to prod value. Eliminates 1 record.\n\n\n392830d5-650f-42a4-9149-a8f7a1246016", "body_html": "<p>Records-Impacted: 1<br>\nTolerance-ID: ucum-error-message-format<br>\nRecord-ID: 392830d5-650f-42a4-9149-a8f7a1246016</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/ValueSet/$batch-validate-code&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;validation&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;system&quot;,&quot;valueUri&quot;:&quot;http://unitsofmeasure.org&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;Torr&quot;}]}}]}&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$batch-validate-code&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;validation&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;system&quot;,&quot;valueUri&quot;:&quot;http://unitsofmeasure.org&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;Torr&quot;}]}}]}&#x27;</code></pre>\n<p>Prod returns <code>Error processing Unit: &#x27;Torr&#x27;: The unit &quot;Torr&quot; is unknown at character 1</code>, dev returns <code>Error processing unit &#x27;Torr&#x27;: The unit &#x27;Torr&#x27; is unknown at character 1</code>.</p>\n<p>UCUM $validate-code (via batch-validate-code) for unknown code &quot;Torr&quot;: the informational OperationOutcome issue text for UCUM parsing errors has different formatting between prod and dev.</p>\n<p>Prod: <code>Error processing Unit: &#x27;Torr&#x27;: The unit &quot;Torr&quot; is unknown at character 1</code><br>\nDev: <code>Error processing unit &#x27;Torr&#x27;: The unit &#x27;Torr&#x27; is unknown at character 1</code></p>\n<p>Three formatting differences:</p>\n<ol><li>Capitalization: &quot;Unit:&quot; (prod) vs &quot;unit&quot; (dev)</li><li>Punctuation: extra colon after unit name in prod (&quot;&#x27;Torr&#x27;:&quot;) vs none in dev (&quot;&#x27;Torr&#x27;&quot;)</li><li>Quoting style: escaped double quotes in prod (<code>&quot;Torr&quot;</code>) vs single quotes in dev (<code>&#x27;Torr&#x27;</code>)</li></ol>\n<p>Both agree on result=false, system, code, and the primary error message. The only difference is in this secondary informational issue text about UCUM parsing.</p>\n<p>1 record in the full comparison dataset. Searched with:</p>\n<ul><li><code>grep -c &#x27;Error processing Unit&#x27; comparison.ndjson</code> → 1</li><li><code>grep -c &#x27;Error processing unit&#x27; comparison.ndjson</code> → 1</li></ul>\n<p>This is a batch-validate-code request: POST /r4/ValueSet/$batch-validate-code</p>\n<p>Tolerance ID: <code>ucum-error-message-format</code>. Matches batch-validate-code records for unitsofmeasure.org where nested validation issue text differs due to UCUM error message formatting. Normalizes dev issue text to prod value. Eliminates 1 record.</p>\n<p>392830d5-650f-42a4-9149-a8f7a1246016</p>", "impact": 1}, {"id": "dfd179a", "title": "Dev fails to process VSAC ValueSets with vsacOpModifier extension", "status": "open", "labels": ["content-differs", "reproduced", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:37", "date_iso": "2026-02-08T13:37:59-06:00", "body_md": "Dev returns a generic error \"Cannot process resource at \\\"exclude[0].filter\\\" due to the presence of the modifier extension vsacOpModifier\" instead of processing VSAC ValueSets that use the vsacOpModifier extension in their exclude filters.\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$validate-code?url=http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.4.642.40.2.48.1|20250419&system=urn:oid:2.16.840.1.113883.6.238&code=2184-0&display=Dominican' -H 'Accept: application/fhir+json'\n\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$validate-code?url=http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.4.642.40.2.48.1|20250419&system=urn:oid:2.16.840.1.113883.6.238&code=2184-0&display=Dominican' -H 'Accept: application/fhir+json'\n```\n\n**Expected (prod)**: `result: false` with specific errors — \"CodeSystem version '1.3' could not be found\" and \"code not found in value set\".\n**Actual (dev)**: `result: false` with generic error — \"Cannot process resource at \\\"exclude[0].filter\\\" due to the presence of the modifier extension vsacOpModifier\".\n\nAlso reproducible with codes `2148-5` (Mexican) and `2151-9` (Chicano) against the same ValueSet.\n\n**What differs**: When validating codes against VSAC ValueSets that use vsacOpModifier, prod processes the ValueSet and returns proper validation results (e.g., unknown codesystem version, not-in-valueset issues), while dev bails out at ValueSet processing with a business-rule error about the modifier extension. Both return result=false, but for completely different reasons — prod gives specific, correct error details while dev gives a generic \"cannot process\" error.\n\n**How widespread**: 3 records in the delta file, all POST /r4/ValueSet/$validate-code, all involving the same VSAC ValueSet (http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.4.642.40.2.48.1|20250419) with system urn:oid:2.16.840.1.113883.6.238.\n\nSearch: grep -c 'vsacOpModifier' results/deltas/deltas.ndjson → 3\n\n**Tolerance**: `vsac-modifier-extension-error` (temp-tolerance) matches validate-code records where dev's message contains \"vsacOpModifier\". Eliminates 3 records.\n\n**Representative record**: 64ff24e8-e8ff-456c-a0ed-0f222b9454fb\n\n---", "body_html": "<p>Dev returns a generic error &quot;Cannot process resource at \\&quot;exclude[0].filter\\&quot; due to the presence of the modifier extension vsacOpModifier&quot; instead of processing VSAC ValueSets that use the vsacOpModifier extension in their exclude filters.</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/ValueSet/$validate-code?url=http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.4.642.40.2.48.1|20250419&amp;system=urn:oid:2.16.840.1.113883.6.238&amp;code=2184-0&amp;display=Dominican&#x27; -H &#x27;Accept: application/fhir+json&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$validate-code?url=http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.4.642.40.2.48.1|20250419&amp;system=urn:oid:2.16.840.1.113883.6.238&amp;code=2184-0&amp;display=Dominican&#x27; -H &#x27;Accept: application/fhir+json&#x27;</code></pre>\n<p><strong>Expected (prod)</strong>: <code>result: false</code> with specific errors — &quot;CodeSystem version &#x27;1.3&#x27; could not be found&quot; and &quot;code not found in value set&quot;.<br>\n<strong>Actual (dev)</strong>: <code>result: false</code> with generic error — &quot;Cannot process resource at \\&quot;exclude[0].filter\\&quot; due to the presence of the modifier extension vsacOpModifier&quot;.</p>\n<p>Also reproducible with codes <code>2148-5</code> (Mexican) and <code>2151-9</code> (Chicano) against the same ValueSet.</p>\n<p><strong>What differs</strong>: When validating codes against VSAC ValueSets that use vsacOpModifier, prod processes the ValueSet and returns proper validation results (e.g., unknown codesystem version, not-in-valueset issues), while dev bails out at ValueSet processing with a business-rule error about the modifier extension. Both return result=false, but for completely different reasons — prod gives specific, correct error details while dev gives a generic &quot;cannot process&quot; error.</p>\n<p><strong>How widespread</strong>: 3 records in the delta file, all POST /r4/ValueSet/$validate-code, all involving the same VSAC ValueSet (<a href=\"http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.4.642.40.2.48.1|20250419\" target=\"_blank\">http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.4.642.40.2.48.1|20250419</a>) with system urn:oid:2.16.840.1.113883.6.238.</p>\n<p>Search: grep -c &#x27;vsacOpModifier&#x27; results/deltas/deltas.ndjson → 3</p>\n<p><strong>Tolerance</strong>: <code>vsac-modifier-extension-error</code> (temp-tolerance) matches validate-code records where dev&#x27;s message contains &quot;vsacOpModifier&quot;. Eliminates 3 records.</p>\n<p><strong>Representative record</strong>: 64ff24e8-e8ff-456c-a0ed-0f222b9454fb</p>\n<hr>", "impact": null}, {"id": "a62854a", "title": "Dev $expand returns empty string id on ValueSet response", "status": "closed", "labels": ["content-differs", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:38", "date_iso": "2026-02-08T13:38:00-06:00", "body_md": "Records-Impacted: 690\nTolerance-ID: expand-dev-empty-id\nRecord-ID: 2bbd9519-3a6b-4f55-8309-745d9f1b16a7\n\n\nAttempted to reproduce on 2026-02-07 but the bug appears to have been **fixed** on tx-dev.fhir.org since the data was collected (2026-02-06).\n\nTried 4 different $expand POST requests — none returned `\"id\":\"\"` from dev:\n\n```bash\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$expand' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"status\":\"active\",\"compose\":{\"include\":[{\"system\":\"http://snomed.info/sct\",\"concept\":[{\"code\":\"160245001\"}]}]}}}]}'\n\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$expand' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/ValueSet/medicationrequest-category\"}]}'\n\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$expand' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"compose\":{\"include\":[{\"system\":\"http://loinc.org\",\"concept\":[{\"code\":\"8480-6\"}]}]}}}]}'\n```\n\nAll three return a ValueSet without `\"id\":\"\"`. Both inline and registered ValueSet expansions now omit `id` entirely, matching prod behavior.\n\n**Status**: No longer reproducible — likely fixed between 2026-02-06 and 2026-02-07.\n\nDev $expand responses include `\"id\": \"\"` at the top level of the returned ValueSet resource. Prod does not include an `id` field at all.\n\n\nIn all 690 $expand delta records where dev returns a successful ValueSet expansion, the dev response includes `\"id\": \"\"` (an empty string). Prod omits the `id` field entirely, which is the correct behavior — per FHIR, string values must be non-empty if present. An empty string `\"\"` is invalid FHIR.\n\nThis affects all POST /r4/ValueSet/$expand records across all code systems (SNOMED, LOINC, ICD, etc.) — it's not specific to any particular ValueSet or code system.\n\n\n```bash\ngrep '\"op\":\"expand\"' jobs/2026-02-round-1/results/deltas/deltas.ndjson | python3 -c \"\nimport json, sys\nfor line in sys.stdin:\n  rec = json.loads(line)\n  dev = json.loads(rec.get('devBody','{}'))\n  if dev.get('id') == '': print(rec['id'])\n\" | wc -l\n```\n\n\n**Dev** (incorrect):\n```json\n{\"resourceType\":\"ValueSet\",\"status\":\"active\",\"id\":\"\",\"expansion\":{...}}\n```\n\n**Prod** (correct):\n```json\n{\"resourceType\":\"ValueSet\",\"status\":\"active\",\"expansion\":{...}}\n```", "body_html": "<p>Records-Impacted: 690<br>\nTolerance-ID: expand-dev-empty-id<br>\nRecord-ID: 2bbd9519-3a6b-4f55-8309-745d9f1b16a7</p>\n<p>Attempted to reproduce on 2026-02-07 but the bug appears to have been <strong>fixed</strong> on tx-dev.fhir.org since the data was collected (2026-02-06).</p>\n<p>Tried 4 different $expand POST requests — none returned <code>&quot;id&quot;:&quot;&quot;</code> from dev:</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;status&quot;:&quot;active&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;http://snomed.info/sct&quot;,&quot;concept&quot;:[{&quot;code&quot;:&quot;160245001&quot;}]}]}}}]}&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/ValueSet/medicationrequest-category&quot;}]}&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;http://loinc.org&quot;,&quot;concept&quot;:[{&quot;code&quot;:&quot;8480-6&quot;}]}]}}}]}&#x27;</code></pre>\n<p>All three return a ValueSet without <code>&quot;id&quot;:&quot;&quot;</code>. Both inline and registered ValueSet expansions now omit <code>id</code> entirely, matching prod behavior.</p>\n<p><strong>Status</strong>: No longer reproducible — likely fixed between 2026-02-06 and 2026-02-07.</p>\n<p>Dev $expand responses include <code>&quot;id&quot;: &quot;&quot;</code> at the top level of the returned ValueSet resource. Prod does not include an <code>id</code> field at all.</p>\n<p>In all 690 $expand delta records where dev returns a successful ValueSet expansion, the dev response includes <code>&quot;id&quot;: &quot;&quot;</code> (an empty string). Prod omits the <code>id</code> field entirely, which is the correct behavior — per FHIR, string values must be non-empty if present. An empty string <code>&quot;&quot;</code> is invalid FHIR.</p>\n<p>This affects all POST /r4/ValueSet/$expand records across all code systems (SNOMED, LOINC, ICD, etc.) — it&#x27;s not specific to any particular ValueSet or code system.</p>\n<pre><code class=\"lang-bash\">grep &#x27;&quot;op&quot;:&quot;expand&quot;&#x27; jobs/2026-02-round-1/results/deltas/deltas.ndjson | python3 -c &quot;\nimport json, sys\nfor line in sys.stdin:\n  rec = json.loads(line)\n  dev = json.loads(rec.get(&#x27;devBody&#x27;,&#x27;{}&#x27;))\n  if dev.get(&#x27;id&#x27;) == &#x27;&#x27;: print(rec[&#x27;id&#x27;])\n&quot; | wc -l</code></pre>\n<p><strong>Dev</strong> (incorrect):</p>\n<pre><code class=\"lang-json\">{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;status&quot;:&quot;active&quot;,&quot;id&quot;:&quot;&quot;,&quot;expansion&quot;:{...}}</code></pre>\n<p><strong>Prod</strong> (correct):</p>\n<pre><code class=\"lang-json\">{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;status&quot;:&quot;active&quot;,&quot;expansion&quot;:{...}}</code></pre>", "impact": 690}, {"id": "2cdb0d3", "title": "Dev $expand echoes includeDefinition=false parameter in expansion", "status": "closed", "labels": ["content-differs", "reproduced", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:38", "date_iso": "2026-02-08T13:38:00-06:00", "body_md": "Records-Impacted: 677\nTolerance-ID: expand-dev-includeDefinition-param\nRecord-ID: 2bbd9519-3a6b-4f55-8309-745d9f1b16a7\n\n\n```bash\ncurl -s \"https://tx.fhir.org/r4/ValueSet/\\$expand\" \\\n-H \"Accept: application/fhir+json\" \\\n-H \"Content-Type: application/fhir+json\" \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/ValueSet/observation-status\"},{\"name\":\"excludeNested\",\"valueBoolean\":true},{\"name\":\"includeDefinition\",\"valueBoolean\":false}]}'\n\ncurl -s \"https://tx-dev.fhir.org/r4/ValueSet/\\$expand\" \\\n-H \"Accept: application/fhir+json\" \\\n-H \"Content-Type: application/fhir+json\" \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/ValueSet/observation-status\"},{\"name\":\"excludeNested\",\"valueBoolean\":true},{\"name\":\"includeDefinition\",\"valueBoolean\":false}]}'\n```\n\nProd expansion.parameter: `[excludeNested, used-codesystem]` — no includeDefinition.\nDev expansion.parameter: `[excludeNested, includeDefinition, used-codesystem]` — echoes `{\"name\":\"includeDefinition\",\"valueBoolean\":false}`.\n\nDev $expand responses include an extra `includeDefinition` parameter (value: false) in the expansion.parameter array. Prod does not include this parameter.\n\n\nIn 677 of the 893 $expand delta records, dev includes `{\"name\":\"includeDefinition\",\"valueBoolean\":false}` in the `expansion.parameter` array. Prod omits this parameter entirely.\n\nThe `includeDefinition` parameter is an input parameter to the $expand operation. While it's valid to echo input parameters in the expansion.parameter array, prod doesn't do it for this parameter (presumably because false is the default). This is a behavioral difference — not a conformance violation per se, but a real difference in what the servers return.\n\n\n```bash\ngrep '\"op\":\"expand\"' jobs/2026-02-round-1/results/deltas/deltas.ndjson | python3 -c \"\nimport json, sys\nfor line in sys.stdin:\n  rec = json.loads(line)\n  dev = json.loads(rec.get('devBody','{}'))\n  params = dev.get('expansion',{}).get('parameter',[])\n  if any(p.get('name')=='includeDefinition' for p in params): print(rec['id'])\n\" | wc -l\n```\n\n\n**Dev** includes extra parameter:\n```json\n\"parameter\": [\n{\"name\":\"excludeNested\",\"valueBoolean\":true},\n{\"name\":\"includeDefinition\",\"valueBoolean\":false},\n{\"name\":\"offset\",\"valueInteger\":0},\n...\n]\n```\n\n**Prod** omits it:\n```json\n\"parameter\": [\n{\"name\":\"excludeNested\",\"valueBoolean\":true},\n{\"name\":\"offset\",\"valueInteger\":0},\n...\n]\n```", "body_html": "<p>Records-Impacted: 677<br>\nTolerance-ID: expand-dev-includeDefinition-param<br>\nRecord-ID: 2bbd9519-3a6b-4f55-8309-745d9f1b16a7</p>\n<pre><code class=\"lang-bash\">curl -s &quot;https://tx.fhir.org/r4/ValueSet/\\$expand&quot; \\\n-H &quot;Accept: application/fhir+json&quot; \\\n-H &quot;Content-Type: application/fhir+json&quot; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/ValueSet/observation-status&quot;},{&quot;name&quot;:&quot;excludeNested&quot;,&quot;valueBoolean&quot;:true},{&quot;name&quot;:&quot;includeDefinition&quot;,&quot;valueBoolean&quot;:false}]}&#x27;\n\ncurl -s &quot;https://tx-dev.fhir.org/r4/ValueSet/\\$expand&quot; \\\n-H &quot;Accept: application/fhir+json&quot; \\\n-H &quot;Content-Type: application/fhir+json&quot; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/ValueSet/observation-status&quot;},{&quot;name&quot;:&quot;excludeNested&quot;,&quot;valueBoolean&quot;:true},{&quot;name&quot;:&quot;includeDefinition&quot;,&quot;valueBoolean&quot;:false}]}&#x27;</code></pre>\n<p>Prod expansion.parameter: <code>[excludeNested, used-codesystem]</code> — no includeDefinition.<br>\nDev expansion.parameter: <code>[excludeNested, includeDefinition, used-codesystem]</code> — echoes <code>{&quot;name&quot;:&quot;includeDefinition&quot;,&quot;valueBoolean&quot;:false}</code>.</p>\n<p>Dev $expand responses include an extra <code>includeDefinition</code> parameter (value: false) in the expansion.parameter array. Prod does not include this parameter.</p>\n<p>In 677 of the 893 $expand delta records, dev includes <code>{&quot;name&quot;:&quot;includeDefinition&quot;,&quot;valueBoolean&quot;:false}</code> in the <code>expansion.parameter</code> array. Prod omits this parameter entirely.</p>\n<p>The <code>includeDefinition</code> parameter is an input parameter to the $expand operation. While it&#x27;s valid to echo input parameters in the expansion.parameter array, prod doesn&#x27;t do it for this parameter (presumably because false is the default). This is a behavioral difference — not a conformance violation per se, but a real difference in what the servers return.</p>\n<pre><code class=\"lang-bash\">grep &#x27;&quot;op&quot;:&quot;expand&quot;&#x27; jobs/2026-02-round-1/results/deltas/deltas.ndjson | python3 -c &quot;\nimport json, sys\nfor line in sys.stdin:\n  rec = json.loads(line)\n  dev = json.loads(rec.get(&#x27;devBody&#x27;,&#x27;{}&#x27;))\n  params = dev.get(&#x27;expansion&#x27;,{}).get(&#x27;parameter&#x27;,[])\n  if any(p.get(&#x27;name&#x27;)==&#x27;includeDefinition&#x27; for p in params): print(rec[&#x27;id&#x27;])\n&quot; | wc -l</code></pre>\n<p><strong>Dev</strong> includes extra parameter:</p>\n<pre><code class=\"lang-json\">&quot;parameter&quot;: [\n{&quot;name&quot;:&quot;excludeNested&quot;,&quot;valueBoolean&quot;:true},\n{&quot;name&quot;:&quot;includeDefinition&quot;,&quot;valueBoolean&quot;:false},\n{&quot;name&quot;:&quot;offset&quot;,&quot;valueInteger&quot;:0},\n...\n]</code></pre>\n<p><strong>Prod</strong> omits it:</p>\n<pre><code class=\"lang-json\">&quot;parameter&quot;: [\n{&quot;name&quot;:&quot;excludeNested&quot;,&quot;valueBoolean&quot;:true},\n{&quot;name&quot;:&quot;offset&quot;,&quot;valueInteger&quot;:0},\n...\n]</code></pre>", "impact": 677}, {"id": "4fa9a6e", "title": "Searchset Bundle formatting: empty entry array, extra pagination links, absolute URLs", "status": "closed", "labels": ["P6", "reproduced", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:38", "date_iso": "2026-02-08T13:38:00-06:00", "body_md": "Records-Impacted: 491\nTolerance-ID: searchset-bundle-format\nRecord-ID: c97f36a4-973b-42c5-8b6d-58464195cfd5\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/ValueSet?_format=json&url=http%3A%2F%2Fwww.rsna.org%2FRadLex_Playbook.aspx' \\\n-H 'Accept: application/fhir+json'\n\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet?_format=json&url=http%3A%2F%2Fwww.rsna.org%2FRadLex_Playbook.aspx' \\\n-H 'Accept: application/fhir+json'\n```\n\nProd returns a searchset Bundle with `total: 0`, no `entry` field, a single `self` link with a relative URL, and server-generated `id`/`meta.lastUpdated`. Dev returns a searchset Bundle with `total: 0`, an empty `entry: []` array, three links (`self`/`first`/`last`) with absolute URLs and `_offset=0`, and no `id` or `meta`.\n\n\nDev's searchset Bundle responses differ from prod in several ways:\n\n1. **`entry: []` on empty results**: When a search returns no results (total: 0), dev includes `entry: []` (an empty array). Prod omits the entry field entirely. Empty arrays violate FHIR's general rule that arrays, if present, must be non-empty.\n\n2. **Extra pagination link relations**: Dev returns `self`, `first`, and `last` link relations. Prod returns only `self`. This applies to both empty and non-empty search results.\n\n3. **Absolute vs relative link URLs**: Dev uses absolute URLs with full host prefix (e.g., `http://tx.fhir.org/r4/ValueSet?...&_offset=0`). Prod uses relative URLs (e.g., `ValueSet?&url=...`). Dev also appends `_offset=0` to search links.\n\n4. **Server-generated metadata**: Prod includes `id` and `meta.lastUpdated` on searchset Bundles. Dev omits these. (This is server-generated transient metadata and is the least significant difference.)\n\n\nAffects all searchset Bundle responses for ValueSet and CodeSystem searches:\n- 337 empty ValueSet search Bundles\n- 154 empty CodeSystem search Bundles\n- 7 non-empty searchset Bundles (these also have the extra links, and may have other substantive differences like total count disagreements)\n\nTotal: **498 records** in the deltas file.\n\nSearch used: Parsed all records with `ValueSet?` or `CodeSystem?` in the URL where prodBody contains a Bundle with type \"searchset\".\n\n\n- `c97f36a4-973b-42c5-8b6d-58464195cfd5` (empty ValueSet search, RadLex Playbook)\n- `4ab7655f-015d-4f44-b184-5ba0fd256926` (empty ValueSet search, DICOM)\n- `640875e4-3839-40d1-aaa1-0bf79bef77f2` (non-empty CodeSystem search, USPS)\n\n---", "body_html": "<p>Records-Impacted: 491<br>\nTolerance-ID: searchset-bundle-format<br>\nRecord-ID: c97f36a4-973b-42c5-8b6d-58464195cfd5</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/ValueSet?_format=json&amp;url=http%3A%2F%2Fwww.rsna.org%2FRadLex_Playbook.aspx&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet?_format=json&amp;url=http%3A%2F%2Fwww.rsna.org%2FRadLex_Playbook.aspx&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27;</code></pre>\n<p>Prod returns a searchset Bundle with <code>total: 0</code>, no <code>entry</code> field, a single <code>self</code> link with a relative URL, and server-generated <code>id</code>/<code>meta.lastUpdated</code>. Dev returns a searchset Bundle with <code>total: 0</code>, an empty <code>entry: []</code> array, three links (<code>self</code>/<code>first</code>/<code>last</code>) with absolute URLs and <code>_offset=0</code>, and no <code>id</code> or <code>meta</code>.</p>\n<p>Dev&#x27;s searchset Bundle responses differ from prod in several ways:</p>\n<ol><li>**<code>entry: []</code> on empty results**: When a search returns no results (total: 0), dev includes <code>entry: []</code> (an empty array). Prod omits the entry field entirely. Empty arrays violate FHIR&#x27;s general rule that arrays, if present, must be non-empty.</li></ol>\n<ol><li><strong>Extra pagination link relations</strong>: Dev returns <code>self</code>, <code>first</code>, and <code>last</code> link relations. Prod returns only <code>self</code>. This applies to both empty and non-empty search results.</li></ol>\n<ol><li><strong>Absolute vs relative link URLs</strong>: Dev uses absolute URLs with full host prefix (e.g., <code>http://tx.fhir.org/r4/ValueSet?...&amp;_offset=0</code>). Prod uses relative URLs (e.g., <code>ValueSet?&amp;url=...</code>). Dev also appends <code>_offset=0</code> to search links.</li></ol>\n<ol><li><strong>Server-generated metadata</strong>: Prod includes <code>id</code> and <code>meta.lastUpdated</code> on searchset Bundles. Dev omits these. (This is server-generated transient metadata and is the least significant difference.)</li></ol>\n<p>Affects all searchset Bundle responses for ValueSet and CodeSystem searches:</p>\n<ul><li>337 empty ValueSet search Bundles</li><li>154 empty CodeSystem search Bundles</li><li>7 non-empty searchset Bundles (these also have the extra links, and may have other substantive differences like total count disagreements)</li></ul>\n<p>Total: <strong>498 records</strong> in the deltas file.</p>\n<p>Search used: Parsed all records with <code>ValueSet?</code> or <code>CodeSystem?</code> in the URL where prodBody contains a Bundle with type &quot;searchset&quot;.</p>\n<ul><li><code>c97f36a4-973b-42c5-8b6d-58464195cfd5</code> (empty ValueSet search, RadLex Playbook)</li><li><code>4ab7655f-015d-4f44-b184-5ba0fd256926</code> (empty ValueSet search, DICOM)</li><li><code>640875e4-3839-40d1-aaa1-0bf79bef77f2</code> (non-empty CodeSystem search, USPS)</li></ul>\n<hr>", "impact": 491}, {"id": "1fff165", "title": "Dev returns empty-string expression/location in OperationOutcome issues", "status": "closed", "labels": ["P6", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:38", "date_iso": "2026-02-08T13:38:00-06:00", "body_md": "Records-Impacted: 318\nTolerance-ID: dev-empty-string-expression-location\nRecord-ID: 7de52d92-3166-495e-ac5e-af262b1019e4\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$validate-code' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/ValueSet/observation-vitalsignresult\"},{\"name\":\"codeableConcept\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"http://loinc.org\",\"code\":\"109691-6\",\"display\":\"Influenza virus A Ag [Measurement] in Nasopharynx\"}]}}]}'\n\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$validate-code' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/ValueSet/observation-vitalsignresult\"},{\"name\":\"codeableConcept\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"http://loinc.org\",\"code\":\"109691-6\",\"display\":\"Influenza virus A Ag [Measurement] in Nasopharynx\"}]}}]}'\n```\n\nAt data collection time, prod omitted `expression` and `location` on the TX_GENERAL_CC_ERROR_MESSAGE issue (correct), while dev returned `\"expression\": [\"\"]` and `\"location\": [\"\"]` (invalid FHIR). As of 2026-02-07, dev no longer returns the empty-string fields — the bug appears fixed on the current dev server.\n\nDev returns `\"expression\": [\"\"]` and `\"location\": [\"\"]` on certain OperationOutcome issue entries in $validate-code responses, where prod correctly omits these fields entirely.\n\n\nIn $validate-code responses (both ValueSet and CodeSystem), dev includes `\"expression\": [\"\"]` and `\"location\": [\"\"]` on OperationOutcome issue entries that have no specific FHIRPath location. Prod omits these fields entirely, which is correct — FHIR requires strings to be non-empty if present. The empty string `\"\"` is invalid FHIR.\n\nThis occurs on issues with these message IDs:\n- TX_GENERAL_CC_ERROR_MESSAGE (311 records)\n- MSG_DRAFT (4 records)\n- MSG_DEPRECATED (3 records)\n\n\n318 delta records show this pattern. All are $validate-code operations (both ValueSet/$validate-code and CodeSystem/$validate-code), all P6 priority.\n\nSearch: examined all records in deltas.ndjson where dev OperationOutcome issues contain empty-string expression or location arrays.\n\n\nTolerance ID: `dev-empty-string-expression-location`. Normalizes by removing `expression: [\"\"]` and `location: [\"\"]` from OperationOutcome issues in dev responses, matching what prod does (omit the fields). This is a normalize tolerance (not skip) so other differences in these records still surface.\n\n\n- `7de52d92-3166-495e-ac5e-af262b1019e4` (ValueSet/$validate-code, TX_GENERAL_CC_ERROR_MESSAGE)\n- `dcdd2b94-db9...` (CodeSystem/$validate-code, TX_GENERAL_CC_ERROR_MESSAGE)", "body_html": "<p>Records-Impacted: 318<br>\nTolerance-ID: dev-empty-string-expression-location<br>\nRecord-ID: 7de52d92-3166-495e-ac5e-af262b1019e4</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/ValueSet/$validate-code&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/ValueSet/observation-vitalsignresult&quot;},{&quot;name&quot;:&quot;codeableConcept&quot;,&quot;valueCodeableConcept&quot;:{&quot;coding&quot;:[{&quot;system&quot;:&quot;http://loinc.org&quot;,&quot;code&quot;:&quot;109691-6&quot;,&quot;display&quot;:&quot;Influenza virus A Ag [Measurement] in Nasopharynx&quot;}]}}]}&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$validate-code&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/ValueSet/observation-vitalsignresult&quot;},{&quot;name&quot;:&quot;codeableConcept&quot;,&quot;valueCodeableConcept&quot;:{&quot;coding&quot;:[{&quot;system&quot;:&quot;http://loinc.org&quot;,&quot;code&quot;:&quot;109691-6&quot;,&quot;display&quot;:&quot;Influenza virus A Ag [Measurement] in Nasopharynx&quot;}]}}]}&#x27;</code></pre>\n<p>At data collection time, prod omitted <code>expression</code> and <code>location</code> on the TX_GENERAL_CC_ERROR_MESSAGE issue (correct), while dev returned <code>&quot;expression&quot;: [&quot;&quot;]</code> and <code>&quot;location&quot;: [&quot;&quot;]</code> (invalid FHIR). As of 2026-02-07, dev no longer returns the empty-string fields — the bug appears fixed on the current dev server.</p>\n<p>Dev returns <code>&quot;expression&quot;: [&quot;&quot;]</code> and <code>&quot;location&quot;: [&quot;&quot;]</code> on certain OperationOutcome issue entries in $validate-code responses, where prod correctly omits these fields entirely.</p>\n<p>In $validate-code responses (both ValueSet and CodeSystem), dev includes <code>&quot;expression&quot;: [&quot;&quot;]</code> and <code>&quot;location&quot;: [&quot;&quot;]</code> on OperationOutcome issue entries that have no specific FHIRPath location. Prod omits these fields entirely, which is correct — FHIR requires strings to be non-empty if present. The empty string <code>&quot;&quot;</code> is invalid FHIR.</p>\n<p>This occurs on issues with these message IDs:</p>\n<ul><li>TX_GENERAL_CC_ERROR_MESSAGE (311 records)</li><li>MSG_DRAFT (4 records)</li><li>MSG_DEPRECATED (3 records)</li></ul>\n<p>318 delta records show this pattern. All are $validate-code operations (both ValueSet/$validate-code and CodeSystem/$validate-code), all P6 priority.</p>\n<p>Search: examined all records in deltas.ndjson where dev OperationOutcome issues contain empty-string expression or location arrays.</p>\n<p>Tolerance ID: <code>dev-empty-string-expression-location</code>. Normalizes by removing <code>expression: [&quot;&quot;]</code> and <code>location: [&quot;&quot;]</code> from OperationOutcome issues in dev responses, matching what prod does (omit the fields). This is a normalize tolerance (not skip) so other differences in these records still surface.</p>\n<ul><li><code>7de52d92-3166-495e-ac5e-af262b1019e4</code> (ValueSet/$validate-code, TX_GENERAL_CC_ERROR_MESSAGE)</li><li><code>dcdd2b94-db9...</code> (CodeSystem/$validate-code, TX_GENERAL_CC_ERROR_MESSAGE)</li></ul>", "impact": 318}, {"id": "0d164f0", "title": "Dev returns 404 instead of 422 for  when referenced CodeSystem is not found", "status": "closed", "labels": ["P4", "reproduced", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:38", "date_iso": "2026-02-08T13:38:00-06:00", "body_md": "Records-Impacted: 296\nTolerance-ID: expand-422-vs-404-codesystem-not-found\nRecord-ID: eee2c985-52e0-4520-b4e4-01766ede5a7d\n\n\n```bash\ncurl -s -w '\\nHTTP Status: %{http_code}\\n' 'https://tx.fhir.org/r4/ValueSet/$expand' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"compose\":{\"include\":[{\"system\":\"http://ontariohealth.ca/fhir/questionnaire/CodeSystem/breastSiteCodes\"}]}}}]}'\n\ncurl -s -w '\\nHTTP Status: %{http_code}\\n' 'https://tx-dev.fhir.org/r4/ValueSet/$expand' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"compose\":{\"include\":[{\"system\":\"http://ontariohealth.ca/fhir/questionnaire/CodeSystem/breastSiteCodes\"}]}}}]}'\n```\n\nProd returns HTTP 422, dev returns HTTP 404. Both return the same OperationOutcome error: \"A definition for CodeSystem '...' could not be found, so the value set cannot be expanded\".\n\n\nWhen a ValueSet $expand fails because a referenced CodeSystem definition cannot be found, prod returns HTTP 422 (Unprocessable Entity) while dev returns HTTP 404 (Not Found). The OperationOutcome error message is identical on both sides: \"A definition for CodeSystem '...' could not be found, so the value set cannot be expanded\". The issue code is `not-found` in both cases.\n\nAdditionally, dev includes `location: [null]` and `expression: [null]` arrays in the OperationOutcome issue (prod omits these), and dev omits the `text` narrative element that prod includes. These are secondary cosmetic differences; the primary issue is the status code mismatch.\n\n\n296 records in this comparison batch. All are POST /r4/ValueSet/$expand operations where the error message contains \"could not be found, so the value set cannot be expanded\".\n\nSearch: `grep '\"prodStatus\":422,\"devStatus\":404' jobs/2026-02-round-1/results/deltas/deltas.ndjson | wc -l` → 296\n\nAll 296 have:\n- Operation: POST /r4/ValueSet/$expand\n- Prod status: 422\n- Dev status: 404\n- OperationOutcome issue code: not-found\n- Identical error message text\n\n\nTolerance ID: `expand-422-vs-404-codesystem-not-found`\nMatches: POST /r4/ValueSet/$expand where prodStatus=422 and devStatus=404, and the OperationOutcome contains \"could not be found, so the value set cannot be expanded\".\nNormalizes: status code difference, strips null location/expression arrays from dev, strips text narrative from prod. Compares remaining OperationOutcome content.\nAffects: 296 records.\n\n\nID: eee2c985-52e0-4520-b4e4-01766ede5a7d\n\n---", "body_html": "<p>Records-Impacted: 296<br>\nTolerance-ID: expand-422-vs-404-codesystem-not-found<br>\nRecord-ID: eee2c985-52e0-4520-b4e4-01766ede5a7d</p>\n<pre><code class=\"lang-bash\">curl -s -w &#x27;\\nHTTP Status: %{http_code}\\n&#x27; &#x27;https://tx.fhir.org/r4/ValueSet/$expand&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;http://ontariohealth.ca/fhir/questionnaire/CodeSystem/breastSiteCodes&quot;}]}}}]}&#x27;\n\ncurl -s -w &#x27;\\nHTTP Status: %{http_code}\\n&#x27; &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;http://ontariohealth.ca/fhir/questionnaire/CodeSystem/breastSiteCodes&quot;}]}}}]}&#x27;</code></pre>\n<p>Prod returns HTTP 422, dev returns HTTP 404. Both return the same OperationOutcome error: &quot;A definition for CodeSystem &#x27;...&#x27; could not be found, so the value set cannot be expanded&quot;.</p>\n<p>When a ValueSet $expand fails because a referenced CodeSystem definition cannot be found, prod returns HTTP 422 (Unprocessable Entity) while dev returns HTTP 404 (Not Found). The OperationOutcome error message is identical on both sides: &quot;A definition for CodeSystem &#x27;...&#x27; could not be found, so the value set cannot be expanded&quot;. The issue code is <code>not-found</code> in both cases.</p>\n<p>Additionally, dev includes <code>location: [null]</code> and <code>expression: [null]</code> arrays in the OperationOutcome issue (prod omits these), and dev omits the <code>text</code> narrative element that prod includes. These are secondary cosmetic differences; the primary issue is the status code mismatch.</p>\n<p>296 records in this comparison batch. All are POST /r4/ValueSet/$expand operations where the error message contains &quot;could not be found, so the value set cannot be expanded&quot;.</p>\n<p>Search: <code>grep &#x27;&quot;prodStatus&quot;:422,&quot;devStatus&quot;:404&#x27; jobs/2026-02-round-1/results/deltas/deltas.ndjson | wc -l</code> → 296</p>\n<p>All 296 have:</p>\n<ul><li>Operation: POST /r4/ValueSet/$expand</li><li>Prod status: 422</li><li>Dev status: 404</li><li>OperationOutcome issue code: not-found</li><li>Identical error message text</li></ul>\n<p>Tolerance ID: <code>expand-422-vs-404-codesystem-not-found</code><br>\nMatches: POST /r4/ValueSet/$expand where prodStatus=422 and devStatus=404, and the OperationOutcome contains &quot;could not be found, so the value set cannot be expanded&quot;.<br>\nNormalizes: status code difference, strips null location/expression arrays from dev, strips text narrative from prod. Compares remaining OperationOutcome content.<br>\nAffects: 296 records.</p>\n<p>ID: eee2c985-52e0-4520-b4e4-01766ede5a7d</p>\n<hr>", "impact": 296}, {"id": "f73e488", "title": "Dev crashes (500) on GET  when CodeSystem content mode prevents expansion", "status": "closed", "labels": ["code-defect", "dev-crash-on-error", "reproduced", "round:2026-02-round-2", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 11:49", "date_iso": "2026-02-08T11:49:46-06:00", "body_md": "Records-Impacted: 258\nTolerance-ID: expand-dev-crash-on-error\nRecord-ID: 6b9d3a10-654f-4823-aadb-0fabc0d915bb\n\n## Repro\n\n```bash\n# Prod\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$expand?url=http:%2F%2Fhl7.org%2Ffhir%2Fus%2Fcore%2FValueSet%2Fus-core-procedure-code&_format=json' \\\n  -H 'Accept: application/fhir+json'\n\n# Dev\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$expand?url=http:%2F%2Fhl7.org%2Ffhir%2Fus%2Fcore%2FValueSet%2Fus-core-procedure-code&_format=json' \\\n  -H 'Accept: application/fhir+json'\n```\n\nProd returns HTTP 422 with issue code \"too-costly\" and clean error message: \"The code System 'http://www.ama-assn.org/go/cpt' has a grammar, and cannot be enumerated directly\". Dev returns HTTP 500 with issue code \"business-rule\" and a JavaScript source code leak in the error message: `contentMode() {\\r\\n    return this.codeSystem.content;\\r\\n  }` instead of the actual content mode value.\n\n## Root Cause\n\n**Classification**: code-level defect\n\n**Prod** uses `CODES_TFhirCodeSystemContentMode[cs.contentMode]` to convert the enum to a string for the error message and the `addParamUri` call:\n[`library/ftx/fhir_valuesets.pas#L3717-L3719`](https://github.com/HealthIntersections/fhirserver/blob/ec46dff3fe631ddeeaa000a3ca9530e0dd8c9eac/library/ftx/fhir_valuesets.pas#L3717-L3719)\n— Correctly interpolates the content mode value (e.g., \"fragment\") into the error message and uses it as the parameter name for `addParamUri`.\n\n**Dev** references `cs.contentMode` (the method itself) instead of `cs.contentMode()` (calling the method) on two lines:\n[`tx/workers/expand.js#L629-L631`](https://github.com/HealthIntersections/FHIRsmith/blob/6440990b4d0f5ca87b48093bad6ac2868067a49e/tx/workers/expand.js#L629-L631)\n— Line 629: `this.addParamUri(cs.contentMode, ...)` passes the function object as the parameter name instead of the return value. Line 631: `'... is a ' + cs.contentMode + ', so this expansion...'` stringifies the function body into the error message, leaking JS source code.\n\nNote: lines 623-626 of the same block correctly use `cs.contentMode()` with parentheses — the bug is only in the else branches (lines 629 and 631).\n\n**Same bug also exists in**:\n[`tx/workers/related.js#L629-L631`](https://github.com/HealthIntersections/FHIRsmith/blob/6440990b4d0f5ca87b48093bad6ac2868067a49e/tx/workers/related.js#L629-L631)\n— Identical code with the same missing `()`.\n\n[`tx/workers/validate.js#L600-L604`](https://github.com/HealthIntersections/FHIRsmith/blob/6440990b4d0f5ca87b48093bad6ac2868067a49e/tx/workers/validate.js#L600-L604)\n— Same missing `()` on lines 600 and 604. This doesn't cause a crash because the function object is compared to a string (always false), but it means incomplete code systems are silently mishandled instead of being properly detected.\n\n**Fix**: Change `cs.contentMode` to `cs.contentMode()` on these lines:\n- `tx/workers/expand.js` lines 629, 631\n- `tx/workers/related.js` lines 629, 631\n- `tx/workers/validate.js` lines 600, 604\n\n## What differs\n\nWhen expanding ValueSets that include code systems with restrictive content modes (e.g., HCPCS, ICD-9-CM), prod returns HTTP 422 with a clear OperationOutcome (issue code \"too-costly\", message like \"The code System X has a grammar, and cannot be enumerated directly\"). Dev returns HTTP 500 with multiple issues:\n\n1. **JS source code leak in error message**: Dev's error text contains interpolated JavaScript function body: `contentMode() {\\r\\n    return this.codeSystem.content;\\r\\n  }` instead of the actual content mode value. The message reads: \"The code system definition for <URL> is a contentMode() { return this.codeSystem.content; }, so this expansion is not permitted...\"\n\n2. **Different issue code**: Dev uses \"business-rule\" instead of prod's \"too-costly\"\n\n3. **Different HTTP status**: Dev returns 500 (server error) instead of 422 (semantic error)\n\n4. **Different code system referenced**: For us-core-procedure-code, prod references CPT (http://www.ama-assn.org/go/cpt) while dev references HCPCS (http://www.cms.gov/Medicare/Coding/HCPCSReleaseCodeSets). Both are included in the ValueSet but the servers stop at different code systems.\n\nAdditionally, 4 records within this category show different dev crashes:\n- 2 records: \"searchText.toLowerCase is not a function\" (medication-codes expand with filter)\n- 1 record: \"Unable to understand default system version\" (iso3166 expand)\n- 1 record: \"Cannot read properties of null (reading 'coding')\" (CodeSystem validate-code)\n\n## How widespread\n\n258 total dev-crash-on-error records in the delta file:\n- 257 are GET /r4/ValueSet/$expand (query params in URL)\n- 1 is POST /r4/CodeSystem/$validate-code\n- All share prod=422, dev=500\n\nThe contentMode JS leak specifically affects 254 records across 2 ValueSets:\n- us-core-procedure-code (200 records, code system: HCPCS)\n- us-core-condition-code (54 records, code system: ICD-9-CM)\n\n## What the tolerance covers\n\nThe existing tolerance `expand-dev-crash-on-error` only matched POST requests (exact URL match `/r4/ValueSet/$expand`). Updated to match URL starting with `/r4/ValueSet/$expand` (covering GET requests with query params) and also the CodeSystem/$validate-code crash. This brings coverage from ~0 to 258 records eliminated.\n\n## Representative record\n\n6b9d3a10-654f-4823-aadb-0fabc0d915bb — GET /r4/ValueSet/$expand?url=http:%2F%2Fhl7.org%2Ffhir%2Fus%2Fcore%2FValueSet%2Fus-core-procedure-code", "body_html": "<p>Records-Impacted: 258<br>\nTolerance-ID: expand-dev-crash-on-error<br>\nRecord-ID: 6b9d3a10-654f-4823-aadb-0fabc0d915bb</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod\ncurl -s &#x27;https://tx.fhir.org/r4/ValueSet/$expand?url=http:%2F%2Fhl7.org%2Ffhir%2Fus%2Fcore%2FValueSet%2Fus-core-procedure-code&amp;_format=json&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;\n\n# Dev\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand?url=http:%2F%2Fhl7.org%2Ffhir%2Fus%2Fcore%2FValueSet%2Fus-core-procedure-code&amp;_format=json&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27;</code></pre>\n<p>Prod returns HTTP 422 with issue code &quot;too-costly&quot; and clean error message: &quot;The code System &#x27;<a href=\"http://www.ama-assn.org/go/cpt&#x27;\" target=\"_blank\">http://www.ama-assn.org/go/cpt&#x27;</a> has a grammar, and cannot be enumerated directly&quot;. Dev returns HTTP 500 with issue code &quot;business-rule&quot; and a JavaScript source code leak in the error message: <code>contentMode() {\\r\\n    return this.codeSystem.content;\\r\\n  }</code> instead of the actual content mode value.</p>\n<h2>Root Cause</h2>\n<p><strong>Classification</strong>: code-level defect</p>\n<p><strong>Prod</strong> uses <code>CODES_TFhirCodeSystemContentMode[cs.contentMode]</code> to convert the enum to a string for the error message and the <code>addParamUri</code> call:<br>\n<a href=\"https://github.com/HealthIntersections/fhirserver/blob/ec46dff3fe631ddeeaa000a3ca9530e0dd8c9eac/library/ftx/fhir_valuesets.pas#L3717-L3719\" target=\"_blank\"><code>library/ftx/fhir_valuesets.pas#L3717-L3719</code></a><br>\n— Correctly interpolates the content mode value (e.g., &quot;fragment&quot;) into the error message and uses it as the parameter name for <code>addParamUri</code>.</p>\n<p><strong>Dev</strong> references <code>cs.contentMode</code> (the method itself) instead of <code>cs.contentMode()</code> (calling the method) on two lines:<br>\n<a href=\"https://github.com/HealthIntersections/FHIRsmith/blob/6440990b4d0f5ca87b48093bad6ac2868067a49e/tx/workers/expand.js#L629-L631\" target=\"_blank\"><code>tx/workers/expand.js#L629-L631</code></a><br>\n— Line 629: <code>this.addParamUri(cs.contentMode, ...)</code> passes the function object as the parameter name instead of the return value. Line 631: <code>&#x27;... is a &#x27; + cs.contentMode + &#x27;, so this expansion...&#x27;</code> stringifies the function body into the error message, leaking JS source code.</p>\n<p>Note: lines 623-626 of the same block correctly use <code>cs.contentMode()</code> with parentheses — the bug is only in the else branches (lines 629 and 631).</p>\n<p><strong>Same bug also exists in</strong>:<br>\n<a href=\"https://github.com/HealthIntersections/FHIRsmith/blob/6440990b4d0f5ca87b48093bad6ac2868067a49e/tx/workers/related.js#L629-L631\" target=\"_blank\"><code>tx/workers/related.js#L629-L631</code></a><br>\n— Identical code with the same missing <code>()</code>.</p>\n<p><a href=\"https://github.com/HealthIntersections/FHIRsmith/blob/6440990b4d0f5ca87b48093bad6ac2868067a49e/tx/workers/validate.js#L600-L604\" target=\"_blank\"><code>tx/workers/validate.js#L600-L604</code></a><br>\n— Same missing <code>()</code> on lines 600 and 604. This doesn&#x27;t cause a crash because the function object is compared to a string (always false), but it means incomplete code systems are silently mishandled instead of being properly detected.</p>\n<p><strong>Fix</strong>: Change <code>cs.contentMode</code> to <code>cs.contentMode()</code> on these lines:</p>\n<ul><li><code>tx/workers/expand.js</code> lines 629, 631</li><li><code>tx/workers/related.js</code> lines 629, 631</li><li><code>tx/workers/validate.js</code> lines 600, 604</li></ul>\n<h2>What differs</h2>\n<p>When expanding ValueSets that include code systems with restrictive content modes (e.g., HCPCS, ICD-9-CM), prod returns HTTP 422 with a clear OperationOutcome (issue code &quot;too-costly&quot;, message like &quot;The code System X has a grammar, and cannot be enumerated directly&quot;). Dev returns HTTP 500 with multiple issues:</p>\n<ol><li><strong>JS source code leak in error message</strong>: Dev&#x27;s error text contains interpolated JavaScript function body: <code>contentMode() {\\r\\n    return this.codeSystem.content;\\r\\n  }</code> instead of the actual content mode value. The message reads: &quot;The code system definition for &lt;URL&gt; is a contentMode() { return this.codeSystem.content; }, so this expansion is not permitted...&quot;</li></ol>\n<ol><li><strong>Different issue code</strong>: Dev uses &quot;business-rule&quot; instead of prod&#x27;s &quot;too-costly&quot;</li></ol>\n<ol><li><strong>Different HTTP status</strong>: Dev returns 500 (server error) instead of 422 (semantic error)</li></ol>\n<ol><li><strong>Different code system referenced</strong>: For us-core-procedure-code, prod references CPT (<a href=\"http://www.ama-assn.org/go/cpt\" target=\"_blank\">http://www.ama-assn.org/go/cpt</a>) while dev references HCPCS (<a href=\"http://www.cms.gov/Medicare/Coding/HCPCSReleaseCodeSets\" target=\"_blank\">http://www.cms.gov/Medicare/Coding/HCPCSReleaseCodeSets</a>). Both are included in the ValueSet but the servers stop at different code systems.</li></ol>\n<p>Additionally, 4 records within this category show different dev crashes:</p>\n<ul><li>2 records: &quot;searchText.toLowerCase is not a function&quot; (medication-codes expand with filter)</li><li>1 record: &quot;Unable to understand default system version&quot; (iso3166 expand)</li><li>1 record: &quot;Cannot read properties of null (reading &#x27;coding&#x27;)&quot; (CodeSystem validate-code)</li></ul>\n<h2>How widespread</h2>\n<p>258 total dev-crash-on-error records in the delta file:</p>\n<ul><li>257 are GET /r4/ValueSet/$expand (query params in URL)</li><li>1 is POST /r4/CodeSystem/$validate-code</li><li>All share prod=422, dev=500</li></ul>\n<p>The contentMode JS leak specifically affects 254 records across 2 ValueSets:</p>\n<ul><li>us-core-procedure-code (200 records, code system: HCPCS)</li><li>us-core-condition-code (54 records, code system: ICD-9-CM)</li></ul>\n<h2>What the tolerance covers</h2>\n<p>The existing tolerance <code>expand-dev-crash-on-error</code> only matched POST requests (exact URL match <code>/r4/ValueSet/$expand</code>). Updated to match URL starting with <code>/r4/ValueSet/$expand</code> (covering GET requests with query params) and also the CodeSystem/$validate-code crash. This brings coverage from ~0 to 258 records eliminated.</p>\n<h2>Representative record</h2>\n<p>6b9d3a10-654f-4823-aadb-0fabc0d915bb — GET /r4/ValueSet/$expand?url=http:%2F%2Fhl7.org%2Ffhir%2Fus%2Fcore%2FValueSet%2Fus-core-procedure-code</p>", "impact": 258}, {"id": "56d28d0", "title": "UCUM -code: dev returns human-readable display instead of code-as-display", "status": "closed", "labels": ["content-differs", "reproduced", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:38", "date_iso": "2026-02-08T13:38:00-06:00", "body_md": "Records-Impacted: 220\nTolerance-ID: ucum-display-code-as-display\nRecord-ID: 6ae99904-538b-4241-89db-b15eab6e637e\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/CodeSystem/$validate-code?url=http://unitsofmeasure.org&code=%5Bin_i%5D' \\\n-H 'Accept: application/fhir+json'\n\ncurl -s 'https://tx-dev.fhir.org/r4/CodeSystem/$validate-code?url=http://unitsofmeasure.org&code=%5Bin_i%5D' \\\n-H 'Accept: application/fhir+json'\n```\n\nProd returns `display: \"[in_i]\"` (the UCUM code itself), dev returns `display: \"(inch)\"` (human-readable name).\n\n\nFor UCUM ($validate-code) operations, prod returns the UCUM code itself as the `display` parameter (e.g., `[in_i]`, `[lb_av]`, `mg`, `%`), while dev returns a human-readable name (e.g., `(inch)`, `(pound)`, `(milligram)`, `(percent)`).\n\nPer the FHIR UCUM guidance (https://terminology.hl7.org/UCUM.html): \"No standardized display value is defined. The UCUM code itself is used directly as the display.\" Prod follows this convention; dev does not.\n\nAll other parameters (result, system, code, version) agree between prod and dev. Display is the only difference.\n\nExamples:\n- code=[in_i]: prod display=\"[in_i]\", dev display=\"(inch)\"\n- code=[lb_av]: prod display=\"[lb_av]\", dev display=\"(pound)\"\n- code=[degF]: prod display=\"[degF]\", dev display=\"(degree Fahrenheit)\"\n- code=mg: prod display=\"mg\", dev display=\"(milligram)\"\n- code=%: prod display=\"%\", dev display=\"(percent)\"\n- code=mm[Hg]: prod display=\"mm[Hg]\", dev display=\"(millimeter of mercury column)\"\n- code=kg/m2: prod display=\"kg/m2\", dev display=\"(kilogram) / (meter ^ 2)\"\n\n\n220 records in deltas.ndjson match this pattern. All are validate-code operations on system http://unitsofmeasure.org where display is the only diff. Found with:\n\ngrep '\"param\":\"display\"' deltas.ndjson | grep 'unitsofmeasure.org' | wc -l\n\nIn all 220 cases, prod's display equals the UCUM code exactly.\n\n\nTolerance ID: ucum-display-code-as-display\nMatches: validate-code operations on http://unitsofmeasure.org where display values differ\nNormalizes both sides to prod's display value (the code itself, per FHIR convention)\n\n\n6ae99904-538b-4241-89db-b15eab6e637e (POST /r4/ValueSet/$validate-code, code=[in_i])", "body_html": "<p>Records-Impacted: 220<br>\nTolerance-ID: ucum-display-code-as-display<br>\nRecord-ID: 6ae99904-538b-4241-89db-b15eab6e637e</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/CodeSystem/$validate-code?url=http://unitsofmeasure.org&amp;code=%5Bin_i%5D&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/CodeSystem/$validate-code?url=http://unitsofmeasure.org&amp;code=%5Bin_i%5D&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27;</code></pre>\n<p>Prod returns <code>display: &quot;[in_i]&quot;</code> (the UCUM code itself), dev returns <code>display: &quot;(inch)&quot;</code> (human-readable name).</p>\n<p>For UCUM ($validate-code) operations, prod returns the UCUM code itself as the <code>display</code> parameter (e.g., <code>[in_i]</code>, <code>[lb_av]</code>, <code>mg</code>, <code>%</code>), while dev returns a human-readable name (e.g., <code>(inch)</code>, <code>(pound)</code>, <code>(milligram)</code>, <code>(percent)</code>).</p>\n<p>Per the FHIR UCUM guidance (<a href=\"https://terminology.hl7.org/UCUM.html\" target=\"_blank\">https://terminology.hl7.org/UCUM.html</a>): &quot;No standardized display value is defined. The UCUM code itself is used directly as the display.&quot; Prod follows this convention; dev does not.</p>\n<p>All other parameters (result, system, code, version) agree between prod and dev. Display is the only difference.</p>\n<p>Examples:</p>\n<ul><li>code=[in_i]: prod display=&quot;[in_i]&quot;, dev display=&quot;(inch)&quot;</li><li>code=[lb_av]: prod display=&quot;[lb_av]&quot;, dev display=&quot;(pound)&quot;</li><li>code=[degF]: prod display=&quot;[degF]&quot;, dev display=&quot;(degree Fahrenheit)&quot;</li><li>code=mg: prod display=&quot;mg&quot;, dev display=&quot;(milligram)&quot;</li><li>code=%: prod display=&quot;%&quot;, dev display=&quot;(percent)&quot;</li><li>code=mm[Hg]: prod display=&quot;mm[Hg]&quot;, dev display=&quot;(millimeter of mercury column)&quot;</li><li>code=kg/m2: prod display=&quot;kg/m2&quot;, dev display=&quot;(kilogram) / (meter ^ 2)&quot;</li></ul>\n<p>220 records in deltas.ndjson match this pattern. All are validate-code operations on system <a href=\"http://unitsofmeasure.org\" target=\"_blank\">http://unitsofmeasure.org</a> where display is the only diff. Found with:</p>\n<p>grep &#x27;&quot;param&quot;:&quot;display&quot;&#x27; deltas.ndjson | grep &#x27;unitsofmeasure.org&#x27; | wc -l</p>\n<p>In all 220 cases, prod&#x27;s display equals the UCUM code exactly.</p>\n<p>Tolerance ID: ucum-display-code-as-display<br>\nMatches: validate-code operations on <a href=\"http://unitsofmeasure.org\" target=\"_blank\">http://unitsofmeasure.org</a> where display values differ<br>\nNormalizes both sides to prod&#x27;s display value (the code itself, per FHIR convention)</p>\n<p>6ae99904-538b-4241-89db-b15eab6e637e (POST /r4/ValueSet/$validate-code, code=[in_i])</p>", "impact": 220}, {"id": "4f12dda", "title": "Dev loads older SNOMED CT and CPT editions, causing expand contains[].version to differ", "status": "closed", "labels": ["config-issue", "content-differs", "reproduced", "round:2026-02-round-2", "to-discuss", "tx-compare", "won't-fix"], "author": "Claude (AI Assistant)", "date": "2026-02-08 19:50", "date_iso": "2026-02-08T19:50:02-06:00", "body_md": "Records-Impacted: 198\nTolerance-ID: expand-contains-version-skew\nRecord-ID: 6f9cf4c7-e6f4-445c-bc86-323b2b6d7165\n\n## Repro\n\n```bash\n# Prod\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$expand?url=http:%2F%2Fcts.nlm.nih.gov%2Ffhir%2FValueSet%2F2.16.840.1.113762.1.4.1267.23&_format=json' \\\n  -H 'Accept: application/fhir+json' | jq '.expansion.contains[:3] | map({system, code, version})'\n\n# Dev\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$expand?url=http:%2F%2Fcts.nlm.nih.gov%2Ffhir%2FValueSet%2F2.16.840.1.113762.1.4.1267.23&_format=json' \\\n  -H 'Accept: application/fhir+json' | jq '.expansion.contains[:3] | map({system, code, version})'\n```\n\nProd returns SNOMED version `http://snomed.info/sct/731000124108/version/20250901` and CPT version `2026`, dev returns SNOMED version `http://snomed.info/sct/731000124108/version/20250301` and CPT version `2025`.\n\n## What differs\n\nIn $expand responses, prod and dev return the same set of codes (same system + code pairs) but with different `version` strings on `expansion.contains[]` entries:\n\n- **SNOMED CT US edition**: prod returns `http://snomed.info/sct/731000124108/version/20250901`, dev returns `http://snomed.info/sct/731000124108/version/20250301`\n- **CPT (AMA)**: prod returns `2026`, dev returns `2025`\n\nBoth sides return 200 with identical code membership (280 codes in the representative record), but each code's version field reflects the loaded edition.\n\nThis differs from bug 9fd2328, which covers the case where SNOMED version skew causes *different* code sets to appear. Here, the codes are the same — only the version annotations differ.\n\n## How widespread\n\n198 expand delta records exhibit this pattern. All are the same ValueSet URL (`http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1267.23`) requested with different parameters. Each contains 280 codes with both SNOMED and CPT codes, where all codes match but version strings differ.\n\nFound via:\n```python\n# For each expand delta with same code membership,\n# check if contains[].version differs for common codes\n```\n\n## What the tolerance covers\n\nTolerance `expand-contains-version-skew` matches expand records where both sides return 200, the code membership is identical, but `contains[].version` strings differ for common codes. It normalizes all `contains[].version` values to prod's values. This only triggers when code sets are the same (no extra/missing codes) — the existing `expand-snomed-version-skew-content` tolerance handles cases with code membership differences.", "body_html": "<p>Records-Impacted: 198<br>\nTolerance-ID: expand-contains-version-skew<br>\nRecord-ID: 6f9cf4c7-e6f4-445c-bc86-323b2b6d7165</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod\ncurl -s &#x27;https://tx.fhir.org/r4/ValueSet/$expand?url=http:%2F%2Fcts.nlm.nih.gov%2Ffhir%2FValueSet%2F2.16.840.1.113762.1.4.1267.23&amp;_format=json&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; | jq &#x27;.expansion.contains[:3] | map({system, code, version})&#x27;\n\n# Dev\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand?url=http:%2F%2Fcts.nlm.nih.gov%2Ffhir%2FValueSet%2F2.16.840.1.113762.1.4.1267.23&amp;_format=json&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; | jq &#x27;.expansion.contains[:3] | map({system, code, version})&#x27;</code></pre>\n<p>Prod returns SNOMED version <code>http://snomed.info/sct/731000124108/version/20250901</code> and CPT version <code>2026</code>, dev returns SNOMED version <code>http://snomed.info/sct/731000124108/version/20250301</code> and CPT version <code>2025</code>.</p>\n<h2>What differs</h2>\n<p>In $expand responses, prod and dev return the same set of codes (same system + code pairs) but with different <code>version</code> strings on <code>expansion.contains[]</code> entries:</p>\n<ul><li><strong>SNOMED CT US edition</strong>: prod returns <code>http://snomed.info/sct/731000124108/version/20250901</code>, dev returns <code>http://snomed.info/sct/731000124108/version/20250301</code></li><li><strong>CPT (AMA)</strong>: prod returns <code>2026</code>, dev returns <code>2025</code></li></ul>\n<p>Both sides return 200 with identical code membership (280 codes in the representative record), but each code&#x27;s version field reflects the loaded edition.</p>\n<p>This differs from bug 9fd2328, which covers the case where SNOMED version skew causes <em>different</em> code sets to appear. Here, the codes are the same — only the version annotations differ.</p>\n<h2>How widespread</h2>\n<p>198 expand delta records exhibit this pattern. All are the same ValueSet URL (<code>http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1267.23</code>) requested with different parameters. Each contains 280 codes with both SNOMED and CPT codes, where all codes match but version strings differ.</p>\n<p>Found via:</p>\n<pre><code class=\"lang-python\"># For each expand delta with same code membership,\n# check if contains[].version differs for common codes</code></pre>\n<h2>What the tolerance covers</h2>\n<p>Tolerance <code>expand-contains-version-skew</code> matches expand records where both sides return 200, the code membership is identical, but <code>contains[].version</code> strings differ for common codes. It normalizes all <code>contains[].version</code> values to prod&#x27;s values. This only triggers when code sets are the same (no extra/missing codes) — the existing <code>expand-snomed-version-skew-content</code> tolerance handles cases with code membership differences.</p>", "impact": 198}, {"id": "5b3ae71", "title": "SNOMED CT edition version skew: dev loads older editions than prod", "status": "closed", "labels": ["content-differs", "reproduced", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:38", "date_iso": "2026-02-08T13:38:00-06:00", "body_md": "Records-Impacted: 181\nTolerance-ID: snomed-version-skew\nRecord-ID: e5716810-0ced-4937-85a5-5651fb884719\n\n\nThe version skew is visible in both the metadata endpoint and $validate-code responses.\nThe International edition has been partially fixed (both servers now resolve to 20250201),\nbut the US edition (731000124108) still shows the bug: dev defaults to 20230301 instead\nof 20250901. Both servers have the 20250901 edition loaded, but dev picks the wrong default.\n\n\n```bash\ncurl -s \"https://tx.fhir.org/r4/metadata?mode=terminology\" \\\n-H \"Accept: application/fhir+json\" | \\\njq '.codeSystem[] | select(.uri==\"http://snomed.info/sct\") | .version[].code | select(contains(\"731000124108\"))'\n\ncurl -s \"https://tx-dev.fhir.org/r4/metadata?mode=terminology\" \\\n-H \"Accept: application/fhir+json\" | \\\njq '.codeSystem[] | select(.uri==\"http://snomed.info/sct\") | .version[].code | select(contains(\"731000124108\"))'\n```\n\nExpected: both list only `http://snomed.info/sct/731000124108/version/20250901`\nActual: dev also has `http://snomed.info/sct/731000124108/version/20230301`\n\n\n```bash\ncurl -s \"https://tx.fhir.org/r4/CodeSystem/\\$validate-code\" \\\n-H \"Content-Type: application/fhir+json\" \\\n-H \"Accept: application/fhir+json\" \\\n--data-raw '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://snomed.info/sct\"},{\"name\":\"code\",\"valueCode\":\"243796009\"},{\"name\":\"version\",\"valueString\":\"http://snomed.info/sct/731000124108\"}]}'\n\ncurl -s \"https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code\" \\\n-H \"Content-Type: application/fhir+json\" \\\n-H \"Accept: application/fhir+json\" \\\n--data-raw '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://snomed.info/sct\"},{\"name\":\"code\",\"valueCode\":\"243796009\"},{\"name\":\"version\",\"valueString\":\"http://snomed.info/sct/731000124108\"}]}'\n```\n\nExpected: both return `\"version\": \"http://snomed.info/sct/731000124108/version/20250901\"`\nActual: dev returns `\"version\": \"http://snomed.info/sct/731000124108/version/20230301\"`\n\n\n- 36822cee-7132-4003-bf9e-a5602f839466 (US edition, code 243796009)\n- 1796976f-3807-40ec-aa48-f8758b0fee62 (US edition, code 272379006)\n- 03fec18b-e871-4041-b9b8-5c770b2b17c7 (International edition, code 106292003)\n\nTested: 2026-02-07\n\nDev returns different (generally older) SNOMED CT edition versions than prod across multiple modules.\n\n\nThe `version` parameter in $validate-code responses contains different SNOMED CT edition URIs:\n\n- International edition (900000000000207008): prod=20250201, dev=20240201 (256 records)\n- US edition (731000124108): prod=20250901, dev=20230301 (46 records, some with reversed newer dev versions)\n- Swedish edition (45991000052106): prod=20220531, dev=20231130 (13 records)\n- Plus other national editions with smaller counts\n\n\n279 total records in the current comparison dataset show SNOMED version parameter differences:\n- 265 categorized as content-differs (version string is the only or primary diff)\n- 14 categorized as result-disagrees (validation result boolean differs — codes valid in one edition but not the other)\n\nAll are $validate-code operations. The version difference also correlates with display text differences in ~80 records (display names changed between editions).\n\nMatched by: system=http://snomed.info/sct AND version parameter contains snomed.info/sct AND prod version != dev version.\n\n\nTolerance ID: snomed-version-skew\nNormalizes the `version` parameter to prod's value on both sides when both contain snomed.info/sct URIs with different version dates. This eliminates records where version is the only diff (~190 records). Records with additional diffs (display, message, result) still surface for separate triage.\n\n\n- e5716810-0ced-4937-85a5-5651fb884719 (International edition, version-only diff)\n- e85ce5f3-b23f-41c0-892e-5f7b2aa672ef (result-disagrees, code 116154003)", "body_html": "<p>Records-Impacted: 181<br>\nTolerance-ID: snomed-version-skew<br>\nRecord-ID: e5716810-0ced-4937-85a5-5651fb884719</p>\n<p>The version skew is visible in both the metadata endpoint and $validate-code responses.<br>\nThe International edition has been partially fixed (both servers now resolve to 20250201),<br>\nbut the US edition (731000124108) still shows the bug: dev defaults to 20230301 instead<br>\nof 20250901. Both servers have the 20250901 edition loaded, but dev picks the wrong default.</p>\n<pre><code class=\"lang-bash\">curl -s &quot;https://tx.fhir.org/r4/metadata?mode=terminology&quot; \\\n-H &quot;Accept: application/fhir+json&quot; | \\\njq &#x27;.codeSystem[] | select(.uri==&quot;http://snomed.info/sct&quot;) | .version[].code | select(contains(&quot;731000124108&quot;))&#x27;\n\ncurl -s &quot;https://tx-dev.fhir.org/r4/metadata?mode=terminology&quot; \\\n-H &quot;Accept: application/fhir+json&quot; | \\\njq &#x27;.codeSystem[] | select(.uri==&quot;http://snomed.info/sct&quot;) | .version[].code | select(contains(&quot;731000124108&quot;))&#x27;</code></pre>\n<p>Expected: both list only <code>http://snomed.info/sct/731000124108/version/20250901</code><br>\nActual: dev also has <code>http://snomed.info/sct/731000124108/version/20230301</code></p>\n<pre><code class=\"lang-bash\">curl -s &quot;https://tx.fhir.org/r4/CodeSystem/\\$validate-code&quot; \\\n-H &quot;Content-Type: application/fhir+json&quot; \\\n-H &quot;Accept: application/fhir+json&quot; \\\n--data-raw &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://snomed.info/sct&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;243796009&quot;},{&quot;name&quot;:&quot;version&quot;,&quot;valueString&quot;:&quot;http://snomed.info/sct/731000124108&quot;}]}&#x27;\n\ncurl -s &quot;https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code&quot; \\\n-H &quot;Content-Type: application/fhir+json&quot; \\\n-H &quot;Accept: application/fhir+json&quot; \\\n--data-raw &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://snomed.info/sct&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;243796009&quot;},{&quot;name&quot;:&quot;version&quot;,&quot;valueString&quot;:&quot;http://snomed.info/sct/731000124108&quot;}]}&#x27;</code></pre>\n<p>Expected: both return <code>&quot;version&quot;: &quot;http://snomed.info/sct/731000124108/version/20250901&quot;</code><br>\nActual: dev returns <code>&quot;version&quot;: &quot;http://snomed.info/sct/731000124108/version/20230301&quot;</code></p>\n<ul><li>36822cee-7132-4003-bf9e-a5602f839466 (US edition, code 243796009)</li><li>1796976f-3807-40ec-aa48-f8758b0fee62 (US edition, code 272379006)</li><li>03fec18b-e871-4041-b9b8-5c770b2b17c7 (International edition, code 106292003)</li></ul>\n<p>Tested: 2026-02-07</p>\n<p>Dev returns different (generally older) SNOMED CT edition versions than prod across multiple modules.</p>\n<p>The <code>version</code> parameter in $validate-code responses contains different SNOMED CT edition URIs:</p>\n<ul><li>International edition (900000000000207008): prod=20250201, dev=20240201 (256 records)</li><li>US edition (731000124108): prod=20250901, dev=20230301 (46 records, some with reversed newer dev versions)</li><li>Swedish edition (45991000052106): prod=20220531, dev=20231130 (13 records)</li><li>Plus other national editions with smaller counts</li></ul>\n<p>279 total records in the current comparison dataset show SNOMED version parameter differences:</p>\n<ul><li>265 categorized as content-differs (version string is the only or primary diff)</li><li>14 categorized as result-disagrees (validation result boolean differs — codes valid in one edition but not the other)</li></ul>\n<p>All are $validate-code operations. The version difference also correlates with display text differences in ~80 records (display names changed between editions).</p>\n<p>Matched by: system=<a href=\"http://snomed.info/sct\" target=\"_blank\">http://snomed.info/sct</a> AND version parameter contains snomed.info/sct AND prod version != dev version.</p>\n<p>Tolerance ID: snomed-version-skew<br>\nNormalizes the <code>version</code> parameter to prod&#x27;s value on both sides when both contain snomed.info/sct URIs with different version dates. This eliminates records where version is the only diff (~190 records). Records with additional diffs (display, message, result) still surface for separate triage.</p>\n<ul><li>e5716810-0ced-4937-85a5-5651fb884719 (International edition, version-only diff)</li><li>e85ce5f3-b23f-41c0-892e-5f7b2aa672ef (result-disagrees, code 116154003)</li></ul>", "impact": 181}, {"id": "be888eb", "title": "v2-0360 $lookup returns version 3.0.0 vs prod 2.0.0 with extra definition/designation", "status": "closed", "labels": ["P6", "reproduced", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:38", "date_iso": "2026-02-08T13:38:00-06:00", "body_md": "Records-Impacted: 157\nTolerance-ID: v2-0360-lookup-version-skew\nRecord-ID: 80a780e6-8842-43a9-a260-889ce87f76ac\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/CodeSystem/$lookup?system=http://terminology.hl7.org/CodeSystem/v2-0360&code=RN' \\\n-H 'Accept: application/fhir+json'\n\ncurl -s 'https://tx-dev.fhir.org/r4/CodeSystem/$lookup?system=http://terminology.hl7.org/CodeSystem/v2-0360&code=RN' \\\n-H 'Accept: application/fhir+json'\n```\n\nProd returns `version: \"2.0.0\"` with no top-level `definition` or `designation` parameters. Dev returns `version: \"3.0.0\"` with an extra `definition` parameter (\"Registered Nurse\") and an extra `designation` parameter (use=preferredForLanguage).\n\n\n$lookup on CodeSystem v2-0360 (DegreeLicenseCertificate) returns different version and content between prod and dev:\n\n1. **Version**: prod returns `version: \"2.0.0\"`, dev returns `version: \"3.0.0\"`\n2. **Definition parameter**: dev returns a top-level `definition` parameter (`\"Registered Nurse\"`); prod returns the definition only as a property (code=definition)\n3. **Designation parameter**: dev returns a `designation` parameter with `preferredForLanguage` use coding; prod does not include designation\n\nThese differences reflect that dev has loaded a newer edition (3.0.0) of the v2-0360 CodeSystem than prod (2.0.0). The structural differences (definition as top-level param, extra designation) are consistent with the newer version having richer content.\n\n\nAll 157 $lookup deltas are for this same system and show the identical pattern. All use code=RN.\n\n```\ngrep '\"op\":\"lookup\"' jobs/2026-02-round-1/results/deltas/deltas.ndjson | wc -l\n\ngrep '\"op\":\"lookup\"' jobs/2026-02-round-1/results/deltas/deltas.ndjson | grep -c 'v2-0360'\n```\n\nRequest properties that predict this difference:\n- Operation: $lookup\n- System: http://terminology.hl7.org/CodeSystem/v2-0360\n- FHIR version: /r4/\n\n\nTolerance ID: `v2-0360-lookup-version-skew`\nMatches: $lookup requests on v2-0360 system\nNormalizes: strips version, definition, and designation parameters from both sides; removes property with code=definition from both sides\nAffects: 157 records\n\n\nID: `80a780e6-8842-43a9-a260-889ce87f76ac`\nURL: GET /r4/CodeSystem/$lookup?system=http://terminology.hl7.org/CodeSystem/v2-0360&code=RN", "body_html": "<p>Records-Impacted: 157<br>\nTolerance-ID: v2-0360-lookup-version-skew<br>\nRecord-ID: 80a780e6-8842-43a9-a260-889ce87f76ac</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/CodeSystem/$lookup?system=http://terminology.hl7.org/CodeSystem/v2-0360&amp;code=RN&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/CodeSystem/$lookup?system=http://terminology.hl7.org/CodeSystem/v2-0360&amp;code=RN&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27;</code></pre>\n<p>Prod returns <code>version: &quot;2.0.0&quot;</code> with no top-level <code>definition</code> or <code>designation</code> parameters. Dev returns <code>version: &quot;3.0.0&quot;</code> with an extra <code>definition</code> parameter (&quot;Registered Nurse&quot;) and an extra <code>designation</code> parameter (use=preferredForLanguage).</p>\n<p>$lookup on CodeSystem v2-0360 (DegreeLicenseCertificate) returns different version and content between prod and dev:</p>\n<ol><li><strong>Version</strong>: prod returns <code>version: &quot;2.0.0&quot;</code>, dev returns <code>version: &quot;3.0.0&quot;</code></li><li><strong>Definition parameter</strong>: dev returns a top-level <code>definition</code> parameter (<code>&quot;Registered Nurse&quot;</code>); prod returns the definition only as a property (code=definition)</li><li><strong>Designation parameter</strong>: dev returns a <code>designation</code> parameter with <code>preferredForLanguage</code> use coding; prod does not include designation</li></ol>\n<p>These differences reflect that dev has loaded a newer edition (3.0.0) of the v2-0360 CodeSystem than prod (2.0.0). The structural differences (definition as top-level param, extra designation) are consistent with the newer version having richer content.</p>\n<p>All 157 $lookup deltas are for this same system and show the identical pattern. All use code=RN.</p>\n<pre><code>grep &#x27;&quot;op&quot;:&quot;lookup&quot;&#x27; jobs/2026-02-round-1/results/deltas/deltas.ndjson | wc -l\n\ngrep &#x27;&quot;op&quot;:&quot;lookup&quot;&#x27; jobs/2026-02-round-1/results/deltas/deltas.ndjson | grep -c &#x27;v2-0360&#x27;</code></pre>\n<p>Request properties that predict this difference:</p>\n<ul><li>Operation: $lookup</li><li>System: <a href=\"http://terminology.hl7.org/CodeSystem/v2-0360\" target=\"_blank\">http://terminology.hl7.org/CodeSystem/v2-0360</a></li><li>FHIR version: /r4/</li></ul>\n<p>Tolerance ID: <code>v2-0360-lookup-version-skew</code><br>\nMatches: $lookup requests on v2-0360 system<br>\nNormalizes: strips version, definition, and designation parameters from both sides; removes property with code=definition from both sides<br>\nAffects: 157 records</p>\n<p>ID: <code>80a780e6-8842-43a9-a260-889ce87f76ac</code><br>\nURL: GET /r4/CodeSystem/$lookup?system=<a href=\"http://terminology.hl7.org/CodeSystem/v2-0360&amp;code=RN\" target=\"_blank\">http://terminology.hl7.org/CodeSystem/v2-0360&amp;code=RN</a></p>", "impact": 157}, {"id": "f45a4bc", "title": "Expand display text differs between prod and dev for same codes", "status": "closed", "labels": ["content-differs", "reproduced", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:38", "date_iso": "2026-02-08T13:38:01-06:00", "body_md": "Records-Impacted: 157\nTolerance-ID: expand-display-text-differs\nRecord-ID: 6d25c912-25f4-45cf-8dea-3dd07d9d7e1e\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$expand' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"status\":\"active\",\"compose\":{\"include\":[{\"system\":\"http://snomed.info/sct\",\"concept\":[{\"code\":\"116101001\"}]}]}}}]}'\n\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$expand' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"status\":\"active\",\"compose\":{\"include\":[{\"system\":\"http://snomed.info/sct\",\"concept\":[{\"code\":\"116101001\"}]}]}}}]}'\n```\n\nProd returns display `\"Product containing gonadotropin releasing hormone receptor antagonist (product)\"` (FSN), dev returns `\"Gonadotropin releasing hormone antagonist\"` (inactive synonym). Same SNOMED version on both servers (20250201).\n\n\nIn $expand responses, display text for the same code differs between prod and dev in\nexpansion.contains[].display. Both servers return the same codes in the same order, but\nwith different human-readable display strings.\n\nExamples:\n- SNOMED 116101001: prod=\"Product containing gonadotropin releasing hormone receptor\nantagonist (product)\", dev=\"Gonadotropin releasing hormone antagonist\"\n- SNOMED 425901007: prod=\"IVF - In vitro fertilisation with intracytoplasmic sperm\ninjection (ICSI)\", dev=\"In vitro fertilization with intracytoplasmic sperm injection\n(procedure)\"\n- SNOMED 60001007: prod=\"Not pregnant\", dev=\"Non pregnant state\"\n- ISO 3166 CUW: prod=\"Curagao\", dev=\"Curaçao\" (character encoding/data edition)\n- ISO 3166 ALA: prod=\"Eland Islands\", dev=\"Åland Islands\"\n\n\n157 expand delta records have display text diffs in expansion.contains.\n\nBy code system:\n- http://snomed.info/sct: 134 records\n- urn:iso:std:iso:3166: 22 records\n- http://unitsofmeasure.org: 1 record\n\nSearch: Compared expansion.contains display values between prodBody and devBody for\nall expand deltas in results/deltas/deltas.ndjson.\n\n\nTolerance ID: expand-display-text-differs\nMatches: $expand responses (resourceType=ValueSet with expansion) where any\ncontains[].display differs between prod and dev for the same code.\nNormalizes: Sets both sides' display to prod's value (canonical), preserving other\nfield differences.\n\n\n- 6d25c912-25f4-45cf-8dea-3dd07d9d7e1e (SNOMED 116101001)\n- 44f0851b-80e8-4a27-b05e-551c0522e39b (SNOMED 425901007, 161744009)\n- 2ff10aef-7210-489d-bb28-6c7739c27027 (ISO 3166 CUW, ALA, CIV)", "body_html": "<p>Records-Impacted: 157<br>\nTolerance-ID: expand-display-text-differs<br>\nRecord-ID: 6d25c912-25f4-45cf-8dea-3dd07d9d7e1e</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/ValueSet/$expand&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;status&quot;:&quot;active&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;http://snomed.info/sct&quot;,&quot;concept&quot;:[{&quot;code&quot;:&quot;116101001&quot;}]}]}}}]}&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;status&quot;:&quot;active&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;http://snomed.info/sct&quot;,&quot;concept&quot;:[{&quot;code&quot;:&quot;116101001&quot;}]}]}}}]}&#x27;</code></pre>\n<p>Prod returns display <code>&quot;Product containing gonadotropin releasing hormone receptor antagonist (product)&quot;</code> (FSN), dev returns <code>&quot;Gonadotropin releasing hormone antagonist&quot;</code> (inactive synonym). Same SNOMED version on both servers (20250201).</p>\n<p>In $expand responses, display text for the same code differs between prod and dev in<br>\nexpansion.contains[].display. Both servers return the same codes in the same order, but<br>\nwith different human-readable display strings.</p>\n<p>Examples:</p>\n<ul><li>SNOMED 116101001: prod=&quot;Product containing gonadotropin releasing hormone receptor</li></ul>\n<p>antagonist (product)&quot;, dev=&quot;Gonadotropin releasing hormone antagonist&quot;</p>\n<ul><li>SNOMED 425901007: prod=&quot;IVF - In vitro fertilisation with intracytoplasmic sperm</li></ul>\n<p>injection (ICSI)&quot;, dev=&quot;In vitro fertilization with intracytoplasmic sperm injection<br>\n(procedure)&quot;</p>\n<ul><li>SNOMED 60001007: prod=&quot;Not pregnant&quot;, dev=&quot;Non pregnant state&quot;</li><li>ISO 3166 CUW: prod=&quot;Curagao&quot;, dev=&quot;Curaçao&quot; (character encoding/data edition)</li><li>ISO 3166 ALA: prod=&quot;Eland Islands&quot;, dev=&quot;Åland Islands&quot;</li></ul>\n<p>157 expand delta records have display text diffs in expansion.contains.</p>\n<p>By code system:</p>\n<ul><li><a href=\"http://snomed.info/sct:\" target=\"_blank\">http://snomed.info/sct:</a> 134 records</li><li>urn:iso:std:iso:3166: 22 records</li><li><a href=\"http://unitsofmeasure.org:\" target=\"_blank\">http://unitsofmeasure.org:</a> 1 record</li></ul>\n<p>Search: Compared expansion.contains display values between prodBody and devBody for<br>\nall expand deltas in results/deltas/deltas.ndjson.</p>\n<p>Tolerance ID: expand-display-text-differs<br>\nMatches: $expand responses (resourceType=ValueSet with expansion) where any<br>\ncontains[].display differs between prod and dev for the same code.<br>\nNormalizes: Sets both sides&#x27; display to prod&#x27;s value (canonical), preserving other<br>\nfield differences.</p>\n<ul><li>6d25c912-25f4-45cf-8dea-3dd07d9d7e1e (SNOMED 116101001)</li><li>44f0851b-80e8-4a27-b05e-551c0522e39b (SNOMED 425901007, 161744009)</li><li>2ff10aef-7210-489d-bb28-6c7739c27027 (ISO 3166 CUW, ALA, CIV)</li></ul>", "impact": 157}, {"id": "4f824c2", "title": "validate-code: dev omits message parameter when result=true", "status": "closed", "labels": ["content-differs", "reproduced", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:38", "date_iso": "2026-02-08T13:38:01-06:00", "body_md": "Records-Impacted: 150\nTolerance-ID: validate-code-missing-message-on-true\nRecord-ID: e934228b-f819-4119-bdd2-dcf4a72988bc\n\n\n```bash\ncurl -s \"https://tx.fhir.org/r4/CodeSystem/\\$validate-code\" \\\n-H \"Accept: application/fhir+json\" \\\n-H \"Content-Type: application/fhir+json\" \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/sid/icd-9-cm\"},{\"name\":\"code\",\"valueCode\":\"441\"}]}'\n\ncurl -s \"https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code\" \\\n-H \"Accept: application/fhir+json\" \\\n-H \"Content-Type: application/fhir+json\" \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/sid/icd-9-cm\"},{\"name\":\"code\",\"valueCode\":\"441\"}]}'\n```\n\nProd returns `result: true` with a `message` parameter: \"Unknown Code '441' in the CodeSystem 'http://hl7.org/fhir/sid/icd-9-cm' version '2015' - note that the code system is labeled as a fragment, so the code may be valid in some other fragment\". Dev returns `result: true` but omits the `message` parameter entirely.\n\n\nDev omits the `message` output parameter on $validate-code responses when `result=true`. Prod includes it. The FHIR spec explicitly states that when result is true, the message parameter \"carries hints and warnings.\"\n\nIn this dataset, all 150 affected records have `result=true` and prod returns a `message` containing warnings like \"Unknown Code '441' in the CodeSystem 'http://hl7.org/fhir/sid/icd-9-cm' version '2015' - note that the code system is labeled as a fragment, so the code may be valid in some other fragment.\"\n\nWhen `result=false`, dev correctly includes the `message` parameter.\n\n\n150 records in comparison.ndjson (38 in current deltas after other tolerances):\n- 111 POST /r4/ValueSet/$validate-code\n- 39 POST /r4/CodeSystem/$validate-code\n\nAll 150 have `result=true` in both prod and dev. The pattern is: validate-code + result=true + prod has message + dev omits message.\n\nSearch: `grep 'missing-in-dev.*message' jobs/2026-02-round-1/results/deltas/deltas.ndjson | wc -l` → 48 lines (38 with actual message param diff after filtering false positives from grep matching \"message\" elsewhere in the line).\n\nVerified in full comparison.ndjson: all 150 records where prod has a message param and dev doesn't have dev result=true (0 with result=false, 0 with no result).\n\n\nTolerance ID: validate-code-missing-message-on-true. Matches validate-code Parameters responses where result=true, prod has a message parameter, and dev does not. Normalizes by stripping the message parameter from prod (since dev doesn't have it and we can't fabricate it). This is a lossy normalization — it hides the missing warning, but the warning content is already present in the issues OperationOutcome.\n\n\ne934228b-f819-4119-bdd2-dcf4a72988bc — POST /r4/CodeSystem/$validate-code for ICD-9-CM code 441.", "body_html": "<p>Records-Impacted: 150<br>\nTolerance-ID: validate-code-missing-message-on-true<br>\nRecord-ID: e934228b-f819-4119-bdd2-dcf4a72988bc</p>\n<pre><code class=\"lang-bash\">curl -s &quot;https://tx.fhir.org/r4/CodeSystem/\\$validate-code&quot; \\\n-H &quot;Accept: application/fhir+json&quot; \\\n-H &quot;Content-Type: application/fhir+json&quot; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/sid/icd-9-cm&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;441&quot;}]}&#x27;\n\ncurl -s &quot;https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code&quot; \\\n-H &quot;Accept: application/fhir+json&quot; \\\n-H &quot;Content-Type: application/fhir+json&quot; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/sid/icd-9-cm&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;441&quot;}]}&#x27;</code></pre>\n<p>Prod returns <code>result: true</code> with a <code>message</code> parameter: &quot;Unknown Code &#x27;441&#x27; in the CodeSystem &#x27;<a href=\"http://hl7.org/fhir/sid/icd-9-cm&#x27;\" target=\"_blank\">http://hl7.org/fhir/sid/icd-9-cm&#x27;</a> version &#x27;2015&#x27; - note that the code system is labeled as a fragment, so the code may be valid in some other fragment&quot;. Dev returns <code>result: true</code> but omits the <code>message</code> parameter entirely.</p>\n<p>Dev omits the <code>message</code> output parameter on $validate-code responses when <code>result=true</code>. Prod includes it. The FHIR spec explicitly states that when result is true, the message parameter &quot;carries hints and warnings.&quot;</p>\n<p>In this dataset, all 150 affected records have <code>result=true</code> and prod returns a <code>message</code> containing warnings like &quot;Unknown Code &#x27;441&#x27; in the CodeSystem &#x27;<a href=\"http://hl7.org/fhir/sid/icd-9-cm&#x27;\" target=\"_blank\">http://hl7.org/fhir/sid/icd-9-cm&#x27;</a> version &#x27;2015&#x27; - note that the code system is labeled as a fragment, so the code may be valid in some other fragment.&quot;</p>\n<p>When <code>result=false</code>, dev correctly includes the <code>message</code> parameter.</p>\n<p>150 records in comparison.ndjson (38 in current deltas after other tolerances):</p>\n<ul><li>111 POST /r4/ValueSet/$validate-code</li><li>39 POST /r4/CodeSystem/$validate-code</li></ul>\n<p>All 150 have <code>result=true</code> in both prod and dev. The pattern is: validate-code + result=true + prod has message + dev omits message.</p>\n<p>Search: <code>grep &#x27;missing-in-dev.*message&#x27; jobs/2026-02-round-1/results/deltas/deltas.ndjson | wc -l</code> → 48 lines (38 with actual message param diff after filtering false positives from grep matching &quot;message&quot; elsewhere in the line).</p>\n<p>Verified in full comparison.ndjson: all 150 records where prod has a message param and dev doesn&#x27;t have dev result=true (0 with result=false, 0 with no result).</p>\n<p>Tolerance ID: validate-code-missing-message-on-true. Matches validate-code Parameters responses where result=true, prod has a message parameter, and dev does not. Normalizes by stripping the message parameter from prod (since dev doesn&#x27;t have it and we can&#x27;t fabricate it). This is a lossy normalization — it hides the missing warning, but the warning content is already present in the issues OperationOutcome.</p>\n<p>e934228b-f819-4119-bdd2-dcf4a72988bc — POST /r4/CodeSystem/$validate-code for ICD-9-CM code 441.</p>", "impact": 150}, {"id": "cff4061", "title": "HCPCS CodeSystem loaded in dev but unknown in prod — 110 result-disagrees", "status": "closed", "labels": ["reproduced", "result-disagrees", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:38", "date_iso": "2026-02-08T13:38:00-06:00", "body_md": "Records-Impacted: 123\nTolerance-ID: hcpcs-codesystem-availability\nRecord-ID: 238a26b7-46b6-4095-a3ba-364b1973da4d\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/CodeSystem/$validate-code?system=http://www.cms.gov/Medicare/Coding/HCPCSReleaseCodeSets&code=G0154' \\\n-H 'Accept: application/fhir+json'\n\ncurl -s 'https://tx-dev.fhir.org/r4/CodeSystem/$validate-code?system=http://www.cms.gov/Medicare/Coding/HCPCSReleaseCodeSets&code=G0154' \\\n-H 'Accept: application/fhir+json'\n```\n\nProd returns `result: false` with `x-caused-by-unknown-system` (\"A definition for CodeSystem 'http://www.cms.gov/Medicare/Coding/HCPCSReleaseCodeSets' could not be found\"). Dev returns `result: true` with `version: \"2025-01\"` and `display: \"health or hospice setting, each 15 minutes\"`.\n\n\nFor $validate-code requests involving system http://www.cms.gov/Medicare/Coding/HCPCSReleaseCodeSets, prod returns result=false with the error \"A definition for CodeSystem 'http://www.cms.gov/Medicare/Coding/HCPCSReleaseCodeSets' could not be found, so the code cannot be validated\" and x-caused-by-unknown-system. Dev returns result=true with version 2025-01, display text, system, and code parameters — successfully finding and validating the codes.\n\nThe diagnostics confirm: prod says \"CodeSystem not found: http://www.cms.gov/Medicare/Coding/HCPCSReleaseCodeSets\" while dev says \"CodeSystem found: http://www.cms.gov/Medicare/Coding/HCPCSReleaseCodeSets|2025-01\".\n\n\n123 delta records mention HCPCS (all validate-code operations):\n- 110 result-disagrees: prod=false dev=true (prod doesn't have HCPCS, dev does)\n- 4 result-disagrees: prod=true dev=false (code 33206, likely a different sub-issue)\n- 9 content-differs: same result but differences in surrounding content\n\nSearched with: grep -c 'HCPCSReleaseCodeSets' jobs/2026-02-round-1/results/deltas/deltas.ndjson\nAll 110 prod=false/dev=true records have x-caused-by-unknown-system pointing to HCPCSReleaseCodeSets.\n\n\nTolerance ID: hcpcs-codesystem-availability. Matches validate-code records where prod has x-caused-by-unknown-system for HCPCSReleaseCodeSets and dev returns result=true. Skips these records since the root cause is code system availability, not a logic bug.", "body_html": "<p>Records-Impacted: 123<br>\nTolerance-ID: hcpcs-codesystem-availability<br>\nRecord-ID: 238a26b7-46b6-4095-a3ba-364b1973da4d</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/CodeSystem/$validate-code?system=http://www.cms.gov/Medicare/Coding/HCPCSReleaseCodeSets&amp;code=G0154&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/CodeSystem/$validate-code?system=http://www.cms.gov/Medicare/Coding/HCPCSReleaseCodeSets&amp;code=G0154&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27;</code></pre>\n<p>Prod returns <code>result: false</code> with <code>x-caused-by-unknown-system</code> (&quot;A definition for CodeSystem &#x27;<a href=\"http://www.cms.gov/Medicare/Coding/HCPCSReleaseCodeSets&#x27;\" target=\"_blank\">http://www.cms.gov/Medicare/Coding/HCPCSReleaseCodeSets&#x27;</a> could not be found&quot;). Dev returns <code>result: true</code> with <code>version: &quot;2025-01&quot;</code> and <code>display: &quot;health or hospice setting, each 15 minutes&quot;</code>.</p>\n<p>For $validate-code requests involving system <a href=\"http://www.cms.gov/Medicare/Coding/HCPCSReleaseCodeSets,\" target=\"_blank\">http://www.cms.gov/Medicare/Coding/HCPCSReleaseCodeSets,</a> prod returns result=false with the error &quot;A definition for CodeSystem &#x27;<a href=\"http://www.cms.gov/Medicare/Coding/HCPCSReleaseCodeSets&#x27;\" target=\"_blank\">http://www.cms.gov/Medicare/Coding/HCPCSReleaseCodeSets&#x27;</a> could not be found, so the code cannot be validated&quot; and x-caused-by-unknown-system. Dev returns result=true with version 2025-01, display text, system, and code parameters — successfully finding and validating the codes.</p>\n<p>The diagnostics confirm: prod says &quot;CodeSystem not found: <a href=\"http://www.cms.gov/Medicare/Coding/HCPCSReleaseCodeSets&quot;\" target=\"_blank\">http://www.cms.gov/Medicare/Coding/HCPCSReleaseCodeSets&quot;</a> while dev says &quot;CodeSystem found: <a href=\"http://www.cms.gov/Medicare/Coding/HCPCSReleaseCodeSets|2025-01&quot;.\" target=\"_blank\">http://www.cms.gov/Medicare/Coding/HCPCSReleaseCodeSets|2025-01&quot;.</a></p>\n<p>123 delta records mention HCPCS (all validate-code operations):</p>\n<ul><li>110 result-disagrees: prod=false dev=true (prod doesn&#x27;t have HCPCS, dev does)</li><li>4 result-disagrees: prod=true dev=false (code 33206, likely a different sub-issue)</li><li>9 content-differs: same result but differences in surrounding content</li></ul>\n<p>Searched with: grep -c &#x27;HCPCSReleaseCodeSets&#x27; jobs/2026-02-round-1/results/deltas/deltas.ndjson<br>\nAll 110 prod=false/dev=true records have x-caused-by-unknown-system pointing to HCPCSReleaseCodeSets.</p>\n<p>Tolerance ID: hcpcs-codesystem-availability. Matches validate-code records where prod has x-caused-by-unknown-system for HCPCSReleaseCodeSets and dev returns result=true. Skips these records since the root cause is code system availability, not a logic bug.</p>", "impact": 123}, {"id": "9fd2328", "title": "Dev loads older SNOMED CT edition (20240201) than prod (20250201), causing  to return different code sets", "status": "closed", "labels": ["config-issue", "content-differs", "reproduced", "round:2026-02-round-2", "to-discuss", "tx-compare", "won't-fix"], "author": "Claude (AI Assistant)", "date": "2026-02-08 19:49", "date_iso": "2026-02-08T19:49:55-06:00", "body_md": "Records-Impacted: 82\nTolerance-ID: expand-snomed-version-skew-content, expand-snomed-version-skew-content-no-used-cs, snomed-version-skew-message-text\nRecord-ID: 2c7143df-3316-422a-b284-237f16fbcd6e, accdb602-a8bc-4e9c-a8fb-22a12b740f0e, 3534e5f0-39e3-4375-9b37-4dc59848cb70\n\n## What differs\n\nProd and dev load different SNOMED CT editions, causing multiple types of differences across $expand and $validate-code operations. Three variants observed:\n\n1. **$expand with `used-codesystem` parameter** (POST requests with inline ValueSets): Prod uses SNOMED International edition 20250201, dev uses 20240201. The `used-codesystem` expansion parameter confirms the version difference. Example: expanding descendants of 365636006 \"Finding of blood group\" — prod returns 208 codes, dev returns 207 (code 1351894008 \"Mixed field RhD\" only in prod).\n\n2. **$expand without `used-codesystem` parameter** (GET requests for VSAC ValueSets): Prod uses SNOMED US edition 20250901, dev uses 20250301. Version difference is only visible in `contains[].version` strings. Example: ValueSet 2.16.840.1.113762.1.4.1240.3 (\"Sex\") — dev returns 5 codes including 184115007 \"Patient sex unknown (finding)\" which is absent from prod's 4-code expansion.\n\n3. **$validate-code message/issues text version skew**: Both sides agree on result=false, but the error message text and OperationOutcome issue text contain different SNOMED edition version strings (e.g., \"version 'http://snomed.info/sct/900000000000207008/version/20250201'\" in prod vs \"version/20240201\" in dev). The message structure and content are otherwise identical — only the embedded version URI differs. All are POST /r4/ValueSet/$validate-code with SNOMED codes that are not found in the specified ValueSet.\n\n## How widespread\n\n82 records total:\n- 40 expand records with `used-codesystem` parameter (POST /r4/ValueSet/$expand with SNOMED filters)\n- 7 expand records without `used-codesystem` parameter (GET /r4/ValueSet/$expand for VSAC ValueSet 2.16.840.1.113762.1.4.1240.3)\n- 35 validate-code content-differs records where message/issues text contain SNOMED version strings that differ only due to edition version skew\n\n## What the tolerances cover\n\n- **`expand-snomed-version-skew-content`** (40 records): Matches expand records where both sides return 200, SNOMED `used-codesystem` versions differ, and code membership differs. Normalizes both sides to the intersection of codes and adjusts total.\n\n- **`expand-snomed-version-skew-content-no-used-cs`** (7 records): Matches expand records where SNOMED version skew is detectable only from `contains[].version` strings (no `used-codesystem` expansion parameter). Same normalization approach — intersects code membership, adjusts total, and normalizes version strings to prod's values.\n\n- **`snomed-version-skew-message-text`** (35 records): Matches validate-code Parameters responses where SNOMED version strings in the `message` valueString and `issues` OperationOutcome issue text differ, but the text is otherwise identical after version normalization. Replaces dev's SNOMED version URIs with prod's values in both the message parameter and issue detail text fields.", "body_html": "<p>Records-Impacted: 82<br>\nTolerance-ID: expand-snomed-version-skew-content, expand-snomed-version-skew-content-no-used-cs, snomed-version-skew-message-text<br>\nRecord-ID: 2c7143df-3316-422a-b284-237f16fbcd6e, accdb602-a8bc-4e9c-a8fb-22a12b740f0e, 3534e5f0-39e3-4375-9b37-4dc59848cb70</p>\n<h2>What differs</h2>\n<p>Prod and dev load different SNOMED CT editions, causing multiple types of differences across $expand and $validate-code operations. Three variants observed:</p>\n<ol><li>**$expand with <code>used-codesystem</code> parameter** (POST requests with inline ValueSets): Prod uses SNOMED International edition 20250201, dev uses 20240201. The <code>used-codesystem</code> expansion parameter confirms the version difference. Example: expanding descendants of 365636006 &quot;Finding of blood group&quot; — prod returns 208 codes, dev returns 207 (code 1351894008 &quot;Mixed field RhD&quot; only in prod).</li></ol>\n<ol><li>**$expand without <code>used-codesystem</code> parameter** (GET requests for VSAC ValueSets): Prod uses SNOMED US edition 20250901, dev uses 20250301. Version difference is only visible in <code>contains[].version</code> strings. Example: ValueSet 2.16.840.1.113762.1.4.1240.3 (&quot;Sex&quot;) — dev returns 5 codes including 184115007 &quot;Patient sex unknown (finding)&quot; which is absent from prod&#x27;s 4-code expansion.</li></ol>\n<ol><li><strong>$validate-code message/issues text version skew</strong>: Both sides agree on result=false, but the error message text and OperationOutcome issue text contain different SNOMED edition version strings (e.g., &quot;version &#x27;<a href=\"http://snomed.info/sct/900000000000207008/version/20250201&#x27;&quot;\" target=\"_blank\">http://snomed.info/sct/900000000000207008/version/20250201&#x27;&quot;</a> in prod vs &quot;version/20240201&quot; in dev). The message structure and content are otherwise identical — only the embedded version URI differs. All are POST /r4/ValueSet/$validate-code with SNOMED codes that are not found in the specified ValueSet.</li></ol>\n<h2>How widespread</h2>\n<p>82 records total:</p>\n<ul><li>40 expand records with <code>used-codesystem</code> parameter (POST /r4/ValueSet/$expand with SNOMED filters)</li><li>7 expand records without <code>used-codesystem</code> parameter (GET /r4/ValueSet/$expand for VSAC ValueSet 2.16.840.1.113762.1.4.1240.3)</li><li>35 validate-code content-differs records where message/issues text contain SNOMED version strings that differ only due to edition version skew</li></ul>\n<h2>What the tolerances cover</h2>\n<ul><li>**<code>expand-snomed-version-skew-content</code>** (40 records): Matches expand records where both sides return 200, SNOMED <code>used-codesystem</code> versions differ, and code membership differs. Normalizes both sides to the intersection of codes and adjusts total.</li></ul>\n<ul><li>**<code>expand-snomed-version-skew-content-no-used-cs</code>** (7 records): Matches expand records where SNOMED version skew is detectable only from <code>contains[].version</code> strings (no <code>used-codesystem</code> expansion parameter). Same normalization approach — intersects code membership, adjusts total, and normalizes version strings to prod&#x27;s values.</li></ul>\n<ul><li>**<code>snomed-version-skew-message-text</code>** (35 records): Matches validate-code Parameters responses where SNOMED version strings in the <code>message</code> valueString and <code>issues</code> OperationOutcome issue text differ, but the text is otherwise identical after version normalization. Replaces dev&#x27;s SNOMED version URIs with prod&#x27;s values in both the message parameter and issue detail text fields.</li></ul>", "impact": 82}, {"id": "f588f80", "title": "Dev echoes display param on failed validate-code when CodeSystem unknown", "status": "closed", "labels": ["content-differs", "reproduced", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:38", "date_iso": "2026-02-08T13:38:00-06:00", "body_md": "Records-Impacted: 74\nTolerance-ID: validate-code-display-echo-on-unknown-system\nRecord-ID: d9457f4d-39c0-445a-96d4-0721961e169d\n\n\n```bash\ncurl -s \"https://tx.fhir.org/r4/CodeSystem/\\$validate-code\" \\\n-H \"Accept: application/fhir+json\" \\\n-H \"Content-Type: application/fhir+json\" \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"https://codesystem.x12.org/005010/1338\"},{\"name\":\"code\",\"valueCode\":\"U\"},{\"name\":\"display\",\"valueString\":\"Urgent\"}]}'\n\ncurl -s \"https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code\" \\\n-H \"Accept: application/fhir+json\" \\\n-H \"Content-Type: application/fhir+json\" \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"https://codesystem.x12.org/005010/1338\"},{\"name\":\"code\",\"valueCode\":\"U\"},{\"name\":\"display\",\"valueString\":\"Urgent\"}]}'\n```\n\nProd returns `result=false` with parameters: result, system, x-caused-by-unknown-system, code, message, issues -- no `display`. Dev returns all the same plus `display: \"Urgent\"` echoed from the request input.\n\n\nWhen $validate-code returns result=false because the CodeSystem is unknown (x-caused-by-unknown-system), dev echoes back the input `display` parameter in the response while prod omits it.\n\nFor example, validating code \"U\" against unknown system `https://codesystem.x12.org/005010/1338`:\n- Prod: returns result=false, system, code, message, x-caused-by-unknown-system, issues — no display parameter\n- Dev: returns all of the above PLUS `display: \"Urgent\"` (echoed from the request input)\n\nPer the FHIR spec, the output `display` parameter is \"a valid display for the concept if the system wishes to present it to users.\" When the CodeSystem is unknown, the server has no basis to return a valid display — it is simply echoing back the unvalidated input.\n\n\n74 records in deltas.ndjson match this pattern. 73 have `x-caused-by-unknown-system` in prod response; 1 has no system at all. All are $validate-code with result=false. Across 38+ distinct code systems including x12.org, various OID-based systems, and others.\n\nSearch: parsed all deltas.ndjson records where comparison.diffs includes {type: \"extra-in-dev\", param: \"display\"} and result=false.\n\n\nTolerance ID: `validate-code-display-echo-on-unknown-system`\nMatches: $validate-code Parameters responses where result=false, prod has no display parameter, and dev has a display parameter.\nNormalizes: strips the display parameter from dev to match prod.\nEliminates: 74 records (73 with only the display diff, 1 with additional message/issues diffs that will remain after normalization).\n\n\nd9457f4d-39c0-445a-96d4-0721961e169d — POST /r4/CodeSystem/$validate-code, code U in system https://codesystem.x12.org/005010/1338", "body_html": "<p>Records-Impacted: 74<br>\nTolerance-ID: validate-code-display-echo-on-unknown-system<br>\nRecord-ID: d9457f4d-39c0-445a-96d4-0721961e169d</p>\n<pre><code class=\"lang-bash\">curl -s &quot;https://tx.fhir.org/r4/CodeSystem/\\$validate-code&quot; \\\n-H &quot;Accept: application/fhir+json&quot; \\\n-H &quot;Content-Type: application/fhir+json&quot; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;https://codesystem.x12.org/005010/1338&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;U&quot;},{&quot;name&quot;:&quot;display&quot;,&quot;valueString&quot;:&quot;Urgent&quot;}]}&#x27;\n\ncurl -s &quot;https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code&quot; \\\n-H &quot;Accept: application/fhir+json&quot; \\\n-H &quot;Content-Type: application/fhir+json&quot; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;https://codesystem.x12.org/005010/1338&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;U&quot;},{&quot;name&quot;:&quot;display&quot;,&quot;valueString&quot;:&quot;Urgent&quot;}]}&#x27;</code></pre>\n<p>Prod returns <code>result=false</code> with parameters: result, system, x-caused-by-unknown-system, code, message, issues -- no <code>display</code>. Dev returns all the same plus <code>display: &quot;Urgent&quot;</code> echoed from the request input.</p>\n<p>When $validate-code returns result=false because the CodeSystem is unknown (x-caused-by-unknown-system), dev echoes back the input <code>display</code> parameter in the response while prod omits it.</p>\n<p>For example, validating code &quot;U&quot; against unknown system <code>https://codesystem.x12.org/005010/1338</code>:</p>\n<ul><li>Prod: returns result=false, system, code, message, x-caused-by-unknown-system, issues — no display parameter</li><li>Dev: returns all of the above PLUS <code>display: &quot;Urgent&quot;</code> (echoed from the request input)</li></ul>\n<p>Per the FHIR spec, the output <code>display</code> parameter is &quot;a valid display for the concept if the system wishes to present it to users.&quot; When the CodeSystem is unknown, the server has no basis to return a valid display — it is simply echoing back the unvalidated input.</p>\n<p>74 records in deltas.ndjson match this pattern. 73 have <code>x-caused-by-unknown-system</code> in prod response; 1 has no system at all. All are $validate-code with result=false. Across 38+ distinct code systems including x12.org, various OID-based systems, and others.</p>\n<p>Search: parsed all deltas.ndjson records where comparison.diffs includes {type: &quot;extra-in-dev&quot;, param: &quot;display&quot;} and result=false.</p>\n<p>Tolerance ID: <code>validate-code-display-echo-on-unknown-system</code><br>\nMatches: $validate-code Parameters responses where result=false, prod has no display parameter, and dev has a display parameter.<br>\nNormalizes: strips the display parameter from dev to match prod.<br>\nEliminates: 74 records (73 with only the display diff, 1 with additional message/issues diffs that will remain after normalization).</p>\n<p>d9457f4d-39c0-445a-96d4-0721961e169d — POST /r4/CodeSystem/$validate-code, code U in system <a href=\"https://codesystem.x12.org/005010/1338\" target=\"_blank\">https://codesystem.x12.org/005010/1338</a></p>", "impact": 74}, {"id": "39d9af6", "title": "SNOMED display text differs for same edition version", "status": "closed", "labels": ["content-differs", "reproduced", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:38", "date_iso": "2026-02-08T13:38:01-06:00", "body_md": "Records-Impacted: 59\nTolerance-ID: snomed-same-version-display-differs\nRecord-ID: 9e9e9c20-cc34-43f8-a0fa-54e8cac48e55\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/CodeSystem/$validate-code?url=http://snomed.info/sct&code=48546005' \\\n-H 'Accept: application/fhir+json'\n\ncurl -s 'https://tx-dev.fhir.org/r4/CodeSystem/$validate-code?url=http://snomed.info/sct&code=48546005' \\\n-H 'Accept: application/fhir+json'\n```\n\nProd returns `display: \"Product containing diazepam (medicinal product)\"`, dev returns `display: \"Diazepam\"`. Both report version `http://snomed.info/sct/900000000000207008/version/20250201`. Also confirmed with code 409063005: prod returns `\"Counselling\"`, dev returns `\"Counseling (regime/therapy)\"`.\n\n\nFor SNOMED $validate-code requests where both prod and dev report the same SNOMED CT edition version (e.g., 20250201), the display text returned for certain codes differs between the two servers. Examples:\n\n- Code 10019 (Diazepam product): prod=\"Product containing diazepam (medicinal product)\", dev=\"Diazepam\"\n- Code 385049006 (Capsule): prod=\"Capsule\", dev=\"Capsule (product)\"\n- Code 44808001 (Counselling): prod=\"Counselling\", dev=\"Counseling (regime/therapy)\"\n- Code 15188001 (Hearing loss): prod=\"Hearing loss\", dev=\"Deafness\"\n- Code 46635009 (Diabetes type I): prod=\"Diabetes mellitus type I\", dev=\"Insulin dependent diabetes mellitus\"\n\nBoth servers agree on result=true, system, code, and version. Only the display (preferred term) differs.\n\n\n59 validate-code records show this pattern. All involve http://snomed.info/sct with matching version strings (primarily 20250201). Found via:\n\ngrep '\"param\":\"display\"' results/deltas/deltas.ndjson | grep 'snomed'\n\nthen filtering to records where prod and dev version parameters are identical.\n\n\nTolerance ID: snomed-same-version-display-differs. Matches SNOMED validate-code Parameters responses where versions are identical but display text differs. Normalizes both sides to prod's display value.", "body_html": "<p>Records-Impacted: 59<br>\nTolerance-ID: snomed-same-version-display-differs<br>\nRecord-ID: 9e9e9c20-cc34-43f8-a0fa-54e8cac48e55</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/CodeSystem/$validate-code?url=http://snomed.info/sct&amp;code=48546005&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/CodeSystem/$validate-code?url=http://snomed.info/sct&amp;code=48546005&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27;</code></pre>\n<p>Prod returns <code>display: &quot;Product containing diazepam (medicinal product)&quot;</code>, dev returns <code>display: &quot;Diazepam&quot;</code>. Both report version <code>http://snomed.info/sct/900000000000207008/version/20250201</code>. Also confirmed with code 409063005: prod returns <code>&quot;Counselling&quot;</code>, dev returns <code>&quot;Counseling (regime/therapy)&quot;</code>.</p>\n<p>For SNOMED $validate-code requests where both prod and dev report the same SNOMED CT edition version (e.g., 20250201), the display text returned for certain codes differs between the two servers. Examples:</p>\n<ul><li>Code 10019 (Diazepam product): prod=&quot;Product containing diazepam (medicinal product)&quot;, dev=&quot;Diazepam&quot;</li><li>Code 385049006 (Capsule): prod=&quot;Capsule&quot;, dev=&quot;Capsule (product)&quot;</li><li>Code 44808001 (Counselling): prod=&quot;Counselling&quot;, dev=&quot;Counseling (regime/therapy)&quot;</li><li>Code 15188001 (Hearing loss): prod=&quot;Hearing loss&quot;, dev=&quot;Deafness&quot;</li><li>Code 46635009 (Diabetes type I): prod=&quot;Diabetes mellitus type I&quot;, dev=&quot;Insulin dependent diabetes mellitus&quot;</li></ul>\n<p>Both servers agree on result=true, system, code, and version. Only the display (preferred term) differs.</p>\n<p>59 validate-code records show this pattern. All involve <a href=\"http://snomed.info/sct\" target=\"_blank\">http://snomed.info/sct</a> with matching version strings (primarily 20250201). Found via:</p>\n<p>grep &#x27;&quot;param&quot;:&quot;display&quot;&#x27; results/deltas/deltas.ndjson | grep &#x27;snomed&#x27;</p>\n<p>then filtering to records where prod and dev version parameters are identical.</p>\n<p>Tolerance ID: snomed-same-version-display-differs. Matches SNOMED validate-code Parameters responses where versions are identical but display text differs. Normalizes both sides to prod&#x27;s display value.</p>", "impact": 59}, {"id": "4aebc14", "title": "Dev -code result=false for SNOMED codes valid in prod due to older SNOMED edition", "status": "closed", "labels": ["config-issue", "reproduced", "result-disagrees", "round:2026-02-round-2", "to-discuss", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 18:48", "date_iso": "2026-02-08T18:48:31-06:00", "body_md": "Records-Impacted: 57\nTolerance-ID: snomed-version-skew-validate-code-result-disagrees\nRecord-ID: a74520f2-677a-41d4-a489-57b323c8dfb9\n\n## Repro\n\n```bash\n# Prod\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$validate-code?' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"coding\",\"valueCoding\":{\"system\":\"http://snomed.info/sct\",\"code\":\"39154008\",\"display\":\"Clinical diagnosis\"}},{\"name\":\"valueSetMode\",\"valueString\":\"NO_MEMBERSHIP_CHECK\"},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true},{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"id\":\"ndhm-diagnosis-use\",\"url\":\"https://nrces.in/ndhm/fhir/r4/ValueSet/ndhm-diagnosis-use\",\"version\":\"6.5.0\",\"compose\":{\"include\":[{\"system\":\"http://snomed.info/sct\",\"filter\":[{\"property\":\"concept\",\"op\":\"is-a\",\"value\":\"106229004\"}]}],\"exclude\":[{\"system\":\"http://snomed.info/sct\",\"concept\":[{\"code\":\"106229004\",\"display\":\"Qualifier for type of diagnosis\"}]}]}}},{\"name\":\"system-version\",\"valueString\":\"http://snomed.info/sct|http://snomed.info/sct/900000000000207008\"}]}'\n\n# Dev\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$validate-code?' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"coding\",\"valueCoding\":{\"system\":\"http://snomed.info/sct\",\"code\":\"39154008\",\"display\":\"Clinical diagnosis\"}},{\"name\":\"valueSetMode\",\"valueString\":\"NO_MEMBERSHIP_CHECK\"},{\"name\":\"default-to-latest-version\",\"valueBoolean\":true},{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"id\":\"ndhm-diagnosis-use\",\"url\":\"https://nrces.in/ndhm/fhir/r4/ValueSet/ndhm-diagnosis-use\",\"version\":\"6.5.0\",\"compose\":{\"include\":[{\"system\":\"http://snomed.info/sct\",\"filter\":[{\"property\":\"concept\",\"op\":\"is-a\",\"value\":\"106229004\"}]}],\"exclude\":[{\"system\":\"http://snomed.info/sct\",\"concept\":[{\"code\":\"106229004\",\"display\":\"Qualifier for type of diagnosis\"}]}]}}},{\"name\":\"system-version\",\"valueString\":\"http://snomed.info/sct|http://snomed.info/sct/900000000000207008\"}]}'\n```\n\nProd returns `result: true` with SNOMED version 20250201. Dev returns `result: false` with SNOMED version 20240201 and an error message that code 39154008 was not found in the ValueSet.\n\n## What differs\n\nOn ValueSet $validate-code operations with SNOMED CT codes, prod returns result=true while dev returns result=false. The root cause is that dev loads older SNOMED CT editions than prod (e.g., International 20240201 vs 20250201, US 20240201 vs 20250901). When a ValueSet uses hierarchy-based filters (e.g., is-a or descendent-of), the code membership can differ between SNOMED versions because the hierarchical relationships change between editions.\n\nFor example, in the representative record, SNOMED code 39154008 (\"Clinical diagnosis\") is validated against ValueSet ndhm-diagnosis-use (which filters for descendants of 106229004 \"Qualifier for type of diagnosis\"). Prod (version 20250201) says the code is in the ValueSet; dev (version 20240201) says it is not.\n\n## How widespread\n\n57 records in the full comparison.ndjson have SNOMED version-skewed validate-code result disagreements. Of those, 12 still appear in deltas.ndjson (the remaining 45 are already handled by other tolerances, likely because they also have status mismatches). Found via:\n\n```python\n# Check all validate-code records for SNOMED version skew + result disagreement\n# across comparison.ndjson\n```\n\nAffected SNOMED modules: International (20240201 vs 20250201) and US (20240201/20230301 vs 20250901). Multiple codes affected: 39154008, 116154003, 309343006, 1287116005, 428041000124106, and others.\n\n## What the tolerance covers\n\nTolerance `snomed-version-skew-validate-code-result-disagrees` skips validate-code records where both prod and dev return 200, both have SNOMED version parameters that differ, and the result boolean disagrees. This is the validate-code counterpart of the existing expand-snomed-version-skew-content tolerance (bug 9fd2328). Eliminates 1 delta record (the others are already handled by existing status-mismatch tolerances).\n\n## Related\n\nSame root cause as bug 9fd2328 (Dev loads older SNOMED CT edition), which covers $expand operations.", "body_html": "<p>Records-Impacted: 57<br>\nTolerance-ID: snomed-version-skew-validate-code-result-disagrees<br>\nRecord-ID: a74520f2-677a-41d4-a489-57b323c8dfb9</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod\ncurl -s &#x27;https://tx.fhir.org/r4/ValueSet/$validate-code?&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;coding&quot;,&quot;valueCoding&quot;:{&quot;system&quot;:&quot;http://snomed.info/sct&quot;,&quot;code&quot;:&quot;39154008&quot;,&quot;display&quot;:&quot;Clinical diagnosis&quot;}},{&quot;name&quot;:&quot;valueSetMode&quot;,&quot;valueString&quot;:&quot;NO_MEMBERSHIP_CHECK&quot;},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true},{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;id&quot;:&quot;ndhm-diagnosis-use&quot;,&quot;url&quot;:&quot;https://nrces.in/ndhm/fhir/r4/ValueSet/ndhm-diagnosis-use&quot;,&quot;version&quot;:&quot;6.5.0&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;http://snomed.info/sct&quot;,&quot;filter&quot;:[{&quot;property&quot;:&quot;concept&quot;,&quot;op&quot;:&quot;is-a&quot;,&quot;value&quot;:&quot;106229004&quot;}]}],&quot;exclude&quot;:[{&quot;system&quot;:&quot;http://snomed.info/sct&quot;,&quot;concept&quot;:[{&quot;code&quot;:&quot;106229004&quot;,&quot;display&quot;:&quot;Qualifier for type of diagnosis&quot;}]}]}}},{&quot;name&quot;:&quot;system-version&quot;,&quot;valueString&quot;:&quot;http://snomed.info/sct|http://snomed.info/sct/900000000000207008&quot;}]}&#x27;\n\n# Dev\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$validate-code?&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;coding&quot;,&quot;valueCoding&quot;:{&quot;system&quot;:&quot;http://snomed.info/sct&quot;,&quot;code&quot;:&quot;39154008&quot;,&quot;display&quot;:&quot;Clinical diagnosis&quot;}},{&quot;name&quot;:&quot;valueSetMode&quot;,&quot;valueString&quot;:&quot;NO_MEMBERSHIP_CHECK&quot;},{&quot;name&quot;:&quot;default-to-latest-version&quot;,&quot;valueBoolean&quot;:true},{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;id&quot;:&quot;ndhm-diagnosis-use&quot;,&quot;url&quot;:&quot;https://nrces.in/ndhm/fhir/r4/ValueSet/ndhm-diagnosis-use&quot;,&quot;version&quot;:&quot;6.5.0&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;http://snomed.info/sct&quot;,&quot;filter&quot;:[{&quot;property&quot;:&quot;concept&quot;,&quot;op&quot;:&quot;is-a&quot;,&quot;value&quot;:&quot;106229004&quot;}]}],&quot;exclude&quot;:[{&quot;system&quot;:&quot;http://snomed.info/sct&quot;,&quot;concept&quot;:[{&quot;code&quot;:&quot;106229004&quot;,&quot;display&quot;:&quot;Qualifier for type of diagnosis&quot;}]}]}}},{&quot;name&quot;:&quot;system-version&quot;,&quot;valueString&quot;:&quot;http://snomed.info/sct|http://snomed.info/sct/900000000000207008&quot;}]}&#x27;</code></pre>\n<p>Prod returns <code>result: true</code> with SNOMED version 20250201. Dev returns <code>result: false</code> with SNOMED version 20240201 and an error message that code 39154008 was not found in the ValueSet.</p>\n<h2>What differs</h2>\n<p>On ValueSet $validate-code operations with SNOMED CT codes, prod returns result=true while dev returns result=false. The root cause is that dev loads older SNOMED CT editions than prod (e.g., International 20240201 vs 20250201, US 20240201 vs 20250901). When a ValueSet uses hierarchy-based filters (e.g., is-a or descendent-of), the code membership can differ between SNOMED versions because the hierarchical relationships change between editions.</p>\n<p>For example, in the representative record, SNOMED code 39154008 (&quot;Clinical diagnosis&quot;) is validated against ValueSet ndhm-diagnosis-use (which filters for descendants of 106229004 &quot;Qualifier for type of diagnosis&quot;). Prod (version 20250201) says the code is in the ValueSet; dev (version 20240201) says it is not.</p>\n<h2>How widespread</h2>\n<p>57 records in the full comparison.ndjson have SNOMED version-skewed validate-code result disagreements. Of those, 12 still appear in deltas.ndjson (the remaining 45 are already handled by other tolerances, likely because they also have status mismatches). Found via:</p>\n<pre><code class=\"lang-python\"># Check all validate-code records for SNOMED version skew + result disagreement\n# across comparison.ndjson</code></pre>\n<p>Affected SNOMED modules: International (20240201 vs 20250201) and US (20240201/20230301 vs 20250901). Multiple codes affected: 39154008, 116154003, 309343006, 1287116005, 428041000124106, and others.</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance <code>snomed-version-skew-validate-code-result-disagrees</code> skips validate-code records where both prod and dev return 200, both have SNOMED version parameters that differ, and the result boolean disagrees. This is the validate-code counterpart of the existing expand-snomed-version-skew-content tolerance (bug 9fd2328). Eliminates 1 delta record (the others are already handled by existing status-mismatch tolerances).</p>\n<h2>Related</h2>\n<p>Same root cause as bug 9fd2328 (Dev loads older SNOMED CT edition), which covers $expand operations.</p>", "impact": 57}, {"id": "a881823", "title": "CPT -code: dev fails to recognize valid CPT codes (result=false)", "status": "closed", "labels": ["reproduced", "result-disagrees", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:38", "date_iso": "2026-02-08T13:38:00-06:00", "body_md": "Records-Impacted: 45\nTolerance-ID: cpt-validate-code-result-disagrees\nRecord-ID: d05e7906-16ee-4915-8c8a-92137b4e62c7\n\n\n```bash\ncurl -s \"https://tx.fhir.org/r4/CodeSystem/\\$validate-code\" \\\n-H \"Accept: application/fhir+json\" \\\n-H \"Content-Type: application/fhir+json\" \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://www.ama-assn.org/go/cpt\"},{\"name\":\"code\",\"valueCode\":\"99214\"}]}'\n\ncurl -s \"https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code\" \\\n-H \"Accept: application/fhir+json\" \\\n-H \"Content-Type: application/fhir+json\" \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://www.ama-assn.org/go/cpt\"},{\"name\":\"code\",\"valueCode\":\"99214\"}]}'\n```\n\nProd returns `result: true` with display \"Office or other outpatient visit for the evaluation and management of an established patient...\" and version \"2023\". Dev returns `result: false` with \"Unknown code '99214' in the CodeSystem 'http://www.ama-assn.org/go/cpt' version '2023'\".\n\n\nDev returns `result: false` with \"Unknown code '<code>' in the CodeSystem 'http://www.ama-assn.org/go/cpt' version '2023'\" for CPT codes that prod successfully validates as `result: true`. Prod returns the code's display text and version; dev returns an error OperationOutcome with `code-invalid`.\n\nExample: CPT code 99214 (a standard E&M visit code). Prod validates it successfully with display text. Dev says it's unknown.\n\nThis affects 17 distinct CPT codes: 33206, 44211, 44401, 45346, 58545, 70551, 73722, 74263, 77061, 77081, 81528, 82274, 83036, 87624, 88175, 93978, 99214.\n\nBoth servers reference the same CodeSystem version (2023), suggesting dev has the CPT CodeSystem loaded but its concept list is incomplete or not being searched correctly.\n\n\n45 result-disagrees records total:\n- 41 on POST /r4/CodeSystem/$validate-code\n- 4 on POST /r4/ValueSet/$validate-code\n\nAll are prod=true/dev=false (dev never finds these codes). Searched with:\ngrep 'ama-assn.org/go/cpt' results/deltas/deltas.ndjson | grep result-disagrees\n\nThere are also 71 content-differs and 8 status-mismatch records for CPT (124 total CPT delta records), likely related to the same underlying data issue, but those are separate patterns.\n\n\nTolerance `cpt-validate-code-result-disagrees` skips all validate-code records where system is http://www.ama-assn.org/go/cpt and prod=true/dev=false (result-disagrees). Eliminates 45 records.", "body_html": "<p>Records-Impacted: 45<br>\nTolerance-ID: cpt-validate-code-result-disagrees<br>\nRecord-ID: d05e7906-16ee-4915-8c8a-92137b4e62c7</p>\n<pre><code class=\"lang-bash\">curl -s &quot;https://tx.fhir.org/r4/CodeSystem/\\$validate-code&quot; \\\n-H &quot;Accept: application/fhir+json&quot; \\\n-H &quot;Content-Type: application/fhir+json&quot; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://www.ama-assn.org/go/cpt&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;99214&quot;}]}&#x27;\n\ncurl -s &quot;https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code&quot; \\\n-H &quot;Accept: application/fhir+json&quot; \\\n-H &quot;Content-Type: application/fhir+json&quot; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://www.ama-assn.org/go/cpt&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;99214&quot;}]}&#x27;</code></pre>\n<p>Prod returns <code>result: true</code> with display &quot;Office or other outpatient visit for the evaluation and management of an established patient...&quot; and version &quot;2023&quot;. Dev returns <code>result: false</code> with &quot;Unknown code &#x27;99214&#x27; in the CodeSystem &#x27;<a href=\"http://www.ama-assn.org/go/cpt&#x27;\" target=\"_blank\">http://www.ama-assn.org/go/cpt&#x27;</a> version &#x27;2023&#x27;&quot;.</p>\n<p>Dev returns <code>result: false</code> with &quot;Unknown code &#x27;&lt;code&gt;&#x27; in the CodeSystem &#x27;<a href=\"http://www.ama-assn.org/go/cpt&#x27;\" target=\"_blank\">http://www.ama-assn.org/go/cpt&#x27;</a> version &#x27;2023&#x27;&quot; for CPT codes that prod successfully validates as <code>result: true</code>. Prod returns the code&#x27;s display text and version; dev returns an error OperationOutcome with <code>code-invalid</code>.</p>\n<p>Example: CPT code 99214 (a standard E&amp;M visit code). Prod validates it successfully with display text. Dev says it&#x27;s unknown.</p>\n<p>This affects 17 distinct CPT codes: 33206, 44211, 44401, 45346, 58545, 70551, 73722, 74263, 77061, 77081, 81528, 82274, 83036, 87624, 88175, 93978, 99214.</p>\n<p>Both servers reference the same CodeSystem version (2023), suggesting dev has the CPT CodeSystem loaded but its concept list is incomplete or not being searched correctly.</p>\n<p>45 result-disagrees records total:</p>\n<ul><li>41 on POST /r4/CodeSystem/$validate-code</li><li>4 on POST /r4/ValueSet/$validate-code</li></ul>\n<p>All are prod=true/dev=false (dev never finds these codes). Searched with:<br>\ngrep &#x27;ama-assn.org/go/cpt&#x27; results/deltas/deltas.ndjson | grep result-disagrees</p>\n<p>There are also 71 content-differs and 8 status-mismatch records for CPT (124 total CPT delta records), likely related to the same underlying data issue, but those are separate patterns.</p>\n<p>Tolerance <code>cpt-validate-code-result-disagrees</code> skips all validate-code records where system is <a href=\"http://www.ama-assn.org/go/cpt\" target=\"_blank\">http://www.ama-assn.org/go/cpt</a> and prod=true/dev=false (result-disagrees). Eliminates 45 records.</p>", "impact": 45}, {"id": "de3b882", "title": "CPT $expand: dev returns empty expansion (total=0) for ValueSets containing CPT codes", "status": "closed", "labels": ["content-differs", "reproduced", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:38", "date_iso": "2026-02-08T13:38:01-06:00", "body_md": "Records-Impacted: 45\nTolerance-ID: cpt-expand-empty-results\nRecord-ID: d03ce6c0-d498-4c96-9165-261fdecc484c\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$expand' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"ValueSet\",\"status\":\"active\",\"compose\":{\"include\":[{\"system\":\"http://www.ama-assn.org/go/cpt\",\"concept\":[{\"code\":\"83036\"}]}]}}'\n\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$expand' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"ValueSet\",\"status\":\"active\",\"compose\":{\"include\":[{\"system\":\"http://www.ama-assn.org/go/cpt\",\"concept\":[{\"code\":\"83036\"}]}]}}'\n```\n\nProd returns `total: 1` with CPT code 83036 (\"Hemoglobin; glycosylated (A1C)\") in `expansion.contains`. Dev returns `total: 0` with no `contains` array. Both report `used-codesystem: http://www.ama-assn.org/go/cpt|2023`.\n\n\nDev returns `total: 0` with no `expansion.contains` array for $expand requests involving CPT codes (`http://www.ama-assn.org/go/cpt|2023`). Prod returns `total: 1` (or more) with the expected CPT codes in `expansion.contains`.\n\nExample (record d03ce6c0): POST /r4/ValueSet/$expand for a ValueSet containing CPT code 83036 (\"Hemoglobin; glycosylated (A1C)\"). Prod returns the code in the expansion; dev returns an empty expansion with total=0.\n\nBoth servers use the same `used-codesystem` version (`http://www.ama-assn.org/go/cpt|2023`), indicating dev believes it has CPT loaded but fails to resolve any codes from it.\n\n\n45 out of 50 $expand delta records with CPT codes show this pattern. Found via:\n```bash\npython3 -c \"...\" # -> 45 of 46 CPT expand deltas\n```\n\nAll 45 records are POST /r4/ValueSet/$expand with `used-codesystem` of `http://www.ama-assn.org/go/cpt|2023`.\n\n\nSame root cause as bug f559b53 (CPT validate-code returns \"Unknown code\"). Dev's CPT data appears non-functional — codes are unknown for validation and absent from expansions.\n\n\nTolerance `cpt-expand-empty-results` matches POST /r4/ValueSet/$expand where dev returns total=0 and prod returns total>0, and the expansion uses CPT as a code system. Skips these records entirely since comparison is meaningless when dev has no CPT data.", "body_html": "<p>Records-Impacted: 45<br>\nTolerance-ID: cpt-expand-empty-results<br>\nRecord-ID: d03ce6c0-d498-4c96-9165-261fdecc484c</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/ValueSet/$expand&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;status&quot;:&quot;active&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;http://www.ama-assn.org/go/cpt&quot;,&quot;concept&quot;:[{&quot;code&quot;:&quot;83036&quot;}]}]}}&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;status&quot;:&quot;active&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;http://www.ama-assn.org/go/cpt&quot;,&quot;concept&quot;:[{&quot;code&quot;:&quot;83036&quot;}]}]}}&#x27;</code></pre>\n<p>Prod returns <code>total: 1</code> with CPT code 83036 (&quot;Hemoglobin; glycosylated (A1C)&quot;) in <code>expansion.contains</code>. Dev returns <code>total: 0</code> with no <code>contains</code> array. Both report <code>used-codesystem: http://www.ama-assn.org/go/cpt|2023</code>.</p>\n<p>Dev returns <code>total: 0</code> with no <code>expansion.contains</code> array for $expand requests involving CPT codes (<code>http://www.ama-assn.org/go/cpt|2023</code>). Prod returns <code>total: 1</code> (or more) with the expected CPT codes in <code>expansion.contains</code>.</p>\n<p>Example (record d03ce6c0): POST /r4/ValueSet/$expand for a ValueSet containing CPT code 83036 (&quot;Hemoglobin; glycosylated (A1C)&quot;). Prod returns the code in the expansion; dev returns an empty expansion with total=0.</p>\n<p>Both servers use the same <code>used-codesystem</code> version (<code>http://www.ama-assn.org/go/cpt|2023</code>), indicating dev believes it has CPT loaded but fails to resolve any codes from it.</p>\n<p>45 out of 50 $expand delta records with CPT codes show this pattern. Found via:</p>\n<pre><code class=\"lang-bash\">python3 -c &quot;...&quot; # -&gt; 45 of 46 CPT expand deltas</code></pre>\n<p>All 45 records are POST /r4/ValueSet/$expand with <code>used-codesystem</code> of <code>http://www.ama-assn.org/go/cpt|2023</code>.</p>\n<p>Same root cause as bug f559b53 (CPT validate-code returns &quot;Unknown code&quot;). Dev&#x27;s CPT data appears non-functional — codes are unknown for validation and absent from expansions.</p>\n<p>Tolerance <code>cpt-expand-empty-results</code> matches POST /r4/ValueSet/$expand where dev returns total=0 and prod returns total&gt;0, and the expansion uses CPT as a code system. Skips these records entirely since comparison is meaningless when dev has no CPT data.</p>", "impact": 45}, {"id": "c3069e3", "title": "Wrong Display Name message format differs: different display option count, formatting, and language tags", "status": "closed", "labels": ["P6", "reproduced", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:38", "date_iso": "2026-02-08T13:38:00-06:00", "body_md": "Records-Impacted: 44\nTolerance-ID: invalid-display-message-format\nRecord-ID: beb4276b-f937-46c3-81ab-7f63cb7798b7\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/CodeSystem/$validate-code' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"system\",\"valueUri\":\"urn:ietf:bcp:47\"},{\"name\":\"code\",\"valueCode\":\"en-US\"},{\"name\":\"display\",\"valueString\":\"English\"},{\"name\":\"displayLanguage\",\"valueCode\":\"en-US\"}]}'\n\ncurl -s 'https://tx-dev.fhir.org/r4/CodeSystem/$validate-code' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"system\",\"valueUri\":\"urn:ietf:bcp:47\"},{\"name\":\"code\",\"valueCode\":\"en-US\"},{\"name\":\"display\",\"valueString\":\"English\"},{\"name\":\"displayLanguage\",\"valueCode\":\"en-US\"}]}'\n```\n\nProd returns \"one of 6 choices\" with duplicate display options and no language tags; dev returns \"one of 3 choices\" with de-duplicated options and `(en)` language tags appended to each.\n\n\nWhen $validate-code detects a wrong display name, prod and dev return different error message text in both the `message` parameter and `issues` OperationOutcome `details.text`.\n\nSpecific differences:\n- **Display option count**: Prod may list duplicate display options (e.g., \"6 choices\" with repeats), while dev de-duplicates (e.g., \"3 choices\" with unique entries)\n- **Language tags**: Dev appends language tags like `(en)` after each display option; prod does not\n- **Example**: For `urn:ietf:bcp:47#en-US`:\n- Prod: \"Valid display is one of 6 choices: 'English (Region=United States)', 'English (United States)', 'English (Region=United States)', ...\"\n- Dev: \"Valid display is one of 3 choices: 'English (Region=United States)' (en), 'English (United States)' (en) or 'English (Region=United States)' (en) ...\"\n\nThe core validation result (`result: false`) agrees in all but 1 of 41 records. The difference is confined to the human-readable error message text.\n\n\n44 delta records have `invalid-display` issue type with only `message` and `issues` diffs. 41 records contain \"Wrong Display Name\" in the delta text.\n\nSearch: `grep -c 'Wrong Display Name' jobs/2026-02-round-1/results/deltas/deltas.ndjson` → 41\nSearch: `grep -c 'invalid-display' jobs/2026-02-round-1/results/deltas/deltas.ndjson` → 53 (44 with only message/issues diffs)\n\nAffected operations: $validate-code on both CodeSystem and ValueSet\nAffected systems: urn:ietf:bcp:47, http://snomed.info/sct, and others\n\n\nTolerance ID: `invalid-display-message-format`\nMatches: validate-code records where both prod and dev have `invalid-display` issue type and only the message/issues text differs. Normalizes the message and issues text to prod's version.\nExpected elimination: ~44 records.\n\n\n`beb4276b-f937-46c3-81ab-7f63cb7798b7` — grep -n 'beb4276b-f937-46c3-81ab-7f63cb7798b7' jobs/2026-02-round-1/comparison.ndjson", "body_html": "<p>Records-Impacted: 44<br>\nTolerance-ID: invalid-display-message-format<br>\nRecord-ID: beb4276b-f937-46c3-81ab-7f63cb7798b7</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/CodeSystem/$validate-code&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;system&quot;,&quot;valueUri&quot;:&quot;urn:ietf:bcp:47&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;en-US&quot;},{&quot;name&quot;:&quot;display&quot;,&quot;valueString&quot;:&quot;English&quot;},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueCode&quot;:&quot;en-US&quot;}]}&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/CodeSystem/$validate-code&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;system&quot;,&quot;valueUri&quot;:&quot;urn:ietf:bcp:47&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;en-US&quot;},{&quot;name&quot;:&quot;display&quot;,&quot;valueString&quot;:&quot;English&quot;},{&quot;name&quot;:&quot;displayLanguage&quot;,&quot;valueCode&quot;:&quot;en-US&quot;}]}&#x27;</code></pre>\n<p>Prod returns &quot;one of 6 choices&quot; with duplicate display options and no language tags; dev returns &quot;one of 3 choices&quot; with de-duplicated options and <code>(en)</code> language tags appended to each.</p>\n<p>When $validate-code detects a wrong display name, prod and dev return different error message text in both the <code>message</code> parameter and <code>issues</code> OperationOutcome <code>details.text</code>.</p>\n<p>Specific differences:</p>\n<ul><li><strong>Display option count</strong>: Prod may list duplicate display options (e.g., &quot;6 choices&quot; with repeats), while dev de-duplicates (e.g., &quot;3 choices&quot; with unique entries)</li><li><strong>Language tags</strong>: Dev appends language tags like <code>(en)</code> after each display option; prod does not</li><li><strong>Example</strong>: For <code>urn:ietf:bcp:47#en-US</code>:</li><li>Prod: &quot;Valid display is one of 6 choices: &#x27;English (Region=United States)&#x27;, &#x27;English (United States)&#x27;, &#x27;English (Region=United States)&#x27;, ...&quot;</li><li>Dev: &quot;Valid display is one of 3 choices: &#x27;English (Region=United States)&#x27; (en), &#x27;English (United States)&#x27; (en) or &#x27;English (Region=United States)&#x27; (en) ...&quot;</li></ul>\n<p>The core validation result (<code>result: false</code>) agrees in all but 1 of 41 records. The difference is confined to the human-readable error message text.</p>\n<p>44 delta records have <code>invalid-display</code> issue type with only <code>message</code> and <code>issues</code> diffs. 41 records contain &quot;Wrong Display Name&quot; in the delta text.</p>\n<p>Search: <code>grep -c &#x27;Wrong Display Name&#x27; jobs/2026-02-round-1/results/deltas/deltas.ndjson</code> → 41<br>\nSearch: <code>grep -c &#x27;invalid-display&#x27; jobs/2026-02-round-1/results/deltas/deltas.ndjson</code> → 53 (44 with only message/issues diffs)</p>\n<p>Affected operations: $validate-code on both CodeSystem and ValueSet<br>\nAffected systems: urn:ietf:bcp:47, <a href=\"http://snomed.info/sct,\" target=\"_blank\">http://snomed.info/sct,</a> and others</p>\n<p>Tolerance ID: <code>invalid-display-message-format</code><br>\nMatches: validate-code records where both prod and dev have <code>invalid-display</code> issue type and only the message/issues text differs. Normalizes the message and issues text to prod&#x27;s version.<br>\nExpected elimination: ~44 records.</p>\n<p><code>beb4276b-f937-46c3-81ab-7f63cb7798b7</code> — grep -n &#x27;beb4276b-f937-46c3-81ab-7f63cb7798b7&#x27; jobs/2026-02-round-1/comparison.ndjson</p>", "impact": 44}, {"id": "ebcb5a6", "title": "Dev $expand reports different used-codesystem versions than prod", "status": "closed", "labels": ["content-differs", "reproduced", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:38", "date_iso": "2026-02-08T13:38:00-06:00", "body_md": "Records-Impacted: 37\nTolerance-ID: expand-used-codesystem-version-skew\nRecord-ID: 2bbd9519-3a6b-4f55-8309-745d9f1b16a7\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$expand' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"compose\":{\"include\":[{\"system\":\"http://snomed.info/sct\",\"concept\":[{\"code\":\"160245001\"}]}]}}},{\"name\":\"system-version\",\"valueUri\":\"http://snomed.info/sct|http://snomed.info/sct/731000124108\"}]}'\n\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$expand' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"valueSet\",\"resource\":{\"resourceType\":\"ValueSet\",\"compose\":{\"include\":[{\"system\":\"http://snomed.info/sct\",\"concept\":[{\"code\":\"160245001\"}]}]}}},{\"name\":\"system-version\",\"valueUri\":\"http://snomed.info/sct|http://snomed.info/sct/731000124108\"}]}'\n```\n\nProd returns `used-codesystem` version `20250901`, dev returns `20230301` for SNOMED US edition.\n\nDev $expand responses report different code system versions in the `used-codesystem` expansion parameter compared to prod. This is the $expand counterpart of the existing SNOMED version skew bug (da50d17), but affects multiple code systems and is specific to expansion metadata rather than validate-code Parameters.\n\n\nIn 37 $expand delta records, the `used-codesystem` expansion parameter reports a different version in dev than prod. This affects multiple code systems:\n\n- (empty/missing): 14 records\n- http://hl7.org/fhir/sid/icd-9-cm: 11 records\n- http://snomed.info/sct: 6 records\n- http://terminology.hl7.org/CodeSystem/medicationrequest-category: 2 records\n- http://loinc.org: 2 records\n- http://terminology.hl7.org/CodeSystem/v3-NullFlavor: 1 record\n- http://hl7.org/fhir/sid/icd-10-cm: 1 record\n\nExamples:\n- SNOMED US: prod `20250901`, dev `20230301`\n- medicationrequest-category: prod `4.0.1`, dev `1.0.0`\n\nThis indicates dev loads different (generally older) editions of these code systems.\n\n\n```bash\ngrep '\"op\":\"expand\"' jobs/2026-02-round-1/results/deltas/deltas.ndjson | python3 -c \"\nimport json, sys\nfor line in sys.stdin:\n  rec = json.loads(line)\n  dev = json.loads(rec.get('devBody','{}'))\n  prod = json.loads(rec.get('prodBody','{}'))\n  d = {p.get('name'):p for p in dev.get('expansion',{}).get('parameter',[])}\n  p = {p.get('name'):p for p in prod.get('expansion',{}).get('parameter',[])}\n  du = d.get('used-codesystem',{}).get('valueUri','')\n  pu = p.get('used-codesystem',{}).get('valueUri','')\n  if du != pu: print(f'{rec[\\\"id\\\"]}: prod={pu} dev={du}')\n\" | wc -l\n```", "body_html": "<p>Records-Impacted: 37<br>\nTolerance-ID: expand-used-codesystem-version-skew<br>\nRecord-ID: 2bbd9519-3a6b-4f55-8309-745d9f1b16a7</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/ValueSet/$expand&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;http://snomed.info/sct&quot;,&quot;concept&quot;:[{&quot;code&quot;:&quot;160245001&quot;}]}]}}},{&quot;name&quot;:&quot;system-version&quot;,&quot;valueUri&quot;:&quot;http://snomed.info/sct|http://snomed.info/sct/731000124108&quot;}]}&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;valueSet&quot;,&quot;resource&quot;:{&quot;resourceType&quot;:&quot;ValueSet&quot;,&quot;compose&quot;:{&quot;include&quot;:[{&quot;system&quot;:&quot;http://snomed.info/sct&quot;,&quot;concept&quot;:[{&quot;code&quot;:&quot;160245001&quot;}]}]}}},{&quot;name&quot;:&quot;system-version&quot;,&quot;valueUri&quot;:&quot;http://snomed.info/sct|http://snomed.info/sct/731000124108&quot;}]}&#x27;</code></pre>\n<p>Prod returns <code>used-codesystem</code> version <code>20250901</code>, dev returns <code>20230301</code> for SNOMED US edition.</p>\n<p>Dev $expand responses report different code system versions in the <code>used-codesystem</code> expansion parameter compared to prod. This is the $expand counterpart of the existing SNOMED version skew bug (da50d17), but affects multiple code systems and is specific to expansion metadata rather than validate-code Parameters.</p>\n<p>In 37 $expand delta records, the <code>used-codesystem</code> expansion parameter reports a different version in dev than prod. This affects multiple code systems:</p>\n<ul><li>(empty/missing): 14 records</li><li><a href=\"http://hl7.org/fhir/sid/icd-9-cm:\" target=\"_blank\">http://hl7.org/fhir/sid/icd-9-cm:</a> 11 records</li><li><a href=\"http://snomed.info/sct:\" target=\"_blank\">http://snomed.info/sct:</a> 6 records</li><li><a href=\"http://terminology.hl7.org/CodeSystem/medicationrequest-category:\" target=\"_blank\">http://terminology.hl7.org/CodeSystem/medicationrequest-category:</a> 2 records</li><li><a href=\"http://loinc.org:\" target=\"_blank\">http://loinc.org:</a> 2 records</li><li><a href=\"http://terminology.hl7.org/CodeSystem/v3-NullFlavor:\" target=\"_blank\">http://terminology.hl7.org/CodeSystem/v3-NullFlavor:</a> 1 record</li><li><a href=\"http://hl7.org/fhir/sid/icd-10-cm:\" target=\"_blank\">http://hl7.org/fhir/sid/icd-10-cm:</a> 1 record</li></ul>\n<p>Examples:</p>\n<ul><li>SNOMED US: prod <code>20250901</code>, dev <code>20230301</code></li><li>medicationrequest-category: prod <code>4.0.1</code>, dev <code>1.0.0</code></li></ul>\n<p>This indicates dev loads different (generally older) editions of these code systems.</p>\n<pre><code class=\"lang-bash\">grep &#x27;&quot;op&quot;:&quot;expand&quot;&#x27; jobs/2026-02-round-1/results/deltas/deltas.ndjson | python3 -c &quot;\nimport json, sys\nfor line in sys.stdin:\n  rec = json.loads(line)\n  dev = json.loads(rec.get(&#x27;devBody&#x27;,&#x27;{}&#x27;))\n  prod = json.loads(rec.get(&#x27;prodBody&#x27;,&#x27;{}&#x27;))\n  d = {p.get(&#x27;name&#x27;):p for p in dev.get(&#x27;expansion&#x27;,{}).get(&#x27;parameter&#x27;,[])}\n  p = {p.get(&#x27;name&#x27;):p for p in prod.get(&#x27;expansion&#x27;,{}).get(&#x27;parameter&#x27;,[])}\n  du = d.get(&#x27;used-codesystem&#x27;,{}).get(&#x27;valueUri&#x27;,&#x27;&#x27;)\n  pu = p.get(&#x27;used-codesystem&#x27;,{}).get(&#x27;valueUri&#x27;,&#x27;&#x27;)\n  if du != pu: print(f&#x27;{rec[\\&quot;id\\&quot;]}: prod={pu} dev={du}&#x27;)\n&quot; | wc -l</code></pre>", "impact": 37}, {"id": "d444de7", "title": "Dev prepends filter-miss details to validate-code message when result=false", "status": "closed", "labels": ["content-differs", "reproduced", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:38", "date_iso": "2026-02-08T13:38:01-06:00", "body_md": "Records-Impacted: 32\nTolerance-ID: validate-code-filter-miss-message-prefix\nRecord-ID: 6d44fc66-34dd-4ebe-889e-02cf345990f3\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$validate-code' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/ValueSet/medication-form-codes\"},{\"name\":\"codeableConcept\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"http://snomed.info/sct\",\"code\":\"385049006\",\"display\":\"Capsule\"}]}}]}'\n\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$validate-code' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/ValueSet/medication-form-codes\"},{\"name\":\"codeableConcept\",\"valueCodeableConcept\":{\"coding\":[{\"system\":\"http://snomed.info/sct\",\"code\":\"385049006\",\"display\":\"Capsule\"}]}}]}'\n```\n\nProd message: `\"No valid coding was found for the value set 'http://hl7.org/fhir/ValueSet/medication-form-codes|4.0.1'\"`, dev message: `\"Code 385049006 is not in the specified filter; No valid coding was found for the value set 'http://hl7.org/fhir/ValueSet/medication-form-codes|4.0.1'\"`. Dev prepends the filter-miss detail exactly as described.\n\n\nOn $validate-code requests against ValueSets with include filters, when the code is not found (result=false on both sides), dev prepends \"Code X is not in the specified filter; \" to its `message` parameter. Prod returns only the standard error message (e.g. \"No valid coding was found for the value set '...'\").\n\nExample (record 6d44fc66):\n- Prod message: \"No valid coding was found for the value set 'http://hl7.org/fhir/ValueSet/medication-form-codes|4.0.1'\"\n- Dev message: \"Code 385049006 is not in the specified filter; No valid coding was found for the value set 'http://hl7.org/fhir/ValueSet/medication-form-codes|4.0.1'\"\n\nDev repeats the filter-miss prefix once per include filter in the ValueSet. Some records have 17+ repetitions (e.g. IPS results-coded-values-laboratory-pathology with 17 include filters).\n\nBoth sides agree on result=false. The only difference is dev's message has extraneous filter-checking details prepended. This is the result=false variant of bug eaeccdd (which covers result=true, where prod omits message entirely).\n\n\n32 records in deltas.ndjson, all POST /r4/ValueSet/$validate-code with result=false on both sides. Found via:\n```\ngrep 'is not in the specified filter' results/deltas/deltas.ndjson | wc -l  → 32\n```\n\nAll are validate-code / content-differs. 30 have message as the only diff; 2 also have a version diff (SNOMED version skew, separate issue).\n\nValueSets affected include medication-form-codes, problems-uv-ips, vaccines-uv-ips, results-coded-values-laboratory-pathology-uv-ips, and others with SNOMED include filters.\n\n\nTolerance ID: validate-code-filter-miss-message-prefix\nMatches: validate-code where result=false on both sides, dev's message ends with prod's message, and the extra prefix contains \"is not in the specified filter\".\nNormalizes: sets dev's message to prod's message value.", "body_html": "<p>Records-Impacted: 32<br>\nTolerance-ID: validate-code-filter-miss-message-prefix<br>\nRecord-ID: 6d44fc66-34dd-4ebe-889e-02cf345990f3</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/ValueSet/$validate-code&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/ValueSet/medication-form-codes&quot;},{&quot;name&quot;:&quot;codeableConcept&quot;,&quot;valueCodeableConcept&quot;:{&quot;coding&quot;:[{&quot;system&quot;:&quot;http://snomed.info/sct&quot;,&quot;code&quot;:&quot;385049006&quot;,&quot;display&quot;:&quot;Capsule&quot;}]}}]}&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$validate-code&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/ValueSet/medication-form-codes&quot;},{&quot;name&quot;:&quot;codeableConcept&quot;,&quot;valueCodeableConcept&quot;:{&quot;coding&quot;:[{&quot;system&quot;:&quot;http://snomed.info/sct&quot;,&quot;code&quot;:&quot;385049006&quot;,&quot;display&quot;:&quot;Capsule&quot;}]}}]}&#x27;</code></pre>\n<p>Prod message: <code>&quot;No valid coding was found for the value set &#x27;http://hl7.org/fhir/ValueSet/medication-form-codes|4.0.1&#x27;&quot;</code>, dev message: <code>&quot;Code 385049006 is not in the specified filter; No valid coding was found for the value set &#x27;http://hl7.org/fhir/ValueSet/medication-form-codes|4.0.1&#x27;&quot;</code>. Dev prepends the filter-miss detail exactly as described.</p>\n<p>On $validate-code requests against ValueSets with include filters, when the code is not found (result=false on both sides), dev prepends &quot;Code X is not in the specified filter; &quot; to its <code>message</code> parameter. Prod returns only the standard error message (e.g. &quot;No valid coding was found for the value set &#x27;...&#x27;&quot;).</p>\n<p>Example (record 6d44fc66):</p>\n<ul><li>Prod message: &quot;No valid coding was found for the value set &#x27;<a href=\"http://hl7.org/fhir/ValueSet/medication-form-codes|4.0.1&#x27;&quot;\" target=\"_blank\">http://hl7.org/fhir/ValueSet/medication-form-codes|4.0.1&#x27;&quot;</a></li><li>Dev message: &quot;Code 385049006 is not in the specified filter; No valid coding was found for the value set &#x27;<a href=\"http://hl7.org/fhir/ValueSet/medication-form-codes|4.0.1&#x27;&quot;\" target=\"_blank\">http://hl7.org/fhir/ValueSet/medication-form-codes|4.0.1&#x27;&quot;</a></li></ul>\n<p>Dev repeats the filter-miss prefix once per include filter in the ValueSet. Some records have 17+ repetitions (e.g. IPS results-coded-values-laboratory-pathology with 17 include filters).</p>\n<p>Both sides agree on result=false. The only difference is dev&#x27;s message has extraneous filter-checking details prepended. This is the result=false variant of bug eaeccdd (which covers result=true, where prod omits message entirely).</p>\n<p>32 records in deltas.ndjson, all POST /r4/ValueSet/$validate-code with result=false on both sides. Found via:</p>\n<pre><code>grep &#x27;is not in the specified filter&#x27; results/deltas/deltas.ndjson | wc -l  → 32</code></pre>\n<p>All are validate-code / content-differs. 30 have message as the only diff; 2 also have a version diff (SNOMED version skew, separate issue).</p>\n<p>ValueSets affected include medication-form-codes, problems-uv-ips, vaccines-uv-ips, results-coded-values-laboratory-pathology-uv-ips, and others with SNOMED include filters.</p>\n<p>Tolerance ID: validate-code-filter-miss-message-prefix<br>\nMatches: validate-code where result=false on both sides, dev&#x27;s message ends with prod&#x27;s message, and the extra prefix contains &quot;is not in the specified filter&quot;.<br>\nNormalizes: sets dev&#x27;s message to prod&#x27;s message value.</p>", "impact": 32}, {"id": "6c31e76", "title": "Dev appends 'and undefined' to valid version list in UNKNOWN_CODESYSTEM_VERSION messages", "status": "closed", "labels": ["content-differs", "reproduced", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:38", "date_iso": "2026-02-08T13:38:00-06:00", "body_md": "Records-Impacted: 26\nTolerance-ID: unknown-version-valid-versions-message\nRecord-ID: a3cf69a7-48f3-47b8-a29d-cd6453647621\n\n\n```bash\ncurl -s \"https://tx.fhir.org/r4/CodeSystem/\\$validate-code\" \\\n-H \"Accept: application/fhir+json\" \\\n-H \"Content-Type: application/fhir+json\" \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://snomed.info/sct\"},{\"name\":\"code\",\"valueCode\":\"116101001\"},{\"name\":\"version\",\"valueString\":\"2017-09\"}]}'\n\ncurl -s \"https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code\" \\\n-H \"Accept: application/fhir+json\" \\\n-H \"Content-Type: application/fhir+json\" \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://snomed.info/sct\"},{\"name\":\"code\",\"valueCode\":\"116101001\"},{\"name\":\"version\",\"valueString\":\"2017-09\"}]}'\n```\n\nProd message ends cleanly: `...http://snomed.info/xsct/900000000000207008/version/20250814`. Dev message ends with: `...http://snomed.info/xsct/900000000000207008/version/20250814 and undefined`.\n\n\nWhen a requested CodeSystem version is not found, both prod and dev return an UNKNOWN_CODESYSTEM_VERSION error listing available versions. Dev appends \" and undefined\" at the end of this version list in 26 of 40 such records.\n\nExample from dev message:\n\"...http://snomed.info/xsct/900000000000207008/version/20250814 and undefined\"\n\nProd message ends cleanly:\n\"...http://snomed.info/xsct/900000000000207008/version/20250814\"\n\nThis appears to be a JS undefined value being concatenated into the version list string, likely from an off-by-one or array join issue.\n\n\n26 records in deltas.ndjson contain \"and undefined\" in the devBody. All are validate-code operations. The pattern appears across SNOMED and other code systems when the requested version is not found.\n\nSearch: grep -c 'and undefined' deltas.ndjson => 26\n\n\nTolerance `unknown-version-valid-versions-message` normalizes the message and issues text in UNKNOWN_CODESYSTEM_VERSION responses by stripping \"Valid versions:\" lists from both sides. This covers both the \"and undefined\" bug and the version list differences caused by different editions being loaded.\n\n\na3cf69a7-48f3-47b8-a29d-cd6453647621 — POST /r4/CodeSystem/$validate-code for SNOMED 2017-09, both return result=false", "body_html": "<p>Records-Impacted: 26<br>\nTolerance-ID: unknown-version-valid-versions-message<br>\nRecord-ID: a3cf69a7-48f3-47b8-a29d-cd6453647621</p>\n<pre><code class=\"lang-bash\">curl -s &quot;https://tx.fhir.org/r4/CodeSystem/\\$validate-code&quot; \\\n-H &quot;Accept: application/fhir+json&quot; \\\n-H &quot;Content-Type: application/fhir+json&quot; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://snomed.info/sct&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;116101001&quot;},{&quot;name&quot;:&quot;version&quot;,&quot;valueString&quot;:&quot;2017-09&quot;}]}&#x27;\n\ncurl -s &quot;https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code&quot; \\\n-H &quot;Accept: application/fhir+json&quot; \\\n-H &quot;Content-Type: application/fhir+json&quot; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://snomed.info/sct&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;116101001&quot;},{&quot;name&quot;:&quot;version&quot;,&quot;valueString&quot;:&quot;2017-09&quot;}]}&#x27;</code></pre>\n<p>Prod message ends cleanly: <code>...http://snomed.info/xsct/900000000000207008/version/20250814</code>. Dev message ends with: <code>...http://snomed.info/xsct/900000000000207008/version/20250814 and undefined</code>.</p>\n<p>When a requested CodeSystem version is not found, both prod and dev return an UNKNOWN_CODESYSTEM_VERSION error listing available versions. Dev appends &quot; and undefined&quot; at the end of this version list in 26 of 40 such records.</p>\n<p>Example from dev message:<br>\n&quot;...<a href=\"http://snomed.info/xsct/900000000000207008/version/20250814\" target=\"_blank\">http://snomed.info/xsct/900000000000207008/version/20250814</a> and undefined&quot;</p>\n<p>Prod message ends cleanly:<br>\n&quot;...<a href=\"http://snomed.info/xsct/900000000000207008/version/20250814&quot;\" target=\"_blank\">http://snomed.info/xsct/900000000000207008/version/20250814&quot;</a></p>\n<p>This appears to be a JS undefined value being concatenated into the version list string, likely from an off-by-one or array join issue.</p>\n<p>26 records in deltas.ndjson contain &quot;and undefined&quot; in the devBody. All are validate-code operations. The pattern appears across SNOMED and other code systems when the requested version is not found.</p>\n<p>Search: grep -c &#x27;and undefined&#x27; deltas.ndjson =&gt; 26</p>\n<p>Tolerance <code>unknown-version-valid-versions-message</code> normalizes the message and issues text in UNKNOWN_CODESYSTEM_VERSION responses by stripping &quot;Valid versions:&quot; lists from both sides. This covers both the &quot;and undefined&quot; bug and the version list differences caused by different editions being loaded.</p>\n<p>a3cf69a7-48f3-47b8-a29d-cd6453647621 — POST /r4/CodeSystem/$validate-code for SNOMED 2017-09, both return result=false</p>", "impact": 26}, {"id": "43d7ea3", "title": "NDC validate-code: dev returns inactive/version/message/issues params that prod omits", "status": "closed", "labels": ["content-differs", "reproduced", "round:2026-02-round-1", "tx-compare", "won't-fix"], "author": "Claude (AI Assistant)", "date": "2026-02-08 19:50", "date_iso": "2026-02-08T19:50:10-06:00", "body_md": "Records-Impacted: 16\nTolerance-ID: ndc-validate-code-extra-inactive-params\nRecord-ID: ac23726f-6ff2-4b72-b2c8-584922d04c92\n\nValidate NDC code 0777-3105-02 against both servers:\n\n```bash\ncurl -s -X POST \"https://tx.fhir.org/r4/CodeSystem/\\$validate-code?\" \\\n-H \"Content-Type: application/fhir+json\" \\\n-H \"Accept: application/fhir+json\" \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/sid/ndc\"},{\"name\":\"code\",\"valueCode\":\"0777-3105-02\"}]}'\n\ncurl -s -X POST \"https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code?\" \\\n-H \"Content-Type: application/fhir+json\" \\\n-H \"Accept: application/fhir+json\" \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://hl7.org/fhir/sid/ndc\"},{\"name\":\"code\",\"valueCode\":\"0777-3105-02\"}]}'\n```\n\n**Prod response** (4 parameters):\n- `result: true`, `system`, `code: \"0777-3105-02\"`, `display: \"Prozac, 100 CAPSULE in 1 BOTTLE (0777-3105-02) (package)\"`\n\n**Dev response** (8 parameters) -- same 4 plus:\n- `version: \"2021-11-01\"`\n- `inactive: true`\n- `message: \"The concept '0777-3105-02' has a status of null and its use should be reviewed\"`\n- `issues`: OperationOutcome with INACTIVE_CONCEPT_FOUND warning\n\nAlso reproducible with NDC codes `0002-8215-01` and `0169-4132-12`.\n\n\nFor NDC ($validate-code on http://hl7.org/fhir/sid/ndc), both servers agree result=true and return matching system, code, and display. However, dev returns four additional parameters that prod omits entirely:\n\n- `version: \"2021-11-01\"` — the NDC code system version\n- `inactive: true` — flags the concept as inactive\n- `message: \"The concept '<code>' has a status of null and its use should be reviewed\"` — a warning about the concept status\n- `issues` — an OperationOutcome with a warning (severity=warning, code=business-rule, tx-issue-type=code-comment, message-id=INACTIVE_CONCEPT_FOUND)\n\nProd's diagnostics show it uses NDC with no version: `Using CodeSystem \"http://hl7.org/fhir/sid/ndc|\" (content = complete)` (empty string after the pipe). Dev uses NDC version 2021-11-01.\n\n\n16 records in deltas.ndjson match this exact pattern. All are POST /r4/CodeSystem/$validate-code? for http://hl7.org/fhir/sid/ndc. Three distinct NDC codes are affected: 0777-3105-02, 0002-8215-01, and 0169-4132-12.\n\nSearch: `grep '\"param\":\"inactive\"' jobs/2026-02-round-1/results/deltas/deltas.ndjson | wc -l` → 16\n\nAll 16 have the same diff signature: extra-in-dev for inactive, issues, message, and version.\n\n\nTolerance `ndc-validate-code-extra-inactive-params` matches validate-code responses where system is http://hl7.org/fhir/sid/ndc and dev has inactive/version/message/issues parameters that prod lacks. It strips the four extra parameters from dev to eliminate the diff. Eliminates 16 records.\n\n\nac23726f-6ff2-4b72-b2c8-584922d04c92 — NDC code 0777-3105-02 (Prozac 100 capsule)", "body_html": "<p>Records-Impacted: 16<br>\nTolerance-ID: ndc-validate-code-extra-inactive-params<br>\nRecord-ID: ac23726f-6ff2-4b72-b2c8-584922d04c92</p>\n<p>Validate NDC code 0777-3105-02 against both servers:</p>\n<pre><code class=\"lang-bash\">curl -s -X POST &quot;https://tx.fhir.org/r4/CodeSystem/\\$validate-code?&quot; \\\n-H &quot;Content-Type: application/fhir+json&quot; \\\n-H &quot;Accept: application/fhir+json&quot; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/sid/ndc&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;0777-3105-02&quot;}]}&#x27;\n\ncurl -s -X POST &quot;https://tx-dev.fhir.org/r4/CodeSystem/\\$validate-code?&quot; \\\n-H &quot;Content-Type: application/fhir+json&quot; \\\n-H &quot;Accept: application/fhir+json&quot; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://hl7.org/fhir/sid/ndc&quot;},{&quot;name&quot;:&quot;code&quot;,&quot;valueCode&quot;:&quot;0777-3105-02&quot;}]}&#x27;</code></pre>\n<p><strong>Prod response</strong> (4 parameters):</p>\n<ul><li><code>result: true</code>, <code>system</code>, <code>code: &quot;0777-3105-02&quot;</code>, <code>display: &quot;Prozac, 100 CAPSULE in 1 BOTTLE (0777-3105-02) (package)&quot;</code></li></ul>\n<p><strong>Dev response</strong> (8 parameters) -- same 4 plus:</p>\n<ul><li><code>version: &quot;2021-11-01&quot;</code></li><li><code>inactive: true</code></li><li><code>message: &quot;The concept &#x27;0777-3105-02&#x27; has a status of null and its use should be reviewed&quot;</code></li><li><code>issues</code>: OperationOutcome with INACTIVE_CONCEPT_FOUND warning</li></ul>\n<p>Also reproducible with NDC codes <code>0002-8215-01</code> and <code>0169-4132-12</code>.</p>\n<p>For NDC ($validate-code on <a href=\"http://hl7.org/fhir/sid/ndc\" target=\"_blank\">http://hl7.org/fhir/sid/ndc</a>), both servers agree result=true and return matching system, code, and display. However, dev returns four additional parameters that prod omits entirely:</p>\n<ul><li><code>version: &quot;2021-11-01&quot;</code> — the NDC code system version</li><li><code>inactive: true</code> — flags the concept as inactive</li><li><code>message: &quot;The concept &#x27;&lt;code&gt;&#x27; has a status of null and its use should be reviewed&quot;</code> — a warning about the concept status</li><li><code>issues</code> — an OperationOutcome with a warning (severity=warning, code=business-rule, tx-issue-type=code-comment, message-id=INACTIVE_CONCEPT_FOUND)</li></ul>\n<p>Prod&#x27;s diagnostics show it uses NDC with no version: <code>Using CodeSystem &quot;http://hl7.org/fhir/sid/ndc|&quot; (content = complete)</code> (empty string after the pipe). Dev uses NDC version 2021-11-01.</p>\n<p>16 records in deltas.ndjson match this exact pattern. All are POST /r4/CodeSystem/$validate-code? for <a href=\"http://hl7.org/fhir/sid/ndc.\" target=\"_blank\">http://hl7.org/fhir/sid/ndc.</a> Three distinct NDC codes are affected: 0777-3105-02, 0002-8215-01, and 0169-4132-12.</p>\n<p>Search: <code>grep &#x27;&quot;param&quot;:&quot;inactive&quot;&#x27; jobs/2026-02-round-1/results/deltas/deltas.ndjson | wc -l</code> → 16</p>\n<p>All 16 have the same diff signature: extra-in-dev for inactive, issues, message, and version.</p>\n<p>Tolerance <code>ndc-validate-code-extra-inactive-params</code> matches validate-code responses where system is <a href=\"http://hl7.org/fhir/sid/ndc\" target=\"_blank\">http://hl7.org/fhir/sid/ndc</a> and dev has inactive/version/message/issues parameters that prod lacks. It strips the four extra parameters from dev to eliminate the diff. Eliminates 16 records.</p>\n<p>ac23726f-6ff2-4b72-b2c8-584922d04c92 — NDC code 0777-3105-02 (Prozac 100 capsule)</p>", "impact": 16}, {"id": "1bc5e64", "title": "Dev returns x-caused-by-unknown-system for CodeSystem versions that prod resolves (RxNorm 04072025, SNOMED US 20220301)", "status": "closed", "labels": ["content-differs", "not-reproduced", "round:2026-02-round-2", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 10:52", "date_iso": "2026-02-08T10:52:55-06:00", "body_md": "Records-Impacted: 7\nTolerance-ID: validate-code-x-unknown-system-extra\nRecord-ID: f7e61c56-3c3c-4925-8822-f0f4e4406e3f\n\n## Repro\n\n```bash\n# Test RxNorm version 04072025\ncurl -s https://tx.fhir.org/r4/ValueSet/\\$validate-code \\\n  -H \"Accept: application/fhir+json\" \\\n  -H \"Content-Type: application/fhir+json\" \\\n  -d '{\n  \"resourceType\": \"Parameters\",\n  \"parameter\": [\n    {\n      \"name\": \"url\",\n      \"valueUri\": \"http://hl7.org/fhir/ValueSet/substance-code\"\n    },\n    {\n      \"name\": \"coding\",\n      \"valueCoding\": {\n        \"system\": \"http://www.nlm.nih.gov/research/umls/rxnorm\",\n        \"version\": \"04072025\",\n        \"code\": \"1049221\"\n      }\n    }\n  ]\n}' | jq '.parameter[] | select(.name==\"x-unknown-system\" or .name==\"x-caused-by-unknown-system\")'\n\n# Dev (same request)\ncurl -s https://tx-dev.fhir.org/r4/ValueSet/\\$validate-code \\\n  -H \"Accept: application/fhir+json\" \\\n  -H \"Content-Type: application/fhir+json\" \\\n  -d '{\n  \"resourceType\": \"Parameters\",\n  \"parameter\": [\n    {\n      \"name\": \"url\",\n      \"valueUri\": \"http://hl7.org/fhir/ValueSet/substance-code\"\n    },\n    {\n      \"name\": \"coding\",\n      \"valueCoding\": {\n        \"system\": \"http://www.nlm.nih.gov/research/umls/rxnorm\",\n        \"version\": \"04072025\",\n        \"code\": \"1049221\"\n      }\n    }\n  ]\n}' | jq '.parameter[] | select(.name==\"x-unknown-system\" or .name==\"x-caused-by-unknown-system\")'\n```\n\n**Result**: Both servers now return identical responses with `x-unknown-system` parameter. The bug describes a scenario where prod did NOT return this parameter but dev did. The servers have converged — both now handle the unknown version the same way.\n\n## What differs\n\nWhen validating a code against a ValueSet that includes codes from RxNorm or SNOMED CT, and the request pins a specific CodeSystem version, dev fails to resolve certain versions that prod resolves:\n\n- **RxNorm version `04072025`**: Dev returns \"A definition for CodeSystem 'http://www.nlm.nih.gov/research/umls/rxnorm' version '04072025' could not be found\". Prod resolves it (falls back to known version `??`) and performs actual validation, returning \"code not found in valueset\".\n- **SNOMED US edition version `20220301`** (`http://snomed.info/sct/731000124108/version/20220301`): Same pattern — dev can't find this version, prod resolves it.\n\nDev returns `x-caused-by-unknown-system` parameter (e.g., `http://www.nlm.nih.gov/research/umls/rxnorm|04072025`) and a single OperationOutcome issue with code `not-found`. Prod omits `x-caused-by-unknown-system` and returns the actual validation result with issues like `this-code-not-in-vs` and `not-in-vs`.\n\nBoth return `result=false`, but for completely different reasons: prod says \"code not in valueset\", dev says \"can't validate because CodeSystem version not found.\"\n\n## How widespread\n\n7 records in the deltas match this pattern (dev has `x-caused-by-unknown-system`, prod does not):\n- 4 records: RxNorm version 04072025\n- 3 records: SNOMED US edition version 20220301\n\nAll are POST /r4/ValueSet/$validate-code operations.\n\nSearch: `grep 'x-caused-by-unknown-system' deltas.ndjson` → 8 hits total, 7 where only dev has the parameter.\n\n## What the tolerance covers\n\nTolerance `validate-code-x-unknown-system-extra` matches validate-code records where dev has `x-caused-by-unknown-system` but prod does not. It normalizes dev's issues, message, and x-caused-by-unknown-system to match prod's values. Eliminates 7 records.\n\nNote: This tolerance previously existed but had a bug — it matched on parameter name `x-unknown-system` instead of the correct `x-caused-by-unknown-system`, so it matched 0 records. The fix corrects the parameter name.", "body_html": "<p>Records-Impacted: 7<br>\nTolerance-ID: validate-code-x-unknown-system-extra<br>\nRecord-ID: f7e61c56-3c3c-4925-8822-f0f4e4406e3f</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Test RxNorm version 04072025\ncurl -s https://tx.fhir.org/r4/ValueSet/\\$validate-code \\\n  -H &quot;Accept: application/fhir+json&quot; \\\n  -H &quot;Content-Type: application/fhir+json&quot; \\\n  -d &#x27;{\n  &quot;resourceType&quot;: &quot;Parameters&quot;,\n  &quot;parameter&quot;: [\n    {\n      &quot;name&quot;: &quot;url&quot;,\n      &quot;valueUri&quot;: &quot;http://hl7.org/fhir/ValueSet/substance-code&quot;\n    },\n    {\n      &quot;name&quot;: &quot;coding&quot;,\n      &quot;valueCoding&quot;: {\n        &quot;system&quot;: &quot;http://www.nlm.nih.gov/research/umls/rxnorm&quot;,\n        &quot;version&quot;: &quot;04072025&quot;,\n        &quot;code&quot;: &quot;1049221&quot;\n      }\n    }\n  ]\n}&#x27; | jq &#x27;.parameter[] | select(.name==&quot;x-unknown-system&quot; or .name==&quot;x-caused-by-unknown-system&quot;)&#x27;\n\n# Dev (same request)\ncurl -s https://tx-dev.fhir.org/r4/ValueSet/\\$validate-code \\\n  -H &quot;Accept: application/fhir+json&quot; \\\n  -H &quot;Content-Type: application/fhir+json&quot; \\\n  -d &#x27;{\n  &quot;resourceType&quot;: &quot;Parameters&quot;,\n  &quot;parameter&quot;: [\n    {\n      &quot;name&quot;: &quot;url&quot;,\n      &quot;valueUri&quot;: &quot;http://hl7.org/fhir/ValueSet/substance-code&quot;\n    },\n    {\n      &quot;name&quot;: &quot;coding&quot;,\n      &quot;valueCoding&quot;: {\n        &quot;system&quot;: &quot;http://www.nlm.nih.gov/research/umls/rxnorm&quot;,\n        &quot;version&quot;: &quot;04072025&quot;,\n        &quot;code&quot;: &quot;1049221&quot;\n      }\n    }\n  ]\n}&#x27; | jq &#x27;.parameter[] | select(.name==&quot;x-unknown-system&quot; or .name==&quot;x-caused-by-unknown-system&quot;)&#x27;</code></pre>\n<p><strong>Result</strong>: Both servers now return identical responses with <code>x-unknown-system</code> parameter. The bug describes a scenario where prod did NOT return this parameter but dev did. The servers have converged — both now handle the unknown version the same way.</p>\n<h2>What differs</h2>\n<p>When validating a code against a ValueSet that includes codes from RxNorm or SNOMED CT, and the request pins a specific CodeSystem version, dev fails to resolve certain versions that prod resolves:</p>\n<ul><li>**RxNorm version <code>04072025</code>**: Dev returns &quot;A definition for CodeSystem &#x27;<a href=\"http://www.nlm.nih.gov/research/umls/rxnorm&#x27;\" target=\"_blank\">http://www.nlm.nih.gov/research/umls/rxnorm&#x27;</a> version &#x27;04072025&#x27; could not be found&quot;. Prod resolves it (falls back to known version <code>??</code>) and performs actual validation, returning &quot;code not found in valueset&quot;.</li><li>**SNOMED US edition version <code>20220301</code>** (<code>http://snomed.info/sct/731000124108/version/20220301</code>): Same pattern — dev can&#x27;t find this version, prod resolves it.</li></ul>\n<p>Dev returns <code>x-caused-by-unknown-system</code> parameter (e.g., <code>http://www.nlm.nih.gov/research/umls/rxnorm|04072025</code>) and a single OperationOutcome issue with code <code>not-found</code>. Prod omits <code>x-caused-by-unknown-system</code> and returns the actual validation result with issues like <code>this-code-not-in-vs</code> and <code>not-in-vs</code>.</p>\n<p>Both return <code>result=false</code>, but for completely different reasons: prod says &quot;code not in valueset&quot;, dev says &quot;can&#x27;t validate because CodeSystem version not found.&quot;</p>\n<h2>How widespread</h2>\n<p>7 records in the deltas match this pattern (dev has <code>x-caused-by-unknown-system</code>, prod does not):</p>\n<ul><li>4 records: RxNorm version 04072025</li><li>3 records: SNOMED US edition version 20220301</li></ul>\n<p>All are POST /r4/ValueSet/$validate-code operations.</p>\n<p>Search: <code>grep &#x27;x-caused-by-unknown-system&#x27; deltas.ndjson</code> → 8 hits total, 7 where only dev has the parameter.</p>\n<h2>What the tolerance covers</h2>\n<p>Tolerance <code>validate-code-x-unknown-system-extra</code> matches validate-code records where dev has <code>x-caused-by-unknown-system</code> but prod does not. It normalizes dev&#x27;s issues, message, and x-caused-by-unknown-system to match prod&#x27;s values. Eliminates 7 records.</p>\n<p>Note: This tolerance previously existed but had a bug — it matched on parameter name <code>x-unknown-system</code> instead of the correct <code>x-caused-by-unknown-system</code>, so it matched 0 records. The fix corrects the parameter name.</p>", "impact": 7}, {"id": "b77d7cd", "title": "BCP-47 display text format: dev returns 'Region=...' instead of standard format", "status": "closed", "labels": ["P6", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:38", "date_iso": "2026-02-08T13:38:00-06:00", "body_md": "Records-Impacted: 7\nTolerance-ID: bcp47-display-format\nRecord-ID: da702ab4-7ced-4b69-945c-0b5bbbc088c0\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/CodeSystem/$validate-code?url=urn:ietf:bcp:47&code=en-US' -H 'Accept: application/fhir+json'\n\ncurl -s 'https://tx-dev.fhir.org/r4/CodeSystem/$validate-code?url=urn:ietf:bcp:47&code=en-US' -H 'Accept: application/fhir+json'\n```\n\nAs of 2026-02-07, both servers return `\"display\": \"English (Region=United States)\"` — the original difference (prod had \"English (United States)\") is no longer present. Prod appears to have been updated to match dev's format.\n\n\nFor BCP-47 language codes (system urn:ietf:bcp:47), dev returns display text with explicit subtag labels like \"English (Region=United States)\" while prod returns the standard format \"English (United States)\".\n\nSpecific example for code en-US:\n- prod: \"English (United States)\"\n- dev: \"English (Region=United States)\"\n\nThe \"Region=\" prefix in dev's display text is non-standard. The IANA/BCP-47 convention is to show the region name without a label prefix.\n\n\n7 P6 $validate-code records in the current delta set match this pattern — all are urn:ietf:bcp:47 validate-code operations for code en-US where the only difference (after diagnostics stripping and parameter sorting) is the display parameter value.\n\nSearch: grep -c 'Region=' deltas.ndjson → 10 total hits (7 are this display-only P6 pattern; 2 are P1 case-sensitivity issues for en-us; 1 is an $expand with transient metadata diffs where \"Region=\" appears only in diagnostics).\n\n\nTolerance: bcp47-display-format. Matches $validate-code records where system=urn:ietf:bcp:47, both prod and dev return display parameters, and the values differ. Canonicalizes dev display to match prod. Expected to eliminate 7 records.\n\n\nda702ab4-7ced-4b69-945c-0b5bbbc088c0 — POST /r4/ValueSet/$validate-code? for en-US in urn:ietf:bcp:47\n\n\ne0019ec #1 Claude (AI Assistant) <claude@anthropic.com>\n\nClosing: no longer reproducible as of 2026-02-07. Both prod and dev now return the same 'Region=...' format for BCP-47 display text. Servers have converged.", "body_html": "<p>Records-Impacted: 7<br>\nTolerance-ID: bcp47-display-format<br>\nRecord-ID: da702ab4-7ced-4b69-945c-0b5bbbc088c0</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/CodeSystem/$validate-code?url=urn:ietf:bcp:47&amp;code=en-US&#x27; -H &#x27;Accept: application/fhir+json&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/CodeSystem/$validate-code?url=urn:ietf:bcp:47&amp;code=en-US&#x27; -H &#x27;Accept: application/fhir+json&#x27;</code></pre>\n<p>As of 2026-02-07, both servers return <code>&quot;display&quot;: &quot;English (Region=United States)&quot;</code> — the original difference (prod had &quot;English (United States)&quot;) is no longer present. Prod appears to have been updated to match dev&#x27;s format.</p>\n<p>For BCP-47 language codes (system urn:ietf:bcp:47), dev returns display text with explicit subtag labels like &quot;English (Region=United States)&quot; while prod returns the standard format &quot;English (United States)&quot;.</p>\n<p>Specific example for code en-US:</p>\n<ul><li>prod: &quot;English (United States)&quot;</li><li>dev: &quot;English (Region=United States)&quot;</li></ul>\n<p>The &quot;Region=&quot; prefix in dev&#x27;s display text is non-standard. The IANA/BCP-47 convention is to show the region name without a label prefix.</p>\n<p>7 P6 $validate-code records in the current delta set match this pattern — all are urn:ietf:bcp:47 validate-code operations for code en-US where the only difference (after diagnostics stripping and parameter sorting) is the display parameter value.</p>\n<p>Search: grep -c &#x27;Region=&#x27; deltas.ndjson → 10 total hits (7 are this display-only P6 pattern; 2 are P1 case-sensitivity issues for en-us; 1 is an $expand with transient metadata diffs where &quot;Region=&quot; appears only in diagnostics).</p>\n<p>Tolerance: bcp47-display-format. Matches $validate-code records where system=urn:ietf:bcp:47, both prod and dev return display parameters, and the values differ. Canonicalizes dev display to match prod. Expected to eliminate 7 records.</p>\n<p>da702ab4-7ced-4b69-945c-0b5bbbc088c0 — POST /r4/ValueSet/$validate-code? for en-US in urn:ietf:bcp:47</p>\n<p>e0019ec #1 Claude (AI Assistant) &lt;claude@anthropic.com&gt;</p>\n<p>Closing: no longer reproducible as of 2026-02-07. Both prod and dev now return the same &#x27;Region=...&#x27; format for BCP-47 display text. Servers have converged.</p>", "impact": 7}, {"id": "4c5d0f9", "title": "Dev returns x-unknown-system for code system versions that prod recognizes", "status": "closed", "labels": ["content-differs", "not-reproduced", "round:2026-02-round-1", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 13:38", "date_iso": "2026-02-08T13:38:01-06:00", "body_md": "Records-Impacted: 5\nTolerance-ID: validate-code-x-unknown-system-extra\nRecord-ID: e23bae38-016e-46ef-bd71-160ddb1ea35a\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/CodeSystem/$validate-code' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"coding\",\"valueCoding\":{\"system\":\"urn:oid:2.16.840.1.113883.6.238\",\"version\":\"v1\",\"code\":\"2054-5\"}}]}'\n\ncurl -s 'https://tx-dev.fhir.org/r4/CodeSystem/$validate-code' \\\n-H 'Accept: application/fhir+json' \\\n-H 'Content-Type: application/fhir+json' \\\n-d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"coding\",\"valueCoding\":{\"system\":\"urn:oid:2.16.840.1.113883.6.238\",\"version\":\"v1\",\"code\":\"2054-5\"}}]}'\n```\n\n**Not reproduced.** Both servers now return identical behavior for unknown code system versions: both return `x-caused-by-unknown-system` parameter, both return `UNKNOWN_CODESYSTEM_VERSION` issue, and both omit `display`. The original ValueSet (`omb-race-category|4.1.0`) is no longer loaded on the public servers, so the exact original request cannot be replayed, but the underlying code system version handling has converged. The parameter name has also changed from `x-unknown-system` to `x-caused-by-unknown-system` on both servers, confirming a code update that aligned the behavior.\n\n\nWhen validating a code against a ValueSet where the requested code system version is not found, dev and prod behave differently:\n\n1. **x-unknown-system parameter**: Dev returns an extra `x-unknown-system` parameter (e.g., `urn:oid:2.16.840.1.113883.6.238|v1`), prod does not.\n2. **Extra OperationOutcome issue**: Dev returns an additional issue with code `not-found`, message-id `UNKNOWN_CODESYSTEM_VERSION`, and text like \"A definition for CodeSystem '...' version 'v1' could not be found, so the code cannot be validated. Valid versions: 1.2\". Prod only returns the `not-in-vs` issue.\n3. **Message text**: Dev's message parameter prepends the unknown-system error before the not-in-vs message. Prod only includes the not-in-vs message.\n4. **Display parameter**: Prod returns a display value (e.g., \"Black or African American\") looked up from its known version. Dev omits display entirely since it considers the system unknown.\n5. **Version parameter**: Prod returns two version parameters — the actual known version (`1.2`) and the requested version (`v1`). Dev only returns the requested version (`v1`).\n\nBoth agree `result=false`, so the validation outcome is the same. The difference is in how each server handles the unknown version — prod falls back to a known version and provides display/version details, while dev treats the version as entirely unknown.\n\n\n5 records in deltas match this pattern (all POST /r4/ValueSet/$validate-code with `x-unknown-system` in dev response):\n- 4 records involve `urn:oid:2.16.840.1.113883.6.238|v1` (CDC Race and Ethnicity)\n- 1 record involves `http://snomed.info/sct|http://snomed.info/sct/731000124108/version/20250301` (SNOMED edition)\n\nSearch: `grep -c 'x-unknown-system' jobs/2026-02-round-1/results/deltas/deltas.ndjson` → 5\nFull comparison data has 21 records mentioning x-unknown-system (16 handled by existing tolerances).\n\n\nTolerance ID: `validate-code-x-unknown-system-extra`. Matches $validate-code responses where dev has `x-unknown-system` parameter that prod lacks. Normalizes by:\n- Stripping `x-unknown-system` from dev\n- Canonicalizing message and issues to prod's values\n- Canonicalizing display and version to prod's values\n\nEliminates 5 delta records.", "body_html": "<p>Records-Impacted: 5<br>\nTolerance-ID: validate-code-x-unknown-system-extra<br>\nRecord-ID: e23bae38-016e-46ef-bd71-160ddb1ea35a</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/CodeSystem/$validate-code&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;coding&quot;,&quot;valueCoding&quot;:{&quot;system&quot;:&quot;urn:oid:2.16.840.1.113883.6.238&quot;,&quot;version&quot;:&quot;v1&quot;,&quot;code&quot;:&quot;2054-5&quot;}}]}&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/CodeSystem/$validate-code&#x27; \\\n-H &#x27;Accept: application/fhir+json&#x27; \\\n-H &#x27;Content-Type: application/fhir+json&#x27; \\\n-d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;coding&quot;,&quot;valueCoding&quot;:{&quot;system&quot;:&quot;urn:oid:2.16.840.1.113883.6.238&quot;,&quot;version&quot;:&quot;v1&quot;,&quot;code&quot;:&quot;2054-5&quot;}}]}&#x27;</code></pre>\n<p><strong>Not reproduced.</strong> Both servers now return identical behavior for unknown code system versions: both return <code>x-caused-by-unknown-system</code> parameter, both return <code>UNKNOWN_CODESYSTEM_VERSION</code> issue, and both omit <code>display</code>. The original ValueSet (<code>omb-race-category|4.1.0</code>) is no longer loaded on the public servers, so the exact original request cannot be replayed, but the underlying code system version handling has converged. The parameter name has also changed from <code>x-unknown-system</code> to <code>x-caused-by-unknown-system</code> on both servers, confirming a code update that aligned the behavior.</p>\n<p>When validating a code against a ValueSet where the requested code system version is not found, dev and prod behave differently:</p>\n<ol><li><strong>x-unknown-system parameter</strong>: Dev returns an extra <code>x-unknown-system</code> parameter (e.g., <code>urn:oid:2.16.840.1.113883.6.238|v1</code>), prod does not.</li><li><strong>Extra OperationOutcome issue</strong>: Dev returns an additional issue with code <code>not-found</code>, message-id <code>UNKNOWN_CODESYSTEM_VERSION</code>, and text like &quot;A definition for CodeSystem &#x27;...&#x27; version &#x27;v1&#x27; could not be found, so the code cannot be validated. Valid versions: 1.2&quot;. Prod only returns the <code>not-in-vs</code> issue.</li><li><strong>Message text</strong>: Dev&#x27;s message parameter prepends the unknown-system error before the not-in-vs message. Prod only includes the not-in-vs message.</li><li><strong>Display parameter</strong>: Prod returns a display value (e.g., &quot;Black or African American&quot;) looked up from its known version. Dev omits display entirely since it considers the system unknown.</li><li><strong>Version parameter</strong>: Prod returns two version parameters — the actual known version (<code>1.2</code>) and the requested version (<code>v1</code>). Dev only returns the requested version (<code>v1</code>).</li></ol>\n<p>Both agree <code>result=false</code>, so the validation outcome is the same. The difference is in how each server handles the unknown version — prod falls back to a known version and provides display/version details, while dev treats the version as entirely unknown.</p>\n<p>5 records in deltas match this pattern (all POST /r4/ValueSet/$validate-code with <code>x-unknown-system</code> in dev response):</p>\n<ul><li>4 records involve <code>urn:oid:2.16.840.1.113883.6.238|v1</code> (CDC Race and Ethnicity)</li><li>1 record involves <code>http://snomed.info/sct|http://snomed.info/sct/731000124108/version/20250301</code> (SNOMED edition)</li></ul>\n<p>Search: <code>grep -c &#x27;x-unknown-system&#x27; jobs/2026-02-round-1/results/deltas/deltas.ndjson</code> → 5<br>\nFull comparison data has 21 records mentioning x-unknown-system (16 handled by existing tolerances).</p>\n<p>Tolerance ID: <code>validate-code-x-unknown-system-extra</code>. Matches $validate-code responses where dev has <code>x-unknown-system</code> parameter that prod lacks. Normalizes by:</p>\n<ul><li>Stripping <code>x-unknown-system</code> from dev</li><li>Canonicalizing message and issues to prod&#x27;s values</li><li>Canonicalizing display and version to prod&#x27;s values</li></ul>\n<p>Eliminates 5 delta records.</p>", "impact": 5}, {"id": "44d6f07", "title": "Dev truncates BCP-47 language tag region in expand displayLanguage parameter", "status": "closed", "labels": ["content-differs", "not-reproduced", "round:2026-02-round-2", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 10:52", "date_iso": "2026-02-08T10:52:56-06:00", "body_md": "Records-Impacted: 2\nTolerance-ID: expand-displayLanguage-region-truncated\nRecord-ID: 4bd05003-c9ae-4886-9009-3f794f2690a1\n\n\n```bash\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$expand' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\n    \"resourceType\": \"Parameters\",\n    \"parameter\": [\n      {\"name\": \"displayLanguage\", \"valueCode\": \"fr-FR\"},\n      {\"name\": \"excludeNested\", \"valueBoolean\": true},\n      {\"name\": \"count\", \"valueInteger\": 10},\n      {\"name\": \"valueSet\", \"resource\": {\n        \"resourceType\": \"ValueSet\",\n        \"status\": \"active\",\n        \"compose\": {\n          \"include\": [{\"system\": \"http://loinc.org\", \"concept\": [{\"code\": \"11369-6\"}]}]\n        }\n      }}\n    ]\n  }' | jq '.expansion.parameter[] | select(.name == \"displayLanguage\")'\n\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$expand' \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\n    \"resourceType\": \"Parameters\",\n    \"parameter\": [\n      {\"name\": \"displayLanguage\", \"valueCode\": \"fr-FR\"},\n      {\"name\": \"excludeNested\", \"valueBoolean\": true},\n      {\"name\": \"count\", \"valueInteger\": 10},\n      {\"name\": \"valueSet\", \"resource\": {\n        \"resourceType\": \"ValueSet\",\n        \"status\": \"active\",\n        \"compose\": {\n          \"include\": [{\"system\": \"http://loinc.org\", \"concept\": [{\"code\": \"11369-6\"}]}]\n        }\n      }}\n    ]\n  }' | jq '.expansion.parameter[] | select(.name == \"displayLanguage\")'\n```\n\n**Result**: Both servers now return `{\"name\": \"displayLanguage\", \"valueCode\": \"fr-FR\"}`. The bug has been fixed - dev no longer truncates the region subtag.\n\n\nIn $expand responses, the `displayLanguage` expansion parameter echoed back by dev truncates the BCP-47 language tag to just the language code, dropping the region subtag. When the request specifies `displayLanguage=fr-FR`, prod echoes back `fr-FR` in the expansion parameters, but dev echoes back `fr`.\n\nThe actual expansion content (codes, display text) is identical between prod and dev — the difference is only in the echoed `displayLanguage` parameter value.\n\n\n2 records in the current comparison show this pattern. Both are POST /r4/ValueSet/$expand requests with `displayLanguage=fr-FR` in the request body.\n\nSearch: grep for records where both prod and dev have a `displayLanguage` expansion parameter but with different values — found only these 2 records (IDs: 4bd05003-c9ae-4886-9009-3f794f2690a1, 57537a3f-f65b-4f96-b9d7-3354772c3973).\n\nThere are an additional 62 records with a different displayLanguage mismatch pattern (prod has displayLanguage=en or en-US but dev omits it entirely), which is a separate issue.\n\n\nTolerance `expand-displayLanguage-region-truncated` normalizes the displayLanguage expansion parameter to the prod value when both sides have a displayLanguage parameter but the values differ only by region subtag truncation (e.g., fr-FR vs fr). This eliminates 2 records.\n\n\n`grep -n '4bd05003-c9ae-4886-9009-3f794f2690a1' jobs/2026-02-round-2/comparison.ndjson`", "body_html": "<p>Records-Impacted: 2<br>\nTolerance-ID: expand-displayLanguage-region-truncated<br>\nRecord-ID: 4bd05003-c9ae-4886-9009-3f794f2690a1</p>\n<pre><code class=\"lang-bash\">curl -s &#x27;https://tx.fhir.org/r4/ValueSet/$expand&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{\n    &quot;resourceType&quot;: &quot;Parameters&quot;,\n    &quot;parameter&quot;: [\n      {&quot;name&quot;: &quot;displayLanguage&quot;, &quot;valueCode&quot;: &quot;fr-FR&quot;},\n      {&quot;name&quot;: &quot;excludeNested&quot;, &quot;valueBoolean&quot;: true},\n      {&quot;name&quot;: &quot;count&quot;, &quot;valueInteger&quot;: 10},\n      {&quot;name&quot;: &quot;valueSet&quot;, &quot;resource&quot;: {\n        &quot;resourceType&quot;: &quot;ValueSet&quot;,\n        &quot;status&quot;: &quot;active&quot;,\n        &quot;compose&quot;: {\n          &quot;include&quot;: [{&quot;system&quot;: &quot;http://loinc.org&quot;, &quot;concept&quot;: [{&quot;code&quot;: &quot;11369-6&quot;}]}]\n        }\n      }}\n    ]\n  }&#x27; | jq &#x27;.expansion.parameter[] | select(.name == &quot;displayLanguage&quot;)&#x27;\n\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{\n    &quot;resourceType&quot;: &quot;Parameters&quot;,\n    &quot;parameter&quot;: [\n      {&quot;name&quot;: &quot;displayLanguage&quot;, &quot;valueCode&quot;: &quot;fr-FR&quot;},\n      {&quot;name&quot;: &quot;excludeNested&quot;, &quot;valueBoolean&quot;: true},\n      {&quot;name&quot;: &quot;count&quot;, &quot;valueInteger&quot;: 10},\n      {&quot;name&quot;: &quot;valueSet&quot;, &quot;resource&quot;: {\n        &quot;resourceType&quot;: &quot;ValueSet&quot;,\n        &quot;status&quot;: &quot;active&quot;,\n        &quot;compose&quot;: {\n          &quot;include&quot;: [{&quot;system&quot;: &quot;http://loinc.org&quot;, &quot;concept&quot;: [{&quot;code&quot;: &quot;11369-6&quot;}]}]\n        }\n      }}\n    ]\n  }&#x27; | jq &#x27;.expansion.parameter[] | select(.name == &quot;displayLanguage&quot;)&#x27;</code></pre>\n<p><strong>Result</strong>: Both servers now return <code>{&quot;name&quot;: &quot;displayLanguage&quot;, &quot;valueCode&quot;: &quot;fr-FR&quot;}</code>. The bug has been fixed - dev no longer truncates the region subtag.</p>\n<p>In $expand responses, the <code>displayLanguage</code> expansion parameter echoed back by dev truncates the BCP-47 language tag to just the language code, dropping the region subtag. When the request specifies <code>displayLanguage=fr-FR</code>, prod echoes back <code>fr-FR</code> in the expansion parameters, but dev echoes back <code>fr</code>.</p>\n<p>The actual expansion content (codes, display text) is identical between prod and dev — the difference is only in the echoed <code>displayLanguage</code> parameter value.</p>\n<p>2 records in the current comparison show this pattern. Both are POST /r4/ValueSet/$expand requests with <code>displayLanguage=fr-FR</code> in the request body.</p>\n<p>Search: grep for records where both prod and dev have a <code>displayLanguage</code> expansion parameter but with different values — found only these 2 records (IDs: 4bd05003-c9ae-4886-9009-3f794f2690a1, 57537a3f-f65b-4f96-b9d7-3354772c3973).</p>\n<p>There are an additional 62 records with a different displayLanguage mismatch pattern (prod has displayLanguage=en or en-US but dev omits it entirely), which is a separate issue.</p>\n<p>Tolerance <code>expand-displayLanguage-region-truncated</code> normalizes the displayLanguage expansion parameter to the prod value when both sides have a displayLanguage parameter but the values differ only by region subtag truncation (e.g., fr-FR vs fr). This eliminates 2 records.</p>\n<p><code>grep -n &#x27;4bd05003-c9ae-4886-9009-3f794f2690a1&#x27; jobs/2026-02-round-2/comparison.ndjson</code></p>", "impact": 2}, {"id": "e18fdef", "title": "Dev returns 404 for LOINC answer list ValueSet $expand (appends |4.0.1 to canonical URL)", "status": "closed", "labels": ["missing-resource", "not-reproduced", "round:2026-02-round-2", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 10:52", "date_iso": "2026-02-08T10:52:57-06:00", "body_md": "Records-Impacted: 2\nTolerance-ID: loinc-answer-list-expand-404\nRecord-ID: 7cf61657-1a32-4b8f-a4c6-f626df7381e0\n\n\n```bash\ncurl -s https://tx.fhir.org/r4/ValueSet/\\$expand \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://loinc.org/vs/LL379-9\"}]}'\n\ncurl -s https://tx-dev.fhir.org/r4/ValueSet/\\$expand \\\n  -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/fhir+json' \\\n  -d '{\"resourceType\":\"Parameters\",\"parameter\":[{\"name\":\"url\",\"valueUri\":\"http://loinc.org/vs/LL379-9\"}]}'\n```\n\n**Result:** Both servers now return 200 with identical ValueSet expansions containing 7 codes. The bug is no longer reproduced - the dev server previously returned 404 with \"ValueSet not found: http://loinc.org/vs/LL379-9|4.0.1\" but now correctly expands the LOINC answer list.\n\n\nWhen expanding the LOINC answer list ValueSet `http://loinc.org/vs/LL379-9` via `POST /r4/ValueSet/$expand`, prod returns 200 with a successful expansion (7 codes), while dev **previously** returned 404 with:\n\n    ValueSet not found: http://loinc.org/vs/LL379-9|4.0.1\n\nDev was appending `|4.0.1` (the FHIR R4 version) to the ValueSet canonical URL when resolving it, causing the lookup to fail.\n\n\n2 records in the comparison dataset showed this exact pattern — both are `POST /r4/ValueSet/$expand` for the same LOINC answer list LL379-9, both with prod=200/dev=404, and both with the same `|4.0.1` suffix in the dev error message.\n\nSearch:\n- `grep 'LL379-9' deltas.ndjson` → 2 records\n- `grep 'missing-resource' deltas.ndjson` → 3 total (1 is a separate CodeSystem/SOP issue)\n- All 2 matching records had identical error diagnostic\n\nThe full comparison.ndjson had 64 records referencing LL379-9, but the other 62 are `GET /r4/ValueSet?_elements=url,version` (search/list operations, not expand) and succeeded on both servers.\n\n\nTolerance ID: `loinc-answer-list-expand-404`\nMatched: `missing-resource` category, `POST /r4/ValueSet/$expand`, dev 404 with diagnostics containing `|4.0.1`\nEliminated: 2 records", "body_html": "<p>Records-Impacted: 2<br>\nTolerance-ID: loinc-answer-list-expand-404<br>\nRecord-ID: 7cf61657-1a32-4b8f-a4c6-f626df7381e0</p>\n<pre><code class=\"lang-bash\">curl -s https://tx.fhir.org/r4/ValueSet/\\$expand \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://loinc.org/vs/LL379-9&quot;}]}&#x27;\n\ncurl -s https://tx-dev.fhir.org/r4/ValueSet/\\$expand \\\n  -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/fhir+json&#x27; \\\n  -d &#x27;{&quot;resourceType&quot;:&quot;Parameters&quot;,&quot;parameter&quot;:[{&quot;name&quot;:&quot;url&quot;,&quot;valueUri&quot;:&quot;http://loinc.org/vs/LL379-9&quot;}]}&#x27;</code></pre>\n<p><strong>Result:</strong> Both servers now return 200 with identical ValueSet expansions containing 7 codes. The bug is no longer reproduced - the dev server previously returned 404 with &quot;ValueSet not found: <a href=\"http://loinc.org/vs/LL379-9|4.0.1&quot;\" target=\"_blank\">http://loinc.org/vs/LL379-9|4.0.1&quot;</a> but now correctly expands the LOINC answer list.</p>\n<p>When expanding the LOINC answer list ValueSet <code>http://loinc.org/vs/LL379-9</code> via <code>POST /r4/ValueSet/$expand</code>, prod returns 200 with a successful expansion (7 codes), while dev <strong>previously</strong> returned 404 with:</p>\n<p>ValueSet not found: <a href=\"http://loinc.org/vs/LL379-9|4.0.1\" target=\"_blank\">http://loinc.org/vs/LL379-9|4.0.1</a></p>\n<p>Dev was appending <code>|4.0.1</code> (the FHIR R4 version) to the ValueSet canonical URL when resolving it, causing the lookup to fail.</p>\n<p>2 records in the comparison dataset showed this exact pattern — both are <code>POST /r4/ValueSet/$expand</code> for the same LOINC answer list LL379-9, both with prod=200/dev=404, and both with the same <code>|4.0.1</code> suffix in the dev error message.</p>\n<p>Search:</p>\n<ul><li><code>grep &#x27;LL379-9&#x27; deltas.ndjson</code> → 2 records</li><li><code>grep &#x27;missing-resource&#x27; deltas.ndjson</code> → 3 total (1 is a separate CodeSystem/SOP issue)</li><li>All 2 matching records had identical error diagnostic</li></ul>\n<p>The full comparison.ndjson had 64 records referencing LL379-9, but the other 62 are <code>GET /r4/ValueSet?_elements=url,version</code> (search/list operations, not expand) and succeeded on both servers.</p>\n<p>Tolerance ID: <code>loinc-answer-list-expand-404</code><br>\nMatched: <code>missing-resource</code> category, <code>POST /r4/ValueSet/$expand</code>, dev 404 with diagnostics containing <code>|4.0.1</code><br>\nEliminated: 2 records</p>", "impact": 2}, {"id": "a9cf20c", "title": "Dev omits deprecated location field on OperationOutcome issues", "status": "closed", "labels": ["code-defect", "content-differs", "reproduced", "round:2026-02-round-2", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 10:52", "date_iso": "2026-02-08T10:52:57-06:00", "body_md": "Records-Impacted: ~3316\nRecord-ID: 59eff7c6-9fd2-45b2-8f27-c790368bcc54, 1697b0cd-971b-475c-8075-f249215b1205, 199de988-2772-45c3-83cb-5ff1de1f01ce\nTolerance-ID: oo-missing-location-field, oo-missing-location-post-version-skew\n\n## Repro\n\n```bash\n# Prod\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$validate-code?url=http:%2F%2Fcts.nlm.nih.gov%2Ffhir%2FValueSet%2F2.16.840.1.114222.4.11.1066&code=1223P0106X&_format=json&system=http:%2F%2Fnucc.org%2Fprovider-taxonomy' \\\n  -H 'Accept: application/fhir+json' | jq '.parameter[] | select(.name == \"issues\") | .resource.issue[0] | {severity, code, location, expression}'\n\n# Dev\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$validate-code?url=http:%2F%2Fcts.nlm.nih.gov%2Ffhir%2FValueSet%2F2.16.840.1.114222.4.11.1066&code=1223P0106X&_format=json&system=http:%2F%2Fnucc.org%2Fprovider-taxonomy' \\\n  -H 'Accept: application/fhir+json' | jq '.parameter[] | select(.name == \"issues\") | .resource.issue[0] | {severity, code, location, expression}'\n```\n\nProd returns `\"location\": [\"system\"]`, dev returns `\"location\": null` (field is omitted).\n\n## Root Cause\n\n**Classification**: code-level defect\n\n**Prod** populates both `location` and `expression` with the same path value on every OperationOutcome issue:\n[`library/fhir4/fhir4_common.pas#L1480-L1492`](https://github.com/HealthIntersections/fhirserver/blob/ec46dff3fe631ddeeaa000a3ca9530e0dd8c9eac/library/fhir4/fhir4_common.pas#L1480-L1492)\n— The `addIssue` method (line 1487-1488) adds the path to both `iss.locationList` and `iss.expressionList`. The same pattern appears in `addIssueNoId` at lines 1457-1458.\n\n**Dev** only sets `expression`, never sets `location`:\n[`tx/library/operation-outcome.js#L25-L46`](https://github.com/HealthIntersections/FHIRsmith/blob/6440990b4d0f5ca87b48093bad6ac2868067a49e/tx/library/operation-outcome.js#L25-L46)\n— The `asIssue()` method (line 33-35) sets `res.expression = [this.path]` but has no corresponding `res.location = [this.path]` line.\n\n**Fix**: In `tx/library/operation-outcome.js`, add `res.location = [this.path]` alongside the existing `res.expression = [this.path]` in the `asIssue()` method (after line 34).\n\n## Tolerances\n\n### 1. `oo-missing-location-field` (~3069 records)\n\n**What it handles**: Strips `location` from prod's OperationOutcome issues when dev lacks it and `location` equals `expression`. Handles both flat `$validate-code` responses (top-level issues parameter) and nested `$batch-validate-code` responses (issues inside `validation` parameter entries).\n\n**Representative records**:\n- `59eff7c6-9fd2-45b2-8f27-c790368bcc54` (flat validate-code, NUCC provider-taxonomy)\n- `1697b0cd-971b-475c-8075-f249215b1205` (batch-validate-code, nested validation structure)\n\n**Details**: Of the ~3069 affected records, ~2555 are fully eliminated from deltas (location was the only remaining difference). The remaining ~514 still have other differences but the location diff is normalized away. The batch-validate-code subset accounts for ~38 records where the nested response structure required additional handling.\n\n### 2. `oo-missing-location-post-version-skew` (~247 records)\n\n**What it handles**: Same root cause, but catches records where `oo-missing-location-field` misses the difference due to pipeline ordering. Specifically, when HL7 terminology version-skew tolerances (`hl7-terminology-cs-version-skew`) strip extra `status-check` informational issues from prod, the OperationOutcome issue arrays only become aligned after those normalizations run. Since `oo-missing-location-field` runs earlier in the pipeline, the misaligned arrays prevent index-based comparison from detecting the location difference. This tolerance runs later to catch those remaining records.\n\n**Representative record**: `199de988-2772-45c3-83cb-5ff1de1f01ce` (validate-code against `condition-category` CodeSystem, prod has extra status-check issue stripped by version-skew tolerance)\n\n## Total impact\n\n~3316 records across both tolerances (~34% of all deltas). All are `$validate-code` or `$batch-validate-code` operations.", "body_html": "<p>Records-Impacted: ~3316<br>\nRecord-ID: 59eff7c6-9fd2-45b2-8f27-c790368bcc54, 1697b0cd-971b-475c-8075-f249215b1205, 199de988-2772-45c3-83cb-5ff1de1f01ce<br>\nTolerance-ID: oo-missing-location-field, oo-missing-location-post-version-skew</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod\ncurl -s &#x27;https://tx.fhir.org/r4/ValueSet/$validate-code?url=http:%2F%2Fcts.nlm.nih.gov%2Ffhir%2FValueSet%2F2.16.840.1.114222.4.11.1066&amp;code=1223P0106X&amp;_format=json&amp;system=http:%2F%2Fnucc.org%2Fprovider-taxonomy&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; | jq &#x27;.parameter[] | select(.name == &quot;issues&quot;) | .resource.issue[0] | {severity, code, location, expression}&#x27;\n\n# Dev\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$validate-code?url=http:%2F%2Fcts.nlm.nih.gov%2Ffhir%2FValueSet%2F2.16.840.1.114222.4.11.1066&amp;code=1223P0106X&amp;_format=json&amp;system=http:%2F%2Fnucc.org%2Fprovider-taxonomy&#x27; \\\n  -H &#x27;Accept: application/fhir+json&#x27; | jq &#x27;.parameter[] | select(.name == &quot;issues&quot;) | .resource.issue[0] | {severity, code, location, expression}&#x27;</code></pre>\n<p>Prod returns <code>&quot;location&quot;: [&quot;system&quot;]</code>, dev returns <code>&quot;location&quot;: null</code> (field is omitted).</p>\n<h2>Root Cause</h2>\n<p><strong>Classification</strong>: code-level defect</p>\n<p><strong>Prod</strong> populates both <code>location</code> and <code>expression</code> with the same path value on every OperationOutcome issue:<br>\n<a href=\"https://github.com/HealthIntersections/fhirserver/blob/ec46dff3fe631ddeeaa000a3ca9530e0dd8c9eac/library/fhir4/fhir4_common.pas#L1480-L1492\" target=\"_blank\"><code>library/fhir4/fhir4_common.pas#L1480-L1492</code></a><br>\n— The <code>addIssue</code> method (line 1487-1488) adds the path to both <code>iss.locationList</code> and <code>iss.expressionList</code>. The same pattern appears in <code>addIssueNoId</code> at lines 1457-1458.</p>\n<p><strong>Dev</strong> only sets <code>expression</code>, never sets <code>location</code>:<br>\n<a href=\"https://github.com/HealthIntersections/FHIRsmith/blob/6440990b4d0f5ca87b48093bad6ac2868067a49e/tx/library/operation-outcome.js#L25-L46\" target=\"_blank\"><code>tx/library/operation-outcome.js#L25-L46</code></a><br>\n— The <code>asIssue()</code> method (line 33-35) sets <code>res.expression = [this.path]</code> but has no corresponding <code>res.location = [this.path]</code> line.</p>\n<p><strong>Fix</strong>: In <code>tx/library/operation-outcome.js</code>, add <code>res.location = [this.path]</code> alongside the existing <code>res.expression = [this.path]</code> in the <code>asIssue()</code> method (after line 34).</p>\n<h2>Tolerances</h2>\n<h3>1. <code>oo-missing-location-field</code> (~3069 records)</h3>\n<p><strong>What it handles</strong>: Strips <code>location</code> from prod&#x27;s OperationOutcome issues when dev lacks it and <code>location</code> equals <code>expression</code>. Handles both flat <code>$validate-code</code> responses (top-level issues parameter) and nested <code>$batch-validate-code</code> responses (issues inside <code>validation</code> parameter entries).</p>\n<p><strong>Representative records</strong>:</p>\n<ul><li><code>59eff7c6-9fd2-45b2-8f27-c790368bcc54</code> (flat validate-code, NUCC provider-taxonomy)</li><li><code>1697b0cd-971b-475c-8075-f249215b1205</code> (batch-validate-code, nested validation structure)</li></ul>\n<p><strong>Details</strong>: Of the ~3069 affected records, ~2555 are fully eliminated from deltas (location was the only remaining difference). The remaining ~514 still have other differences but the location diff is normalized away. The batch-validate-code subset accounts for ~38 records where the nested response structure required additional handling.</p>\n<h3>2. <code>oo-missing-location-post-version-skew</code> (~247 records)</h3>\n<p><strong>What it handles</strong>: Same root cause, but catches records where <code>oo-missing-location-field</code> misses the difference due to pipeline ordering. Specifically, when HL7 terminology version-skew tolerances (<code>hl7-terminology-cs-version-skew</code>) strip extra <code>status-check</code> informational issues from prod, the OperationOutcome issue arrays only become aligned after those normalizations run. Since <code>oo-missing-location-field</code> runs earlier in the pipeline, the misaligned arrays prevent index-based comparison from detecting the location difference. This tolerance runs later to catch those remaining records.</p>\n<p><strong>Representative record</strong>: <code>199de988-2772-45c3-83cb-5ff1de1f01ce</code> (validate-code against <code>condition-category</code> CodeSystem, prod has extra status-check issue stripped by version-skew tolerance)</p>\n<h2>Total impact</h2>\n<p>~3316 records across both tolerances (~34% of all deltas). All are <code>$validate-code</code> or <code>$batch-validate-code</code> operations.</p>", "impact": null}, {"id": "3e1d117", "title": "validate-code: dev returns result=false with 'undefined' system when dev cache not warm at comparison start", "status": "closed", "labels": ["repro-inconclusive", "round:2026-02-round-2", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-08 10:53", "date_iso": "2026-02-08T10:53:35-06:00", "body_md": "Tolerance-ID: validate-code-undefined-system-result-disagrees\nRecord-ID: 49614070-0a84-4943-942d-0f40746020a5\n\nPOST $validate-code: dev returns result=false with \"undefined\" system in diagnostics where prod returns result=true. Dev server cache was not warm at start of comparison run, causing it to fail to resolve systems that prod resolves.\n\nAlso covers the related pattern `validate-code-undefined-system-missing-params` where both return result=false but dev is missing code/system/display params due to the same undefined system issue.\n\nPreviously adjudicated by GG as equiv-autofix test artifact. Converted to temp-tolerance so it is re-evaluated in future rounds.", "body_html": "<p>Tolerance-ID: validate-code-undefined-system-result-disagrees<br>\nRecord-ID: 49614070-0a84-4943-942d-0f40746020a5</p>\n<p>POST $validate-code: dev returns result=false with &quot;undefined&quot; system in diagnostics where prod returns result=true. Dev server cache was not warm at start of comparison run, causing it to fail to resolve systems that prod resolves.</p>\n<p>Also covers the related pattern <code>validate-code-undefined-system-missing-params</code> where both return result=false but dev is missing code/system/display params due to the same undefined system issue.</p>\n<p>Previously adjudicated by GG as equiv-autofix test artifact. Converted to temp-tolerance so it is re-evaluated in future rounds.</p>", "impact": null}, {"id": "6edc96c", "title": "Dev loads different versions of HL7 terminology CodeSystems (terminology.hl7.org) than prod", "status": "closed", "labels": ["config-issue", "content-differs", "reproduced", "round:2026-02-round-2", "tx-compare", "won't-fix"], "author": "Claude (AI Assistant)", "date": "2026-02-08 19:49", "date_iso": "2026-02-08T19:49:47-06:00", "body_md": "Records-Impacted: ~465\nRecord-ID: 04364a8a-acce-491a-8018-9ac010d47d21, ef77e7ca-9afa-4325-a1f3-a939a62a490f, 7813f9ee-79ee-445b-8064-603a98e876bf, 83509e51-1a8b-4d77-8f4e-7b0037009c4a, 2d18564d-4e72-425d-aca0-358240df2c57, 118efc0f-ad5c-4db9-b9e6-2120a5824b92\nTolerance-ID: hl7-terminology-cs-version-skew, expand-hl7-terminology-version-skew-params, expand-hl7-terminology-version-skew-content, validate-code-hl7-terminology-vs-version-skew, expand-hl7-terminology-version-skew-vs-metadata, hl7-terminology-lookup-definition-designation-skew\n\n## Summary\n\nDev loads older/different versions of HL7 terminology CodeSystems and ValueSets (`http://terminology.hl7.org/CodeSystem/*`, `http://terminology.hl7.org/ValueSet/*`) than prod. For example, prod loads `consentcategorycodes` at version `4.0.1` while dev loads `1.0.1`; prod loads `observation-category` at `4.0.1` while dev loads `2.0.0`. Dev also loads different ValueSet versions (e.g., `v3-TribalEntityUS|4.0.0` vs dev's `|2018-08-12`, `v3-ActEncounterCode|3.0.0` vs dev's `|2014-03-26`). This version skew is the single root cause behind six distinct manifestations affecting `$validate-code`, `$expand`, and `$lookup` operations.\n\nKnown affected CodeSystems and their version mismatches:\n- `consentcategorycodes`: prod=4.0.1, dev=1.0.1\n- `goal-achievement`: prod=4.0.1, dev=1.0.1\n- `observation-category`: prod=4.0.1, dev=2.0.0\n- `consentpolicycodes`: prod=4.0.1, dev=3.0.1\n- `condition-category`: prod=4.0.1, dev=2.0.0\n- `condition-clinical`: prod=4.0.1, dev=3.0.0\n- `v2-0116`: prod=2.9, dev=3.0.0\n\nKnown affected ValueSets:\n- `v3-ActEncounterCode`: prod=3.0.0, dev=2014-03-26\n- `v3-TribalEntityUS`: prod=4.0.0, dev=2018-08-12\n\n## Tolerances\n\n### 1. `hl7-terminology-cs-version-skew` (~58 records)\n\n**What it handles**: `$validate-code` responses where the only differences are CodeSystem version strings in the `version` parameter, `message` text, and `issues` OperationOutcome `details.text`. Also strips draft `status-check` informational issues that prod includes but dev omits (because dev loads a version that lacks the draft status metadata). Both servers agree on validation results for all affected codes.\n\n**Normalizes**: Dev's version parameter and version strings in message/issues text to prod's values; strips prod's draft status-check issues.\n\n**Representative record**: `04364a8a-acce-491a-8018-9ac010d47d21` — validate-code for `consentcategorycodes` where prod says \"version '4.0.1'\", dev says \"version '1.0.1'\".\n\n### 2. `expand-hl7-terminology-version-skew-params` (~236 records)\n\n**What it handles**: `$expand` responses where the `expansion.parameter` entries differ due to version skew. The `used-codesystem` version strings differ (e.g., `observation-category|4.0.1` vs `|2.0.0`) and prod includes `warning-draft` parameters that dev omits.\n\n**Normalizes**: `used-codesystem` versions for `terminology.hl7.org` systems to prod's values; strips `warning-draft` parameters from both sides.\n\n**Representative record**: `ef77e7ca-9afa-4325-a1f3-a939a62a490f` — expand of `us-core-simple-observation-category` where used-codesystem version and warning-draft differ.\n\n### 3. `expand-hl7-terminology-version-skew-content` (~163 records)\n\n**What it handles**: `$expand` responses where prod and dev return slightly different sets of codes (1-5 extra/missing) because different CodeSystem versions include different codes. For example, dev's older `consentpolicycodes` includes `ch-epr` (removed in 4.0.1), and dev's older `observation-category` includes an extra `symptom` code. The common codes between prod and dev are identical.\n\n**Normalizes**: Both sides to the intersection of codes present in both responses; adjusts the total count accordingly.\n\n**Representative record**: `7813f9ee-79ee-445b-8064-603a98e876bf` — expand of `consent-policy` where dev returns 27 codes vs prod's 26 (extra `ch-epr`).\n\n### 4. `validate-code-hl7-terminology-vs-version-skew` (4 records)\n\n**What it handles**: `$validate-code` responses where the only difference is the ValueSet version string in message text and issues details text. Both servers agree on `result=false` and all other parameters. The difference appears in \"not found in the value set 'url|version'\" messages where prod references the newer ValueSet version (e.g., `v3-ActEncounterCode|3.0.0`) and dev references the older version (e.g., `|2014-03-26`).\n\n**Normalizes**: ValueSet pipe-delimited version strings in message and issues text to prod's values.\n\n**Representative record**: `83509e51-1a8b-4d77-8f4e-7b0037009c4a` — validate-code for PLB in v3-ActEncounterCode where prod says `|3.0.0`, dev says `|2014-03-26`.\n\n### 5. `expand-hl7-terminology-version-skew-vs-metadata` (3 records)\n\n**What it handles**: `$expand` responses where the ValueSet-level metadata fields (date, name, title, version, identifier, language, immutable, meta) differ because prod and dev loaded different editions of the same HL7 terminology ValueSet. The expansion contents are handled by other tolerances (e.g., code intersection), but the wrapper metadata still reflects the different loaded ValueSet versions. For example, TribalEntityUS: prod returns version=4.0.0/name=TribalEntityUS/date=2014-03-26, dev returns version=2018-08-12/name=v3.TribalEntityUS/date=2018-08-12.\n\n**Normalizes**: Dev's metadata fields (date, name, title, version, identifier, language, immutable, meta) to prod's values.\n\n**Representative record**: `2d18564d-4e72-425d-aca0-358240df2c57` — expand of v3-TribalEntityUS where all ValueSet metadata differs between versions.\n\n### 6. `hl7-terminology-lookup-definition-designation-skew` (1 record)\n\n**What it handles**: `$lookup` responses for HL7 terminology CodeSystems where dev returns extra top-level `definition` and `designation` parameters that prod doesn't return. Dev has `definition` as a top-level parameter (with version-dependent text), while prod returns `definition` only as a property entry. Dev also includes a `designation` parameter with `preferredForLanguage` use that prod omits entirely. Both are consequences of dev loading a newer CodeSystem version with richer content.\n\n**Normalizes**: Strips `definition` and `designation` top-level parameters and `definition` property entries from both sides.\n\n**Representative record**: `118efc0f-ad5c-4db9-b9e6-2120a5824b92` — lookup of `active` in `condition-clinical` where dev (version 3.0.0) returns extra definition and designation, prod (version 4.0.1) returns definition only as a property.\n\n## Repro\n\n```bash\n# Prod\ncurl -s 'https://tx.fhir.org/r4/ValueSet/$expand?url=http:%2F%2Fterminology.hl7.org%2FValueSet%2Fv3-TribalEntityUS&incomplete-ok=true&_format=json' -H 'Accept: application/fhir+json' | jq '{version, name, title, date}'\n\n# Dev\ncurl -s 'https://tx-dev.fhir.org/r4/ValueSet/$expand?url=http:%2F%2Fterminology.hl7.org%2FValueSet%2Fv3-TribalEntityUS&incomplete-ok=true&_format=json' -H 'Accept: application/fhir+json' | jq '{version, name, title, date}'\n```\n\nProd returns `version=4.0.0, name=TribalEntityUS`, dev returns `version=2018-08-12, name=v3.TribalEntityUS`.", "body_html": "<p>Records-Impacted: ~465<br>\nRecord-ID: 04364a8a-acce-491a-8018-9ac010d47d21, ef77e7ca-9afa-4325-a1f3-a939a62a490f, 7813f9ee-79ee-445b-8064-603a98e876bf, 83509e51-1a8b-4d77-8f4e-7b0037009c4a, 2d18564d-4e72-425d-aca0-358240df2c57, 118efc0f-ad5c-4db9-b9e6-2120a5824b92<br>\nTolerance-ID: hl7-terminology-cs-version-skew, expand-hl7-terminology-version-skew-params, expand-hl7-terminology-version-skew-content, validate-code-hl7-terminology-vs-version-skew, expand-hl7-terminology-version-skew-vs-metadata, hl7-terminology-lookup-definition-designation-skew</p>\n<h2>Summary</h2>\n<p>Dev loads older/different versions of HL7 terminology CodeSystems and ValueSets (<code>http://terminology.hl7.org/CodeSystem/*</code>, <code>http://terminology.hl7.org/ValueSet/*</code>) than prod. For example, prod loads <code>consentcategorycodes</code> at version <code>4.0.1</code> while dev loads <code>1.0.1</code>; prod loads <code>observation-category</code> at <code>4.0.1</code> while dev loads <code>2.0.0</code>. Dev also loads different ValueSet versions (e.g., <code>v3-TribalEntityUS|4.0.0</code> vs dev&#x27;s <code>|2018-08-12</code>, <code>v3-ActEncounterCode|3.0.0</code> vs dev&#x27;s <code>|2014-03-26</code>). This version skew is the single root cause behind six distinct manifestations affecting <code>$validate-code</code>, <code>$expand</code>, and <code>$lookup</code> operations.</p>\n<p>Known affected CodeSystems and their version mismatches:</p>\n<ul><li><code>consentcategorycodes</code>: prod=4.0.1, dev=1.0.1</li><li><code>goal-achievement</code>: prod=4.0.1, dev=1.0.1</li><li><code>observation-category</code>: prod=4.0.1, dev=2.0.0</li><li><code>consentpolicycodes</code>: prod=4.0.1, dev=3.0.1</li><li><code>condition-category</code>: prod=4.0.1, dev=2.0.0</li><li><code>condition-clinical</code>: prod=4.0.1, dev=3.0.0</li><li><code>v2-0116</code>: prod=2.9, dev=3.0.0</li></ul>\n<p>Known affected ValueSets:</p>\n<ul><li><code>v3-ActEncounterCode</code>: prod=3.0.0, dev=2014-03-26</li><li><code>v3-TribalEntityUS</code>: prod=4.0.0, dev=2018-08-12</li></ul>\n<h2>Tolerances</h2>\n<h3>1. <code>hl7-terminology-cs-version-skew</code> (~58 records)</h3>\n<p><strong>What it handles</strong>: <code>$validate-code</code> responses where the only differences are CodeSystem version strings in the <code>version</code> parameter, <code>message</code> text, and <code>issues</code> OperationOutcome <code>details.text</code>. Also strips draft <code>status-check</code> informational issues that prod includes but dev omits (because dev loads a version that lacks the draft status metadata). Both servers agree on validation results for all affected codes.</p>\n<p><strong>Normalizes</strong>: Dev&#x27;s version parameter and version strings in message/issues text to prod&#x27;s values; strips prod&#x27;s draft status-check issues.</p>\n<p><strong>Representative record</strong>: <code>04364a8a-acce-491a-8018-9ac010d47d21</code> — validate-code for <code>consentcategorycodes</code> where prod says &quot;version &#x27;4.0.1&#x27;&quot;, dev says &quot;version &#x27;1.0.1&#x27;&quot;.</p>\n<h3>2. <code>expand-hl7-terminology-version-skew-params</code> (~236 records)</h3>\n<p><strong>What it handles</strong>: <code>$expand</code> responses where the <code>expansion.parameter</code> entries differ due to version skew. The <code>used-codesystem</code> version strings differ (e.g., <code>observation-category|4.0.1</code> vs <code>|2.0.0</code>) and prod includes <code>warning-draft</code> parameters that dev omits.</p>\n<p><strong>Normalizes</strong>: <code>used-codesystem</code> versions for <code>terminology.hl7.org</code> systems to prod&#x27;s values; strips <code>warning-draft</code> parameters from both sides.</p>\n<p><strong>Representative record</strong>: <code>ef77e7ca-9afa-4325-a1f3-a939a62a490f</code> — expand of <code>us-core-simple-observation-category</code> where used-codesystem version and warning-draft differ.</p>\n<h3>3. <code>expand-hl7-terminology-version-skew-content</code> (~163 records)</h3>\n<p><strong>What it handles</strong>: <code>$expand</code> responses where prod and dev return slightly different sets of codes (1-5 extra/missing) because different CodeSystem versions include different codes. For example, dev&#x27;s older <code>consentpolicycodes</code> includes <code>ch-epr</code> (removed in 4.0.1), and dev&#x27;s older <code>observation-category</code> includes an extra <code>symptom</code> code. The common codes between prod and dev are identical.</p>\n<p><strong>Normalizes</strong>: Both sides to the intersection of codes present in both responses; adjusts the total count accordingly.</p>\n<p><strong>Representative record</strong>: <code>7813f9ee-79ee-445b-8064-603a98e876bf</code> — expand of <code>consent-policy</code> where dev returns 27 codes vs prod&#x27;s 26 (extra <code>ch-epr</code>).</p>\n<h3>4. <code>validate-code-hl7-terminology-vs-version-skew</code> (4 records)</h3>\n<p><strong>What it handles</strong>: <code>$validate-code</code> responses where the only difference is the ValueSet version string in message text and issues details text. Both servers agree on <code>result=false</code> and all other parameters. The difference appears in &quot;not found in the value set &#x27;url|version&#x27;&quot; messages where prod references the newer ValueSet version (e.g., <code>v3-ActEncounterCode|3.0.0</code>) and dev references the older version (e.g., <code>|2014-03-26</code>).</p>\n<p><strong>Normalizes</strong>: ValueSet pipe-delimited version strings in message and issues text to prod&#x27;s values.</p>\n<p><strong>Representative record</strong>: <code>83509e51-1a8b-4d77-8f4e-7b0037009c4a</code> — validate-code for PLB in v3-ActEncounterCode where prod says <code>|3.0.0</code>, dev says <code>|2014-03-26</code>.</p>\n<h3>5. <code>expand-hl7-terminology-version-skew-vs-metadata</code> (3 records)</h3>\n<p><strong>What it handles</strong>: <code>$expand</code> responses where the ValueSet-level metadata fields (date, name, title, version, identifier, language, immutable, meta) differ because prod and dev loaded different editions of the same HL7 terminology ValueSet. The expansion contents are handled by other tolerances (e.g., code intersection), but the wrapper metadata still reflects the different loaded ValueSet versions. For example, TribalEntityUS: prod returns version=4.0.0/name=TribalEntityUS/date=2014-03-26, dev returns version=2018-08-12/name=v3.TribalEntityUS/date=2018-08-12.</p>\n<p><strong>Normalizes</strong>: Dev&#x27;s metadata fields (date, name, title, version, identifier, language, immutable, meta) to prod&#x27;s values.</p>\n<p><strong>Representative record</strong>: <code>2d18564d-4e72-425d-aca0-358240df2c57</code> — expand of v3-TribalEntityUS where all ValueSet metadata differs between versions.</p>\n<h3>6. <code>hl7-terminology-lookup-definition-designation-skew</code> (1 record)</h3>\n<p><strong>What it handles</strong>: <code>$lookup</code> responses for HL7 terminology CodeSystems where dev returns extra top-level <code>definition</code> and <code>designation</code> parameters that prod doesn&#x27;t return. Dev has <code>definition</code> as a top-level parameter (with version-dependent text), while prod returns <code>definition</code> only as a property entry. Dev also includes a <code>designation</code> parameter with <code>preferredForLanguage</code> use that prod omits entirely. Both are consequences of dev loading a newer CodeSystem version with richer content.</p>\n<p><strong>Normalizes</strong>: Strips <code>definition</code> and <code>designation</code> top-level parameters and <code>definition</code> property entries from both sides.</p>\n<p><strong>Representative record</strong>: <code>118efc0f-ad5c-4db9-b9e6-2120a5824b92</code> — lookup of <code>active</code> in <code>condition-clinical</code> where dev (version 3.0.0) returns extra definition and designation, prod (version 4.0.1) returns definition only as a property.</p>\n<h2>Repro</h2>\n<pre><code class=\"lang-bash\"># Prod\ncurl -s &#x27;https://tx.fhir.org/r4/ValueSet/$expand?url=http:%2F%2Fterminology.hl7.org%2FValueSet%2Fv3-TribalEntityUS&amp;incomplete-ok=true&amp;_format=json&#x27; -H &#x27;Accept: application/fhir+json&#x27; | jq &#x27;{version, name, title, date}&#x27;\n\n# Dev\ncurl -s &#x27;https://tx-dev.fhir.org/r4/ValueSet/$expand?url=http:%2F%2Fterminology.hl7.org%2FValueSet%2Fv3-TribalEntityUS&amp;incomplete-ok=true&amp;_format=json&#x27; -H &#x27;Accept: application/fhir+json&#x27; | jq &#x27;{version, name, title, date}&#x27;</code></pre>\n<p>Prod returns <code>version=4.0.0, name=TribalEntityUS</code>, dev returns <code>version=2018-08-12, name=v3.TribalEntityUS</code>.</p>", "impact": null}, {"id": "9f41615", "title": "POST _search with form-encoded body crashes with 500 error", "status": "closed", "labels": ["round:2026-02-round-3", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-11 19:09", "date_iso": "2026-02-11T19:09:34-06:00", "body_md": "## Summary\n\n`POST /r4/CodeSystem/_search` with `Content-Type: application/x-www-form-urlencoded` crashes on the JS server with a 500 error. The form-encoded body is not parsed, so query parameters like `_offset` are undefined.\n\n## Repro\n\n```\ncurl -s -H 'Accept: application/fhir+json' \\\n  -H 'Content-Type: application/x-www-form-urlencoded' \\\n  -d '_count=5' \\\n  'https://tx-dev.fhir.org/r4/CodeSystem/_search'\n```\n\nReturns OperationOutcome with:\n- severity: error\n- diagnostics: \"Cannot read properties of undefined (reading '_offset')\"\n\n## Expected\n\nShould return a search Bundle with 5 entries (same as `GET /r4/CodeSystem?_count=5`).\n\nProduction (Pascal) handles this correctly and returns results.\n\n## Root cause\n\nThe Express app configures `express.raw()` and `express.json()` middleware but not `express.urlencoded()`. The FHIR _search operation requires form-encoded POST bodies per the spec (https://hl7.org/fhir/R4/search.html#Introduction).", "body_html": "<h2>Summary</h2>\n<p><code>POST /r4/CodeSystem/_search</code> with <code>Content-Type: application/x-www-form-urlencoded</code> crashes on the JS server with a 500 error. The form-encoded body is not parsed, so query parameters like <code>_offset</code> are undefined.</p>\n<h2>Repro</h2>\n<pre><code>curl -s -H &#x27;Accept: application/fhir+json&#x27; \\\n  -H &#x27;Content-Type: application/x-www-form-urlencoded&#x27; \\\n  -d &#x27;_count=5&#x27; \\\n  &#x27;https://tx-dev.fhir.org/r4/CodeSystem/_search&#x27;</code></pre>\n<p>Returns OperationOutcome with:</p>\n<ul><li>severity: error</li><li>diagnostics: &quot;Cannot read properties of undefined (reading &#x27;_offset&#x27;)&quot;</li></ul>\n<h2>Expected</h2>\n<p>Should return a search Bundle with 5 entries (same as <code>GET /r4/CodeSystem?_count=5</code>).</p>\n<p>Production (Pascal) handles this correctly and returns results.</p>\n<h2>Root cause</h2>\n<p>The Express app configures <code>express.raw()</code> and <code>express.json()</code> middleware but not <code>express.urlencoded()</code>. The FHIR _search operation requires form-encoded POST bodies per the spec (<a href=\"https://hl7.org/fhir/R4/search.html#Introduction\" target=\"_blank\">https://hl7.org/fhir/R4/search.html#Introduction</a>).</p>", "impact": null}, {"id": "e3866e4", "title": "_count=0 returns 20 results instead of summary-only response", "status": "closed", "labels": ["round:2026-02-round-3", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-11 19:09", "date_iso": "2026-02-11T19:09:34-06:00", "body_md": "## Summary\n\n`GET /r4/CodeSystem?_count=0` returns 20 entries on the JS server instead of a summary-only response (0 entries). This is because `parseInt(\"0\") || 20` evaluates to `20` in JavaScript since `0` is falsy.\n\n## Repro\n\n```\ncurl -s -H 'Accept: application/fhir+json' 'https://tx-dev.fhir.org/r4/CodeSystem?_count=0'\n```\n\nReturns: Bundle with total=2007 and 20 entries\nExpected: Bundle with total=2007 and 0 entries (summary-only)\n\n## Comparison\n\nProduction (Pascal) also doesn't handle _count=0 per spec — it returns 10 entries (its default). So both servers are wrong, but in different ways.\n\nPer the FHIR spec: \"_count=0 can be used to return only the count and total and not any matches.\"\n\n## Root cause\n\nIn `tx/workers/search.js`, the count parsing is:\n```js\ncount = parseInt(count) || 20\n```\n\nSince `parseInt(\"0\")` returns `0` and `0` is falsy in JS, it falls through to the default of 20. Should use `parseInt(count) ?? 20` or explicit null check.", "body_html": "<h2>Summary</h2>\n<p><code>GET /r4/CodeSystem?_count=0</code> returns 20 entries on the JS server instead of a summary-only response (0 entries). This is because <code>parseInt(&quot;0&quot;) || 20</code> evaluates to <code>20</code> in JavaScript since <code>0</code> is falsy.</p>\n<h2>Repro</h2>\n<pre><code>curl -s -H &#x27;Accept: application/fhir+json&#x27; &#x27;https://tx-dev.fhir.org/r4/CodeSystem?_count=0&#x27;</code></pre>\n<p>Returns: Bundle with total=2007 and 20 entries<br>\nExpected: Bundle with total=2007 and 0 entries (summary-only)</p>\n<h2>Comparison</h2>\n<p>Production (Pascal) also doesn&#x27;t handle _count=0 per spec — it returns 10 entries (its default). So both servers are wrong, but in different ways.</p>\n<p>Per the FHIR spec: &quot;_count=0 can be used to return only the count and total and not any matches.&quot;</p>\n<h2>Root cause</h2>\n<p>In <code>tx/workers/search.js</code>, the count parsing is:</p>\n<pre><code class=\"lang-js\">count = parseInt(count) || 20</code></pre>\n<p>Since <code>parseInt(&quot;0&quot;)</code> returns <code>0</code> and <code>0</code> is falsy in JS, it falls through to the default of 20. Should use <code>parseInt(count) ?? 20</code> or explicit null check.</p>", "impact": null}, {"id": "b839c0e", "title": "Typo \"conplete\" in factory CodeSystem content field (read.js:107)", "status": "closed", "labels": ["round:2026-02-round-3", "tx-compare"], "author": "Claude (AI Assistant)", "date": "2026-02-11 19:16", "date_iso": "2026-02-11T19:16:28-06:00", "body_md": "## Summary\n\nIn `tx/workers/read.js` line 107, the factory CodeSystem content value is set to `\"conplete\"` instead of `\"complete\"`. This affects all iterable factory CodeSystems (e.g., `x-us-states`).\n\n## Repro\n\n```\ncurl -s -H 'Accept: application/fhir+json' 'https://tx-dev.fhir.org/r4/CodeSystem/x-us-states' | jq .content\n```\n\nReturns: `\"conplete\"`\nExpected: `\"complete\"`\n\n## Notes\n\n- Production (Pascal) returns 404 for factory CodeSystem reads — this is a JS-only feature, so no prod comparison available.\n- `\"conplete\"` is not a valid FHIR CodeSystem content code. Valid values: not-present, example, fragment, complete, supplement.", "body_html": "<h2>Summary</h2>\n<p>In <code>tx/workers/read.js</code> line 107, the factory CodeSystem content value is set to <code>&quot;conplete&quot;</code> instead of <code>&quot;complete&quot;</code>. This affects all iterable factory CodeSystems (e.g., <code>x-us-states</code>).</p>\n<h2>Repro</h2>\n<pre><code>curl -s -H &#x27;Accept: application/fhir+json&#x27; &#x27;https://tx-dev.fhir.org/r4/CodeSystem/x-us-states&#x27; | jq .content</code></pre>\n<p>Returns: <code>&quot;conplete&quot;</code><br>\nExpected: <code>&quot;complete&quot;</code></p>\n<h2>Notes</h2>\n<ul><li>Production (Pascal) returns 404 for factory CodeSystem reads — this is a JS-only feature, so no prod comparison available.</li><li><code>&quot;conplete&quot;</code> is not a valid FHIR CodeSystem content code. Valid values: not-present, example, fragment, complete, supplement.</li></ul>", "impact": null}];
const STATS = {"total": 102, "open": 67, "closed": 35, "labels": {"content-differs": 65, "reproduced": 82, "round:2026-02-round-2": 45, "tx-compare": 102, "code-defect": 8, "status-mismatch": 11, "result-disagrees": 8, "round:2026-02-round-3": 14, "dev-crash-on-error": 2, "round:2026-02-round-1": 49, "repro-inconclusive": 8, "config-issue": 5, "dev-crash-on-valid": 3, "missing-resource": 3, "no-repro-needed": 1, "version-skew": 1, "wont-fix": 1, "P3": 1, "not-reproduced": 5, "P6": 5, "P4": 1, "to-discuss": 3, "won't-fix": 4}, "sortedLabels": ["tx-compare", "reproduced", "content-differs", "round:2026-02-round-1", "round:2026-02-round-2", "round:2026-02-round-3", "status-mismatch", "code-defect", "result-disagrees", "repro-inconclusive", "config-issue", "not-reproduced", "P6", "won't-fix", "dev-crash-on-valid", "missing-resource", "to-discuss", "dev-crash-on-error", "no-repro-needed", "version-skew", "wont-fix", "P3", "P4"], "job": {"total": 9206, "matchedPerfectly": 0, "matchedEquiv": 4360, "knownIssues": 3504, "untriaged": 1342}, "defaultRoundLabel": "round:2026-02-round-3"};

document.getElementById("gen-time").textContent = new Date().toLocaleString();

// Pipeline overview bar
(function() {
  const job = STATS.job;
  if (!job) return;
  const bar = document.getElementById("pipeline-bar");
  const segs = [
    { value: job.matchedPerfectly, label: "matched perfectly", cls: "seg-perfect" },
    { value: job.matchedEquiv, label: "considered equivalent by Claude", cls: "seg-equiv" },
    { value: job.knownIssues, label: "considered mismatches by Claude; bugs listed below", cls: "seg-known" },
    { value: job.untriaged, label: "untriaged", cls: "seg-untriaged" },
  ];
  const total = job.total;
  let html = "";
  for (const s of segs) {
    if (s.value === 0) continue;
    const pct = (s.value / total * 100);
    html += `<div class="pipeline-seg ${s.cls}" style="flex:${s.value}">
      <span class="seg-value">${s.value.toLocaleString()}</span>
      <span class="seg-label">${s.label}</span>
    </div>`;
  }
  bar.innerHTML = html;
})();

// Stats bar
(function() {
  const bar = document.getElementById("stats-bar");
  let html = `<div class="stat"><span class="stat-value">${STATS.total}</span> bugs total</div>`;
  html += `<div class="stat-divider"></div>`;
  html += `<div class="stat"><span class="stat-value" style="color:var(--status-open-fg)">${STATS.open}</span> open</div>`;
  html += `<div class="stat"><span class="stat-value">${STATS.closed}</span> closed</div>`;
  bar.innerHTML = html;
})();

// Label filter pills
(function() {
  const container = document.getElementById("label-filters");
  let html = "";
  for (const label of STATS.sortedLabels) {
    const c = STATS.labels[label] || 0;
    html += `<span class="filter-pill" data-label="${label}">${label} <span class="count">${c}</span></span>`;
  }
  container.innerHTML = html;
})();

// State — default round label filter if present
let activeLabels = new Set();
if (STATS.defaultRoundLabel && STATS.labels[STATS.defaultRoundLabel]) {
  activeLabels.add(STATS.defaultRoundLabel);
}
let activeStatus = "open";
let searchQuery = "";
let currentSort = "impact";

function renderBugList() {
  const list = document.getElementById("bug-list");
  // Sort bugs
  const sorted = [...BUGS];
  if (currentSort === "impact") {
    sorted.sort((a, b) => (b.impact || 0) - (a.impact || 0) || a.title.localeCompare(b.title));
  } else if (currentSort === "date") {
    sorted.sort((a, b) => (b.date_iso || "").localeCompare(a.date_iso || ""));
  } else if (currentSort === "title") {
    sorted.sort((a, b) => a.title.localeCompare(b.title));
  }

  let html = "";
  for (const bug of sorted) {
    const statusClass = bug.status === "open" ? "pill-status-open" : "pill-status-closed";
    const labels = bug.labels.map(l => `<span class="pill pill-label" data-label="${l}">${l}</span>`).join("");
    const impactPill = bug.impact ? `<span class="pill pill-impact">${bug.impact.toLocaleString()} records</span>` : "";

    html += `<div class="bug-card" data-status="${bug.status}" data-id="${bug.id}" data-labels="${bug.labels.join(",")}" data-impact="${bug.impact || 0}">
      <div class="bug-header" onclick="toggleBug(this)">
        <svg class="bug-expand-icon" viewBox="0 0 16 16" fill="currentColor">
          <path d="M6.22 3.22a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042L9.94 8 6.22 4.28a.75.75 0 0 1 0-1.06Z"/>
        </svg>
        <div class="bug-info">
          <div class="bug-title">${bug.title}</div>
          <div class="bug-meta">
            <button class="copy-btn" title="Copy title and ID" onclick="event.stopPropagation(); copyBug(this, '${bug.id}')">
              <svg width="12" height="12" viewBox="0 0 16 16" fill="currentColor"><path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"/><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"/></svg>
            </button>
            <span class="pill ${statusClass}">${bug.status}</span>
            ${labels}
            ${impactPill}
            <span class="bug-id">${bug.id}</span>
            <span class="bug-date">updated ${bug.date}</span>
          </div>
        </div>
      </div>
      <div class="bug-body">${bug.body_html}</div>
    </div>`;
  }

  list.innerHTML = html;
  applyFilters();
}

function toggleBug(header) {
  header.parentElement.classList.toggle("expanded");
}

function copyBug(btn, bugId) {
  const bug = BUGS.find(b => b.id === bugId);
  if (!bug) return;
  const text = bug.title + " (" + bugId + ")";
  navigator.clipboard.writeText(text).then(() => {
    btn.classList.add("copied");
    setTimeout(() => btn.classList.remove("copied"), 1500);
  });
}

let allExpanded = false;
function toggleExpandAll() {
  allExpanded = !allExpanded;
  const cards = document.querySelectorAll(".bug-card:not(.hidden)");
  cards.forEach(c => c.classList.toggle("expanded", allExpanded));
  document.getElementById("expand-all-btn").textContent = allExpanded ? "Collapse all" : "Expand all";
}

function applyFilters() {
  const cards = document.querySelectorAll(".bug-card");
  const query = searchQuery.toLowerCase();
  let visibleCount = 0;

  cards.forEach(card => {
    const status = card.dataset.status;
    const cardLabels = card.dataset.labels ? card.dataset.labels.split(",") : [];
    const bugId = card.dataset.id;
    const bug = BUGS.find(b => b.id === bugId);

    let show = true;

    // Label filter: card must have at least one of the active labels.
    // Special case: if a round: label is active, also show bugs with no round: label
    // (those are current-round bugs not yet labeled).
    if (activeLabels.size > 0) {
      const hasMatchingLabel = cardLabels.some(l => activeLabels.has(l));
      const activeRoundLabels = [...activeLabels].filter(l => l.startsWith("round:"));
      const hasNoRoundLabel = !cardLabels.some(l => l.startsWith("round:"));
      if (!hasMatchingLabel && !(activeRoundLabels.length > 0 && hasNoRoundLabel)) {
        show = false;
      }
    }

    if (activeStatus !== "all" && status !== activeStatus) {
      show = false;
    }

    if (query && show && bug) {
      const searchable = (bug.title + " " + bug.body_md + " " + bug.labels.join(" ")).toLowerCase();
      if (!searchable.includes(query)) {
        show = false;
      }
    }

    card.classList.toggle("hidden", !show);
    if (show) visibleCount++;
  });

  document.getElementById("no-results").classList.toggle("hidden", visibleCount > 0);
}

// Search
document.getElementById("search").addEventListener("input", function() {
  searchQuery = this.value;
  applyFilters();
});

// Label filter pills — derive all visuals from activeLabels set
function updatePillVisuals() {
  document.querySelectorAll(".filter-pill[data-label]").forEach(pill => {
    const label = pill.dataset.label;
    if (activeLabels.size === 0) {
      pill.classList.remove("dimmed", "active");
    } else if (activeLabels.has(label)) {
      pill.classList.remove("dimmed");
      pill.classList.add("active");
    } else {
      pill.classList.add("dimmed");
      pill.classList.remove("active");
    }
  });
}

document.querySelectorAll(".filter-pill[data-label]").forEach(pill => {
  pill.addEventListener("click", function() {
    const label = this.dataset.label;
    if (activeLabels.has(label)) {
      activeLabels.delete(label);
    } else {
      activeLabels.add(label);
    }
    updatePillVisuals();
    applyFilters();
  });
});

// Status filter buttons
document.querySelectorAll(".ctrl-btn[data-status]").forEach(btn => {
  btn.addEventListener("click", function() {
    document.querySelectorAll(".ctrl-btn[data-status]").forEach(b => b.classList.remove("active"));
    this.classList.add("active");
    activeStatus = this.dataset.status;
    applyFilters();
  });
});

// Sort buttons
document.querySelectorAll(".sort-btn").forEach(btn => {
  btn.addEventListener("click", function() {
    document.querySelectorAll(".sort-btn").forEach(b => b.classList.remove("active"));
    this.classList.add("active");
    currentSort = this.dataset.sort;
    renderBugList();
  });
});

// Initial render
renderBugList();
updatePillVisuals();
</script>
</body>
</html>